<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>CentOS 7 配置docket | K A I</title><meta name="keywords" content="Web开发"><meta name="author" content="Kaillliu"><meta name="copyright" content="Kaillliu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="CentOS 7 安装 JAVA环境（JDK 1.8）">
<meta property="og:type" content="article">
<meta property="og:title" content="CentOS 7 配置docket">
<meta property="og:url" content="http://kaillliu.github.io/2022/05/09/CentOS%207%E9%85%8D%E7%BD%AEdocket/index.html">
<meta property="og:site_name" content="K A I">
<meta property="og:description" content="CentOS 7 安装 JAVA环境（JDK 1.8）">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/97079772_p0_master1200.jpg">
<meta property="article:published_time" content="2022-05-09T07:32:13.000Z">
<meta property="article:modified_time" content="2022-05-09T07:48:38.011Z">
<meta property="article:author" content="Kaillliu">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Centos">
<meta property="article:tag" content="docket">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/97079772_p0_master1200.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://kaillliu.github.io/2022/05/09/CentOS%207%E9%85%8D%E7%BD%AEdocket/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="manifest" href="/pwa/manifest.json"/><link rel="apple-touch-icon" sizes="180x180" href="/pwa/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/pwa/32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/pwa/16.png"/><link rel="mask-icon" href="/pwa/safari-pinned-tab.svg" color="#5bbad5"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":600},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#263238","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CentOS 7 配置docket',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-09 15:48:38'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/EXKx_vaVAAA9c9Z.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/97079772_p0_master1200.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">K A I</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">CentOS 7 配置docket</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-09T07:32:13.000Z" title="发表于 2022-05-09 15:32:13">2022-05-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-09T07:48:38.011Z" title="更新于 2022-05-09 15:48:38">2022-05-09</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web%E5%BC%80%E5%8F%91/">Web开发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">10.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>40分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="CentOS 7 配置docket"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的容器中,然后发布到任何流行的Linux机器或Windows 机器上,也可以实现虚拟化,容器是完全使用沙箱机制,相互之间不会有任何接口。 Docker简介</p>
</blockquote>
<h2 id="一、Docker-安装">一、Docker 安装</h2>
<h3 id="1、Docker-要求-CentOS-系统的内核版本高于-3-10-，查看本页面的前提条件来验证你的CentOS-版本是否支持-Docker-。通过-uname-r-命令查看你当前的内核版本">1、Docker 要求 CentOS 系统的内核版本高于 3.10 ，查看本页面的前提条件来验证你的CentOS 版本是否支持 Docker 。通过 uname -r 命令查看你当前的内核版本</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -r</span><br></pre></td></tr></table></figure>
<h3 id="2、-使用-root-权限登录-Centos-确保-yum-包更新到最新。">2、(使用 root 权限登录 Centos)确保 yum 包更新到最新。</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum <span class="keyword">update</span></span><br></pre></td></tr></table></figure>
<h3 id="3、卸载旧版本-如果安装过旧版本的话">3、卸载旧版本(如果安装过旧版本的话)</h3>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum <span class="keyword">remove</span> docker  docker-common docker-selinux docker-engine</span><br></pre></td></tr></table></figure>
<h3 id="4、安装需要的软件包，-yum-util-提供yum-config-manager功能，另外两个是devicemapper驱动依赖的">4、安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的</h3>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">sudo</span> yum install -y yum-utils device-mapper-persistent-<span class="class"><span class="keyword">data</span> lvm2</span></span><br></pre></td></tr></table></figure>
<h3 id="5、设置yum源">5、设置yum源</h3>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum-config-manager --add-repo <span class="symbol">https:</span>/<span class="regexp">/download.docker.com/linux</span><span class="regexp">/centos/docker</span>-ce.repo</span><br></pre></td></tr></table></figure>
<h3 id="6、可以查看所有仓库中所有docker版本，并选择特定版本安装">6、可以查看所有仓库中所有docker版本，并选择特定版本安装</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list docker<span class="operator">-</span>ce <span class="comment">--showduplicates | sort -r</span></span><br></pre></td></tr></table></figure>
<h3 id="7、安装docker">7、安装docker</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce</span><br></pre></td></tr></table></figure>
<h3 id="8、启动并加入开机启动">8、启动并加入开机启动</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br><span class="line"></span><br><span class="line">sudo systemctl restart docker    <span class="comment"># 重启 </span></span><br><span class="line"></span><br><span class="line">sudo systemctl status docker <span class="comment">#  查看状态 </span></span><br><span class="line"></span><br><span class="line">sudo systemctl stop docker  <span class="comment"># 停止 </span></span><br><span class="line"></span><br><span class="line">sudo systemctl <span class="built_in">enable</span> docker</span><br></pre></td></tr></table></figure>
<h3 id="9、将用户移动到docker组里">9、将用户移动到docker组里</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -G docker <span class="variable">$USER</span> <span class="comment">//将当前用户添加到docker组中．</span></span><br><span class="line"></span><br><span class="line">docker version <span class="comment"># 查看版本</span></span><br></pre></td></tr></table></figure>
<h2 id="二、docker-基本命令详解">二、docker 基本命令详解</h2>
<h3 id="1-查找镜像">1.查找镜像</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">search</span> nginx</span><br></pre></td></tr></table></figure>
<h3 id="2-拉取镜像">2.拉取镜像</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx</span><br></pre></td></tr></table></figure>
<h3 id="3-运行镜像并进入镜像">3.运行镜像并进入镜像</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run - 运行一个容器 -t - 分配一个（伪）tty (link is external) -i - 交互模式 (so we can interact with it) nginx- 使用 nginx 基础镜像 /bin/bash - 运行命令 bash shell</span><br><span class="line">docker run -i -t nginx /bin/bash</span><br></pre></td></tr></table></figure>
<h3 id="4-docker-命令帮助">4.docker 命令帮助</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">docker   <span class="comment"># docker 命令帮助</span></span><br><span class="line">Commands:</span><br><span class="line">    attach  <span class="comment"># 当前 shell 下 attach 连接指定运行镜像</span></span><br><span class="line">    build   <span class="comment"># 通过 Dockerfile 定制镜像</span></span><br><span class="line">    commit  <span class="comment"># 提交当前容器为新的镜像</span></span><br><span class="line">    <span class="built_in">cp</span>      <span class="comment"># 从容器中拷贝指定文件或者目录到宿主机中</span></span><br><span class="line">    create  <span class="comment"># 创建一个新的容器，同 run，但不启动容器</span></span><br><span class="line">    diff    <span class="comment"># 查看 docker 容器变化，检查容器文件系统上文件或目录的更改 A    添加了文件或目录，D  文件或目录已删除，C 文件或目录已更改</span></span><br><span class="line">    events  <span class="comment"># 从 docker 服务获取容器实时事件</span></span><br><span class="line">    <span class="built_in">exec</span>    <span class="comment"># 在已存在的容器上运行命令</span></span><br><span class="line">    <span class="built_in">export</span>  <span class="comment"># 导出容器的内容流作为一个 tar 归档文件[对应 import ]</span></span><br><span class="line">    <span class="built_in">history</span> <span class="comment"># 展示一个镜像形成历史</span></span><br><span class="line">    images  <span class="comment"># 列出系统当前镜像</span></span><br><span class="line">    import  <span class="comment"># 从tar包中的内容创建一个新的文件系统映像[对应 export]</span></span><br><span class="line">    info    <span class="comment"># 显示系统相关信息</span></span><br><span class="line">    inspect <span class="comment"># 查看容器详细信息</span></span><br><span class="line">    <span class="built_in">kill</span>    <span class="comment"># kill 指定 docker 容器</span></span><br><span class="line">    load    <span class="comment"># 从一个 tar 包中加载一个镜像[对应 save]</span></span><br><span class="line">    login   <span class="comment"># 注册或者登陆一个 docker 源服务器</span></span><br><span class="line">    <span class="built_in">logout</span>  <span class="comment"># 从当前 Docker registry 退出</span></span><br><span class="line">    logs    <span class="comment"># 输出当前容器日志信息 -f 动态查看</span></span><br><span class="line">    port    <span class="comment"># 查看映射端口对应的容器内部源端口</span></span><br><span class="line">    pause   <span class="comment"># 暂停容器</span></span><br><span class="line">    ps      <span class="comment"># 列出容器列表</span></span><br><span class="line">    pull    <span class="comment"># 从docker镜像源服务器拉取指定镜像或者库镜像</span></span><br><span class="line">    push    <span class="comment"># 推送指定镜像或者库镜像至docker源服务器</span></span><br><span class="line">    restart <span class="comment"># 重启运行的容器</span></span><br><span class="line">    <span class="built_in">rm</span>      <span class="comment"># 移除一个或者多个容器</span></span><br><span class="line">    rmi     <span class="comment"># 移除一个或多个镜像[无容器使用该镜像才可删除，否则需删除相关容器才可继续或 -f 强制删除]</span></span><br><span class="line">    run     <span class="comment"># 创建一个新的容器并运行一个命令</span></span><br><span class="line">    save    <span class="comment"># 保存一个镜像为一个 tar 包[对应 load]</span></span><br><span class="line">    search  <span class="comment"># 在 docker hub 中搜索镜像</span></span><br><span class="line">    start   <span class="comment"># 启动容器</span></span><br><span class="line">    stop    <span class="comment"># 停止容器</span></span><br><span class="line">    tag     <span class="comment"># 给源中镜像打标签</span></span><br><span class="line">    top     <span class="comment"># 查看容器中运行的进程信息</span></span><br><span class="line">    unpause <span class="comment"># 取消暂停容器</span></span><br><span class="line">    version <span class="comment"># 查看 docker 版本号</span></span><br><span class="line">    <span class="built_in">wait</span>    <span class="comment"># 截取容器停止时的退出状态值</span></span><br></pre></td></tr></table></figure>
<h3 id="5-docker-option">5. docker option</h3>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Usage</span> <span class="keyword">of</span> docker:</span><br><span class="line">  <span class="comment">--api-enable-cors=false  # 远程 API 中开启 CORS 头</span></span><br><span class="line">  -b, <span class="comment">--bridge=&quot;&quot;   # 桥接网络use &#x27;none&#x27; to disable container networking</span></span><br><span class="line">  <span class="comment">--bip=&quot;&quot;    # 和 -b 选项不兼容，具体没有测试过</span></span><br><span class="line">  -d, <span class="comment">--daemon=false   # daemon 模式</span></span><br><span class="line">  -<span class="type">D</span>, <span class="comment">--debug=false   # debug 模式</span></span><br><span class="line">  <span class="comment">--dns=[]    # 强制 docker 使用指定 dns 服务器</span></span><br><span class="line">  <span class="comment">--dns-search=[]   # 强制 docker 使用指定 dns 搜索域</span></span><br><span class="line">  -e, <span class="comment">--exec-driver=&quot;native&quot;  # 强制 docker 运行时使用指定执行驱动器</span></span><br><span class="line">  <span class="comment">--fixed-cidr=&quot;&quot;            IPv4 subnet for fixed IPs (ex: 10.20.0.0/16)this subnet must be nested in the bridge subnet (which is defined by -b or --bip)</span></span><br><span class="line">  -<span class="type">G</span>, <span class="comment">--group=&quot;docker&quot;       Group to assign the unix socket specified by -H when running in daemon mode</span></span><br><span class="line"></span><br><span class="line">  use &#x27;&#x27; (the empty string) to disable setting <span class="keyword">of</span> a group</span><br><span class="line">  -g, <span class="comment">--graph=&quot;/var/lib/docker&quot;  # 容器运行的根目录路径</span></span><br><span class="line">  -<span class="type">H</span>, <span class="comment">--host=[] # daemon 模式下 docker 指定绑定方式[tcp or 本地 socket]</span></span><br><span class="line">  specified using one or more tcp://host:port, unix:///path/to/socket, fd://* or fd://socketfd.</span><br><span class="line">  <span class="comment">--icc=true  # 跨容器通信</span></span><br><span class="line">  <span class="comment">--insecure-registry=[]                 Enable insecure communication with specified registries (no certificate verification for HTTPS and enable HTTP fallback) (e.g., localhost:5000 or 10.20.0.0/16)</span></span><br><span class="line">  <span class="comment">--ip=&quot;0.0.0.0&quot;   # 指定监听地址，默认所有 ip</span></span><br><span class="line">  <span class="comment">--ip-forward=true  # 开启转发</span></span><br><span class="line">  <span class="comment">--ip-masq=true         Enable IP masquerading for bridge&#x27;s IP range</span></span><br><span class="line">  <span class="comment">--iptables=true   # 添加对应 iptables 规则</span></span><br><span class="line">  <span class="comment">--mtu=0        # 设置网络 mtu</span></span><br><span class="line">  <span class="keyword">if</span> no value is provided: <span class="keyword">default</span> to the <span class="keyword">default</span> route <span class="type">MTU</span> or 1500 if no <span class="keyword">default</span> route is available</span><br><span class="line">  -p, <span class="comment">--pidfile=&quot;/var/run/docker.pid&quot;    # 指定 pid 文件位置</span></span><br><span class="line">  <span class="comment">--registry-mirror=[]        Specify a preferred Docker registry mirror                  </span></span><br><span class="line">  -s, <span class="comment">--storage-driver=&quot;&quot;    # 强制 docker 运行时使用指定存储驱动</span></span><br><span class="line">  <span class="comment">--selinux-enabled=false     # 开启 selinux 支持</span></span><br><span class="line">  <span class="comment">--storage-opt=[]           # 设置存储驱动选项</span></span><br><span class="line">  <span class="comment">--tls=false               # 开启 tls</span></span><br><span class="line">  <span class="comment">--tlscacert=&quot;/root/.docker/ca.pem&quot;     Trust only remotes providing a certificate signed by the CA given here</span></span><br><span class="line">  <span class="comment">--tlscert=&quot;/root/.docker/cert.pem&quot;    # tls 证书文件位置</span></span><br><span class="line">  <span class="comment">--tlskey=&quot;/root/.docker/key.pem&quot;       # tls key 文件位置</span></span><br><span class="line">  <span class="comment">--tlsverify=false                      # 使用 tls 并确认远程控制主机</span></span><br><span class="line">  -v, <span class="comment">--version=false            # 输出 docker 版本信息</span></span><br></pre></td></tr></table></figure>
<h3 id="6-docker-run">6.docker run</h3>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">docker run --help</span><br><span class="line"><span class="symbol">Usage:</span> docker run [<span class="variable constant_">OPTIONS</span>] <span class="variable constant_">IMAGE</span> [<span class="variable constant_">COMMAND</span>] [<span class="variable constant_">ARG</span>...] Run a command <span class="keyword">in</span> a new container</span><br><span class="line">  -a, --attach=[] Attach to stdin, stdout <span class="keyword">or</span> stderr.</span><br><span class="line">  -c, --cpu-shares=<span class="number">0</span> <span class="comment"># 设置 cpu 使用权重 --cap-add=[] Add Linux capabilities</span></span><br><span class="line">  --cap-drop=[] Drop Linux capabilities</span><br><span class="line">  --cidfile=<span class="string">&quot;&quot;</span>  <span class="comment"># 把容器 id 写入到指定文件 </span></span><br><span class="line">  --cpuset=<span class="string">&quot;&quot;</span> <span class="comment"># cpu 绑定 -d, --detach=false Detached mode: Run container in the background, print new container id # 后台运行容器 </span></span><br><span class="line">  --device=[] Add a host device to the container (e.g. --device=<span class="regexp">/dev/sdc</span><span class="symbol">:/dev/xvdc</span>) </span><br><span class="line">  --dns=[]  <span class="comment"># 设置 dns </span></span><br><span class="line">  --dns-search=[]  <span class="comment"># 设置 dns 域搜索 </span></span><br><span class="line">  -e, --env=[] <span class="comment"># 定义环境变量 </span></span><br><span class="line">  --entrypoint=<span class="string">&quot;&quot;</span> Overwrite the default entrypoint of the image <span class="comment"># ？ </span></span><br><span class="line">  --env-file=[] <span class="comment"># 从指定文件读取变量值 </span></span><br><span class="line">  --expose=[] <span class="comment"># 指定对外提供服务端口 </span></span><br><span class="line">  -h, --hostname=<span class="string">&quot;&quot;</span>  <span class="comment"># 设置容器主机名 </span></span><br><span class="line">  -i, --interactive=<span class="literal">false</span> <span class="comment"># 保持标准输出开启即使没有 attached </span></span><br><span class="line">  --link=[]  <span class="comment"># 添加链接到另外一个容器 </span></span><br><span class="line">  --lxc-conf=[] (lxc exec-driver only) Add custom lxc options </span><br><span class="line">  --lxc-conf=<span class="string">&quot;lxc.cgroup.cpuset.cpus = 0,1&quot;</span> </span><br><span class="line">  -m, --memory=<span class="string">&quot;&quot;</span> <span class="comment"># 内存限制 </span></span><br><span class="line">  --name=<span class="string">&quot;&quot;</span>  <span class="comment"># 设置容器名 </span></span><br><span class="line">  --net=<span class="string">&quot;bridge&quot;</span>  <span class="comment"># 设置容器网络模式 &#x27;bridge&#x27;: creates a new network stack for the container on the docker bridge &#x27;none&#x27;: no networking for this container &#x27;container:&lt;name|id&gt;&#x27;: reuses another container network stack &#x27;host&#x27;: use the host network stack inside the container.  Note: the host mode gives the container full access to local system services such as D-bus and is therefore considered insecure.</span></span><br><span class="line">  -P, --publish-all=<span class="literal">false</span>  <span class="comment"># 自动映射容器对外提供服务的端口 </span></span><br><span class="line">  -p, --publish=[] <span class="comment"># 指定端口映射  format: ip:hostPort:containerPort | ip::containerPort | hostPort:containerPort  (use &#x27;docker port&#x27; to see the actual mapping) </span></span><br><span class="line">  --privileged=<span class="literal">false</span>  <span class="comment"># 提供更多的权限给容器 </span></span><br><span class="line">  --restart=<span class="string">&quot;&quot;</span> Restart policy to apply <span class="keyword">when</span> a container exits (no, on-failure[<span class="symbol">:max-retry</span>], always) </span><br><span class="line">  --rm=<span class="literal">false</span> <span class="comment"># 如果容器退出自动移除和 -d 选项冲突 --security-opt=[] Security Options</span></span><br><span class="line">  --sig-proxy=<span class="literal">true</span> Proxify received signals to the process (even <span class="keyword">in</span> non-tty mode). <span class="variable constant_">SIGCHLD</span> is <span class="keyword">not</span> proxied.</span><br><span class="line">  -t, --tty=<span class="literal">false</span>  <span class="comment"># 分配伪终端 </span></span><br><span class="line">  -u, --user=<span class="string">&quot;&quot;</span>  <span class="comment"># 指定运行容器的用户 uid 或者用户名 </span></span><br><span class="line">  -v, --volume=[]  <span class="comment"># 挂载卷 </span></span><br><span class="line">  --volumes-from=[] <span class="comment"># 从指定容器挂载卷 </span></span><br><span class="line">  -w, --workdir=<span class="string">&quot;&quot;</span>  <span class="comment"># 指定容器工作目录</span></span><br></pre></td></tr></table></figure>
<h3 id="7-命令举例">7.命令举例</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">docker ps：列出运行中的容器</span><br><span class="line">docker ps -a ：列出所有的容器</span><br><span class="line">docker stop 容器<span class="built_in">id</span>：停止容器</span><br><span class="line">docker <span class="built_in">kill</span> 容器<span class="built_in">id</span>：强制停止容器</span><br><span class="line">docker start 容器<span class="built_in">id</span>：启动已停止的容器</span><br><span class="line">docker inspect 容器<span class="built_in">id</span>：查看容器的所有信息</span><br><span class="line">docker container logs 容器<span class="built_in">id</span>：查看容器日志</span><br><span class="line">docker top 容器<span class="built_in">id</span>：查看容器里的进程</span><br><span class="line">docker <span class="built_in">exec</span> -it 容器<span class="built_in">id</span> /bin/bash：进入容器</span><br><span class="line"><span class="built_in">exit</span>：退出容器</span><br><span class="line">docker <span class="built_in">rm</span> 容器<span class="built_in">id</span>：删除已停止的容器</span><br><span class="line">docker <span class="built_in">rm</span> -f 容器<span class="built_in">id</span>：删除正在运行的容器</span><br></pre></td></tr></table></figure>
<h2 id="三、docker安装镜像并挂载目录文件">三、docker安装镜像并挂载目录文件</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">以nginx为例：</span><br></pre></td></tr></table></figure>
<h3 id="1-在Docker下载Nginx镜像">1.在Docker下载Nginx镜像</h3>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx <span class="comment">##拉取镜像</span></span><br><span class="line">docker images <span class="comment">##查看镜像</span></span><br></pre></td></tr></table></figure>
<h3 id="2-创建挂载目录">2.创建挂载目录</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> nginx</span><br><span class="line"><span class="built_in">cd</span> nginx</span><br><span class="line"><span class="built_in">mkdir</span> conf.d logs html</span><br></pre></td></tr></table></figure>
<h3 id="3-挂载并启动nginx">3.挂载并启动nginx</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">命令说明： –privileged=true 配置了nginx.conf的外部挂载 之后可能导致nginx不能启动，使用该命令； -v /home/dabing/conf.d/default.conf:/etc/nginx/conf.d/default.conf 挂载默认配置文件 -v /home/dabing/conf/nginx.conf:/etc/nginx/nginx.conf 挂载nginx.conf文件 -v /home/dabing/logs:/var/log/nginx 挂载日志目录 -v /home/dabing/html:/usr/share/nginx/html 挂载html目录</span><br><span class="line">docker run -p 80:80 --name nginx1 --privileged=true -v /home/dabing/nginx/html:/usr/share/nginx/html -v /home/dabing/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /home/dabing/nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf -v /home/dabing/nginx/logs:/var/log/nginx -d nginx</span><br></pre></td></tr></table></figure>
<h3 id="4-docker进入容器">4.docker进入容器</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it 775c7c9ee1e1 /<span class="built_in">bin</span>/bash</span><br></pre></td></tr></table></figure>
<h2 id="四、Dockerfile">四、Dockerfile</h2>
<blockquote>
<p>Dockerfile是一个包含用于组合映像的命令的文本文档。可以使用在命令行中调用任何命令。 Docker通过读取Dockerfile中的指令自动生成映像。</p>
</blockquote>
<h3 id="1-docker-build命令用于从Dockerfile构建映像。可以在docker-build命令中使用-f标志指向文件系统中任何位置的Dockerfile。">1.docker build命令用于从Dockerfile构建映像。可以在docker build命令中使用-f标志指向文件系统中任何位置的Dockerfile。</h3>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f /path/<span class="selector-tag">to</span>/<span class="selector-tag">a</span>/Dockerfile</span><br></pre></td></tr></table></figure>
<h3 id="2-Dockerfile的基本结构">2.Dockerfile的基本结构</h3>
<p>Dockerfile 一般分为四部分：基础镜像信息、维护者信息、镜像操作指令和容器启动时执行指令，’#’ 为 Dockerfile 中的注释。</p>
<h3 id="3-Dockerfile文件说明">3.Dockerfile文件说明</h3>
<p>Docker以从上到下的顺序运行Dockerfile的指令。为了指定基本映像，第一条指令必须是FROM。一个声明以＃字符开头则被视为注释。可以在Docker文件中使用RUN，CMD，FROM，EXPOSE，ENV等指令。</p>
<h3 id="1-FROM：指定基础镜像，必须为第一个命令">1.FROM：指定基础镜像，必须为第一个命令</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">格式：</span><br><span class="line">　　FROM <span class="tag">&lt;<span class="name">image</span>&gt;</span></span><br><span class="line">　　FROM <span class="tag">&lt;<span class="name">image</span>&gt;</span>:<span class="tag">&lt;<span class="name">tag</span>&gt;</span></span><br><span class="line">　　FROM <span class="tag">&lt;<span class="name">image</span>&gt;</span>@<span class="tag">&lt;<span class="name">digest</span>&gt;</span></span><br><span class="line">示例：</span><br><span class="line">　　FROM mysql:5.7</span><br><span class="line">注：</span><br><span class="line">　　tag或digest是可选的，如果不使用这两个值时，会使用latest版本的基础镜像</span><br></pre></td></tr></table></figure>
<h3 id="2-MAINTAINER-维护者信息">2.MAINTAINER: 维护者信息</h3>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">格式：</span><br><span class="line">    <span class="variable constant_">MAINTAINER</span> &lt;name&gt;</span><br><span class="line">示例：</span><br><span class="line">    <span class="variable constant_">MAINTAINER</span> Jasper Xu</span><br><span class="line">    <span class="variable constant_">MAINTAINER</span> sorex<span class="variable">@163</span>.com</span><br><span class="line">    <span class="variable constant_">MAINTAINER</span> Jasper Xu &lt;sorex<span class="variable">@163</span>.com&gt;</span><br></pre></td></tr></table></figure>
<h3 id="3-RUN：构建镜像时执行的命令">3.RUN：构建镜像时执行的命令</h3>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">RUN用于在镜像容器中执行命令，其有以下两种命令执行方式：</span><br><span class="line">shell执行</span><br><span class="line">格式：</span><br><span class="line">    RUN &lt;command&gt;</span><br><span class="line">exec执行</span><br><span class="line">格式：</span><br><span class="line">    RUN <span class="selector-attr">[<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span></span><br><span class="line">示例：</span><br><span class="line">    RUN <span class="selector-attr">[<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span></span><br><span class="line">    RUN apk update</span><br><span class="line">    RUN <span class="selector-attr">[<span class="string">&quot;/etc/execfile&quot;</span>, <span class="string">&quot;arg1&quot;</span>, <span class="string">&quot;arg1&quot;</span>]</span></span><br><span class="line">注：</span><br><span class="line">　　RUN指令创建的中间镜像会被缓存，并会在下次构建中使用。如果不想使用这些缓存镜像，可以在构建时指定<span class="attr">--no-cache</span>参数，如：docker build <span class="attr">--no-cache</span></span><br></pre></td></tr></table></figure>
<h3 id="4-ADD：将本地文件添加到容器中，tar类型文件会自动解压-网络压缩资源不会被解压-，可以访问网络资源，类似wget">4.ADD：将本地文件添加到容器中，tar类型文件会自动解压(网络压缩资源不会被解压)，可以访问网络资源，类似wget</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">格式：</span><br><span class="line">    <span class="keyword">ADD</span> <span class="operator">&lt;</span>src<span class="operator">&gt;</span>... <span class="operator">&lt;</span>dest<span class="operator">&gt;</span></span><br><span class="line">    <span class="keyword">ADD</span> [&quot;&lt;src&gt;&quot;,... &quot;&lt;dest&gt;&quot;] 用于支持包含空格的路径</span><br><span class="line">示例：</span><br><span class="line">    <span class="keyword">ADD</span> hom<span class="operator">*</span> <span class="operator">/</span>mydir<span class="operator">/</span>          # 添加所有以&quot;hom&quot;开头的文件</span><br><span class="line">    <span class="keyword">ADD</span> hom?.txt <span class="operator">/</span>mydir<span class="operator">/</span>      # ? 替代一个单字符,例如：&quot;home.txt&quot;</span><br><span class="line">    <span class="keyword">ADD</span> test relativeDir<span class="operator">/</span>     # 添加 &quot;test&quot; 到 `WORKDIR`<span class="operator">/</span>relativeDir<span class="operator">/</span></span><br><span class="line">    <span class="keyword">ADD</span> test <span class="operator">/</span>absoluteDir<span class="operator">/</span>    # 添加 &quot;test&quot; 到 <span class="operator">/</span>absoluteDir<span class="operator">/</span></span><br></pre></td></tr></table></figure>
<h3 id="5-COPY：功能类似ADD，但是是不会自动解压文件，也不能访问网络资源">5.COPY：功能类似ADD，但是是不会自动解压文件，也不能访问网络资源</h3>
<h3 id="6-CMD：构建容器后调用，也就是在容器启动时才进行调用。">6.CMD：构建容器后调用，也就是在容器启动时才进行调用。</h3>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">格式：</span><br><span class="line">    <span class="built_in">CMD</span> [<span class="string">&quot;executable&quot;</span>,<span class="string">&quot;param1&quot;</span>,<span class="string">&quot;param2&quot;</span>] (执行可执行文件，优先)</span><br><span class="line">    <span class="built_in">CMD</span> [<span class="string">&quot;param1&quot;</span>,<span class="string">&quot;param2&quot;</span>] (设置了ENTRYPOINT，则直接调用ENTRYPOINT添加参数)</span><br><span class="line">    <span class="built_in">CMD</span> command param1 param2 (执行shell内部命令)</span><br><span class="line">示例：</span><br><span class="line">    <span class="built_in">CMD</span> echo <span class="string">&quot;This is a test.&quot;</span> | wc -</span><br><span class="line">    <span class="built_in">CMD</span> [<span class="string">&quot;/usr/bin/wc&quot;</span>,<span class="string">&quot;--help&quot;</span>]</span><br><span class="line">注：</span><br><span class="line"> 　　<span class="built_in">CMD</span>不同于RUN，<span class="built_in">CMD</span>用于指定在容器启动时所要执行的命令，而RUN用于指定镜像构建时所要执行的命令。</span><br></pre></td></tr></table></figure>
<h3 id="7-ENTRYPOINT：配置容器，使其可执行化。配合CMD可省去-application-，只使用参数。">7.ENTRYPOINT：配置容器，使其可执行化。配合CMD可省去&quot;application&quot;，只使用参数。</h3>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">格式：</span><br><span class="line">    ENTRYPOINT <span class="selector-attr">[<span class="string">&quot;executable&quot;</span>, <span class="string">&quot;param1&quot;</span>, <span class="string">&quot;param2&quot;</span>]</span> (可执行文件, 优先)</span><br><span class="line">    ENTRYPOINT command param1 param2 (shell内部命令)</span><br><span class="line">示例：</span><br><span class="line">    <span class="selector-tag">FROM</span> ubuntu</span><br><span class="line">    ENTRYPOINT <span class="selector-attr">[<span class="string">&quot;top&quot;</span>, <span class="string">&quot;-b&quot;</span>]</span></span><br><span class="line">    CMD <span class="selector-attr">[<span class="string">&quot;-c&quot;</span>]</span></span><br><span class="line">注：</span><br><span class="line">　　　ENTRYPOINT与CMD非常类似，不同的是通过docker run执行的命令不会覆盖ENTRYPOINT，而docker run命令中指定的任何参数，都会被当做参数再次传递给ENTRYPOINT。Dockerfile中只允许有一个ENTRYPOINT命令，多指定时会覆盖前面的设置，而只执行最后的ENTRYPOINT指令。</span><br></pre></td></tr></table></figure>
<h3 id="8-LABEL：用于为镜像添加元数据">8.LABEL：用于为镜像添加元数据</h3>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">格式：</span><br><span class="line">    LABEL &lt;<span class="keyword">key</span>&gt;=&lt;value&gt; &lt;<span class="keyword">key</span>&gt;=&lt;value&gt; &lt;<span class="keyword">key</span>&gt;=&lt;value&gt; ...</span><br><span class="line">示例：</span><br><span class="line">　　LABEL version=<span class="string">&quot;1.0&quot;</span> description=<span class="string">&quot;这是一个Web服务器&quot;</span> <span class="keyword">by</span>=<span class="string">&quot;IT笔录&quot;</span></span><br><span class="line">注：</span><br><span class="line">　　使用LABEL指定元数据时，一条LABEL指定可以指定一或多条元数据，指定多条元数据时不同元数据之间通过空格分隔。推荐将所有的元数据通过一条LABEL指令指定，以免生成过多的中间镜像。</span><br></pre></td></tr></table></figure>
<h3 id="9-ENV：设置环境变量">9.ENV：设置环境变量</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">格式：</span><br><span class="line">    ENV <span class="tag">&lt;<span class="name">key</span>&gt;</span> <span class="tag">&lt;<span class="name">value</span>&gt;</span>  #<span class="tag">&lt;<span class="name">key</span>&gt;</span>之后的所有内容均会被视为其<span class="tag">&lt;<span class="name">value</span>&gt;</span>的组成部分，因此，一次只能设置一个变量</span><br><span class="line">    ENV <span class="tag">&lt;<span class="name">key</span>&gt;</span>=<span class="tag">&lt;<span class="name">value</span>&gt;</span> ...  #可以设置多个变量，每个变量为一个&quot;<span class="tag">&lt;<span class="name">key</span>&gt;</span>=<span class="tag">&lt;<span class="name">value</span>&gt;</span>&quot;的键值对，如果<span class="tag">&lt;<span class="name">key</span>&gt;</span>中包含空格，可以使用来进行转义，也可以通过&quot;&quot;来进行标示；另外，反斜线也可以用于续行</span><br><span class="line">示例：</span><br><span class="line">    ENV myName John Doe</span><br><span class="line">    ENV myDog Rex The Dog</span><br><span class="line">    ENV myCat=fluffy</span><br></pre></td></tr></table></figure>
<h3 id="10-EXPOSE：指定于外界交互的端口">10.EXPOSE：指定于外界交互的端口</h3>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">格式：</span><br><span class="line">    EXPOSE &lt;port&gt; <span class="selector-attr">[&lt;port&gt;...]</span></span><br><span class="line">示例：</span><br><span class="line">    EXPOSE <span class="number">80</span> <span class="number">443</span></span><br><span class="line">    EXPOSE <span class="number">8080</span></span><br><span class="line">    EXPOSE <span class="number">11211</span>/tcp <span class="number">11211</span>/udp</span><br><span class="line">注：</span><br><span class="line">　　EXPOSE并不会让容器的端口访问到主机。要使其可访问，需要在docker run运行容器时通过-<span class="selector-tag">p</span>来发布这些端口，或通过-<span class="selector-tag">P</span>参数来发布EXPOSE导出的所有端口</span><br></pre></td></tr></table></figure>
<h3 id="11-VOLUME：用于指定持久化目录">11.VOLUME：用于指定持久化目录</h3>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">格式：</span><br><span class="line">    <span class="variable constant_">VOLUME</span> [<span class="string">&quot;/path/to/dir&quot;</span>]</span><br><span class="line">示例：</span><br><span class="line">    <span class="variable constant_">VOLUME</span> [<span class="string">&quot;/data&quot;</span>]</span><br><span class="line">    <span class="variable constant_">VOLUME</span> [<span class="string">&quot;/var/www&quot;</span>, <span class="string">&quot;/var/log/apache2&quot;</span>, <span class="string">&quot;/etc/apache2&quot;</span></span><br><span class="line">注：</span><br><span class="line">　　一个卷可以存在于一个或多个容器的指定目录，该目录可以绕过联合文件系统，并具有以下功能：</span><br><span class="line"><span class="number">1</span> 卷可以容器间共享和重用</span><br><span class="line"><span class="number">2</span> 容器并不一定要和其它容器共享卷</span><br><span class="line"><span class="number">3</span> 修改卷后会立即生效</span><br><span class="line"><span class="number">4</span> 对卷的修改不会对镜像产生影响</span><br><span class="line"><span class="number">5</span> 卷会一直存在，直到没有任何容器在使用它</span><br></pre></td></tr></table></figure>
<h3 id="12-WORKDIR：工作目录，类似于cd命令">12.WORKDIR：工作目录，类似于cd命令</h3>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">格式：</span><br><span class="line">    WORKDIR /path/<span class="selector-tag">to</span>/workdir</span><br><span class="line">示例：</span><br><span class="line">    WORKDIR /<span class="selector-tag">a</span>  (这时工作目录为/<span class="selector-tag">a</span>)</span><br><span class="line">    WORKDIR <span class="selector-tag">b</span>  (这时工作目录为/<span class="selector-tag">a</span>/<span class="selector-tag">b</span>)</span><br><span class="line">    WORKDIR c  (这时工作目录为/<span class="selector-tag">a</span>/<span class="selector-tag">b</span>/c)</span><br><span class="line">注：</span><br><span class="line">　　通过WORKDIR设置工作目录后，Dockerfile中其后的命令RUN、CMD、ENTRYPOINT、ADD、COPY等命令都会在该目录下执行。在使用docker run运行容器时，可以通过-w参数覆盖构建时所设置的工作目录。</span><br></pre></td></tr></table></figure>
<h3 id="13-USER-指定运行容器时的用户名或-UID，后续的-RUN-也会使用指定用户。使用USER指定用户时，可以使用用户名、UID或GID，或是两者的组合。当服务不需要管理员权限时，可以通过该命令指定运行用户。并且可以在之前创建所需要的用户">13.USER:指定运行容器时的用户名或 UID，后续的 RUN 也会使用指定用户。使用USER指定用户时，可以使用用户名、UID或GID，或是两者的组合。当服务不需要管理员权限时，可以通过该命令指定运行用户。并且可以在之前创建所需要的用户</h3>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">格式:</span><br><span class="line">　　<span class="keyword">USER</span> <span class="keyword">user</span></span><br><span class="line">　　<span class="keyword">USER</span> <span class="keyword">user</span>:<span class="keyword">group</span></span><br><span class="line">　　<span class="keyword">USER</span> uid</span><br><span class="line">　　<span class="keyword">USER</span> uid:gid</span><br><span class="line">　　<span class="keyword">USER</span> <span class="keyword">user</span>:gid</span><br><span class="line">　　<span class="keyword">USER</span> uid:<span class="keyword">group</span></span><br><span class="line"> 示例：</span><br><span class="line">　　<span class="keyword">USER</span> www</span><br><span class="line"> 注：</span><br><span class="line">　　使用<span class="keyword">USER</span>指定用户后，Dockerfile中其后的命令RUN、CMD、ENTRYPOINT都将使用该用户。镜像构建完成后，通过docker run运行容器时，可以通过<span class="operator">-</span>u参数来覆盖所指定的用户。</span><br></pre></td></tr></table></figure>
<h3 id="14-ARG：用于指定传递给构建运行时的变量">14.ARG：用于指定传递给构建运行时的变量</h3>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">格式：</span><br><span class="line">    ARG <span class="tag">&lt;<span class="name">name</span>&gt;</span>[=<span class="tag">&lt;<span class="name">default</span> <span class="attr">value</span>&gt;</span>]</span><br><span class="line">示例：</span><br><span class="line">    ARG site</span><br><span class="line">    ARG build_user=www</span><br></pre></td></tr></table></figure>
<h3 id="15-ONBUILD：用于设置镜像触发器">15.ONBUILD：用于设置镜像触发器</h3>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">格式：</span><br><span class="line">　　ONBUILD <span class="selector-attr">[INSTRUCTION]</span></span><br><span class="line">示例：</span><br><span class="line">　　ONBUILD ADD . /app/<span class="attribute">src</span></span><br><span class="line">　　ONBUILD RUN /usr/local/bin/python-build <span class="attr">--dir</span> /app/<span class="attribute">src</span></span><br><span class="line">注：</span><br><span class="line">　　当所构建的镜像被用做其它镜像的基础镜像，该镜像中的触发器将会被钥触发</span><br></pre></td></tr></table></figure>
<h3 id="例：">例：</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This my first nginx Dockerfile</span></span><br><span class="line"><span class="comment"># Version 1.0</span></span><br><span class="line"><span class="comment"># Base images 基础镜像</span></span><br><span class="line">FROM centos</span><br><span class="line"><span class="comment">#MAINTAINER 维护者信息</span></span><br><span class="line">MAINTAINER tianfeiyu </span><br><span class="line"><span class="comment">#ENV 设置环境变量</span></span><br><span class="line">ENV PATH /usr/local/nginx/sbin:<span class="variable">$PATH</span></span><br><span class="line"><span class="comment">#ADD  文件放在当前目录下，拷过去会自动解压</span></span><br><span class="line">ADD nginx-1.8.0.tar.gz /usr/local/  </span><br><span class="line">ADD epel-release-latest-7.noarch.rpm /usr/local/  </span><br><span class="line"><span class="comment">#RUN 执行以下命令 </span></span><br><span class="line">RUN rpm -ivh /usr/local/epel-release-latest-7.noarch.rpm</span><br><span class="line">RUN yum install -y wget lftp gcc gcc-c++ make openssl-devel pcre-devel pcre &amp;&amp; yum clean all</span><br><span class="line">RUN useradd -s /sbin/nologin -M www</span><br><span class="line"><span class="comment">#WORKDIR 相当于cd</span></span><br><span class="line">WORKDIR /usr/local/nginx-1.8.0 </span><br><span class="line">RUN ./configure --prefix=/usr/local/nginx --user=www --group=www --with-http_ssl_module --with-pcre &amp;&amp; make &amp;&amp; make install</span><br><span class="line">RUN <span class="built_in">echo</span> <span class="string">&quot;daemon off;&quot;</span> &gt;&gt; /etc/nginx.conf</span><br><span class="line"><span class="comment">#EXPOSE 映射端口</span></span><br><span class="line">EXPOSE 80</span><br><span class="line"><span class="comment">#CMD 运行以下命令</span></span><br><span class="line">CMD [<span class="string">&quot;nginx&quot;</span>]</span><br></pre></td></tr></table></figure>
<h3 id="dockerfile图解释义">dockerfile图解释义</h3>
<p><img src="https://img-blog.csdnimg.cn/img_convert/961ac83016dafae7888a018139025477.png" alt="961ac83016dafae7888a018139025477.png"></p>
<h2 id="五、docker-compose">五、docker-compose</h2>
<blockquote>
<p>Compose是一个用于定义和运行多容器Docker应用程序的工具。使用组合，可以使用组合文件配置应用程序的服务。然后，使用单个命令从配置中创建和启动所有服务。</p>
</blockquote>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="operator">-</span>y install epel<span class="operator">-</span>release <span class="comment">##安装pip</span></span><br><span class="line">yum <span class="operator">-</span>y install python<span class="operator">-</span>pip</span><br><span class="line">pip <span class="operator">-</span><span class="operator">-</span>version <span class="comment">##确认版本</span></span><br><span class="line">pip install <span class="operator">-</span><span class="operator">-</span>upgrade pip <span class="comment">##更新pip</span></span><br><span class="line">pip install docker<span class="operator">-</span>compose  <span class="comment">##安装docker-compose</span></span><br><span class="line">docker<span class="operator">-</span>compose version</span><br></pre></td></tr></table></figure>
<h3 id="1-docker-compose-yml-详解">1.docker-compose.yml 详解</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#系统变量</span></span><br><span class="line"><span class="variable">$PWD</span> ： 当前目录</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment">#注意：YAML布尔值（true，false，yes，no，on，off）必须用引号括起来，以便解析器将它们解释为字符串。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#字典时</span></span><br><span class="line"></span><br><span class="line">environment:</span><br><span class="line"></span><br><span class="line">  SHOW: <span class="string">&#x27;true&#x27;</span></span><br><span class="line"></span><br><span class="line"> 数组时   </span><br><span class="line"></span><br><span class="line">environment:</span><br><span class="line"></span><br><span class="line">  - SHOW=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#版本号</span></span><br><span class="line"></span><br><span class="line">version: <span class="string">&quot;2.1&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定创建的虚拟网络数量 </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 作用：通过不同的虚拟网络实现了容器网络之间的隔离，从而在最大程度上去保护后端网络的安全。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#networks:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  mynet:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#    driver: bridge</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  mynet1:</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 重用的代码模板</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 模板的定义必须以 x- 开头</span></span><br><span class="line"></span><br><span class="line">x-logging:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 以 &amp; 开头的字符串为模板命名</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 以 * 加上模板的名称引用模板</span></span><br><span class="line"></span><br><span class="line">  &amp;default-logging</span><br><span class="line"></span><br><span class="line">  driver: json-file</span><br><span class="line"></span><br><span class="line">  options:</span><br><span class="line"></span><br><span class="line">    max-size: <span class="string">&quot;200k&quot;</span></span><br><span class="line"></span><br><span class="line">    max-file: <span class="string">&quot;10&quot;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义全局挂载卷 </span></span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line"></span><br><span class="line">  test_1.thinking.com:</span><br><span class="line"></span><br><span class="line">  test_2.thinking.com:</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务</span></span><br><span class="line"></span><br><span class="line">services: </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> <span class="comment">#服务名称</span></span><br><span class="line"></span><br><span class="line"> todo:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 构建镜像</span></span><br><span class="line"></span><br><span class="line">     build:</span><br><span class="line"></span><br><span class="line">         <span class="comment"># 指定dockerfile的上下文路径（相对当前docker-compose.yml的位置）</span></span><br><span class="line"></span><br><span class="line">         <span class="comment"># 包含Dockerfile文件的目录路径，或者是git仓库的URL。 </span></span><br><span class="line"></span><br><span class="line">         <span class="comment"># 当提供的值是相对路径时，它被解释为相对于当前compose文件的位置。 </span></span><br><span class="line"></span><br><span class="line">         <span class="comment"># 该目录也是发送到Docker守护程序构建镜像的上下文。</span></span><br><span class="line"></span><br><span class="line">       context: . </span><br><span class="line"></span><br><span class="line">       <span class="comment"># Dockerfile的文件名称</span></span><br><span class="line"></span><br><span class="line">       dockerfile: Dockerfile-todo</span><br><span class="line"></span><br><span class="line">       args:                            </span><br><span class="line"></span><br><span class="line">        <span class="comment"># 变量</span></span><br><span class="line"></span><br><span class="line">        buildno: 1</span><br><span class="line"></span><br><span class="line">        password: secret</span><br><span class="line"></span><br><span class="line">       <span class="comment">#  Dockerfile里面可使用的参数变量          </span></span><br><span class="line"></span><br><span class="line">       <span class="comment">#  Dockerfile：</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">#    ARG buildno </span></span><br><span class="line"></span><br><span class="line">       <span class="comment">#    ARG password</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">#    RUN echo &quot;Build number: $buildno&quot;</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">#    RUN script-requiring-password.sh &quot;$password&quot;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">     <span class="comment"># 镜像名 ： 仓库/标签:版本</span></span><br><span class="line"></span><br><span class="line">     image: zhanyang/todo-demo:1.0.0   </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">     <span class="comment"># 依赖(以指定顺序启动)</span></span><br><span class="line"></span><br><span class="line">     depends_on:  </span><br><span class="line"></span><br><span class="line">       mysql:</span><br><span class="line"></span><br><span class="line">         condition: service_healthy</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">     <span class="comment"># 指定一个自定义容器名称，而不是生成的默认名称。</span></span><br><span class="line"></span><br><span class="line">     <span class="comment"># 由于Docker容器名称必须是唯一的，因此如果指定了自定义名称，则无法将服务扩展到多个容器。</span></span><br><span class="line"></span><br><span class="line">     container_name: todo</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">     <span class="comment"># 卷挂载路径设置。</span></span><br><span class="line"></span><br><span class="line">     <span class="comment"># 可以设置宿主机路径 （HOST:CONTAINER） 或加上访问模式 （HOST:CONTAINER:ro）</span></span><br><span class="line"></span><br><span class="line">     <span class="comment"># 挂载数据卷的默认权限是读写（rw），可以通过ro指定为只读。 </span></span><br><span class="line"></span><br><span class="line">     volumes:</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 只需指定一个路径，让引擎创建一个卷</span></span><br><span class="line"></span><br><span class="line">              - /var/lib/mysql</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">              <span class="comment"># 指定绝对路径映射</span></span><br><span class="line"></span><br><span class="line">              - /opt/data:/var/lib/mysql</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">              <span class="comment"># 相对于当前compose文件的相对路径</span></span><br><span class="line"></span><br><span class="line">              - ./cache:/tmp/cache</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">              <span class="comment"># 用户家目录相对路径</span></span><br><span class="line"></span><br><span class="line">              - ~/configs:/etc/configs/:ro</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">              <span class="comment"># 命名卷</span></span><br><span class="line"></span><br><span class="line">              - datavolume:/var/lib/mysql</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">              <span class="comment"># 使用全局挂载卷</span></span><br><span class="line"></span><br><span class="line">              - test_1.thinking.com:/test:rw</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">         <span class="comment"># 指定日志驱动为 json-file，存储日志的最大文件 size 为 200k，最多存储 10 这样大的文件。</span></span><br><span class="line"></span><br><span class="line">         <span class="comment"># logging支持很多driver，而每一个driver对应的options都不一样</span></span><br><span class="line"></span><br><span class="line">         <span class="comment"># docker inspect -f &#123;&#123;.HostConfig.LogConfig&#125;&#125; lnmp-nginx</span></span><br><span class="line"></span><br><span class="line">         <span class="comment"># result：&#123;json-file map[max-file:10 max-size:2000k]&#125;</span></span><br><span class="line"></span><br><span class="line">         <span class="comment"># docker info |grep &#x27;Logging Driver&#x27;</span></span><br><span class="line"></span><br><span class="line">         <span class="comment"># result：Logging Driver: json-file</span></span><br><span class="line"></span><br><span class="line">         <span class="comment"># 其他：https://docs.docker.com/engine/admin/logging/overview/</span></span><br><span class="line"></span><br><span class="line">    logging:</span><br><span class="line"></span><br><span class="line">      driver: <span class="string">&quot;json-file&quot;</span></span><br><span class="line"></span><br><span class="line">      options:</span><br><span class="line"></span><br><span class="line">        max-size: <span class="string">&quot;200k&quot;</span></span><br><span class="line"></span><br><span class="line">        max-file: <span class="string">&quot;10&quot;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        <span class="comment"># 指定使用的虚拟网络</span></span><br><span class="line"></span><br><span class="line">    networks: </span><br><span class="line"></span><br><span class="line">    <span class="comment">#   - mynet</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 覆盖容器启动后默认执行的命令。 </span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 该命令也可以是一个类似于dockerfile的列表：command: [&quot;bundle&quot;, &quot;exec&quot;, &quot;thin&quot;, &quot;-p&quot;, &quot;3000&quot;]</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">command</span>: bundle <span class="built_in">exec</span> thin -p 3000</span><br><span class="line"></span><br><span class="line">    <span class="comment"># may</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">command</span>: [<span class="string">&quot;/usr/local/nginx/sbin/nginx&quot;</span>]</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        <span class="comment"># 链接到另一个服务中的容器。 请指定服务名称和链接别名（SERVICE：ALIAS），或者仅指定服务名称。</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 实际是通过设置/etc/hosts的域名解析，从而实现容器间的通信。</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 故可以像在应用中使用localhost一样使用服务的别名链接其他容器的服务，前提是多个服务容器在一个网络中可路由联通</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># links也可以起到和depends_on相似的功能，即定义服务之间的依赖关系，从而确定服务启动的顺序</span></span><br><span class="line"></span><br><span class="line">    links:</span><br><span class="line"></span><br><span class="line">       - db</span><br><span class="line"></span><br><span class="line">       - db:database</span><br><span class="line"></span><br><span class="line">       - redis</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">      <span class="comment"># 链接到docker-compose.yml 外部的容器，甚至并非 Compose 管理的容器。参数格式跟 links 类似。</span></span><br><span class="line"></span><br><span class="line">     external</span><br><span class="line"></span><br><span class="line">         - redis_1</span><br><span class="line"></span><br><span class="line">         - project_db_1:mysql</span><br><span class="line"></span><br><span class="line">         - project_db_1:postgresql</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        <span class="comment"># 暴露端口，但不映射到宿主机，只被连接的服务访问。 仅可以指定内部端口为参数</span></span><br><span class="line"></span><br><span class="line">     expose:</span><br><span class="line"></span><br><span class="line">         - <span class="string">&quot;3000&quot;</span></span><br><span class="line"></span><br><span class="line">         - <span class="string">&quot;8000&quot;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        <span class="comment"># 暴露端口信息。使用宿主：容器 （HOST:CONTAINER）格式或者仅仅指定容器的端口（宿主将会随机选择端口）都可以。</span></span><br><span class="line"></span><br><span class="line">     ports:</span><br><span class="line"></span><br><span class="line">         - <span class="string">&quot;3000&quot;</span></span><br><span class="line"></span><br><span class="line">         - <span class="string">&quot;3000-3005&quot;</span></span><br><span class="line"></span><br><span class="line">         - <span class="string">&quot;8000:8000&quot;</span></span><br><span class="line"></span><br><span class="line">         - <span class="string">&quot;9090-9091:8080-8081&quot;</span></span><br><span class="line"></span><br><span class="line">         - <span class="string">&quot;49100:22&quot;</span></span><br><span class="line"></span><br><span class="line">         - <span class="string">&quot;127.0.0.1:8001:8001&quot;</span></span><br><span class="line"></span><br><span class="line">         - <span class="string">&quot;127.0.0.1:5000-5010:5000-5010&quot;</span></span><br><span class="line"></span><br><span class="line">         - <span class="string">&quot;6060:6060/udp&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># v3.2中ports的长格式的语法允许配置不能用短格式表示的附加字段。</span></span><br><span class="line"></span><br><span class="line">     ports:</span><br><span class="line"></span><br><span class="line">          - target: 80 <span class="comment">#容器内的端口 </span></span><br><span class="line"></span><br><span class="line">            published: 8080 <span class="comment">#物理主机的端口 </span></span><br><span class="line"></span><br><span class="line">            protocol: tcp <span class="comment">#端口协议（tcp或udp） </span></span><br><span class="line"></span><br><span class="line">            mode: host <span class="comment">#host 和ingress 两总模式，host用于在每个节点上发布主机端口，ingress 用于被负载平衡的swarm模式端口。</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="comment"># no是默认的重启策略，在任何情况下都不会重启容器。  </span></span><br><span class="line"></span><br><span class="line">    restart: <span class="string">&quot;no&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 指定为always时，容器总是重新启动。</span></span><br><span class="line"></span><br><span class="line">    restart: always </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 如果退出代码指示出现故障错误，则on-failure将重新启动容器。</span></span><br><span class="line"></span><br><span class="line">    restart: on-failure</span><br><span class="line"></span><br><span class="line">    restart: unless-stopped</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="comment"># pid 将PID模式设置为主机PID模式。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这就打开了容器与主机操作系统之间的共享PID地址空间。 </span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用此标志启动的容器将能够访问和操作裸机的命名空间中的其他容器，反之亦然。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 即打开该选项的容器可以相互通过进程 ID 来访问和操作。</span></span><br><span class="line"></span><br><span class="line">    pid: <span class="string">&quot;host&quot;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 配置 DNS 服务器。可以是一个值，也可以是一个列表。</span></span><br><span class="line"></span><br><span class="line">    dns: 8.8.8.8</span><br><span class="line"></span><br><span class="line">    dns:</span><br><span class="line"></span><br><span class="line">      - 8.8.8.8</span><br><span class="line"></span><br><span class="line">      - 9.9.9.9</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 自定义搜索域</span></span><br><span class="line"></span><br><span class="line">    dns_search: example.com</span><br><span class="line"></span><br><span class="line">    dns_search:</span><br><span class="line"></span><br><span class="line">      - dc1.example.com</span><br><span class="line"></span><br><span class="line">      - dc2.example.com</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 覆盖Dockerfile中的entrypoint，用法同Dockerfile中的用法</span></span><br><span class="line"></span><br><span class="line">    entrypoint: [<span class="string">&quot;/usr/local/nginx/sbin/nginx&quot;</span>,<span class="string">&quot;-g&quot;</span>,<span class="string">&quot;daemon off;&quot;</span>]</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加环境变量。 你可以使用数组或字典两种形式。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 任何布尔值; true，false，yes，no需要用引号括起来，以确保它们不被YML解析器转换为True或False。 </span></span><br><span class="line"></span><br><span class="line">    environment:</span><br><span class="line"></span><br><span class="line">      RACK_ENV: development</span><br><span class="line"></span><br><span class="line">      SHOW: <span class="string">&#x27;true&#x27;</span></span><br><span class="line"></span><br><span class="line">      SESSION_SECRET:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 【注意】：如果你的服务指定了build选项，那么在构建过程中通过environment定义的环境变量将不会起作用。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将使用build的args子选项来定义构建时的环境变量。</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    environment:</span><br><span class="line"></span><br><span class="line">      - RACK_ENV=development</span><br><span class="line"></span><br><span class="line">      - SHOW=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      - SESSION_SECRE</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 1&gt;将定义的变量编写在文件中，然后在yml文件中进行添加 </span></span><br><span class="line"></span><br><span class="line">    env_file: .<span class="built_in">env</span></span><br><span class="line"></span><br><span class="line">    env_file:</span><br><span class="line"></span><br><span class="line">      - ./common.env</span><br><span class="line"></span><br><span class="line">      - ./apps/web.env</span><br><span class="line"></span><br><span class="line">      - /opt/secrets.env</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2&gt;例如：</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># old：</span></span><br><span class="line"></span><br><span class="line">        db:</span><br><span class="line"></span><br><span class="line">        image: mysql</span><br><span class="line"></span><br><span class="line">        ports:</span><br><span class="line"></span><br><span class="line">          - <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line"></span><br><span class="line">        environment:</span><br><span class="line"></span><br><span class="line">          MYSQL_ROOT_PASSWORD: redhat</span><br><span class="line"></span><br><span class="line">          MYSQL_DATABASE: wordpress</span><br><span class="line"></span><br><span class="line">          MYSQL_USER: wordpress</span><br><span class="line"></span><br><span class="line">          MYSQL_PASSWORD: wordpress</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="comment"># new：</span></span><br><span class="line"></span><br><span class="line">        db:</span><br><span class="line"></span><br><span class="line">           image: mysql</span><br><span class="line"></span><br><span class="line">           ports:</span><br><span class="line"></span><br><span class="line">              - <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line"></span><br><span class="line">           env_file: ./mysql_env</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">      <span class="comment"># 创建env_file文件在当前目录mysql_env</span></span><br><span class="line"></span><br><span class="line">         MYSQL_ROOT_PASSWORD=redhat</span><br><span class="line"></span><br><span class="line">         MYSQL_DATABASE=wordpress</span><br><span class="line"></span><br><span class="line">         MYSQL_USER=wordpress</span><br><span class="line"></span><br><span class="line">         MYSQL_PASSWORD=wordpress3</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 添加hostname映射，类似于docker cli下面的--add-host</span></span><br><span class="line"></span><br><span class="line">    extra_hosts:</span><br><span class="line"></span><br><span class="line">     - <span class="string">&quot;www.hcstart.com:192.168.101.14&quot;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 配置一个检查去测试服务中的容器是否运行正常  </span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 具体： https://docs.docker.com/engine/reference/builder/#healthcheck</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查看healthcheck的状态输出 ： docker inspect lnmp-nginx</span></span><br><span class="line"></span><br><span class="line">    healthcheck:</span><br><span class="line"></span><br><span class="line">      <span class="built_in">test</span>: [<span class="string">&quot;CMD&quot;</span>, <span class="string">&quot;curl&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;http://localhost&quot;</span>]</span><br><span class="line"></span><br><span class="line">      interval: 1m30s</span><br><span class="line"></span><br><span class="line">      <span class="built_in">timeout</span>: 10s</span><br><span class="line"></span><br><span class="line">      retries: 3</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="comment">#  labels:添加元数据到container中，查看现有容器的labels：</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#  docker inspect -f &#123;&#123;.Config.Labels&#125;&#125; lnmp-nginx # lnmp-nginx ：容器名</span></span><br><span class="line"></span><br><span class="line">    labels:</span><br><span class="line"></span><br><span class="line">      com.example.description: <span class="string">&quot;Accounting webapp&quot;</span></span><br><span class="line"></span><br><span class="line">      com.example.department: <span class="string">&quot;Finance&quot;</span></span><br><span class="line"></span><br><span class="line">      com.example.label-with-empty-value: <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    labels:</span><br><span class="line"></span><br><span class="line">      - <span class="string">&quot;com.example.description=Accounting webapp&quot;</span></span><br><span class="line"></span><br><span class="line">      - <span class="string">&quot;com.example.department=Finance&quot;</span></span><br><span class="line"></span><br><span class="line">      - <span class="string">&quot;com.example.label-with-empty-value&quot;</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 在容器中设置内核参数</span></span><br><span class="line"></span><br><span class="line">    sysctls:</span><br><span class="line"></span><br><span class="line">         net.core.somaxconn: 1024</span><br><span class="line"></span><br><span class="line">         net.ipv4.tcp_syncookies: 0</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    sysctls:</span><br><span class="line"></span><br><span class="line">        - net.core.somaxconn=1024</span><br><span class="line"></span><br><span class="line">        - net.ipv4.tcp_syncookies=0</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">mysql:</span><br><span class="line"></span><br><span class="line">     environment:</span><br><span class="line"></span><br><span class="line">       MYSQL_ROOT_PASSWORD: password</span><br><span class="line"></span><br><span class="line">       MYSQL_DATABASE: tododb</span><br><span class="line"></span><br><span class="line">       MYSQL_USER: user</span><br><span class="line"></span><br><span class="line">       MYSQL_PASSWORD: pass</span><br><span class="line"></span><br><span class="line">     build:</span><br><span class="line"></span><br><span class="line">       context: .</span><br><span class="line"></span><br><span class="line">       dockerfile: Dockerfile-mysql</span><br><span class="line"></span><br><span class="line">     image: zhanyang/mysql:5.6</span><br><span class="line"></span><br><span class="line">     container_name: mysql</span><br><span class="line"></span><br><span class="line">     <span class="comment"># 以 * 加上模板的名称引用模板     使用全局自定义模板</span></span><br><span class="line"></span><br><span class="line">     logging: *default-logging</span><br><span class="line"></span><br><span class="line">     <span class="comment"># 指定使用的虚拟网络</span></span><br><span class="line"></span><br><span class="line">     networks: </span><br><span class="line"></span><br><span class="line">     <span class="comment">#  - mynet1</span></span><br><span class="line"></span><br><span class="line">Compose和Docker兼容性：</span><br><span class="line"></span><br><span class="line">    Compose 文件格式有3个版本,分别为1, 2.x 和 3.x</span><br><span class="line"></span><br><span class="line">    目前主流的为 3.x 其支持 docker 1.13.0 及其以上的版本</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">常用参数：</span><br><span class="line"></span><br><span class="line">    version           <span class="comment"># 指定 compose 文件的版本</span></span><br><span class="line"></span><br><span class="line">    services          <span class="comment"># 定义所有的 service 信息, services 下面的第一级别的 key 既是一个 service 的名称</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        build                 <span class="comment"># 指定包含构建上下文的路径, 或作为一个对象，该对象具有 context 和指定的 dockerfile 文件以及 args 参数值</span></span><br><span class="line"></span><br><span class="line">            context               <span class="comment"># context: 指定 Dockerfile 文件所在的路径</span></span><br><span class="line"></span><br><span class="line">            dockerfile            <span class="comment"># dockerfile: 指定 context 指定的目录下面的 Dockerfile 的名称(默认为 Dockerfile)</span></span><br><span class="line"></span><br><span class="line">            args                  <span class="comment"># args: Dockerfile 在 build 过程中需要的参数 (等同于 docker container build --build-arg 的作用)</span></span><br><span class="line"></span><br><span class="line">            cache_from            <span class="comment"># v3.2中新增的参数, 指定缓存的镜像列表 (等同于 docker container build --cache_from 的作用)</span></span><br><span class="line"></span><br><span class="line">            labels                <span class="comment"># v3.3中新增的参数, 设置镜像的元数据 (等同于 docker container build --labels 的作用)</span></span><br><span class="line"></span><br><span class="line">            shm_size              <span class="comment"># v3.5中新增的参数, 设置容器 /dev/shm 分区的大小 (等同于 docker container build --shm-size 的作用)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        <span class="built_in">command</span>               <span class="comment"># 覆盖容器启动后默认执行的命令, 支持 shell 格式和 [] 格式</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        configs               <span class="comment"># 不知道怎么用</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        cgroup_parent         <span class="comment"># 不知道怎么用</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        container_name        <span class="comment"># 指定容器的名称 (等同于 docker run --name 的作用)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        credential_spec       <span class="comment"># 不知道怎么用</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        deploy                <span class="comment"># v3 版本以上, 指定与部署和运行服务相关的配置, deploy 部分是 docker stack 使用的, docker stack 依赖 docker swarm</span></span><br><span class="line"></span><br><span class="line">            endpoint_mode         <span class="comment"># v3.3 版本中新增的功能, 指定服务暴露的方式</span></span><br><span class="line"></span><br><span class="line">                vip                   <span class="comment"># Docker 为该服务分配了一个虚拟 IP(VIP), 作为客户端的访问服务的地址</span></span><br><span class="line"></span><br><span class="line">                dnsrr                 <span class="comment"># DNS轮询, Docker 为该服务设置 DNS 条目, 使得服务名称的 DNS 查询返回一个 IP 地址列表, 客户端直接访问其中的一个地址</span></span><br><span class="line"></span><br><span class="line">            labels                <span class="comment"># 指定服务的标签，这些标签仅在服务上设置</span></span><br><span class="line"></span><br><span class="line">            mode                  <span class="comment"># 指定 deploy 的模式</span></span><br><span class="line"></span><br><span class="line">                global                <span class="comment"># 每个集群节点都只有一个容器</span></span><br><span class="line"></span><br><span class="line">                replicated            <span class="comment"># 用户可以指定集群中容器的数量(默认)</span></span><br><span class="line"></span><br><span class="line">            placement             <span class="comment"># 不知道怎么用</span></span><br><span class="line"></span><br><span class="line">            replicas              <span class="comment"># deploy 的 mode 为 replicated 时, 指定容器副本的数量</span></span><br><span class="line"></span><br><span class="line">            resources             <span class="comment"># 资源限制</span></span><br><span class="line"></span><br><span class="line">                limits                <span class="comment"># 设置容器的资源限制</span></span><br><span class="line"></span><br><span class="line">                    cpus: <span class="string">&quot;0.5&quot;</span>           <span class="comment"># 设置该容器最多只能使用 50% 的 CPU </span></span><br><span class="line"></span><br><span class="line">                    memory: 50M           <span class="comment"># 设置该容器最多只能使用 50M 的内存空间 </span></span><br><span class="line"></span><br><span class="line">                reservations          <span class="comment"># 设置为容器预留的系统资源(随时可用)</span></span><br><span class="line"></span><br><span class="line">                    cpus: <span class="string">&quot;0.2&quot;</span>           <span class="comment"># 为该容器保留 20% 的 CPU</span></span><br><span class="line"></span><br><span class="line">                    memory: 20M           <span class="comment"># 为该容器保留 20M 的内存空间</span></span><br><span class="line"></span><br><span class="line">            restart_policy        <span class="comment"># 定义容器重启策略, 用于代替 restart 参数</span></span><br><span class="line"></span><br><span class="line">                condition             <span class="comment"># 定义容器重启策略(接受三个参数)</span></span><br><span class="line"></span><br><span class="line">                    none                  <span class="comment"># 不尝试重启</span></span><br><span class="line"></span><br><span class="line">                    on-failure            <span class="comment"># 只有当容器内部应用程序出现问题才会重启</span></span><br><span class="line"></span><br><span class="line">                    any                   <span class="comment"># 无论如何都会尝试重启(默认)</span></span><br><span class="line"></span><br><span class="line">                delay                 <span class="comment"># 尝试重启的间隔时间(默认为 0s)</span></span><br><span class="line"></span><br><span class="line">                max_attempts          <span class="comment"># 尝试重启次数(默认一直尝试重启)</span></span><br><span class="line"></span><br><span class="line">                window                <span class="comment"># 检查重启是否成功之前的等待时间(即如果容器启动了, 隔多少秒之后去检测容器是否正常, 默认 0s)</span></span><br><span class="line"></span><br><span class="line">            update_config         <span class="comment"># 用于配置滚动更新配置</span></span><br><span class="line"></span><br><span class="line">                parallelism           <span class="comment"># 一次性更新的容器数量</span></span><br><span class="line"></span><br><span class="line">                delay                 <span class="comment"># 更新一组容器之间的间隔时间</span></span><br><span class="line"></span><br><span class="line">                failure_action        <span class="comment"># 定义更新失败的策略</span></span><br><span class="line"></span><br><span class="line">                    <span class="built_in">continue</span>              <span class="comment"># 继续更新</span></span><br><span class="line"></span><br><span class="line">                    rollback              <span class="comment"># 回滚更新</span></span><br><span class="line"></span><br><span class="line">                    pause                 <span class="comment"># 暂停更新(默认)</span></span><br><span class="line"></span><br><span class="line">                monitor               <span class="comment"># 每次更新后的持续时间以监视更新是否失败(单位: ns|us|ms|s|m|h) (默认为0)</span></span><br><span class="line"></span><br><span class="line">                max_failure_ratio     <span class="comment"># 回滚期间容忍的失败率(默认值为0)</span></span><br><span class="line"></span><br><span class="line">                order                 <span class="comment"># v3.4 版本中新增的参数, 回滚期间的操作顺序</span></span><br><span class="line"></span><br><span class="line">                    stop-first            <span class="comment">#旧任务在启动新任务之前停止(默认)</span></span><br><span class="line"></span><br><span class="line">                    start-first           <span class="comment">#首先启动新任务, 并且正在运行的任务暂时重叠</span></span><br><span class="line"></span><br><span class="line">            rollback_config       <span class="comment"># v3.7 版本中新增的参数, 用于定义在 update_config 更新失败的回滚策略</span></span><br><span class="line"></span><br><span class="line">                parallelism           <span class="comment"># 一次回滚的容器数, 如果设置为0, 则所有容器同时回滚</span></span><br><span class="line"></span><br><span class="line">                delay                 <span class="comment"># 每个组回滚之间的时间间隔(默认为0)</span></span><br><span class="line"></span><br><span class="line">                failure_action        <span class="comment"># 定义回滚失败的策略</span></span><br><span class="line"></span><br><span class="line">                    <span class="built_in">continue</span>              <span class="comment"># 继续回滚</span></span><br><span class="line"></span><br><span class="line">                    pause                 <span class="comment"># 暂停回滚</span></span><br><span class="line"></span><br><span class="line">                monitor               <span class="comment"># 每次回滚任务后的持续时间以监视失败(单位: ns|us|ms|s|m|h) (默认为0)</span></span><br><span class="line"></span><br><span class="line">                max_failure_ratio     <span class="comment"># 回滚期间容忍的失败率(默认值0)</span></span><br><span class="line"></span><br><span class="line">                order                 <span class="comment"># 回滚期间的操作顺序</span></span><br><span class="line"></span><br><span class="line">                    stop-first            <span class="comment"># 旧任务在启动新任务之前停止(默认)</span></span><br><span class="line"></span><br><span class="line">                    start-first           <span class="comment"># 首先启动新任务, 并且正在运行的任务暂时重叠</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">            注意：</span><br><span class="line"></span><br><span class="line">                支持 docker-compose up 和 docker-compose run 但不支持 docker stack deploy 的子选项</span><br><span class="line"></span><br><span class="line">                security_opt  container_name  devices  tmpfs  stop_signal  links    cgroup_parent</span><br><span class="line"></span><br><span class="line">                network_mode  external_links  restart  build  userns_mode  sysctls</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        devices               <span class="comment"># 指定设备映射列表 (等同于 docker run --device 的作用)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        depends_on            <span class="comment"># 定义容器启动顺序 (此选项解决了容器之间的依赖关系， 此选项在 v3 版本中 使用 swarm 部署时将忽略该选项)</span></span><br><span class="line"></span><br><span class="line">            示例：</span><br><span class="line"></span><br><span class="line">                docker-compose up 以依赖顺序启动服务，下面例子中 redis 和 db 服务在 web 启动前启动</span><br><span class="line"></span><br><span class="line">                默认情况下使用 docker-compose up web 这样的方式启动 web 服务时，也会启动 redis 和 db 两个服务，因为在配置文件中定义了依赖关系</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">                version: <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line">                services:</span><br><span class="line"></span><br><span class="line">                    web:</span><br><span class="line"></span><br><span class="line">                        build: .</span><br><span class="line"></span><br><span class="line">                        depends_on:</span><br><span class="line"></span><br><span class="line">                            - db      </span><br><span class="line"></span><br><span class="line">                            - redis  </span><br><span class="line"></span><br><span class="line">                    redis:</span><br><span class="line"></span><br><span class="line">                        image: redis</span><br><span class="line"></span><br><span class="line">                    db:</span><br><span class="line"></span><br><span class="line">                        image: postgres                             </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        dns                   <span class="comment"># 设置 DNS 地址(等同于 docker run --dns 的作用)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        dns_search            <span class="comment"># 设置 DNS 搜索域(等同于 docker run --dns-search 的作用)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        tmpfs                 <span class="comment"># v2 版本以上, 挂载目录到容器中, 作为容器的临时文件系统(等同于 docker run --tmpfs 的作用, 在使用 swarm 部署时将忽略该选项)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        entrypoint            <span class="comment"># 覆盖容器的默认 entrypoint 指令 (等同于 docker run --entrypoint 的作用)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        env_file              <span class="comment"># 从指定文件中读取变量设置为容器中的环境变量, 可以是单个值或者一个文件列表, 如果多个文件中的变量重名则后面的变量覆盖前面的变量, environment 的值覆盖 env_file 的值</span></span><br><span class="line"></span><br><span class="line">            文件格式：</span><br><span class="line"></span><br><span class="line">                RACK_ENV=development </span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        environment           <span class="comment"># 设置环境变量， environment 的值可以覆盖 env_file 的值 (等同于 docker run --env 的作用)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        expose                <span class="comment"># 暴露端口, 但是不能和宿主机建立映射关系, 类似于 Dockerfile 的 EXPOSE 指令</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        external_links        <span class="comment"># 连接不在 docker-compose.yml 中定义的容器或者不在 compose 管理的容器(docker run 启动的容器, 在 v3 版本中使用 swarm 部署时将忽略该选项)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        extra_hosts           <span class="comment"># 添加 host 记录到容器中的 /etc/hosts 中 (等同于 docker run --add-host 的作用)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        healthcheck           <span class="comment"># v2.1 以上版本, 定义容器健康状态检查, 类似于 Dockerfile 的 HEALTHCHECK 指令</span></span><br><span class="line"></span><br><span class="line">            <span class="built_in">test</span>                  <span class="comment"># 检查容器检查状态的命令, 该选项必须是一个字符串或者列表, 第一项必须是 NONE, CMD 或 CMD-SHELL, 如果其是一个字符串则相当于 CMD-SHELL 加该字符串</span></span><br><span class="line"></span><br><span class="line">                NONE                  <span class="comment"># 禁用容器的健康状态检测</span></span><br><span class="line"></span><br><span class="line">                CMD                   <span class="comment"># test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;]</span></span><br><span class="line"></span><br><span class="line">                CMD-SHELL             <span class="comment"># test: [&quot;CMD-SHELL&quot;, &quot;curl -f http://localhost || exit 1&quot;] 或者　test: curl -f https://localhost || exit 1</span></span><br><span class="line"></span><br><span class="line">            interval: 1m30s       <span class="comment"># 每次检查之间的间隔时间</span></span><br><span class="line"></span><br><span class="line">            <span class="built_in">timeout</span>: 10s          <span class="comment"># 运行命令的超时时间</span></span><br><span class="line"></span><br><span class="line">            retries: 3            <span class="comment"># 重试次数</span></span><br><span class="line"></span><br><span class="line">            start_period: 40s     <span class="comment"># v3.4 以上新增的选项, 定义容器启动时间间隔</span></span><br><span class="line"></span><br><span class="line">            <span class="built_in">disable</span>: <span class="literal">true</span>         <span class="comment"># true 或 false, 表示是否禁用健康状态检测和　test: NONE 相同</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        image                 <span class="comment"># 指定 docker 镜像, 可以是远程仓库镜像、本地镜像</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        init                  <span class="comment"># v3.7 中新增的参数, true 或 false 表示是否在容器中运行一个 init, 它接收信号并传递给进程</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        isolation             <span class="comment"># 隔离容器技术, 在 Linux 中仅支持 default 值</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        labels                <span class="comment"># 使用 Docker 标签将元数据添加到容器, 与 Dockerfile 中的 LABELS 类似</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        links                 <span class="comment"># 链接到其它服务中的容器, 该选项是 docker 历史遗留的选项, 目前已被用户自定义网络名称空间取代, 最终有可能被废弃 (在使用 swarm 部署时将忽略该选项)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        logging               <span class="comment"># 设置容器日志服务</span></span><br><span class="line"></span><br><span class="line">            driver                <span class="comment"># 指定日志记录驱动程序, 默认 json-file (等同于 docker run --log-driver 的作用)</span></span><br><span class="line"></span><br><span class="line">            options               <span class="comment"># 指定日志的相关参数 (等同于 docker run --log-opt 的作用)</span></span><br><span class="line"></span><br><span class="line">                max-size              <span class="comment"># 设置单个日志文件的大小, 当到达这个值后会进行日志滚动操作</span></span><br><span class="line"></span><br><span class="line">                max-file              <span class="comment"># 日志文件保留的数量</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        network_mode          <span class="comment"># 指定网络模式 (等同于 docker run --net 的作用, 在使用 swarm 部署时将忽略该选项)         </span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        networks              <span class="comment"># 将容器加入指定网络 (等同于 docker network connect 的作用), networks 可以位于 compose 文件顶级键和 services 键的二级键</span></span><br><span class="line"></span><br><span class="line">            aliases               <span class="comment"># 同一网络上的容器可以使用服务名称或别名连接到其中一个服务的容器</span></span><br><span class="line"></span><br><span class="line">            ipv4_address      <span class="comment"># IP V4 格式</span></span><br><span class="line"></span><br><span class="line">            ipv6_address      <span class="comment"># IP V6 格式</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">            示例:</span><br><span class="line"></span><br><span class="line">                version: <span class="string">&#x27;3.7&#x27;</span></span><br><span class="line"></span><br><span class="line">                services: </span><br><span class="line"></span><br><span class="line">                    <span class="built_in">test</span>: </span><br><span class="line"></span><br><span class="line">                        image: nginx:1.14-alpine</span><br><span class="line"></span><br><span class="line">                        container_name: mynginx</span><br><span class="line"></span><br><span class="line">                        <span class="built_in">command</span>: ifconfig</span><br><span class="line"></span><br><span class="line">                        networks: </span><br><span class="line"></span><br><span class="line">                            app_net:                                <span class="comment"># 调用下面 networks 定义的 app_net 网络</span></span><br><span class="line"></span><br><span class="line">                            ipv4_address: 172.16.238.10</span><br><span class="line"></span><br><span class="line">                networks:</span><br><span class="line"></span><br><span class="line">                    app_net:</span><br><span class="line"></span><br><span class="line">                        driver: bridge</span><br><span class="line"></span><br><span class="line">                        ipam:</span><br><span class="line"></span><br><span class="line">                            driver: default</span><br><span class="line"></span><br><span class="line">                            config:</span><br><span class="line"></span><br><span class="line">                                - subnet: 172.16.238.0/24</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        pid: <span class="string">&#x27;host&#x27;</span>           <span class="comment"># 共享宿主机的 进程空间(PID)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        ports                 <span class="comment"># 建立宿主机和容器之间的端口映射关系, ports 支持两种语法格式</span></span><br><span class="line"></span><br><span class="line">            SHORT 语法格式示例:</span><br><span class="line"></span><br><span class="line">                - <span class="string">&quot;3000&quot;</span>                            <span class="comment"># 暴露容器的 3000 端口, 宿主机的端口由 docker 随机映射一个没有被占用的端口</span></span><br><span class="line"></span><br><span class="line">                - <span class="string">&quot;3000-3005&quot;</span>                       <span class="comment"># 暴露容器的 3000 到 3005 端口, 宿主机的端口由 docker 随机映射没有被占用的端口</span></span><br><span class="line"></span><br><span class="line">                - <span class="string">&quot;8000:8000&quot;</span>                       <span class="comment"># 容器的 8000 端口和宿主机的 8000 端口建立映射关系</span></span><br><span class="line"></span><br><span class="line">                - <span class="string">&quot;9090-9091:8080-8081&quot;</span></span><br><span class="line"></span><br><span class="line">                - <span class="string">&quot;127.0.0.1:8001:8001&quot;</span>             <span class="comment"># 指定映射宿主机的指定地址的</span></span><br><span class="line"></span><br><span class="line">                - <span class="string">&quot;127.0.0.1:5000-5010:5000-5010&quot;</span>   </span><br><span class="line"></span><br><span class="line">                - <span class="string">&quot;6060:6060/udp&quot;</span>                   <span class="comment"># 指定协议</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">            LONG 语法格式示例:(v3.2 新增的语法格式)</span><br><span class="line"></span><br><span class="line">                ports:</span><br><span class="line"></span><br><span class="line">                    - target: 80                    <span class="comment"># 容器端口</span></span><br><span class="line"></span><br><span class="line">                      published: 8080               <span class="comment"># 宿主机端口</span></span><br><span class="line"></span><br><span class="line">                      protocol: tcp                 <span class="comment"># 协议类型</span></span><br><span class="line"></span><br><span class="line">                      mode: host                    <span class="comment"># host 在每个节点上发布主机端口,  ingress 对于群模式端口进行负载均衡</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        secrets               <span class="comment"># 不知道怎么用</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        security_opt          <span class="comment"># 为每个容器覆盖默认的标签 (在使用 swarm 部署时将忽略该选项)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        stop_grace_period     <span class="comment"># 指定在发送了 SIGTERM 信号之后, 容器等待多少秒之后退出(默认 10s)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        stop_signal           <span class="comment"># 指定停止容器发送的信号 (默认为 SIGTERM 相当于 kill PID; SIGKILL 相当于 kill -9 PID; 在使用 swarm 部署时将忽略该选项)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        sysctls               <span class="comment"># 设置容器中的内核参数 (在使用 swarm 部署时将忽略该选项)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        ulimits               <span class="comment"># 设置容器的 limit</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        userns_mode           <span class="comment"># 如果Docker守护程序配置了用户名称空间, 则禁用此服务的用户名称空间 (在使用 swarm 部署时将忽略该选项)</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        volumes               <span class="comment"># 定义容器和宿主机的卷映射关系, 其和 networks 一样可以位于 services 键的二级键和 compose 顶级键, 如果需要跨服务间使用则在顶级键定义, 在 services 中引用</span></span><br><span class="line"></span><br><span class="line">            SHORT 语法格式示例:</span><br><span class="line"></span><br><span class="line">                volumes:</span><br><span class="line"></span><br><span class="line">                    - /var/lib/mysql                <span class="comment"># 映射容器内的 /var/lib/mysql 到宿主机的一个随机目录中</span></span><br><span class="line"></span><br><span class="line">                    - /opt/data:/var/lib/mysql      <span class="comment"># 映射容器内的 /var/lib/mysql 到宿主机的 /opt/data</span></span><br><span class="line"></span><br><span class="line">                    - ./cache:/tmp/cache            <span class="comment"># 映射容器内的 /var/lib/mysql 到宿主机 compose 文件所在的位置</span></span><br><span class="line"></span><br><span class="line">                    - ~/configs:/etc/configs/:ro    <span class="comment"># 映射容器宿主机的目录到容器中去, 权限只读</span></span><br><span class="line"></span><br><span class="line">                    - datavolume:/var/lib/mysql     <span class="comment"># datavolume 为 volumes 顶级键定义的目录, 在此处直接调用</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">            LONG 语法格式示例:(v3.2 新增的语法格式)</span><br><span class="line"></span><br><span class="line">                version: <span class="string">&quot;3.2&quot;</span></span><br><span class="line"></span><br><span class="line">                services:</span><br><span class="line"></span><br><span class="line">                    web:</span><br><span class="line"></span><br><span class="line">                        image: nginx:alpine</span><br><span class="line"></span><br><span class="line">                        ports:</span><br><span class="line"></span><br><span class="line">                            - <span class="string">&quot;80:80&quot;</span></span><br><span class="line"></span><br><span class="line">                        volumes:</span><br><span class="line"></span><br><span class="line">                            - <span class="built_in">type</span>: volume                  <span class="comment"># mount 的类型, 必须是 bind、volume 或 tmpfs</span></span><br><span class="line"></span><br><span class="line">                                <span class="built_in">source</span>: mydata              <span class="comment"># 宿主机目录</span></span><br><span class="line"></span><br><span class="line">                                target: /data               <span class="comment"># 容器目录</span></span><br><span class="line"></span><br><span class="line">                                volume:                     <span class="comment"># 配置额外的选项, 其 key 必须和 type 的值相同</span></span><br><span class="line"></span><br><span class="line">                                    nocopy: <span class="literal">true</span>                <span class="comment"># volume 额外的选项, 在创建卷时禁用从容器复制数据</span></span><br><span class="line"></span><br><span class="line">                            - <span class="built_in">type</span>: <span class="built_in">bind</span>                    <span class="comment"># volume 模式只指定容器路径即可, 宿主机路径随机生成; bind 需要指定容器和数据机的映射路径</span></span><br><span class="line"></span><br><span class="line">                                <span class="built_in">source</span>: ./static</span><br><span class="line"></span><br><span class="line">                                target: /opt/app/static</span><br><span class="line"></span><br><span class="line">                                read_only: <span class="literal">true</span>             <span class="comment"># 设置文件系统为只读文件系统</span></span><br><span class="line"></span><br><span class="line">                volumes:</span><br><span class="line"></span><br><span class="line">                    mydata:                                 <span class="comment"># 定义在 volume, 可在所有服务中调用</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        restart               <span class="comment"># 定义容器重启策略(在使用 swarm 部署时将忽略该选项, 在 swarm 使用 restart_policy 代替 restart)</span></span><br><span class="line"></span><br><span class="line">            no                    <span class="comment"># 禁止自动重启容器(默认)</span></span><br><span class="line"></span><br><span class="line">            always                <span class="comment"># 无论如何容器都会重启</span></span><br><span class="line"></span><br><span class="line">            on-failure            <span class="comment"># 当出现 on-failure 报错时, 容器重新启动</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        其他选项：</span><br><span class="line"></span><br><span class="line">            domainname, hostname, ipc, mac_address, privileged, read_only, shm_size, stdin_open, <span class="built_in">tty</span>, user, working_dir</span><br><span class="line"></span><br><span class="line">            上面这些选项都只接受单个值和 docker run 的对应参数类似</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">        对于值为时间的可接受的值：</span><br><span class="line"></span><br><span class="line">            2.5s</span><br><span class="line"></span><br><span class="line">            10s</span><br><span class="line"></span><br><span class="line">            1m30s</span><br><span class="line"></span><br><span class="line">            2h32m</span><br><span class="line"></span><br><span class="line">            5h34m56s</span><br><span class="line"></span><br><span class="line">            时间单位: us, ms, s, m， h</span><br><span class="line"></span><br><span class="line">        对于值为大小的可接受的值：</span><br><span class="line"></span><br><span class="line">            2b</span><br><span class="line"></span><br><span class="line">            1024kb</span><br><span class="line"></span><br><span class="line">            2048k</span><br><span class="line"></span><br><span class="line">            300m</span><br><span class="line"></span><br><span class="line">            1gb</span><br><span class="line"></span><br><span class="line">            单位: b, k, m, g 或者 kb, mb, gb</span><br><span class="line"></span><br><span class="line">    networks          <span class="comment"># 定义 networks 信息</span></span><br><span class="line"></span><br><span class="line">        driver                <span class="comment"># 指定网络模式, 大多数情况下, 它 bridge 于单个主机和 overlay Swarm 上</span></span><br><span class="line"></span><br><span class="line">            bridge                <span class="comment"># Docker 默认使用 bridge 连接单个主机上的网络</span></span><br><span class="line"></span><br><span class="line">            overlay               <span class="comment"># overlay 驱动程序创建一个跨多个节点命名的网络</span></span><br><span class="line"></span><br><span class="line">            host                  <span class="comment"># 共享主机网络名称空间(等同于 docker run --net=host)</span></span><br><span class="line"></span><br><span class="line">            none                  <span class="comment"># 等同于 docker run --net=none</span></span><br><span class="line"></span><br><span class="line">        driver_opts           <span class="comment"># v3.2以上版本, 传递给驱动程序的参数, 这些参数取决于驱动程序</span></span><br><span class="line"></span><br><span class="line">        attachable            <span class="comment"># driver 为 overlay 时使用, 如果设置为 true 则除了服务之外，独立容器也可以附加到该网络; 如果独立容器连接到该网络，则它可以与其他 Docker 守护进程连接到的该网络的服务和独立容器进行通信</span></span><br><span class="line"></span><br><span class="line">        ipam                  <span class="comment"># 自定义 IPAM 配置. 这是一个具有多个属性的对象, 每个属性都是可选的</span></span><br><span class="line"></span><br><span class="line">            driver                <span class="comment"># IPAM 驱动程序, bridge 或者 default</span></span><br><span class="line"></span><br><span class="line">            config                <span class="comment"># 配置项</span></span><br><span class="line"></span><br><span class="line">                subnet                <span class="comment"># CIDR格式的子网，表示该网络的网段</span></span><br><span class="line"></span><br><span class="line">        external              <span class="comment"># 外部网络, 如果设置为 true 则 docker-compose up 不会尝试创建它, 如果它不存在则引发错误</span></span><br><span class="line"></span><br><span class="line">        name                  <span class="comment"># v3.5 以上版本, 为此网络设置名称</span></span><br><span class="line"></span><br><span class="line">文件格式示例：</span><br><span class="line"></span><br><span class="line">    version: <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line">    services:</span><br><span class="line"></span><br><span class="line">      redis:</span><br><span class="line"></span><br><span class="line">        image: redis:alpine</span><br><span class="line"></span><br><span class="line">        ports:</span><br><span class="line"></span><br><span class="line">          - <span class="string">&quot;6379&quot;</span></span><br><span class="line"></span><br><span class="line">        networks:</span><br><span class="line"></span><br><span class="line">          - frontend</span><br><span class="line"></span><br><span class="line">        deploy:</span><br><span class="line"></span><br><span class="line">          replicas: 2</span><br><span class="line"></span><br><span class="line">          update_config:</span><br><span class="line"></span><br><span class="line">            parallelism: 2</span><br><span class="line"></span><br><span class="line">            delay: 10s</span><br><span class="line"></span><br><span class="line">          restart_policy:</span><br><span class="line"></span><br><span class="line">            condition: on-failure</span><br><span class="line"></span><br><span class="line">      db:</span><br><span class="line"></span><br><span class="line">        image: postgres:9.4</span><br><span class="line"></span><br><span class="line">        volumes:</span><br><span class="line"></span><br><span class="line">          - db-data:/var/lib/postgresql/data</span><br><span class="line"></span><br><span class="line">        networks:</span><br><span class="line"></span><br><span class="line">          - backend</span><br><span class="line"></span><br><span class="line">        deploy:</span><br><span class="line"></span><br><span class="line">          placement:</span><br><span class="line"></span><br><span class="line">            constraints: [node.role == manager]</span><br></pre></td></tr></table></figure>
<h3 id="2-docker-compose-常用命令">2.docker-compose 常用命令</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.查看docker-compose的版本</span></span><br><span class="line"></span><br><span class="line">docker-compose  --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.验证（docker-compose.yml）文件配置，当配置正确时，不输出任何内容，当文件配置错误，输出错误信息。</span></span><br><span class="line"></span><br><span class="line">docker-compose config  -q</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.启动compose(后台运行，即守护进程)</span></span><br><span class="line"></span><br><span class="line">docker-compose up -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.指定文件后台启动</span></span><br><span class="line"></span><br><span class="line">docker-compose -f docker-compose.yml  up -d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.查看日志</span></span><br><span class="line"></span><br><span class="line">docker-compose logs tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6.监听日志</span></span><br><span class="line"></span><br><span class="line">docker-compose logs -f tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 7.停止容器</span></span><br><span class="line"></span><br><span class="line">docker-compose stop tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 8.启动容器</span></span><br><span class="line"></span><br><span class="line">docker-compose start tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 9.重启容器</span></span><br><span class="line"></span><br><span class="line">docker-compose restart tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 10.删除容器（推荐先执行停止容器）</span></span><br><span class="line"></span><br><span class="line">docker-compose <span class="built_in">rm</span> tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 11.进入tomcat服务下容器</span></span><br><span class="line"></span><br><span class="line">docker-compose <span class="built_in">exec</span> tomcat bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 12.查看当前有哪些容器（docker-compose.yml 所在文件夹下执行）</span></span><br><span class="line"></span><br><span class="line">docker-compose ps</span><br><span class="line"></span><br><span class="line"><span class="comment"># 13.显示运行的进程：</span></span><br><span class="line"></span><br><span class="line">docker-compose top tomcat</span><br><span class="line"></span><br><span class="line"><span class="comment"># 14.下载服务镜像</span></span><br><span class="line"></span><br><span class="line">docker-compose pull 镜像名称</span><br><span class="line"></span><br><span class="line"><span class="comment"># 15.列出镜像</span></span><br><span class="line"></span><br><span class="line">docker-compose images</span><br></pre></td></tr></table></figure>
<h3 id="例：测试所用">例：测试所用</h3>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">version:</span> <span class="string">&#x27;3.1&#x27;</span> <span class="comment"># 版本号</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">services:</span>   <span class="comment">## 服务</span></span><br><span class="line"></span><br><span class="line">  <span class="symbol">tomcat:</span>   <span class="comment">#tomcat 服务</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">restart:</span> always</span><br><span class="line"></span><br><span class="line">    <span class="symbol">image:</span> <span class="symbol">tomcat:</span><span class="number">8</span>  <span class="comment">#镜像</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">container_name:</span> tomcat8  <span class="comment">#容器名</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">ports:</span>   <span class="comment">#端口</span></span><br><span class="line"></span><br><span class="line">      - <span class="number">8080</span><span class="symbol">:</span><span class="number">8080</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">volumes:</span>   <span class="comment">#数据卷</span></span><br><span class="line"></span><br><span class="line">      - <span class="regexp">/home/dabing</span><span class="regexp">/lzz/webapps</span><span class="regexp">/:/usr</span><span class="regexp">/local/tomcat</span><span class="regexp">/webapps/</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">  <span class="symbol">mysql:</span>  <span class="comment">#mysql服务</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">build:</span> .  <span class="comment">#通过MySQL的Dockerfile文件构建MySQL</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">restart:</span> always</span><br><span class="line"></span><br><span class="line">    <span class="symbol">image:</span> <span class="symbol">mysql:</span><span class="number">5.7</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">container_name:</span> mysql5.<span class="number">7</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">ports:</span></span><br><span class="line"></span><br><span class="line">      - <span class="number">3306</span><span class="symbol">:</span><span class="number">3306</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">environment:</span></span><br><span class="line"></span><br><span class="line">      <span class="variable constant_">MYSQL_ROOT_PASSWORD</span>: <span class="number">123456</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">command:</span></span><br><span class="line"></span><br><span class="line">      --character-set-server=utf8mb4</span><br><span class="line"></span><br><span class="line">      --collation-server=utf8mb4_general_ci</span><br><span class="line"></span><br><span class="line">      --explicit_defaults_for_timestamp=<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      --lower_case_table_names=<span class="number">1</span></span><br><span class="line"></span><br><span class="line">      --max_allowed_packet=128M</span><br><span class="line"></span><br><span class="line">      --sql-mode=<span class="string">&quot;STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">volumes:</span></span><br><span class="line"></span><br><span class="line">      - <span class="regexp">/home/dabing</span><span class="regexp">/mysql:/var</span><span class="regexp">/lib/mysql</span></span><br></pre></td></tr></table></figure>
<h3 id="DOCKERFile">DOCKERFile</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  这个是构建MySQL的dockerfile</span></span><br><span class="line">FROM registry.saas.hand-china.com/tools/mysql:5.7.17</span><br><span class="line"><span class="comment"># mysql的工作位置</span></span><br><span class="line">ENV WORK_PATH /usr/local/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义会被容器自动执行的目录</span></span><br><span class="line">ENV AUTO_RUN_DIR /docker-entrypoint-initdb.d</span><br><span class="line"></span><br><span class="line"><span class="comment">#复制gropshop.sql到/usr/local </span></span><br><span class="line">COPY grogshop.sql  /usr/local/</span><br><span class="line"></span><br><span class="line"><span class="comment">#把要执行的shell文件放到/docker-entrypoint-initdb.d/目录下，容器会自动执行这个shell</span></span><br><span class="line">COPY docker-entrypoint.sh  <span class="variable">$AUTO_RUN_DIR</span>/</span><br><span class="line"></span><br><span class="line"><span class="comment">#给执行文件增加可执行权限</span></span><br><span class="line">RUN <span class="built_in">chmod</span> a+x <span class="variable">$AUTO_RUN_DIR</span>/docker-entrypoint.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置容器启动时执行的命令</span></span><br><span class="line"><span class="comment">#CMD [&quot;sh&quot;, &quot;/docker-entrypoint-initdb.d/import.sh&quot;]</span></span><br></pre></td></tr></table></figure>
<p>相关资源：<a target="_blank" rel="noopener" href="https://download.csdn.net/download/weixin_38636763/14890248?spm=1001.2101.3001.5697"><em>Docker</em>容器的创建、启动、和停止的方法_<em>docker</em>启动已创建的容器…</a></p>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/Centos/">Centos</a><a class="post-meta__tags" href="/tags/docket/">docket</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/97079772_p0_master1200.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E4%BA%94/"><img class="next-cover" src="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/97102324_p0_master1200.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Nginx学习（五）--- 与Tomcat结合</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/04/19/%E5%9C%A8VMware%E4%B8%8A%E5%AE%89%E8%A3%85Centos7%E7%B3%BB%E7%BB%9F%E5%9C%A8VMware%E4%B8%8A%E5%AE%89%E8%A3%85Centos7%E7%B3%BB%E7%BB%9F/" title="在VMware上安装Centos7系统"><img class="cover" src="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/97025298_p0.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-19</div><div class="title">在VMware上安装Centos7系统</div></div></a></div><div><a href="/2022/04/21/CentOS%207%E5%AE%89%E8%A3%85JAVA%E7%8E%AF%E5%A2%83%EF%BC%88JDK%201.8%EF%BC%89/" title="CentOS 7 安装 JAVA环境（JDK 1.8）"><img class="cover" src="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/96887683_p0_master1200.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-21</div><div class="title">CentOS 7 安装 JAVA环境（JDK 1.8）</div></div></a></div><div><a href="/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E4%B8%80/" title="Nginx学习（一）"><img class="cover" src="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/96369940_p0_master1200.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-21</div><div class="title">Nginx学习（一）</div></div></a></div><div><a href="/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E4%B8%89/" title="Nginx学习（三）--- 反向代理"><img class="cover" src="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/94796009_p0.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-21</div><div class="title">Nginx学习（三）--- 反向代理</div></div></a></div><div><a href="/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E4%BA%8C/" title="Nginx学习（二）"><img class="cover" src="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/97102324_p0_master1200.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-21</div><div class="title">Nginx学习（二）</div></div></a></div><div><a href="/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E4%BA%94/" title="Nginx学习（五）--- 与Tomcat结合"><img class="cover" src="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/97102324_p0_master1200.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-21</div><div class="title">Nginx学习（五）--- 与Tomcat结合</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/EXKx_vaVAAA9c9Z.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Kaillliu</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">15</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">10</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/51341210"><i class="fa-brands fa-bilibili"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://space.bilibili.com/51341210" target="_blank" title="bilibili"><i class="fa-brands fa-bilibili"></i></a><a class="social-icon" href="https://weibo.com/u/5412952403" target="_blank" title="weibo"><i class="fa-brands fa-weibo"></i></a><a class="social-icon" href="mailto:kaillliu@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Docker-%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">一、Docker 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81Docker-%E8%A6%81%E6%B1%82-CentOS-%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%86%85%E6%A0%B8%E7%89%88%E6%9C%AC%E9%AB%98%E4%BA%8E-3-10-%EF%BC%8C%E6%9F%A5%E7%9C%8B%E6%9C%AC%E9%A1%B5%E9%9D%A2%E7%9A%84%E5%89%8D%E6%8F%90%E6%9D%A1%E4%BB%B6%E6%9D%A5%E9%AA%8C%E8%AF%81%E4%BD%A0%E7%9A%84CentOS-%E7%89%88%E6%9C%AC%E6%98%AF%E5%90%A6%E6%94%AF%E6%8C%81-Docker-%E3%80%82%E9%80%9A%E8%BF%87-uname-r-%E5%91%BD%E4%BB%A4%E6%9F%A5%E7%9C%8B%E4%BD%A0%E5%BD%93%E5%89%8D%E7%9A%84%E5%86%85%E6%A0%B8%E7%89%88%E6%9C%AC"><span class="toc-number">1.1.</span> <span class="toc-text">1、Docker 要求 CentOS 系统的内核版本高于 3.10 ，查看本页面的前提条件来验证你的CentOS 版本是否支持 Docker 。通过 uname -r 命令查看你当前的内核版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81-%E4%BD%BF%E7%94%A8-root-%E6%9D%83%E9%99%90%E7%99%BB%E5%BD%95-Centos-%E7%A1%AE%E4%BF%9D-yum-%E5%8C%85%E6%9B%B4%E6%96%B0%E5%88%B0%E6%9C%80%E6%96%B0%E3%80%82"><span class="toc-number">1.2.</span> <span class="toc-text">2、(使用 root 权限登录 Centos)确保 yum 包更新到最新。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%8D%B8%E8%BD%BD%E6%97%A7%E7%89%88%E6%9C%AC-%E5%A6%82%E6%9E%9C%E5%AE%89%E8%A3%85%E8%BF%87%E6%97%A7%E7%89%88%E6%9C%AC%E7%9A%84%E8%AF%9D"><span class="toc-number">1.3.</span> <span class="toc-text">3、卸载旧版本(如果安装过旧版本的话)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%AE%89%E8%A3%85%E9%9C%80%E8%A6%81%E7%9A%84%E8%BD%AF%E4%BB%B6%E5%8C%85%EF%BC%8C-yum-util-%E6%8F%90%E4%BE%9Byum-config-manager%E5%8A%9F%E8%83%BD%EF%BC%8C%E5%8F%A6%E5%A4%96%E4%B8%A4%E4%B8%AA%E6%98%AFdevicemapper%E9%A9%B1%E5%8A%A8%E4%BE%9D%E8%B5%96%E7%9A%84"><span class="toc-number">1.4.</span> <span class="toc-text">4、安装需要的软件包， yum-util 提供yum-config-manager功能，另外两个是devicemapper驱动依赖的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E8%AE%BE%E7%BD%AEyum%E6%BA%90"><span class="toc-number">1.5.</span> <span class="toc-text">5、设置yum源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%8F%AF%E4%BB%A5%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E4%BB%93%E5%BA%93%E4%B8%AD%E6%89%80%E6%9C%89docker%E7%89%88%E6%9C%AC%EF%BC%8C%E5%B9%B6%E9%80%89%E6%8B%A9%E7%89%B9%E5%AE%9A%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85"><span class="toc-number">1.6.</span> <span class="toc-text">6、可以查看所有仓库中所有docker版本，并选择特定版本安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E5%AE%89%E8%A3%85docker"><span class="toc-number">1.7.</span> <span class="toc-text">7、安装docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E5%90%AF%E5%8A%A8%E5%B9%B6%E5%8A%A0%E5%85%A5%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8"><span class="toc-number">1.8.</span> <span class="toc-text">8、启动并加入开机启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E5%B0%86%E7%94%A8%E6%88%B7%E7%A7%BB%E5%8A%A8%E5%88%B0docker%E7%BB%84%E9%87%8C"><span class="toc-number">1.9.</span> <span class="toc-text">9、将用户移动到docker组里</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81docker-%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3"><span class="toc-number">2.</span> <span class="toc-text">二、docker 基本命令详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%9F%A5%E6%89%BE%E9%95%9C%E5%83%8F"><span class="toc-number">2.1.</span> <span class="toc-text">1.查找镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F"><span class="toc-number">2.2.</span> <span class="toc-text">2.拉取镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E8%BF%90%E8%A1%8C%E9%95%9C%E5%83%8F%E5%B9%B6%E8%BF%9B%E5%85%A5%E9%95%9C%E5%83%8F"><span class="toc-number">2.3.</span> <span class="toc-text">3.运行镜像并进入镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-docker-%E5%91%BD%E4%BB%A4%E5%B8%AE%E5%8A%A9"><span class="toc-number">2.4.</span> <span class="toc-text">4.docker 命令帮助</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-docker-option"><span class="toc-number">2.5.</span> <span class="toc-text">5. docker option</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-docker-run"><span class="toc-number">2.6.</span> <span class="toc-text">6.docker run</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E5%91%BD%E4%BB%A4%E4%B8%BE%E4%BE%8B"><span class="toc-number">2.7.</span> <span class="toc-text">7.命令举例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81docker%E5%AE%89%E8%A3%85%E9%95%9C%E5%83%8F%E5%B9%B6%E6%8C%82%E8%BD%BD%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">三、docker安装镜像并挂载目录文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9C%A8Docker%E4%B8%8B%E8%BD%BDNginx%E9%95%9C%E5%83%8F"><span class="toc-number">3.1.</span> <span class="toc-text">1.在Docker下载Nginx镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA%E6%8C%82%E8%BD%BD%E7%9B%AE%E5%BD%95"><span class="toc-number">3.2.</span> <span class="toc-text">2.创建挂载目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%8C%82%E8%BD%BD%E5%B9%B6%E5%90%AF%E5%8A%A8nginx"><span class="toc-number">3.3.</span> <span class="toc-text">3.挂载并启动nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-docker%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8"><span class="toc-number">3.4.</span> <span class="toc-text">4.docker进入容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Dockerfile"><span class="toc-number">4.</span> <span class="toc-text">四、Dockerfile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-docker-build%E5%91%BD%E4%BB%A4%E7%94%A8%E4%BA%8E%E4%BB%8EDockerfile%E6%9E%84%E5%BB%BA%E6%98%A0%E5%83%8F%E3%80%82%E5%8F%AF%E4%BB%A5%E5%9C%A8docker-build%E5%91%BD%E4%BB%A4%E4%B8%AD%E4%BD%BF%E7%94%A8-f%E6%A0%87%E5%BF%97%E6%8C%87%E5%90%91%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%AD%E4%BB%BB%E4%BD%95%E4%BD%8D%E7%BD%AE%E7%9A%84Dockerfile%E3%80%82"><span class="toc-number">4.1.</span> <span class="toc-text">1.docker build命令用于从Dockerfile构建映像。可以在docker build命令中使用-f标志指向文件系统中任何位置的Dockerfile。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Dockerfile%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="toc-number">4.2.</span> <span class="toc-text">2.Dockerfile的基本结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-Dockerfile%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-number">4.3.</span> <span class="toc-text">3.Dockerfile文件说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-FROM%EF%BC%9A%E6%8C%87%E5%AE%9A%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F%EF%BC%8C%E5%BF%85%E9%A1%BB%E4%B8%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%91%BD%E4%BB%A4"><span class="toc-number">4.4.</span> <span class="toc-text">1.FROM：指定基础镜像，必须为第一个命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-MAINTAINER-%E7%BB%B4%E6%8A%A4%E8%80%85%E4%BF%A1%E6%81%AF"><span class="toc-number">4.5.</span> <span class="toc-text">2.MAINTAINER: 维护者信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-RUN%EF%BC%9A%E6%9E%84%E5%BB%BA%E9%95%9C%E5%83%8F%E6%97%B6%E6%89%A7%E8%A1%8C%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-number">4.6.</span> <span class="toc-text">3.RUN：构建镜像时执行的命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-ADD%EF%BC%9A%E5%B0%86%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E6%B7%BB%E5%8A%A0%E5%88%B0%E5%AE%B9%E5%99%A8%E4%B8%AD%EF%BC%8Ctar%E7%B1%BB%E5%9E%8B%E6%96%87%E4%BB%B6%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%A7%A3%E5%8E%8B-%E7%BD%91%E7%BB%9C%E5%8E%8B%E7%BC%A9%E8%B5%84%E6%BA%90%E4%B8%8D%E4%BC%9A%E8%A2%AB%E8%A7%A3%E5%8E%8B-%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE%E7%BD%91%E7%BB%9C%E8%B5%84%E6%BA%90%EF%BC%8C%E7%B1%BB%E4%BC%BCwget"><span class="toc-number">4.7.</span> <span class="toc-text">4.ADD：将本地文件添加到容器中，tar类型文件会自动解压(网络压缩资源不会被解压)，可以访问网络资源，类似wget</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-COPY%EF%BC%9A%E5%8A%9F%E8%83%BD%E7%B1%BB%E4%BC%BCADD%EF%BC%8C%E4%BD%86%E6%98%AF%E6%98%AF%E4%B8%8D%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%EF%BC%8C%E4%B9%9F%E4%B8%8D%E8%83%BD%E8%AE%BF%E9%97%AE%E7%BD%91%E7%BB%9C%E8%B5%84%E6%BA%90"><span class="toc-number">4.8.</span> <span class="toc-text">5.COPY：功能类似ADD，但是是不会自动解压文件，也不能访问网络资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-CMD%EF%BC%9A%E6%9E%84%E5%BB%BA%E5%AE%B9%E5%99%A8%E5%90%8E%E8%B0%83%E7%94%A8%EF%BC%8C%E4%B9%9F%E5%B0%B1%E6%98%AF%E5%9C%A8%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8%E6%97%B6%E6%89%8D%E8%BF%9B%E8%A1%8C%E8%B0%83%E7%94%A8%E3%80%82"><span class="toc-number">4.9.</span> <span class="toc-text">6.CMD：构建容器后调用，也就是在容器启动时才进行调用。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-ENTRYPOINT%EF%BC%9A%E9%85%8D%E7%BD%AE%E5%AE%B9%E5%99%A8%EF%BC%8C%E4%BD%BF%E5%85%B6%E5%8F%AF%E6%89%A7%E8%A1%8C%E5%8C%96%E3%80%82%E9%85%8D%E5%90%88CMD%E5%8F%AF%E7%9C%81%E5%8E%BB-application-%EF%BC%8C%E5%8F%AA%E4%BD%BF%E7%94%A8%E5%8F%82%E6%95%B0%E3%80%82"><span class="toc-number">4.10.</span> <span class="toc-text">7.ENTRYPOINT：配置容器，使其可执行化。配合CMD可省去&quot;application&quot;，只使用参数。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-LABEL%EF%BC%9A%E7%94%A8%E4%BA%8E%E4%B8%BA%E9%95%9C%E5%83%8F%E6%B7%BB%E5%8A%A0%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">4.11.</span> <span class="toc-text">8.LABEL：用于为镜像添加元数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-ENV%EF%BC%9A%E8%AE%BE%E7%BD%AE%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="toc-number">4.12.</span> <span class="toc-text">9.ENV：设置环境变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-EXPOSE%EF%BC%9A%E6%8C%87%E5%AE%9A%E4%BA%8E%E5%A4%96%E7%95%8C%E4%BA%A4%E4%BA%92%E7%9A%84%E7%AB%AF%E5%8F%A3"><span class="toc-number">4.13.</span> <span class="toc-text">10.EXPOSE：指定于外界交互的端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-VOLUME%EF%BC%9A%E7%94%A8%E4%BA%8E%E6%8C%87%E5%AE%9A%E6%8C%81%E4%B9%85%E5%8C%96%E7%9B%AE%E5%BD%95"><span class="toc-number">4.14.</span> <span class="toc-text">11.VOLUME：用于指定持久化目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-WORKDIR%EF%BC%9A%E5%B7%A5%E4%BD%9C%E7%9B%AE%E5%BD%95%EF%BC%8C%E7%B1%BB%E4%BC%BC%E4%BA%8Ecd%E5%91%BD%E4%BB%A4"><span class="toc-number">4.15.</span> <span class="toc-text">12.WORKDIR：工作目录，类似于cd命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13-USER-%E6%8C%87%E5%AE%9A%E8%BF%90%E8%A1%8C%E5%AE%B9%E5%99%A8%E6%97%B6%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%E6%88%96-UID%EF%BC%8C%E5%90%8E%E7%BB%AD%E7%9A%84-RUN-%E4%B9%9F%E4%BC%9A%E4%BD%BF%E7%94%A8%E6%8C%87%E5%AE%9A%E7%94%A8%E6%88%B7%E3%80%82%E4%BD%BF%E7%94%A8USER%E6%8C%87%E5%AE%9A%E7%94%A8%E6%88%B7%E6%97%B6%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E7%94%A8%E6%88%B7%E5%90%8D%E3%80%81UID%E6%88%96GID%EF%BC%8C%E6%88%96%E6%98%AF%E4%B8%A4%E8%80%85%E7%9A%84%E7%BB%84%E5%90%88%E3%80%82%E5%BD%93%E6%9C%8D%E5%8A%A1%E4%B8%8D%E9%9C%80%E8%A6%81%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E6%97%B6%EF%BC%8C%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E8%AF%A5%E5%91%BD%E4%BB%A4%E6%8C%87%E5%AE%9A%E8%BF%90%E8%A1%8C%E7%94%A8%E6%88%B7%E3%80%82%E5%B9%B6%E4%B8%94%E5%8F%AF%E4%BB%A5%E5%9C%A8%E4%B9%8B%E5%89%8D%E5%88%9B%E5%BB%BA%E6%89%80%E9%9C%80%E8%A6%81%E7%9A%84%E7%94%A8%E6%88%B7"><span class="toc-number">4.16.</span> <span class="toc-text">13.USER:指定运行容器时的用户名或 UID，后续的 RUN 也会使用指定用户。使用USER指定用户时，可以使用用户名、UID或GID，或是两者的组合。当服务不需要管理员权限时，可以通过该命令指定运行用户。并且可以在之前创建所需要的用户</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#14-ARG%EF%BC%9A%E7%94%A8%E4%BA%8E%E6%8C%87%E5%AE%9A%E4%BC%A0%E9%80%92%E7%BB%99%E6%9E%84%E5%BB%BA%E8%BF%90%E8%A1%8C%E6%97%B6%E7%9A%84%E5%8F%98%E9%87%8F"><span class="toc-number">4.17.</span> <span class="toc-text">14.ARG：用于指定传递给构建运行时的变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#15-ONBUILD%EF%BC%9A%E7%94%A8%E4%BA%8E%E8%AE%BE%E7%BD%AE%E9%95%9C%E5%83%8F%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">4.18.</span> <span class="toc-text">15.ONBUILD：用于设置镜像触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%EF%BC%9A"><span class="toc-number">4.19.</span> <span class="toc-text">例：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dockerfile%E5%9B%BE%E8%A7%A3%E9%87%8A%E4%B9%89"><span class="toc-number">4.20.</span> <span class="toc-text">dockerfile图解释义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81docker-compose"><span class="toc-number">5.</span> <span class="toc-text">五、docker-compose</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-docker-compose-yml-%E8%AF%A6%E8%A7%A3"><span class="toc-number">5.1.</span> <span class="toc-text">1.docker-compose.yml 详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-docker-compose-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">5.2.</span> <span class="toc-text">2.docker-compose 常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%EF%BC%9A%E6%B5%8B%E8%AF%95%E6%89%80%E7%94%A8"><span class="toc-number">5.3.</span> <span class="toc-text">例：测试所用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DOCKERFile"><span class="toc-number">5.4.</span> <span class="toc-text">DOCKERFile</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/05/09/CentOS%207%E9%85%8D%E7%BD%AEdocket/" title="CentOS 7 配置docket"><img src="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/97079772_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CentOS 7 配置docket"/></a><div class="content"><a class="title" href="/2022/05/09/CentOS%207%E9%85%8D%E7%BD%AEdocket/" title="CentOS 7 配置docket">CentOS 7 配置docket</a><time datetime="2022-05-09T07:32:13.000Z" title="发表于 2022-05-09 15:32:13">2022-05-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E4%BA%94/" title="Nginx学习（五）--- 与Tomcat结合"><img src="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/97102324_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx学习（五）--- 与Tomcat结合"/></a><div class="content"><a class="title" href="/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E4%BA%94/" title="Nginx学习（五）--- 与Tomcat结合">Nginx学习（五）--- 与Tomcat结合</a><time datetime="2022-04-21T09:00:00.000Z" title="发表于 2022-04-21 17:00:00">2022-04-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E4%B8%89/" title="Nginx学习（三）--- 反向代理"><img src="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/94796009_p0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx学习（三）--- 反向代理"/></a><div class="content"><a class="title" href="/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E4%B8%89/" title="Nginx学习（三）--- 反向代理">Nginx学习（三）--- 反向代理</a><time datetime="2022-04-21T08:53:00.000Z" title="发表于 2022-04-21 16:53:00">2022-04-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E5%9B%9B/" title="Nginx学习（四）--- 负载均衡"><img src="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/96887683_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx学习（四）--- 负载均衡"/></a><div class="content"><a class="title" href="/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E5%9B%9B/" title="Nginx学习（四）--- 负载均衡">Nginx学习（四）--- 负载均衡</a><time datetime="2022-04-21T08:53:00.000Z" title="发表于 2022-04-21 16:53:00">2022-04-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E4%BA%8C/" title="Nginx学习（二）"><img src="https://cdn.jsdelivr.net/gh/Kaillliu/blog-img/97102324_p0_master1200.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Nginx学习（二）"/></a><div class="content"><a class="title" href="/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E4%BA%8C/" title="Nginx学习（二）">Nginx学习（二）</a><time datetime="2022-04-21T08:27:00.000Z" title="发表于 2022-04-21 16:27:00">2022-04-21</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By Kaillliu</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>