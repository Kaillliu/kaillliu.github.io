{"meta":{"title":"K A I","subtitle":"","description":"","author":"Kaillliu","url":"http://kaillliu.github.io","root":"/"},"pages":[{"title":"","date":"2022-03-28T10:54:00.479Z","updated":"2022-03-28T10:54:00.479Z","comments":true,"path":"manifest.json","permalink":"http://kaillliu.github.io/manifest.json","excerpt":"","text":"{\"name\":\"string\",\"short_name\":\"Junzhou\",\"theme_color\":\"#49b1f5\",\"background_color\":\"#49b1f5\",\"display\":\"standalone\",\"scope\":\"/\",\"start_url\":\"/\",\"icons\":[{\"src\":\"images/pwaicons/36.png\",\"sizes\":\"36x36\",\"type\":\"image/png\"},{\"src\":\"images/pwaicons/48.png\",\"sizes\":\"48x48\",\"type\":\"image/png\"},{\"src\":\"images/pwaicons/72.png\",\"sizes\":\"72x72\",\"type\":\"image/png\"},{\"src\":\"images/pwaicons/96.png\",\"sizes\":\"96x96\",\"type\":\"image/png\"},{\"src\":\"images/pwaicons/144.png\",\"sizes\":\"144x144\",\"type\":\"image/png\"},{\"src\":\"images/pwaicons/192.png\",\"sizes\":\"192x192\",\"type\":\"image/png\"},{\"src\":\"images/pwaicons/512.png\",\"sizes\":\"512x512\",\"type\":\"image/png\"}],\"splash_pages\":null}"},{"title":"about","date":"2022-03-27T10:02:17.000Z","updated":"2022-03-29T05:26:19.360Z","comments":true,"path":"about/index.html","permalink":"http://kaillliu.github.io/about/index.html","excerpt":"","text":"ä¸çŸ¥é“è¿™ä¸€é¡µè¯¥æ”¾äº›å•¥ï¼Œå°±æ”¾ä¸ªé‚®ç®±å§ï¼Œæœ‰å•¥äº‹å¯ä»¥å‘é‚®ä»¶è”ç³»æˆ‘ğŸ˜„ é‚®ç®±ï¼škaillliu@163.com"},{"title":"404","date":"2022-03-27T10:04:11.081Z","updated":"2022-03-27T10:04:11.081Z","comments":true,"path":"404/index.html","permalink":"http://kaillliu.github.io/404/index.html","excerpt":"","text":""},{"title":"åˆ†ç±»","date":"2022-03-27T09:43:43.000Z","updated":"2022-03-28T06:10:42.758Z","comments":true,"path":"categories/index.html","permalink":"http://kaillliu.github.io/categories/index.html","excerpt":"","text":""},{"title":"contact","date":"2022-03-27T10:13:42.000Z","updated":"2022-03-27T10:13:54.674Z","comments":true,"path":"contact/index.html","permalink":"http://kaillliu.github.io/contact/index.html","excerpt":"","text":""},{"title":"ç«™å¤–é“¾æ¥","date":"2022-03-28T06:11:16.000Z","updated":"2022-03-28T06:14:09.815Z","comments":true,"path":"link/index.html","permalink":"http://kaillliu.github.io/link/index.html","excerpt":"","text":""},{"title":"æ ‡ç­¾","date":"2022-03-27T09:44:50.000Z","updated":"2022-03-28T06:10:24.448Z","comments":true,"path":"tags/index.html","permalink":"http://kaillliu.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"WDCNNé¢„æµ‹CWRUæ•°æ®é›†","slug":"wcnnå¤„ç†cwruæ•°æ®é›†","date":"2022-10-14T09:25:23.000Z","updated":"2022-10-30T06:10:24.788Z","comments":true,"path":"2022/10/14/wcnnå¤„ç†cwruæ•°æ®é›†/","link":"","permalink":"http://kaillliu.github.io/2022/10/14/wcnn%E5%A4%84%E7%90%86cwru%E6%95%B0%E6%8D%AE%E9%9B%86/","excerpt":"","text":"æ•…éšœè¯Šæ–­ è½´æ‰¿æ•…éšœè¯Šæ–­ç®—æ³•æ­¥éª¤åˆ†è§£ CWRUæ•°æ® â€‹ åœ¨æµ‹è¯•ä¸­ï¼Œä½¿ç”¨ç”µç«èŠ±åŠ å·¥(EDM)ï¼Œåœ¨ç”µæœºçš„é©±åŠ¨ç«¯å’Œé£æ‰‡ç«¯è½´æ‰¿(SKFæ·±æ²Ÿçƒè½´æ‰¿:6205-2RS JEMå’Œ6203-2RS JEM)ä¸Šæ¤å…¥ç›´å¾„ä¸º0.007 - 0.028è‹±å¯¸(0.18 - 0.71 mm)çš„æ•…éšœï¼Œæ•…éšœåˆ†åˆ«è¢«è®¾ç½®åœ¨æ»šåŠ¨ä½“ã€å†…åœˆå’Œå¤–åœˆä¸Šã€‚æ¯ç§æ•…éšœè½´æ‰¿å‡è¢«ä»¥åŒæ ·çš„çŠ¶æ€å®‰è£…åœ¨è¯•éªŒå°ä¸Šï¼Œç„¶ååœ¨0åˆ°3é©¬åŠ›çš„ç”µæœºè´Ÿè½½ä¸‹(å¤§çº¦ç”µæœºè½¬é€Ÿä¸º1797åˆ°1720 rpm)ä»¥æ’é€Ÿè¿è¡Œã€‚ åœ¨æ¯æ¬¡æµ‹è¯•ä¸­ï¼Œæµ‹é‡é©±åŠ¨ç«¯è½´æ‰¿å£³ä½“(DE)å‚ç›´æ–¹å‘ä¸Šçš„åŠ é€Ÿåº¦ï¼Œåœ¨ä¸€äº›æµ‹è¯•ä¸­ä¹Ÿæµ‹é‡é£æ‰‡ç«¯è½´æ‰¿å£³ä½“(FE)å’Œç”µæœºæ”¯æ’‘åº•æ¿(BA)å‚ç›´æ–¹å‘ä¸Šçš„åŠ é€Ÿåº¦ã€‚æŸäº›æµ‹è¯•ä½¿ç”¨çš„é‡‡æ ·ç‡ä¸º12 kHzï¼Œå…¶ä»–æµ‹è¯•ä½¿ç”¨çš„é‡‡æ ·ç‡ä¸º48 kHzã€‚ â€‹ æœ¬æ¬¡ä¸»è¦ä½¿ç”¨ 48k Drive End Bearing Fault Data ä½¿ç”¨48kHzé‡‡æ ·é¢‘ç‡ï¼ŒSKF6205æ·±æ²Ÿçƒè½´æ‰¿ï¼Œé©±åŠ¨ç«¯æ•°æ®ï¼Œé©±åŠ¨ç«¯è½´æ‰¿å£³ä½“(DE)çš„é‡‡æ ·æ•°æ® ä½¿ç”¨ä¸‰ç§ä¸åŒçš„æŸä¼¤ç›´å¾„ 0.007inchï¼Œ0.014inchï¼Œ0.021inchï¼›ä¸‰ç§ä¸åŒçš„æ•…éšœï¼Œå¤–åœˆ6ç‚¹é’Ÿæ–¹å‘ã€å†…åœˆã€æ»šåŠ¨ä½“ï¼Œ9æ€»ä¸åŒçš„çŠ¶æ€ æ¯ä¸ªæ ·æœ¬ä½¿ç”¨ 2048ä¸ªæ•°æ®ç‚¹ï¼Œå¹¶åšå½’ä¸€åŒ–å¤„ç† 4ä¸ªæ•°æ®é›†ï¼Œ1hpè´Ÿè½½ï¼Œ2hpè´Ÿè½½ï¼Œ3hpè´Ÿè½½ ï¼Œä»¥åŠå‰ä¸‰ä¸ªçš„å¹¶é›† WDCNN æ¦‚è¿° æœ¬æ–‡ç« ä¸»è¦åŸºäº Pytorch å¤ç°WDCNNåœ¨CWRUæ•°æ®é›†ä¸Šçš„æ•…éšœåˆ†ç±»ï¼Œæœªå¤ç°åŸºäºAdaBNçš„WDCNNå’ŒåŸºäºè®­ç»ƒå¹²æ‰°çš„WDCNNçš„TiCNNæ¨¡å‹ å‚è€ƒè®ºæ–‡ [1]å¼ ä¼Ÿ. åŸºäºå·ç§¯ç¥ç»ç½‘ç»œçš„è½´æ‰¿æ•…éšœè¯Šæ–­ç®—æ³•ç ”ç©¶[D]. å“ˆå°”æ»¨å·¥ä¸šå¤§å­¦, 2017. A New Deep Learning Model for Fault Diagnosis with Good Anti-Noise and Domain Adaptation Ability on Raw Vibration Signals æ¨¡å‹ç»“æ„ WDCNNçš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡ä½¿ç”¨1DCNNç¬¬ä¸€å±‚çš„å¤§å·ç§¯æ ¸ï¼Œæå–æ—¶åºä¿¡å·çš„ç‰¹å¾ï¼›ç¬¬ä¸€å±‚ä¸ºå¤§å·ç§¯æ ¸ï¼Œä¹‹åå·ç§¯å±‚å…¨éƒ¨ä¸º 3Ã—1 çš„å°å·ç§¯æ ¸ã€‚ æ•°æ®é›†è®¾ç½® ä½¿ç”¨ é‡‡æ ·é¢‘ç‡ä¸º48kHz 1hp å·¥å†µçš„é©±åŠ¨ç«¯æ—¶åºæ•°æ®åšæ•°æ®é›†ï¼Œæ•°æ®åŒ…å«åç±»æ•°æ® æ­£å¸¸æ•°æ® ï¼š98.mat æ•…éšœå®½åº¦ï¼ˆå•ä½ï¼šmmï¼‰ å†…åœˆï¼ˆIRï¼‰ æ»šåŠ¨ä½“ï¼ˆBallï¼‰ å¤–åœˆï¼ˆOR)(centeræ–¹å‘) 0.18 110 123 136 0.36 175 190 202 0.53 214 227 239 åŸå§‹çš„æ—¶åŸŸä¿¡å· 136å·æ•°æ®çš„åŸå§‹æ•°æ®å±•ç¤º â€‹ æ•°æ®é›†å‚æ•°è®¾ç½® ä¸ºäº†æ¨¡æ‹Ÿæ—‹è½¬æœºæ¢°çš„æ­£å¸¸å·¥å†µï¼Œå°†æ­£å¸¸æ ·æœ¬çš„æ•°é‡è®¾ç½®ä¸ºé—®é¢˜æ ·æœ¬çš„10å€ï¼Œå¹¶ä½¿ç”¨æ»‘åŠ¨çª—å£ï¼Œå¯¹æ•°æ®è¿›è¡Œå¢å¼ºã€‚ è®¾ç½®é¡¹ å‚æ•° è®­ç»ƒé›†æ¯”ä¾‹ 0.7 éªŒè¯é›†æ¯”ä¾‹ 0.2 æµ‹è¯•é›†æ¯”ä¾‹ 0.1 å•ä¸ªæ ·æœ¬çš„æ•°æ®é•¿åº¦ 2048 æ»‘åŠ¨çª—å£çš„æ­¥é•¿ 28 æ­£å¸¸ç±»åˆ«çš„æ ·æœ¬é‡ 3000 æ•…éšœç±»åˆ«çš„æ ·æœ¬é‡ 300 æ€»æ ·æœ¬é‡ 5700 è¶…å‚æ•°çš„é€‰æ‹© è¶…å‚æ•° æ•°æ® å­¦ä¹ ç‡ 0.001 æƒé‡è¡°é€€ 0.005 å¾ªç¯æ¬¡æ•° 100 ä¼˜åŒ–å™¨å’ŒæŸå¤±å‡½æ•° ä¼˜åŒ–å™¨ é€‰ç”¨Adamä¼˜åŒ–å™¨ 1optimizer = torch.optim.Adam(model.parameters(), lr = learning_rate, weight_decay=weight_dacay) æŸå¤±å‡½æ•° é€‰ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•° 1criterion = nn.CrossEntropyLoss() è®­ç»ƒç»“æœå¯è§†åŒ– ç²¾åº¦å’Œlossçš„è®­ç»ƒè¿‡ç¨‹ æµ‹è¯•é›†ç²¾åº¦ æµ‹è¯•é›†æ··æ·†çŸ©é˜µ æ ‡å‡†åŒ– T-sne åˆ†ç±»æ•ˆæœå¯è§†åŒ– åŸå§‹æ•°æ®åˆ†å¸ƒ WDCNNå€’æ•°ç¬¬äºŒå±‚çš„å…¨è¿æ¥å±‚ WDCNNåˆ†ç±»ç»“æœçš„å¯è§†åŒ– å›¾åƒå¤„ç†æ¨¡å‹ æ¦‚è¿° åŸºäº Pytorch ï¼Œå°†ä¸€ç»´çš„æ—¶åºæŒ¯åŠ¨ä¿¡å·é€šè¿‡çŸ­æ—¶å‚…é‡Œå¶å˜æ¢è½¬åŒ–æˆç°åº¦å›¾ï¼Œå†é€šè¿‡OpenCvçš„ä¼ªå½©è‰²å¤„ç†æ–¹æ³•ï¼Œå°†ç°åº¦å›¾æ˜ å°„ä¸ºå½©è‰²å›¾ï¼Œå¹¶å°†ç”Ÿæˆçš„å›¾ç‰‡é€å…¥å›¾åƒåˆ†ç±»çš„ç¥ç»ç½‘ç»œä¸­ å‚è€ƒè®ºæ–‡ [1]åˆ˜é£, é™ˆä»æ–‡, é‚¢å‡¯ç², ç­‰. åŸºäºè¿ç§»å­¦ä¹ ä¸æ·±åº¦æ®‹å·®ç½‘ç»œçš„æ»šåŠ¨è½´æ‰¿å¿«é€Ÿæ•…éšœè¯Šæ–­ç®—æ³•[J]. æŒ¯åŠ¨ä¸å†²å‡», 2022, 41(3): 154-164. [2]èµµå°å¼º, ç½—ç»´å…°. æ”¹è¿›å·ç§¯Lenet-5ç¥ç»ç½‘ç»œçš„è½´æ‰¿æ•…éšœè¯Šæ–­æ–¹æ³•[J]. ç”µå­æµ‹é‡ä¸ä»ªå™¨å­¦æŠ¥, 2022, 36(06): 113-125. [3]æ±¤äº®, å‡¡ç„±å³°, å¾é€‚æ–, ç­‰. åŸºäºè´å¶æ–¯ä¼˜åŒ–ä¸æ”¹è¿›LeNet-5çš„æ»šåŠ¨è½´æ‰¿æ•…éšœè¯Šæ–­[J]. è®¡é‡å­¦æŠ¥, 2022, 43(07): 913-919. æ¨¡å‹ç»“æ„ åˆ†åˆ«ä½¿ç”¨äº† AlexNet ã€ResNet - 18ã€ResNeXt -50 è¿›è¡Œäº†æµ‹è¯•ï¼Œè¿™é‡Œå±•ç¤ºä¸€ä¸‹ å‚è€ƒè®ºæ–‡1ä¸­çš„ç½‘ç»œæ¨¡å‹ æ•°æ®é›†è®¾ç½® ä½¿ç”¨ é‡‡æ ·é¢‘ç‡ä¸º48kHz 1hp å·¥å†µçš„é©±åŠ¨ç«¯æ—¶åºæ•°æ®åšæ•°æ®é›†ï¼Œæ•°æ®åŒ…å«åç±»æ•°æ® æ­£å¸¸æ•°æ® ï¼š98.mat æ•…éšœå®½åº¦ï¼ˆå•ä½ï¼šmmï¼‰ å†…åœˆï¼ˆIRï¼‰ æ»šåŠ¨ä½“ï¼ˆBallï¼‰ å¤–åœˆï¼ˆOR)(centeræ–¹å‘) 0.18 110 123 136 0.36 175 190 202 0.53 214 227 239 æ•°æ®é›†å‚æ•°è®¾ç½® ä¸ºäº†æ¨¡æ‹Ÿæ—‹è½¬æœºæ¢°çš„æ­£å¸¸å·¥å†µï¼Œå°†æ­£å¸¸æ ·æœ¬çš„æ•°é‡è®¾ç½®ä¸ºé—®é¢˜æ ·æœ¬çš„10å€ï¼Œå¹¶ä½¿ç”¨æ»‘åŠ¨çª—å£ï¼Œå¯¹æ•°æ®è¿›è¡Œå¢å¼ºã€‚ è®¾ç½®é¡¹ å‚æ•° è®­ç»ƒé›†æ¯”ä¾‹ 0.7 éªŒè¯é›†æ¯”ä¾‹ 0.2 æµ‹è¯•é›†æ¯”ä¾‹ 0.1 å•ä¸ªæ ·æœ¬çš„æ•°æ®é•¿åº¦ 1024 æ»‘åŠ¨çª—å£çš„æ­¥é•¿ 28 æ­£å¸¸ç±»åˆ«çš„æ ·æœ¬é‡ 3000 æ•…éšœç±»åˆ«çš„æ ·æœ¬é‡ 300 æ€»æ ·æœ¬é‡ 5700 çŸ­æ—¶å‚…é‡Œå¶å˜æ¢(STFT) ä½¿ç”¨STFTå°†ä¸€ç»´æ—¶åŸŸæ•°æ®è½¬åŒ–æˆé¢‘è°±å›¾ï¼Œå¹¶é€šè¿‡OpenCVçš„ä¼ªå½©è‰²å¤„ç†æˆå½©è‰²å›¾ç‰‡ï¼Œä»¥é€‚åº”ç½‘ç»œä¸­çš„ä¸‰é€šé“è¾“å…¥ è¶…å‚æ•°çš„é€‰æ‹© è¶…å‚æ•° æ•°æ® å­¦ä¹ ç‡ 0.001 æƒé‡è¡°é€€ 0.00001 å¾ªç¯æ¬¡æ•° 10 ä¼˜åŒ–å™¨å’ŒæŸå¤±å‡½æ•° ä¼˜åŒ–å™¨ é€‰ç”¨Adamä¼˜åŒ–å™¨ï¼ŒåŒæ—¶ï¼Œè¿‡æ»¤æ¨¡å‹ä¸­ä¸éœ€è¦è®­ç»ƒçš„å±‚ 1optimizer = torch.optim.Adam(filter(lambda p: p.requires_grad, model.parameters()), lr = learning_rate, weight_decay=weight_decay) æŸå¤±å‡½æ•° é€‰ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•° 1criterion = nn.CrossEntropyLoss() è®­ç»ƒç»“æœå¯è§†åŒ– ç²¾åº¦å’Œlossçš„è®­ç»ƒè¿‡ç¨‹ æµ‹è¯•é›†ç²¾åº¦ æµ‹è¯•é›†æ··æ·†çŸ©é˜µ æ ‡å‡†åŒ– T-sne åˆ†ç±»æ•ˆæœå¯è§†åŒ– ResNet18å€’æ•°ç¬¬äºŒå±‚çš„å…¨è¿æ¥å±‚ ResNet18åˆ†ç±»ç»“æœçš„å¯è§†åŒ– æ€»ç»“ WDCNNæ¨¡å‹å¤ç°éƒ¨åˆ† â€‹ ç”±äºæ˜¯ 17 å¹´çš„è®ºæ–‡ï¼ŒWDCNNåœ¨è¿‘å‡ å¹´çš„æ–‡ç« ä¸­ç»å¸¸è¢«æ‹¿æ¥åšæ€§èƒ½å¯¹æ¯”ï¼Œæ•…å°è¯•å¤ç°è®ºæ–‡ä¸­çš„æ¨¡å‹ã€‚ â€‹ è®ºæ–‡ä¸­ï¼Œå…ˆæ˜¯æå‡ºäº†WDCNNè¿™ä¸ªç¬¬ä¸€å±‚å®½å·ç§¯æ ¸ç®—æ³•ï¼Œå¹¶åœ¨CWRU 12kHzä¸åŒè´Ÿè½½çš„æ•°æ®é›†ä¸ŠéªŒè¯äº†WDCNNçš„å‡†ç¡®ç‡ã€‚ç„¶åï¼Œæå‡ºäº†å°†æ‰€æœ‰ BN å±‚çš„å‡å€¼æ–¹å·®ç”¨æµ‹è¯•é›†çš„å‡å€¼æ–¹å·®æ›¿æ¢ï¼Œå…¶ä»–ç½‘ç»œå‚æ•°ä¿æŒä¸å˜çš„åŸºäºAdaBN-WDCNNç®—æ³•ï¼Œé€šè¿‡å¯¹åŸå§‹ä¿¡å·æ·»åŠ ä¸åŒå™ªå£°çš„æ–¹å¼ï¼ŒéªŒè¯ç®—æ³•çš„æŠ—å™ªæ€§èƒ½ï¼›å¹¶æ”¹å˜ç¬¬ä¸€å±‚å·ç§¯æ ¸å¤§å°ï¼Œåšå®éªŒå±•ç¤ºäº†ç¬¬ä¸€å±‚å·ç§¯æ ¸åœ¨ä¸åŒå¤§å°ä¸‹æ¨¡å‹çš„æ€§èƒ½å˜åŒ–ï¼›è¿˜åœ¨å˜å·¥å†µçš„æƒ…å†µä¸‹ï¼Œå±•ç¤ºäº†æ¨¡å‹çš„è¿ç§»èƒ½åŠ›ã€‚ â€‹ æœ€åï¼Œæ›´æ”¹äº†WDCNNä¸­çš„éƒ¨åˆ†ç»“æ„ï¼Œæå‡ºäº†Ti-CNNæ¨¡å‹ï¼Œå¹¶éªŒè¯äº†å…¶æœ‰æ•ˆæ€§ã€‚ ResNetæ¨¡å‹å¤ç°éƒ¨åˆ† â€‹ ä¸»è¦æ˜¯é€šè¿‡å°†æ—¶åºæ•°æ®è½¬åŒ–ä¸ºäºŒç»´ç°åº¦å›¾ï¼Œå†é€šè¿‡OpenCVä¼ªè‰²å½©å¤„ç†ï¼Œåˆ†ä¸ºåç±»ï¼› â€‹ è®ºæ–‡ä¸­ï¼Œä¸»è¦æ˜¯æå‡ºäº†TL-ResNetï¼›å°†é€šè¿‡ImageNeté¢„è®­ç»ƒçš„ResNet18çš„layer1ï¼Œlayer2ï¼Œlayer3çš„å‚æ•°å†»ç»“ï¼Œåªä½¿ç”¨è‡ªå·±çš„æ•°æ®å»è®­ç»ƒlayer4å’Œåˆ†ç±»å™¨ã€‚ â€‹ åœ¨æ¨¡å‹çš„æ€§èƒ½éªŒè¯æ–¹é¢ï¼Œä¸»è¦ä½¿ç”¨äº†CWRUå’ŒPU çš„è½´æ‰¿æ•°æ®é›†ï¼Œåœ¨ä¸åŒçš„è¿­ä»£æ¬¡æ•°ï¼ˆ2ï¼Œ10ï¼‰å’Œè¾“å…¥é€šé“ï¼ˆç°åº¦å›¾å’Œå½©è‰²å›¾ï¼‰ï¼Œä¸åŒçš„æ¨¡å‹ä¹‹ä¸­åšå¯¹æ¯”å®éªŒï¼ŒéªŒè¯TL-ResNetçš„æœ‰æ•ˆæ€§ã€‚æœ€åï¼Œä½¿ç”¨äº†**å°æ ·æœ¬** å·¥å†µè¿ç§»çš„æ–¹æ³•ï¼Œå¾—å‡ºå°æ ·æœ¬çš„å¤§å°ä¸ºç›®æ ‡åŸŸæ•°æ®é›†çš„ ï¼‘ï¼ï¼… åŠä»¥ä¸Šæ—¶ï¼Œåº”ç”¨å°æ ·æœ¬è¿ç§»æ‰èƒ½å–å¾—æ˜æ˜¾çš„å’Œç¨³å®šçš„å‡†ç¡®ç‡æå‡ã€‚ â€‹ æœ€åå’Œç»å…¸çš„æ•…éšœè¯Šæ–­æ–¹æ³•åšæ¯”è¾ƒï¼Œå±•ç¤ºç®—æ³•çš„æœ‰æ•ˆæ€§ã€‚ ç»“è®º â€‹ åœ¨å¤ç°çš„è¿‡ç¨‹ä¸­ï¼Œ ä¸è®ºæ–‡ä¸­ç›¸æ¯”ï¼Œé€‰ç”¨äº†48kHzé‡‡æ ·é¢‘ç‡çš„æ•°æ®ï¼Œè·‘å‡ºæ¥çš„æ¨¡å‹ç²¾åº¦ä¸è®ºæ–‡ä¸­é€‰ç”¨çš„12kHzçš„æ•°æ®å¯¹æ¯”ç›¸å¯¹è¾ƒä½ï¼Œä½†æ˜¯ä¹Ÿå–å¾—äº†ä¸é”™çš„æ•ˆæœã€‚å½“æŠŠæ•…éšœç±»åˆ«çš„æ ·æœ¬å’Œæ­£å¸¸ç±»åˆ«çš„æ ·æœ¬æ¯”ä¾‹è®¾ç½®ä¸ºç­‰æ¯”çš„æ—¶å€™ï¼Œæ¨¡å‹çš„ç²¾åº¦èƒ½ä¸Šå‡ 1%ï¼Œè¯´æ˜æ•…éšœçš„æ ·æœ¬æ¯”ä¾‹å’Œæ ·æœ¬é‡å¯¹æ•…éšœè¯Šæ–­çš„æ•ˆæœæœ‰ä¸€å®šå½±å“ã€‚ â€‹ ç›®å‰è¿˜æœªåšæŠ—å™ªæ€§å®éªŒï¼Œæ‰“ç®—é€šè¿‡éšæœºå¢åŠ é«˜æ–¯ç™½å™ªå£°çš„æ–¹å¼ï¼Œå¯¹åŸå§‹æ•°æ®é›†è¿›è¡Œå¤„ç†ï¼Œå†è¿›è¡Œè®­ç»ƒå’Œæµ‹è¯•ã€‚ â€‹ æ€»çš„æ¥çœ‹ï¼Œæ•…éšœæ ·æœ¬é‡å¯¹æ¨¡å‹çš„åˆ†ç±»ç²¾åº¦æœ‰è¾ƒå¤§å½±å“ï¼Œå¹¶ä¸”ï¼Œåœ¨å®é™…ç”Ÿäº§ä¸­ï¼Œæ•…éšœçš„æ ·æœ¬é‡ä¹Ÿæ˜¯è¾ƒå°‘çš„ï¼›å¦‚ä½•å¯¹æ¨¡å‹è¿›è¡Œä¼˜åŒ–ï¼Œä½¿å…¶åœ¨é«˜å™ªå£°ï¼Œå·¥å†µå¤æ‚çš„å·¥å†µä¸‹ä¿æŒè‰¯å¥½çš„åˆ†ç±»ç²¾åº¦æ˜¯ç›®å‰æ•…éšœè¯Šæ–­çš„ç ”ç©¶æ–¹å‘ã€‚ â€‹ å†œæœºå¤‡ä»¶çš„æ•…éšœè¯Šæ–­çš„è¯ï¼Œå®éªŒå°çš„è®¾è®¡å’Œå¤‡ä»¶çš„é€‰æ‹©ï¼Œä»¥åŠå¤‡ä»¶çš„æ•…éšœåˆ†ç±»éƒ½è‡³å…³é‡è¦ï¼›å¹¶ä¸”ï¼ŒåŸºäºæŒ¯åŠ¨ä¿¡å·çš„æ•…éšœè¯Šæ–­å¯¹ä¼ æ„Ÿå™¨çš„é‡‡æ ·é¢‘ç‡æœ‰è¾ƒé«˜è¦æ±‚ï¼Œé«˜é‡‡æ ·é¢‘ç‡èƒ½æ›´å¥½çš„ååº”æ—‹è½¬éƒ¨ä»¶çš„è¿è¡Œæƒ…å†µï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨é«˜é‡‡æ ·é¢‘ç‡çš„åŠ é€Ÿåº¦ä¼ æ„Ÿå™¨ã€‚è¿˜éœ€è¦æ¨¡æ‹Ÿä¸åŒè´Ÿè½½ï¼Œä¸åŒè½¬é€Ÿä¸‹çš„å·¥å†µï¼Œé‡‡é›†æ•°æ®å¹¶æ”¾å…¥æ¨¡å‹ä¸­å®éªŒã€‚ ç¨‹åºå®Œæ•´ä»£ç ","categories":[{"name":"æ•…éšœè¯Šæ–­","slug":"æ•…éšœè¯Šæ–­","permalink":"http://kaillliu.github.io/categories/%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/"}],"tags":[{"name":"æ·±åº¦å­¦ä¹ ","slug":"æ·±åº¦å­¦ä¹ ","permalink":"http://kaillliu.github.io/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"},{"name":"CNN","slug":"CNN","permalink":"http://kaillliu.github.io/tags/CNN/"},{"name":"æ•…éšœè¯Šæ–­","slug":"æ•…éšœè¯Šæ–­","permalink":"http://kaillliu.github.io/tags/%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/"}]},{"title":"GitHubå‘½ä»¤","slug":"githubæ¨é€","date":"2022-06-19T14:46:23.000Z","updated":"2022-06-19T14:53:44.670Z","comments":true,"path":"2022/06/19/githubæ¨é€/","link":"","permalink":"http://kaillliu.github.io/2022/06/19/github%E6%8E%A8%E9%80%81/","excerpt":"","text":"1.å…ˆåœ¨githubä¸Šé¢åˆ›å»ºä¸€ä¸ªé¡¹ç›®åœ°å€ https://blog.csdn.net/qq_34645412/article/details/80517184 2.å…¶æ¬¡è¿›å…¥åˆ°æœ¬åœ°é¡¹ç›®çš„ç›®å½•æ–‡ä»¶ä¸‹é¢ æ‰§è¡Œ git initï¼šåˆå§‹åŒ–æœ¬åœ°ä»“åº“ git add . æ·»åŠ å…¨éƒ¨å·²ç»ä¿®æ”¹çš„æ–‡ä»¶ï¼Œå‡†å¤‡commit æäº¤ è¯¥å‘½ä»¤æ•ˆæœç­‰åŒäº git add -A git commit -m â€˜æäº¤è¯´æ˜â€™ å°†ä¿®æ”¹åçš„æ–‡ä»¶æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œå¦‚ï¼šgit commit -m â€˜é¡¹ç›®åˆ›å»ºâ€™ è¿æ¥åˆ°è¿œç¨‹ä»“åº“ï¼Œå¹¶å°†ä»£ç åŒæ­¥åˆ°è¿œç¨‹ä»“åº“ â€‹ git remote add origin è¿œç¨‹ä»“åº“åœ°å€ git pull origin master // æŠŠæœ¬åœ°ä»“åº“çš„å˜åŒ–è¿æ¥åˆ°è¿œç¨‹ä»“åº“ä¸»åˆ†æ”¯ git push -u origin master åˆ›å»ºä¸€ä¸ª upStream ï¼ˆä¸Šä¼ æµï¼‰ï¼Œå¹¶å°†æœ¬åœ°ä»£ç é€šè¿‡è¿™ä¸ª upStream æ¨é€åˆ° åˆ«åä¸º origin çš„ä»“åº“ä¸­çš„ master åˆ†æ”¯ä¸Šï¼Œ â€‹ -u ï¼Œå°±æ˜¯åˆ›å»º upStream ä¸Šä¼ æµï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªä¸Šä¼ æµå°±æ— æ³•å°†ä»£ç æ¨é€åˆ° githubï¼›åŒæ—¶ï¼Œè¿™ä¸ª upStream åªéœ€è¦åœ¨åˆæ¬¡æ¨é€ä»£ç çš„æ—¶å€™åˆ›å»ºï¼Œä»¥åå°±ä¸ç”¨åˆ›å»ºäº† â€‹ åˆ°æ­¤æ‰§è¡Œå®Œæ¯•ï¼ŒæŸ¥çœ‹åˆ†æ”¯æäº¤çŠ¶æ€ç¡®è®¤æ˜¯å¦æäº¤å®Œæ•´ git status å¦‚æœé‡åˆ°ï¼šUpdates were rejected because the remote contains work that you doçš„é—®é¢˜ æ‰§è¡Œgit push -u origin master å‰ æ‰§è¡Œgit pull origin master å¦‚æœé‡åˆ°Updates were rejected because the tip of your current branch is behindå³:è‡ªå·±å½“å‰ç‰ˆæœ¬ä½äºè¿œç¨‹ä»“åº“ç‰ˆæœ¬ æ‰§è¡Œ git push -u origin master -f","categories":[{"name":"GitHub","slug":"GitHub","permalink":"http://kaillliu.github.io/categories/GitHub/"}],"tags":[{"name":"GitHub","slug":"GitHub","permalink":"http://kaillliu.github.io/tags/GitHub/"}]},{"title":"CentOS 7 é…ç½®docket","slug":"CentOS 7é…ç½®docket","date":"2022-05-09T07:32:13.000Z","updated":"2022-05-09T07:48:38.011Z","comments":true,"path":"2022/05/09/CentOS 7é…ç½®docket/","link":"","permalink":"http://kaillliu.github.io/2022/05/09/CentOS%207%E9%85%8D%E7%BD%AEdocket/","excerpt":"","text":"Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªå¯ç§»æ¤çš„å®¹å™¨ä¸­,ç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„Linuxæœºå™¨æˆ–Windows æœºå™¨ä¸Š,ä¹Ÿå¯ä»¥å®ç°è™šæ‹ŸåŒ–,å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶,ç›¸äº’ä¹‹é—´ä¸ä¼šæœ‰ä»»ä½•æ¥å£ã€‚ Dockerç®€ä»‹ ä¸€ã€Docker å®‰è£… 1ã€Docker è¦æ±‚ CentOS ç³»ç»Ÿçš„å†…æ ¸ç‰ˆæœ¬é«˜äº 3.10 ï¼ŒæŸ¥çœ‹æœ¬é¡µé¢çš„å‰ææ¡ä»¶æ¥éªŒè¯ä½ çš„CentOS ç‰ˆæœ¬æ˜¯å¦æ”¯æŒ Docker ã€‚é€šè¿‡ uname -r å‘½ä»¤æŸ¥çœ‹ä½ å½“å‰çš„å†…æ ¸ç‰ˆæœ¬ 1uname -r 2ã€(ä½¿ç”¨ root æƒé™ç™»å½• Centos)ç¡®ä¿ yum åŒ…æ›´æ–°åˆ°æœ€æ–°ã€‚ 1sudo yum update 3ã€å¸è½½æ—§ç‰ˆæœ¬(å¦‚æœå®‰è£…è¿‡æ—§ç‰ˆæœ¬çš„è¯) 1sudo yum remove docker docker-common docker-selinux docker-engine 4ã€å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ…ï¼Œ yum-util æä¾›yum-config-manageråŠŸèƒ½ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯devicemapperé©±åŠ¨ä¾èµ–çš„ 1sudo yum install -y yum-utils device-mapper-persistent-data lvm2 5ã€è®¾ç½®yumæº 1sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo 6ã€å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ä»“åº“ä¸­æ‰€æœ‰dockerç‰ˆæœ¬ï¼Œå¹¶é€‰æ‹©ç‰¹å®šç‰ˆæœ¬å®‰è£… 1yum list docker-ce --showduplicates | sort -r 7ã€å®‰è£…docker 1sudo yum install docker-ce 8ã€å¯åŠ¨å¹¶åŠ å…¥å¼€æœºå¯åŠ¨ 123456789sudo systemctl start dockersudo systemctl restart docker # é‡å¯ sudo systemctl status docker # æŸ¥çœ‹çŠ¶æ€ sudo systemctl stop docker # åœæ­¢ sudo systemctl enable docker 9ã€å°†ç”¨æˆ·ç§»åŠ¨åˆ°dockerç»„é‡Œ 123sudo usermod -G docker $USER //å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ°dockerç»„ä¸­ï¼docker version # æŸ¥çœ‹ç‰ˆæœ¬ äºŒã€docker åŸºæœ¬å‘½ä»¤è¯¦è§£ 1.æŸ¥æ‰¾é•œåƒ 1docker search nginx 2.æ‹‰å–é•œåƒ 1docker pull nginx 3.è¿è¡Œé•œåƒå¹¶è¿›å…¥é•œåƒ 12docker run - è¿è¡Œä¸€ä¸ªå®¹å™¨ -t - åˆ†é…ä¸€ä¸ªï¼ˆä¼ªï¼‰tty (link is external) -i - äº¤äº’æ¨¡å¼ (so we can interact with it) nginx- ä½¿ç”¨ nginx åŸºç¡€é•œåƒ /bin/bash - è¿è¡Œå‘½ä»¤ bash shelldocker run -i -t nginx /bin/bash 4.docker å‘½ä»¤å¸®åŠ© 123456789101112131415161718192021222324252627282930313233343536373839docker # docker å‘½ä»¤å¸®åŠ©Commands: attach # å½“å‰ shell ä¸‹ attach è¿æ¥æŒ‡å®šè¿è¡Œé•œåƒ build # é€šè¿‡ Dockerfile å®šåˆ¶é•œåƒ commit # æäº¤å½“å‰å®¹å™¨ä¸ºæ–°çš„é•œåƒ cp # ä»å®¹å™¨ä¸­æ‹·è´æŒ‡å®šæ–‡ä»¶æˆ–è€…ç›®å½•åˆ°å®¿ä¸»æœºä¸­ create # åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼ŒåŒ runï¼Œä½†ä¸å¯åŠ¨å®¹å™¨ diff # æŸ¥çœ‹ docker å®¹å™¨å˜åŒ–ï¼Œæ£€æŸ¥å®¹å™¨æ–‡ä»¶ç³»ç»Ÿä¸Šæ–‡ä»¶æˆ–ç›®å½•çš„æ›´æ”¹ A æ·»åŠ äº†æ–‡ä»¶æˆ–ç›®å½•ï¼ŒD æ–‡ä»¶æˆ–ç›®å½•å·²åˆ é™¤ï¼ŒC æ–‡ä»¶æˆ–ç›®å½•å·²æ›´æ”¹ events # ä» docker æœåŠ¡è·å–å®¹å™¨å®æ—¶äº‹ä»¶ exec # åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸Šè¿è¡Œå‘½ä»¤ export # å¯¼å‡ºå®¹å™¨çš„å†…å®¹æµä½œä¸ºä¸€ä¸ª tar å½’æ¡£æ–‡ä»¶[å¯¹åº” import ] history # å±•ç¤ºä¸€ä¸ªé•œåƒå½¢æˆå†å² images # åˆ—å‡ºç³»ç»Ÿå½“å‰é•œåƒ import # ä»taråŒ…ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿæ˜ åƒ[å¯¹åº” export] info # æ˜¾ç¤ºç³»ç»Ÿç›¸å…³ä¿¡æ¯ inspect # æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ kill # kill æŒ‡å®š docker å®¹å™¨ load # ä»ä¸€ä¸ª tar åŒ…ä¸­åŠ è½½ä¸€ä¸ªé•œåƒ[å¯¹åº” save] login # æ³¨å†Œæˆ–è€…ç™»é™†ä¸€ä¸ª docker æºæœåŠ¡å™¨ logout # ä»å½“å‰ Docker registry é€€å‡º logs # è¾“å‡ºå½“å‰å®¹å™¨æ—¥å¿—ä¿¡æ¯ -f åŠ¨æ€æŸ¥çœ‹ port # æŸ¥çœ‹æ˜ å°„ç«¯å£å¯¹åº”çš„å®¹å™¨å†…éƒ¨æºç«¯å£ pause # æš‚åœå®¹å™¨ ps # åˆ—å‡ºå®¹å™¨åˆ—è¡¨ pull # ä»dockeré•œåƒæºæœåŠ¡å™¨æ‹‰å–æŒ‡å®šé•œåƒæˆ–è€…åº“é•œåƒ push # æ¨é€æŒ‡å®šé•œåƒæˆ–è€…åº“é•œåƒè‡³dockeræºæœåŠ¡å™¨ restart # é‡å¯è¿è¡Œçš„å®¹å™¨ rm # ç§»é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ rmi # ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ[æ— å®¹å™¨ä½¿ç”¨è¯¥é•œåƒæ‰å¯åˆ é™¤ï¼Œå¦åˆ™éœ€åˆ é™¤ç›¸å…³å®¹å™¨æ‰å¯ç»§ç»­æˆ– -f å¼ºåˆ¶åˆ é™¤] run # åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è¿è¡Œä¸€ä¸ªå‘½ä»¤ save # ä¿å­˜ä¸€ä¸ªé•œåƒä¸ºä¸€ä¸ª tar åŒ…[å¯¹åº” load] search # åœ¨ docker hub ä¸­æœç´¢é•œåƒ start # å¯åŠ¨å®¹å™¨ stop # åœæ­¢å®¹å™¨ tag # ç»™æºä¸­é•œåƒæ‰“æ ‡ç­¾ top # æŸ¥çœ‹å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯ unpause # å–æ¶ˆæš‚åœå®¹å™¨ version # æŸ¥çœ‹ docker ç‰ˆæœ¬å· wait # æˆªå–å®¹å™¨åœæ­¢æ—¶çš„é€€å‡ºçŠ¶æ€å€¼ 5. docker option 1234567891011121314151617181920212223242526272829303132333435Usage of docker: --api-enable-cors=false # è¿œç¨‹ API ä¸­å¼€å¯ CORS å¤´ -b, --bridge=&quot;&quot; # æ¡¥æ¥ç½‘ç»œuse &#x27;none&#x27; to disable container networking --bip=&quot;&quot; # å’Œ -b é€‰é¡¹ä¸å…¼å®¹ï¼Œå…·ä½“æ²¡æœ‰æµ‹è¯•è¿‡ -d, --daemon=false # daemon æ¨¡å¼ -D, --debug=false # debug æ¨¡å¼ --dns=[] # å¼ºåˆ¶ docker ä½¿ç”¨æŒ‡å®š dns æœåŠ¡å™¨ --dns-search=[] # å¼ºåˆ¶ docker ä½¿ç”¨æŒ‡å®š dns æœç´¢åŸŸ -e, --exec-driver=&quot;native&quot; # å¼ºåˆ¶ docker è¿è¡Œæ—¶ä½¿ç”¨æŒ‡å®šæ‰§è¡Œé©±åŠ¨å™¨ --fixed-cidr=&quot;&quot; IPv4 subnet for fixed IPs (ex: 10.20.0.0/16)this subnet must be nested in the bridge subnet (which is defined by -b or --bip) -G, --group=&quot;docker&quot; Group to assign the unix socket specified by -H when running in daemon mode use &#x27;&#x27; (the empty string) to disable setting of a group -g, --graph=&quot;/var/lib/docker&quot; # å®¹å™¨è¿è¡Œçš„æ ¹ç›®å½•è·¯å¾„ -H, --host=[] # daemon æ¨¡å¼ä¸‹ docker æŒ‡å®šç»‘å®šæ–¹å¼[tcp or æœ¬åœ° socket] specified using one or more tcp://host:port, unix:///path/to/socket, fd://* or fd://socketfd. --icc=true # è·¨å®¹å™¨é€šä¿¡ --insecure-registry=[] Enable insecure communication with specified registries (no certificate verification for HTTPS and enable HTTP fallback) (e.g., localhost:5000 or 10.20.0.0/16) --ip=&quot;0.0.0.0&quot; # æŒ‡å®šç›‘å¬åœ°å€ï¼Œé»˜è®¤æ‰€æœ‰ ip --ip-forward=true # å¼€å¯è½¬å‘ --ip-masq=true Enable IP masquerading for bridge&#x27;s IP range --iptables=true # æ·»åŠ å¯¹åº” iptables è§„åˆ™ --mtu=0 # è®¾ç½®ç½‘ç»œ mtu if no value is provided: default to the default route MTU or 1500 if no default route is available -p, --pidfile=&quot;/var/run/docker.pid&quot; # æŒ‡å®š pid æ–‡ä»¶ä½ç½® --registry-mirror=[] Specify a preferred Docker registry mirror -s, --storage-driver=&quot;&quot; # å¼ºåˆ¶ docker è¿è¡Œæ—¶ä½¿ç”¨æŒ‡å®šå­˜å‚¨é©±åŠ¨ --selinux-enabled=false # å¼€å¯ selinux æ”¯æŒ --storage-opt=[] # è®¾ç½®å­˜å‚¨é©±åŠ¨é€‰é¡¹ --tls=false # å¼€å¯ tls --tlscacert=&quot;/root/.docker/ca.pem&quot; Trust only remotes providing a certificate signed by the CA given here --tlscert=&quot;/root/.docker/cert.pem&quot; # tls è¯ä¹¦æ–‡ä»¶ä½ç½® --tlskey=&quot;/root/.docker/key.pem&quot; # tls key æ–‡ä»¶ä½ç½® --tlsverify=false # ä½¿ç”¨ tls å¹¶ç¡®è®¤è¿œç¨‹æ§åˆ¶ä¸»æœº -v, --version=false # è¾“å‡º docker ç‰ˆæœ¬ä¿¡æ¯ 6.docker run 123456789101112131415161718192021222324252627282930313233docker run --helpUsage: docker run [OPTIONS] IMAGE [COMMAND] [ARG...] Run a command in a new container -a, --attach=[] Attach to stdin, stdout or stderr. -c, --cpu-shares=0 # è®¾ç½® cpu ä½¿ç”¨æƒé‡ --cap-add=[] Add Linux capabilities --cap-drop=[] Drop Linux capabilities --cidfile=&quot;&quot; # æŠŠå®¹å™¨ id å†™å…¥åˆ°æŒ‡å®šæ–‡ä»¶ --cpuset=&quot;&quot; # cpu ç»‘å®š -d, --detach=false Detached mode: Run container in the background, print new container id # åå°è¿è¡Œå®¹å™¨ --device=[] Add a host device to the container (e.g. --device=/dev/sdc:/dev/xvdc) --dns=[] # è®¾ç½® dns --dns-search=[] # è®¾ç½® dns åŸŸæœç´¢ -e, --env=[] # å®šä¹‰ç¯å¢ƒå˜é‡ --entrypoint=&quot;&quot; Overwrite the default entrypoint of the image # ï¼Ÿ --env-file=[] # ä»æŒ‡å®šæ–‡ä»¶è¯»å–å˜é‡å€¼ --expose=[] # æŒ‡å®šå¯¹å¤–æä¾›æœåŠ¡ç«¯å£ -h, --hostname=&quot;&quot; # è®¾ç½®å®¹å™¨ä¸»æœºå -i, --interactive=false # ä¿æŒæ ‡å‡†è¾“å‡ºå¼€å¯å³ä½¿æ²¡æœ‰ attached --link=[] # æ·»åŠ é“¾æ¥åˆ°å¦å¤–ä¸€ä¸ªå®¹å™¨ --lxc-conf=[] (lxc exec-driver only) Add custom lxc options --lxc-conf=&quot;lxc.cgroup.cpuset.cpus = 0,1&quot; -m, --memory=&quot;&quot; # å†…å­˜é™åˆ¶ --name=&quot;&quot; # è®¾ç½®å®¹å™¨å --net=&quot;bridge&quot; # è®¾ç½®å®¹å™¨ç½‘ç»œæ¨¡å¼ &#x27;bridge&#x27;: creates a new network stack for the container on the docker bridge &#x27;none&#x27;: no networking for this container &#x27;container:&lt;name|id&gt;&#x27;: reuses another container network stack &#x27;host&#x27;: use the host network stack inside the container. Note: the host mode gives the container full access to local system services such as D-bus and is therefore considered insecure. -P, --publish-all=false # è‡ªåŠ¨æ˜ å°„å®¹å™¨å¯¹å¤–æä¾›æœåŠ¡çš„ç«¯å£ -p, --publish=[] # æŒ‡å®šç«¯å£æ˜ å°„ format: ip:hostPort:containerPort | ip::containerPort | hostPort:containerPort (use &#x27;docker port&#x27; to see the actual mapping) --privileged=false # æä¾›æ›´å¤šçš„æƒé™ç»™å®¹å™¨ --restart=&quot;&quot; Restart policy to apply when a container exits (no, on-failure[:max-retry], always) --rm=false # å¦‚æœå®¹å™¨é€€å‡ºè‡ªåŠ¨ç§»é™¤å’Œ -d é€‰é¡¹å†²çª --security-opt=[] Security Options --sig-proxy=true Proxify received signals to the process (even in non-tty mode). SIGCHLD is not proxied. -t, --tty=false # åˆ†é…ä¼ªç»ˆç«¯ -u, --user=&quot;&quot; # æŒ‡å®šè¿è¡Œå®¹å™¨çš„ç”¨æˆ· uid æˆ–è€…ç”¨æˆ·å -v, --volume=[] # æŒ‚è½½å· --volumes-from=[] # ä»æŒ‡å®šå®¹å™¨æŒ‚è½½å· -w, --workdir=&quot;&quot; # æŒ‡å®šå®¹å™¨å·¥ä½œç›®å½• 7.å‘½ä»¤ä¸¾ä¾‹ 123456789101112docker psï¼šåˆ—å‡ºè¿è¡Œä¸­çš„å®¹å™¨docker ps -a ï¼šåˆ—å‡ºæ‰€æœ‰çš„å®¹å™¨docker stop å®¹å™¨idï¼šåœæ­¢å®¹å™¨docker kill å®¹å™¨idï¼šå¼ºåˆ¶åœæ­¢å®¹å™¨docker start å®¹å™¨idï¼šå¯åŠ¨å·²åœæ­¢çš„å®¹å™¨docker inspect å®¹å™¨idï¼šæŸ¥çœ‹å®¹å™¨çš„æ‰€æœ‰ä¿¡æ¯docker container logs å®¹å™¨idï¼šæŸ¥çœ‹å®¹å™¨æ—¥å¿—docker top å®¹å™¨idï¼šæŸ¥çœ‹å®¹å™¨é‡Œçš„è¿›ç¨‹docker exec -it å®¹å™¨id /bin/bashï¼šè¿›å…¥å®¹å™¨exitï¼šé€€å‡ºå®¹å™¨docker rm å®¹å™¨idï¼šåˆ é™¤å·²åœæ­¢çš„å®¹å™¨docker rm -f å®¹å™¨idï¼šåˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨ ä¸‰ã€dockerå®‰è£…é•œåƒå¹¶æŒ‚è½½ç›®å½•æ–‡ä»¶ 1ä»¥nginxä¸ºä¾‹ï¼š 1.åœ¨Dockerä¸‹è½½Nginxé•œåƒ 12docker pull nginx ##æ‹‰å–é•œåƒdocker images ##æŸ¥çœ‹é•œåƒ 2.åˆ›å»ºæŒ‚è½½ç›®å½• 123mkdir nginxcd nginxmkdir conf.d logs html 3.æŒ‚è½½å¹¶å¯åŠ¨nginx 12å‘½ä»¤è¯´æ˜ï¼š â€“privileged=true é…ç½®äº†nginx.confçš„å¤–éƒ¨æŒ‚è½½ ä¹‹åå¯èƒ½å¯¼è‡´nginxä¸èƒ½å¯åŠ¨ï¼Œä½¿ç”¨è¯¥å‘½ä»¤ï¼› -v /home/dabing/conf.d/default.conf:/etc/nginx/conf.d/default.conf æŒ‚è½½é»˜è®¤é…ç½®æ–‡ä»¶ -v /home/dabing/conf/nginx.conf:/etc/nginx/nginx.conf æŒ‚è½½nginx.confæ–‡ä»¶ -v /home/dabing/logs:/var/log/nginx æŒ‚è½½æ—¥å¿—ç›®å½• -v /home/dabing/html:/usr/share/nginx/html æŒ‚è½½htmlç›®å½•docker run -p 80:80 --name nginx1 --privileged=true -v /home/dabing/nginx/html:/usr/share/nginx/html -v /home/dabing/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /home/dabing/nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf -v /home/dabing/nginx/logs:/var/log/nginx -d nginx 4.dockerè¿›å…¥å®¹å™¨ 1docker exec -it 775c7c9ee1e1 /bin/bash å››ã€Dockerfile Dockerfileæ˜¯ä¸€ä¸ªåŒ…å«ç”¨äºç»„åˆæ˜ åƒçš„å‘½ä»¤çš„æ–‡æœ¬æ–‡æ¡£ã€‚å¯ä»¥ä½¿ç”¨åœ¨å‘½ä»¤è¡Œä¸­è°ƒç”¨ä»»ä½•å‘½ä»¤ã€‚ Dockeré€šè¿‡è¯»å–Dockerfileä¸­çš„æŒ‡ä»¤è‡ªåŠ¨ç”Ÿæˆæ˜ åƒã€‚ 1.docker buildå‘½ä»¤ç”¨äºä»Dockerfileæ„å»ºæ˜ åƒã€‚å¯ä»¥åœ¨docker buildå‘½ä»¤ä¸­ä½¿ç”¨-fæ ‡å¿—æŒ‡å‘æ–‡ä»¶ç³»ç»Ÿä¸­ä»»ä½•ä½ç½®çš„Dockerfileã€‚ 1docker build -f /path/to/a/Dockerfile 2.Dockerfileçš„åŸºæœ¬ç»“æ„ Dockerfile ä¸€èˆ¬åˆ†ä¸ºå››éƒ¨åˆ†ï¼šåŸºç¡€é•œåƒä¿¡æ¯ã€ç»´æŠ¤è€…ä¿¡æ¯ã€é•œåƒæ“ä½œæŒ‡ä»¤å’Œå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡ŒæŒ‡ä»¤ï¼Œâ€™#â€™ ä¸º Dockerfile ä¸­çš„æ³¨é‡Šã€‚ 3.Dockerfileæ–‡ä»¶è¯´æ˜ Dockerä»¥ä»ä¸Šåˆ°ä¸‹çš„é¡ºåºè¿è¡ŒDockerfileçš„æŒ‡ä»¤ã€‚ä¸ºäº†æŒ‡å®šåŸºæœ¬æ˜ åƒï¼Œç¬¬ä¸€æ¡æŒ‡ä»¤å¿…é¡»æ˜¯FROMã€‚ä¸€ä¸ªå£°æ˜ä»¥ï¼ƒå­—ç¬¦å¼€å¤´åˆ™è¢«è§†ä¸ºæ³¨é‡Šã€‚å¯ä»¥åœ¨Dockeræ–‡ä»¶ä¸­ä½¿ç”¨RUNï¼ŒCMDï¼ŒFROMï¼ŒEXPOSEï¼ŒENVç­‰æŒ‡ä»¤ã€‚ 1.FROMï¼šæŒ‡å®šåŸºç¡€é•œåƒï¼Œå¿…é¡»ä¸ºç¬¬ä¸€ä¸ªå‘½ä»¤ 12345678æ ¼å¼ï¼š FROM &lt;image&gt; FROM &lt;image&gt;:&lt;tag&gt; FROM &lt;image&gt;@&lt;digest&gt;ç¤ºä¾‹ï¼š FROM mysql:5.7æ³¨ï¼š tagæˆ–digestæ˜¯å¯é€‰çš„ï¼Œå¦‚æœä¸ä½¿ç”¨è¿™ä¸¤ä¸ªå€¼æ—¶ï¼Œä¼šä½¿ç”¨latestç‰ˆæœ¬çš„åŸºç¡€é•œåƒ 2.MAINTAINER: ç»´æŠ¤è€…ä¿¡æ¯ 123456æ ¼å¼ï¼š MAINTAINER &lt;name&gt;ç¤ºä¾‹ï¼š MAINTAINER Jasper Xu MAINTAINER sorex@163.com MAINTAINER Jasper Xu &lt;sorex@163.com&gt; 3.RUNï¼šæ„å»ºé•œåƒæ—¶æ‰§è¡Œçš„å‘½ä»¤ 12345678910111213RUNç”¨äºåœ¨é•œåƒå®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œå…¶æœ‰ä»¥ä¸‹ä¸¤ç§å‘½ä»¤æ‰§è¡Œæ–¹å¼ï¼šshellæ‰§è¡Œæ ¼å¼ï¼š RUN &lt;command&gt;execæ‰§è¡Œæ ¼å¼ï¼š RUN [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]ç¤ºä¾‹ï¼š RUN [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;] RUN apk update RUN [&quot;/etc/execfile&quot;, &quot;arg1&quot;, &quot;arg1&quot;]æ³¨ï¼š RUNæŒ‡ä»¤åˆ›å»ºçš„ä¸­é—´é•œåƒä¼šè¢«ç¼“å­˜ï¼Œå¹¶ä¼šåœ¨ä¸‹æ¬¡æ„å»ºä¸­ä½¿ç”¨ã€‚å¦‚æœä¸æƒ³ä½¿ç”¨è¿™äº›ç¼“å­˜é•œåƒï¼Œå¯ä»¥åœ¨æ„å»ºæ—¶æŒ‡å®š--no-cacheå‚æ•°ï¼Œå¦‚ï¼šdocker build --no-cache 4.ADDï¼šå°†æœ¬åœ°æ–‡ä»¶æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼Œtarç±»å‹æ–‡ä»¶ä¼šè‡ªåŠ¨è§£å‹(ç½‘ç»œå‹ç¼©èµ„æºä¸ä¼šè¢«è§£å‹)ï¼Œå¯ä»¥è®¿é—®ç½‘ç»œèµ„æºï¼Œç±»ä¼¼wget 12345678æ ¼å¼ï¼š ADD &lt;src&gt;... &lt;dest&gt; ADD [&quot;&lt;src&gt;&quot;,... &quot;&lt;dest&gt;&quot;] ç”¨äºæ”¯æŒåŒ…å«ç©ºæ ¼çš„è·¯å¾„ç¤ºä¾‹ï¼š ADD hom* /mydir/ # æ·»åŠ æ‰€æœ‰ä»¥&quot;hom&quot;å¼€å¤´çš„æ–‡ä»¶ ADD hom?.txt /mydir/ # ? æ›¿ä»£ä¸€ä¸ªå•å­—ç¬¦,ä¾‹å¦‚ï¼š&quot;home.txt&quot; ADD test relativeDir/ # æ·»åŠ  &quot;test&quot; åˆ° `WORKDIR`/relativeDir/ ADD test /absoluteDir/ # æ·»åŠ  &quot;test&quot; åˆ° /absoluteDir/ 5.COPYï¼šåŠŸèƒ½ç±»ä¼¼ADDï¼Œä½†æ˜¯æ˜¯ä¸ä¼šè‡ªåŠ¨è§£å‹æ–‡ä»¶ï¼Œä¹Ÿä¸èƒ½è®¿é—®ç½‘ç»œèµ„æº 6.CMDï¼šæ„å»ºå®¹å™¨åè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯åœ¨å®¹å™¨å¯åŠ¨æ—¶æ‰è¿›è¡Œè°ƒç”¨ã€‚ 123456789æ ¼å¼ï¼š CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;] (æ‰§è¡Œå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¼˜å…ˆ) CMD [&quot;param1&quot;,&quot;param2&quot;] (è®¾ç½®äº†ENTRYPOINTï¼Œåˆ™ç›´æ¥è°ƒç”¨ENTRYPOINTæ·»åŠ å‚æ•°) CMD command param1 param2 (æ‰§è¡Œshellå†…éƒ¨å‘½ä»¤)ç¤ºä¾‹ï¼š CMD echo &quot;This is a test.&quot; | wc - CMD [&quot;/usr/bin/wc&quot;,&quot;--help&quot;]æ³¨ï¼š CMDä¸åŒäºRUNï¼ŒCMDç”¨äºæŒ‡å®šåœ¨å®¹å™¨å¯åŠ¨æ—¶æ‰€è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œè€ŒRUNç”¨äºæŒ‡å®šé•œåƒæ„å»ºæ—¶æ‰€è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚ 7.ENTRYPOINTï¼šé…ç½®å®¹å™¨ï¼Œä½¿å…¶å¯æ‰§è¡ŒåŒ–ã€‚é…åˆCMDå¯çœå»&quot;application&quot;ï¼Œåªä½¿ç”¨å‚æ•°ã€‚ 123456789æ ¼å¼ï¼š ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;] (å¯æ‰§è¡Œæ–‡ä»¶, ä¼˜å…ˆ) ENTRYPOINT command param1 param2 (shellå†…éƒ¨å‘½ä»¤)ç¤ºä¾‹ï¼š FROM ubuntu ENTRYPOINT [&quot;top&quot;, &quot;-b&quot;] CMD [&quot;-c&quot;]æ³¨ï¼š ENTRYPOINTä¸CMDéå¸¸ç±»ä¼¼ï¼Œä¸åŒçš„æ˜¯é€šè¿‡docker runæ‰§è¡Œçš„å‘½ä»¤ä¸ä¼šè¦†ç›–ENTRYPOINTï¼Œè€Œdocker runå‘½ä»¤ä¸­æŒ‡å®šçš„ä»»ä½•å‚æ•°ï¼Œéƒ½ä¼šè¢«å½“åšå‚æ•°å†æ¬¡ä¼ é€’ç»™ENTRYPOINTã€‚Dockerfileä¸­åªå…è®¸æœ‰ä¸€ä¸ªENTRYPOINTå‘½ä»¤ï¼Œå¤šæŒ‡å®šæ—¶ä¼šè¦†ç›–å‰é¢çš„è®¾ç½®ï¼Œè€Œåªæ‰§è¡Œæœ€åçš„ENTRYPOINTæŒ‡ä»¤ã€‚ 8.LABELï¼šç”¨äºä¸ºé•œåƒæ·»åŠ å…ƒæ•°æ® 123456æ ¼å¼ï¼š LABEL &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...ç¤ºä¾‹ï¼š LABEL version=&quot;1.0&quot; description=&quot;è¿™æ˜¯ä¸€ä¸ªWebæœåŠ¡å™¨&quot; by=&quot;ITç¬”å½•&quot;æ³¨ï¼š ä½¿ç”¨LABELæŒ‡å®šå…ƒæ•°æ®æ—¶ï¼Œä¸€æ¡LABELæŒ‡å®šå¯ä»¥æŒ‡å®šä¸€æˆ–å¤šæ¡å…ƒæ•°æ®ï¼ŒæŒ‡å®šå¤šæ¡å…ƒæ•°æ®æ—¶ä¸åŒå…ƒæ•°æ®ä¹‹é—´é€šè¿‡ç©ºæ ¼åˆ†éš”ã€‚æ¨èå°†æ‰€æœ‰çš„å…ƒæ•°æ®é€šè¿‡ä¸€æ¡LABELæŒ‡ä»¤æŒ‡å®šï¼Œä»¥å…ç”Ÿæˆè¿‡å¤šçš„ä¸­é—´é•œåƒã€‚ 9.ENVï¼šè®¾ç½®ç¯å¢ƒå˜é‡ 1234567æ ¼å¼ï¼š ENV &lt;key&gt; &lt;value&gt; #&lt;key&gt;ä¹‹åçš„æ‰€æœ‰å†…å®¹å‡ä¼šè¢«è§†ä¸ºå…¶&lt;value&gt;çš„ç»„æˆéƒ¨åˆ†ï¼Œå› æ­¤ï¼Œä¸€æ¬¡åªèƒ½è®¾ç½®ä¸€ä¸ªå˜é‡ ENV &lt;key&gt;=&lt;value&gt; ... #å¯ä»¥è®¾ç½®å¤šä¸ªå˜é‡ï¼Œæ¯ä¸ªå˜é‡ä¸ºä¸€ä¸ª&quot;&lt;key&gt;=&lt;value&gt;&quot;çš„é”®å€¼å¯¹ï¼Œå¦‚æœ&lt;key&gt;ä¸­åŒ…å«ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨æ¥è¿›è¡Œè½¬ä¹‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡&quot;&quot;æ¥è¿›è¡Œæ ‡ç¤ºï¼›å¦å¤–ï¼Œåæ–œçº¿ä¹Ÿå¯ä»¥ç”¨äºç»­è¡Œç¤ºä¾‹ï¼š ENV myName John Doe ENV myDog Rex The Dog ENV myCat=fluffy 10.EXPOSEï¼šæŒ‡å®šäºå¤–ç•Œäº¤äº’çš„ç«¯å£ 12345678æ ¼å¼ï¼š EXPOSE &lt;port&gt; [&lt;port&gt;...]ç¤ºä¾‹ï¼š EXPOSE 80 443 EXPOSE 8080 EXPOSE 11211/tcp 11211/udpæ³¨ï¼š EXPOSEå¹¶ä¸ä¼šè®©å®¹å™¨çš„ç«¯å£è®¿é—®åˆ°ä¸»æœºã€‚è¦ä½¿å…¶å¯è®¿é—®ï¼Œéœ€è¦åœ¨docker runè¿è¡Œå®¹å™¨æ—¶é€šè¿‡-pæ¥å‘å¸ƒè¿™äº›ç«¯å£ï¼Œæˆ–é€šè¿‡-På‚æ•°æ¥å‘å¸ƒEXPOSEå¯¼å‡ºçš„æ‰€æœ‰ç«¯å£ 11.VOLUMEï¼šç”¨äºæŒ‡å®šæŒä¹…åŒ–ç›®å½• 123456789101112æ ¼å¼ï¼š VOLUME [&quot;/path/to/dir&quot;]ç¤ºä¾‹ï¼š VOLUME [&quot;/data&quot;] VOLUME [&quot;/var/www&quot;, &quot;/var/log/apache2&quot;, &quot;/etc/apache2&quot;æ³¨ï¼š ä¸€ä¸ªå·å¯ä»¥å­˜åœ¨äºä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„æŒ‡å®šç›®å½•ï¼Œè¯¥ç›®å½•å¯ä»¥ç»•è¿‡è”åˆæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶å…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š1 å·å¯ä»¥å®¹å™¨é—´å…±äº«å’Œé‡ç”¨2 å®¹å™¨å¹¶ä¸ä¸€å®šè¦å’Œå…¶å®ƒå®¹å™¨å…±äº«å·3 ä¿®æ”¹å·åä¼šç«‹å³ç”Ÿæ•ˆ4 å¯¹å·çš„ä¿®æ”¹ä¸ä¼šå¯¹é•œåƒäº§ç”Ÿå½±å“5 å·ä¼šä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•å®¹å™¨åœ¨ä½¿ç”¨å®ƒ 12.WORKDIRï¼šå·¥ä½œç›®å½•ï¼Œç±»ä¼¼äºcdå‘½ä»¤ 12345678æ ¼å¼ï¼š WORKDIR /path/to/workdirç¤ºä¾‹ï¼š WORKDIR /a (è¿™æ—¶å·¥ä½œç›®å½•ä¸º/a) WORKDIR b (è¿™æ—¶å·¥ä½œç›®å½•ä¸º/a/b) WORKDIR c (è¿™æ—¶å·¥ä½œç›®å½•ä¸º/a/b/c)æ³¨ï¼š é€šè¿‡WORKDIRè®¾ç½®å·¥ä½œç›®å½•åï¼ŒDockerfileä¸­å…¶åçš„å‘½ä»¤RUNã€CMDã€ENTRYPOINTã€ADDã€COPYç­‰å‘½ä»¤éƒ½ä¼šåœ¨è¯¥ç›®å½•ä¸‹æ‰§è¡Œã€‚åœ¨ä½¿ç”¨docker runè¿è¡Œå®¹å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡-wå‚æ•°è¦†ç›–æ„å»ºæ—¶æ‰€è®¾ç½®çš„å·¥ä½œç›®å½•ã€‚ 13.USER:æŒ‡å®šè¿è¡Œå®¹å™¨æ—¶çš„ç”¨æˆ·åæˆ– UIDï¼Œåç»­çš„ RUN ä¹Ÿä¼šä½¿ç”¨æŒ‡å®šç”¨æˆ·ã€‚ä½¿ç”¨USERæŒ‡å®šç”¨æˆ·æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç”¨æˆ·åã€UIDæˆ–GIDï¼Œæˆ–æ˜¯ä¸¤è€…çš„ç»„åˆã€‚å½“æœåŠ¡ä¸éœ€è¦ç®¡ç†å‘˜æƒé™æ—¶ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤æŒ‡å®šè¿è¡Œç”¨æˆ·ã€‚å¹¶ä¸”å¯ä»¥åœ¨ä¹‹å‰åˆ›å»ºæ‰€éœ€è¦çš„ç”¨æˆ· 1234567891011æ ¼å¼: USER user USER user:group USER uid USER uid:gid USER user:gid USER uid:group ç¤ºä¾‹ï¼š USER www æ³¨ï¼š ä½¿ç”¨USERæŒ‡å®šç”¨æˆ·åï¼ŒDockerfileä¸­å…¶åçš„å‘½ä»¤RUNã€CMDã€ENTRYPOINTéƒ½å°†ä½¿ç”¨è¯¥ç”¨æˆ·ã€‚é•œåƒæ„å»ºå®Œæˆåï¼Œé€šè¿‡docker runè¿è¡Œå®¹å™¨æ—¶ï¼Œå¯ä»¥é€šè¿‡-uå‚æ•°æ¥è¦†ç›–æ‰€æŒ‡å®šçš„ç”¨æˆ·ã€‚ 14.ARGï¼šç”¨äºæŒ‡å®šä¼ é€’ç»™æ„å»ºè¿è¡Œæ—¶çš„å˜é‡ 12345æ ¼å¼ï¼š ARG &lt;name&gt;[=&lt;default value&gt;]ç¤ºä¾‹ï¼š ARG site ARG build_user=www 15.ONBUILDï¼šç”¨äºè®¾ç½®é•œåƒè§¦å‘å™¨ 1234567æ ¼å¼ï¼š ONBUILD [INSTRUCTION]ç¤ºä¾‹ï¼š ONBUILD ADD . /app/src ONBUILD RUN /usr/local/bin/python-build --dir /app/srcæ³¨ï¼š å½“æ‰€æ„å»ºçš„é•œåƒè¢«ç”¨åšå…¶å®ƒé•œåƒçš„åŸºç¡€é•œåƒï¼Œè¯¥é•œåƒä¸­çš„è§¦å‘å™¨å°†ä¼šè¢«é’¥è§¦å‘ ä¾‹ï¼š 1234567891011121314151617181920212223# This my first nginx Dockerfile# Version 1.0# Base images åŸºç¡€é•œåƒFROM centos#MAINTAINER ç»´æŠ¤è€…ä¿¡æ¯MAINTAINER tianfeiyu #ENV è®¾ç½®ç¯å¢ƒå˜é‡ENV PATH /usr/local/nginx/sbin:$PATH#ADD æ–‡ä»¶æ”¾åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œæ‹·è¿‡å»ä¼šè‡ªåŠ¨è§£å‹ADD nginx-1.8.0.tar.gz /usr/local/ ADD epel-release-latest-7.noarch.rpm /usr/local/ #RUN æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ RUN rpm -ivh /usr/local/epel-release-latest-7.noarch.rpmRUN yum install -y wget lftp gcc gcc-c++ make openssl-devel pcre-devel pcre &amp;&amp; yum clean allRUN useradd -s /sbin/nologin -M www#WORKDIR ç›¸å½“äºcdWORKDIR /usr/local/nginx-1.8.0 RUN ./configure --prefix=/usr/local/nginx --user=www --group=www --with-http_ssl_module --with-pcre &amp;&amp; make &amp;&amp; make installRUN echo &quot;daemon off;&quot; &gt;&gt; /etc/nginx.conf#EXPOSE æ˜ å°„ç«¯å£EXPOSE 80#CMD è¿è¡Œä»¥ä¸‹å‘½ä»¤CMD [&quot;nginx&quot;] dockerfileå›¾è§£é‡Šä¹‰ äº”ã€docker-compose Composeæ˜¯ä¸€ä¸ªç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨Dockeråº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚ä½¿ç”¨ç»„åˆï¼Œå¯ä»¥ä½¿ç”¨ç»„åˆæ–‡ä»¶é…ç½®åº”ç”¨ç¨‹åºçš„æœåŠ¡ã€‚ç„¶åï¼Œä½¿ç”¨å•ä¸ªå‘½ä»¤ä»é…ç½®ä¸­åˆ›å»ºå’Œå¯åŠ¨æ‰€æœ‰æœåŠ¡ã€‚ 123456yum -y install epel-release ##å®‰è£…pipyum -y install python-pippip --version ##ç¡®è®¤ç‰ˆæœ¬pip install --upgrade pip ##æ›´æ–°pippip install docker-compose ##å®‰è£…docker-composedocker-compose version 1.docker-compose.yml è¯¦è§£ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000100110021003100410051006100710081009101010111012101310141015101610171018101910201021102210231024102510261027102810291030103110321033103410351036103710381039104010411042104310441045104610471048104910501051105210531054105510561057105810591060106110621063106410651066106710681069107010711072107310741075107610771078107910801081108210831084108510861087108810891090109110921093109410951096109710981099110011011102110311041105110611071108110911101111111211131114111511161117111811191120112111221123112411251126112711281129113011311132113311341135113611371138113911401141114211431144114511461147114811491150#ç³»ç»Ÿå˜é‡$PWD ï¼š å½“å‰ç›®å½• #æ³¨æ„ï¼šYAMLå¸ƒå°”å€¼ï¼ˆtrueï¼Œfalseï¼Œyesï¼Œnoï¼Œonï¼Œoffï¼‰å¿…é¡»ç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œä»¥ä¾¿è§£æå™¨å°†å®ƒä»¬è§£é‡Šä¸ºå­—ç¬¦ä¸²ã€‚#å­—å…¸æ—¶environment: SHOW: &#x27;true&#x27; æ•°ç»„æ—¶ environment: - SHOW=true#ç‰ˆæœ¬å·version: &quot;2.1&quot;# æŒ‡å®šåˆ›å»ºçš„è™šæ‹Ÿç½‘ç»œæ•°é‡ # ä½œç”¨ï¼šé€šè¿‡ä¸åŒçš„è™šæ‹Ÿç½‘ç»œå®ç°äº†å®¹å™¨ç½‘ç»œä¹‹é—´çš„éš”ç¦»ï¼Œä»è€Œåœ¨æœ€å¤§ç¨‹åº¦ä¸Šå»ä¿æŠ¤åç«¯ç½‘ç»œçš„å®‰å…¨ã€‚#networks:# mynet:# driver: bridge# mynet1: # é‡ç”¨çš„ä»£ç æ¨¡æ¿# æ¨¡æ¿çš„å®šä¹‰å¿…é¡»ä»¥ x- å¼€å¤´x-logging: # ä»¥ &amp; å¼€å¤´çš„å­—ç¬¦ä¸²ä¸ºæ¨¡æ¿å‘½å # ä»¥ * åŠ ä¸Šæ¨¡æ¿çš„åç§°å¼•ç”¨æ¨¡æ¿ &amp;default-logging driver: json-file options: max-size: &quot;200k&quot; max-file: &quot;10&quot; # å®šä¹‰å…¨å±€æŒ‚è½½å· volumes: test_1.thinking.com: test_2.thinking.com: # æœåŠ¡services: #æœåŠ¡åç§° todo: # æ„å»ºé•œåƒ build: # æŒ‡å®šdockerfileçš„ä¸Šä¸‹æ–‡è·¯å¾„ï¼ˆç›¸å¯¹å½“å‰docker-compose.ymlçš„ä½ç½®ï¼‰ # åŒ…å«Dockerfileæ–‡ä»¶çš„ç›®å½•è·¯å¾„ï¼Œæˆ–è€…æ˜¯gitä»“åº“çš„URLã€‚ # å½“æä¾›çš„å€¼æ˜¯ç›¸å¯¹è·¯å¾„æ—¶ï¼Œå®ƒè¢«è§£é‡Šä¸ºç›¸å¯¹äºå½“å‰composeæ–‡ä»¶çš„ä½ç½®ã€‚ # è¯¥ç›®å½•ä¹Ÿæ˜¯å‘é€åˆ°Dockerå®ˆæŠ¤ç¨‹åºæ„å»ºé•œåƒçš„ä¸Šä¸‹æ–‡ã€‚ context: . # Dockerfileçš„æ–‡ä»¶åç§° dockerfile: Dockerfile-todo args: # å˜é‡ buildno: 1 password: secret # Dockerfileé‡Œé¢å¯ä½¿ç”¨çš„å‚æ•°å˜é‡ # Dockerfileï¼š # ARG buildno # ARG password # RUN echo &quot;Build number: $buildno&quot; # RUN script-requiring-password.sh &quot;$password&quot; # é•œåƒå ï¼š ä»“åº“/æ ‡ç­¾:ç‰ˆæœ¬ image: zhanyang/todo-demo:1.0.0 # ä¾èµ–(ä»¥æŒ‡å®šé¡ºåºå¯åŠ¨) depends_on: mysql: condition: service_healthy # æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰å®¹å™¨åç§°ï¼Œè€Œä¸æ˜¯ç”Ÿæˆçš„é»˜è®¤åç§°ã€‚ # ç”±äºDockerå®¹å™¨åç§°å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå› æ­¤å¦‚æœæŒ‡å®šäº†è‡ªå®šä¹‰åç§°ï¼Œåˆ™æ— æ³•å°†æœåŠ¡æ‰©å±•åˆ°å¤šä¸ªå®¹å™¨ã€‚ container_name: todo # å·æŒ‚è½½è·¯å¾„è®¾ç½®ã€‚ # å¯ä»¥è®¾ç½®å®¿ä¸»æœºè·¯å¾„ ï¼ˆHOST:CONTAINERï¼‰ æˆ–åŠ ä¸Šè®¿é—®æ¨¡å¼ ï¼ˆHOST:CONTAINER:roï¼‰ # æŒ‚è½½æ•°æ®å·çš„é»˜è®¤æƒé™æ˜¯è¯»å†™ï¼ˆrwï¼‰ï¼Œå¯ä»¥é€šè¿‡roæŒ‡å®šä¸ºåªè¯»ã€‚ volumes: # åªéœ€æŒ‡å®šä¸€ä¸ªè·¯å¾„ï¼Œè®©å¼•æ“åˆ›å»ºä¸€ä¸ªå· - /var/lib/mysql # æŒ‡å®šç»å¯¹è·¯å¾„æ˜ å°„ - /opt/data:/var/lib/mysql # ç›¸å¯¹äºå½“å‰composeæ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ - ./cache:/tmp/cache # ç”¨æˆ·å®¶ç›®å½•ç›¸å¯¹è·¯å¾„ - ~/configs:/etc/configs/:ro # å‘½åå· - datavolume:/var/lib/mysql # ä½¿ç”¨å…¨å±€æŒ‚è½½å· - test_1.thinking.com:/test:rw # æŒ‡å®šæ—¥å¿—é©±åŠ¨ä¸º json-fileï¼Œå­˜å‚¨æ—¥å¿—çš„æœ€å¤§æ–‡ä»¶ size ä¸º 200kï¼Œæœ€å¤šå­˜å‚¨ 10 è¿™æ ·å¤§çš„æ–‡ä»¶ã€‚ # loggingæ”¯æŒå¾ˆå¤šdriverï¼Œè€Œæ¯ä¸€ä¸ªdriverå¯¹åº”çš„optionséƒ½ä¸ä¸€æ · # docker inspect -f &#123;&#123;.HostConfig.LogConfig&#125;&#125; lnmp-nginx # resultï¼š&#123;json-file map[max-file:10 max-size:2000k]&#125; # docker info |grep &#x27;Logging Driver&#x27; # resultï¼šLogging Driver: json-file # å…¶ä»–ï¼šhttps://docs.docker.com/engine/admin/logging/overview/ logging: driver: &quot;json-file&quot; options: max-size: &quot;200k&quot; max-file: &quot;10&quot; # æŒ‡å®šä½¿ç”¨çš„è™šæ‹Ÿç½‘ç»œ networks: # - mynet # è¦†ç›–å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤ã€‚ # è¯¥å‘½ä»¤ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç±»ä¼¼äºdockerfileçš„åˆ—è¡¨ï¼šcommand: [&quot;bundle&quot;, &quot;exec&quot;, &quot;thin&quot;, &quot;-p&quot;, &quot;3000&quot;] command: bundle exec thin -p 3000 # may command: [&quot;/usr/local/nginx/sbin/nginx&quot;] # é“¾æ¥åˆ°å¦ä¸€ä¸ªæœåŠ¡ä¸­çš„å®¹å™¨ã€‚ è¯·æŒ‡å®šæœåŠ¡åç§°å’Œé“¾æ¥åˆ«åï¼ˆSERVICEï¼šALIASï¼‰ï¼Œæˆ–è€…ä»…æŒ‡å®šæœåŠ¡åç§°ã€‚ # å®é™…æ˜¯é€šè¿‡è®¾ç½®/etc/hostsçš„åŸŸåè§£æï¼Œä»è€Œå®ç°å®¹å™¨é—´çš„é€šä¿¡ã€‚ # æ•…å¯ä»¥åƒåœ¨åº”ç”¨ä¸­ä½¿ç”¨localhostä¸€æ ·ä½¿ç”¨æœåŠ¡çš„åˆ«åé“¾æ¥å…¶ä»–å®¹å™¨çš„æœåŠ¡ï¼Œå‰ææ˜¯å¤šä¸ªæœåŠ¡å®¹å™¨åœ¨ä¸€ä¸ªç½‘ç»œä¸­å¯è·¯ç”±è”é€š # linksä¹Ÿå¯ä»¥èµ·åˆ°å’Œdepends_onç›¸ä¼¼çš„åŠŸèƒ½ï¼Œå³å®šä¹‰æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä»è€Œç¡®å®šæœåŠ¡å¯åŠ¨çš„é¡ºåº links: - db - db:database - redis # é“¾æ¥åˆ°docker-compose.yml å¤–éƒ¨çš„å®¹å™¨ï¼Œç”šè‡³å¹¶é Compose ç®¡ç†çš„å®¹å™¨ã€‚å‚æ•°æ ¼å¼è·Ÿ links ç±»ä¼¼ã€‚ external - redis_1 - project_db_1:mysql - project_db_1:postgresql # æš´éœ²ç«¯å£ï¼Œä½†ä¸æ˜ å°„åˆ°å®¿ä¸»æœºï¼Œåªè¢«è¿æ¥çš„æœåŠ¡è®¿é—®ã€‚ ä»…å¯ä»¥æŒ‡å®šå†…éƒ¨ç«¯å£ä¸ºå‚æ•° expose: - &quot;3000&quot; - &quot;8000&quot; # æš´éœ²ç«¯å£ä¿¡æ¯ã€‚ä½¿ç”¨å®¿ä¸»ï¼šå®¹å™¨ ï¼ˆHOST:CONTAINERï¼‰æ ¼å¼æˆ–è€…ä»…ä»…æŒ‡å®šå®¹å™¨çš„ç«¯å£ï¼ˆå®¿ä¸»å°†ä¼šéšæœºé€‰æ‹©ç«¯å£ï¼‰éƒ½å¯ä»¥ã€‚ ports: - &quot;3000&quot; - &quot;3000-3005&quot; - &quot;8000:8000&quot; - &quot;9090-9091:8080-8081&quot; - &quot;49100:22&quot; - &quot;127.0.0.1:8001:8001&quot; - &quot;127.0.0.1:5000-5010:5000-5010&quot; - &quot;6060:6060/udp&quot; # v3.2ä¸­portsçš„é•¿æ ¼å¼çš„è¯­æ³•å…è®¸é…ç½®ä¸èƒ½ç”¨çŸ­æ ¼å¼è¡¨ç¤ºçš„é™„åŠ å­—æ®µã€‚ ports: - target: 80 #å®¹å™¨å†…çš„ç«¯å£ published: 8080 #ç‰©ç†ä¸»æœºçš„ç«¯å£ protocol: tcp #ç«¯å£åè®®ï¼ˆtcpæˆ–udpï¼‰ mode: host #host å’Œingress ä¸¤æ€»æ¨¡å¼ï¼Œhostç”¨äºåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå‘å¸ƒä¸»æœºç«¯å£ï¼Œingress ç”¨äºè¢«è´Ÿè½½å¹³è¡¡çš„swarmæ¨¡å¼ç«¯å£ã€‚ # noæ˜¯é»˜è®¤çš„é‡å¯ç­–ç•¥ï¼Œåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸ä¼šé‡å¯å®¹å™¨ã€‚ restart: &quot;no&quot; # æŒ‡å®šä¸ºalwaysæ—¶ï¼Œå®¹å™¨æ€»æ˜¯é‡æ–°å¯åŠ¨ã€‚ restart: always # å¦‚æœé€€å‡ºä»£ç æŒ‡ç¤ºå‡ºç°æ•…éšœé”™è¯¯ï¼Œåˆ™on-failureå°†é‡æ–°å¯åŠ¨å®¹å™¨ã€‚ restart: on-failure restart: unless-stopped # pid å°†PIDæ¨¡å¼è®¾ç½®ä¸ºä¸»æœºPIDæ¨¡å¼ã€‚ # è¿™å°±æ‰“å¼€äº†å®¹å™¨ä¸ä¸»æœºæ“ä½œç³»ç»Ÿä¹‹é—´çš„å…±äº«PIDåœ°å€ç©ºé—´ã€‚ # ä½¿ç”¨æ­¤æ ‡å¿—å¯åŠ¨çš„å®¹å™¨å°†èƒ½å¤Ÿè®¿é—®å’Œæ“ä½œè£¸æœºçš„å‘½åç©ºé—´ä¸­çš„å…¶ä»–å®¹å™¨ï¼Œåä¹‹äº¦ç„¶ã€‚ # å³æ‰“å¼€è¯¥é€‰é¡¹çš„å®¹å™¨å¯ä»¥ç›¸äº’é€šè¿‡è¿›ç¨‹ ID æ¥è®¿é—®å’Œæ“ä½œã€‚ pid: &quot;host&quot; # é…ç½® DNS æœåŠ¡å™¨ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚ dns: 8.8.8.8 dns: - 8.8.8.8 - 9.9.9.9 # è‡ªå®šä¹‰æœç´¢åŸŸ dns_search: example.com dns_search: - dc1.example.com - dc2.example.com # è¦†ç›–Dockerfileä¸­çš„entrypointï¼Œç”¨æ³•åŒDockerfileä¸­çš„ç”¨æ³• entrypoint: [&quot;/usr/local/nginx/sbin/nginx&quot;,&quot;-g&quot;,&quot;daemon off;&quot;] # æ·»åŠ ç¯å¢ƒå˜é‡ã€‚ ä½ å¯ä»¥ä½¿ç”¨æ•°ç»„æˆ–å­—å…¸ä¸¤ç§å½¢å¼ã€‚ # ä»»ä½•å¸ƒå°”å€¼; trueï¼Œfalseï¼Œyesï¼Œnoéœ€è¦ç”¨å¼•å·æ‹¬èµ·æ¥ï¼Œä»¥ç¡®ä¿å®ƒä»¬ä¸è¢«YMLè§£æå™¨è½¬æ¢ä¸ºTrueæˆ–Falseã€‚ environment: RACK_ENV: development SHOW: &#x27;true&#x27; SESSION_SECRET: # ã€æ³¨æ„ã€‘ï¼šå¦‚æœä½ çš„æœåŠ¡æŒ‡å®šäº†buildé€‰é¡¹ï¼Œé‚£ä¹ˆåœ¨æ„å»ºè¿‡ç¨‹ä¸­é€šè¿‡environmentå®šä¹‰çš„ç¯å¢ƒå˜é‡å°†ä¸ä¼šèµ·ä½œç”¨ã€‚ # å°†ä½¿ç”¨buildçš„argså­é€‰é¡¹æ¥å®šä¹‰æ„å»ºæ—¶çš„ç¯å¢ƒå˜é‡ã€‚ environment: - RACK_ENV=development - SHOW=true - SESSION_SECRE # 1&gt;å°†å®šä¹‰çš„å˜é‡ç¼–å†™åœ¨æ–‡ä»¶ä¸­ï¼Œç„¶ååœ¨ymlæ–‡ä»¶ä¸­è¿›è¡Œæ·»åŠ  env_file: .env env_file: - ./common.env - ./apps/web.env - /opt/secrets.env # 2&gt;ä¾‹å¦‚ï¼š # oldï¼š db: image: mysql ports: - &quot;3306:3306&quot; environment: MYSQL_ROOT_PASSWORD: redhat MYSQL_DATABASE: wordpress MYSQL_USER: wordpress MYSQL_PASSWORD: wordpress # newï¼š db: image: mysql ports: - &quot;3306:3306&quot; env_file: ./mysql_env # åˆ›å»ºenv_fileæ–‡ä»¶åœ¨å½“å‰ç›®å½•mysql_env MYSQL_ROOT_PASSWORD=redhat MYSQL_DATABASE=wordpress MYSQL_USER=wordpress MYSQL_PASSWORD=wordpress3 # æ·»åŠ hostnameæ˜ å°„ï¼Œç±»ä¼¼äºdocker cliä¸‹é¢çš„--add-host extra_hosts: - &quot;www.hcstart.com:192.168.101.14&quot; # é…ç½®ä¸€ä¸ªæ£€æŸ¥å»æµ‹è¯•æœåŠ¡ä¸­çš„å®¹å™¨æ˜¯å¦è¿è¡Œæ­£å¸¸ # å…·ä½“ï¼š https://docs.docker.com/engine/reference/builder/#healthcheck # æŸ¥çœ‹healthcheckçš„çŠ¶æ€è¾“å‡º ï¼š docker inspect lnmp-nginx healthcheck: test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;] interval: 1m30s timeout: 10s retries: 3 # labels:æ·»åŠ å…ƒæ•°æ®åˆ°containerä¸­ï¼ŒæŸ¥çœ‹ç°æœ‰å®¹å™¨çš„labelsï¼š # docker inspect -f &#123;&#123;.Config.Labels&#125;&#125; lnmp-nginx # lnmp-nginx ï¼šå®¹å™¨å labels: com.example.description: &quot;Accounting webapp&quot; com.example.department: &quot;Finance&quot; com.example.label-with-empty-value: &quot;&quot; labels: - &quot;com.example.description=Accounting webapp&quot; - &quot;com.example.department=Finance&quot; - &quot;com.example.label-with-empty-value&quot; # åœ¨å®¹å™¨ä¸­è®¾ç½®å†…æ ¸å‚æ•° sysctls: net.core.somaxconn: 1024 net.ipv4.tcp_syncookies: 0 sysctls: - net.core.somaxconn=1024 - net.ipv4.tcp_syncookies=0 mysql: environment: MYSQL_ROOT_PASSWORD: password MYSQL_DATABASE: tododb MYSQL_USER: user MYSQL_PASSWORD: pass build: context: . dockerfile: Dockerfile-mysql image: zhanyang/mysql:5.6 container_name: mysql # ä»¥ * åŠ ä¸Šæ¨¡æ¿çš„åç§°å¼•ç”¨æ¨¡æ¿ ä½¿ç”¨å…¨å±€è‡ªå®šä¹‰æ¨¡æ¿ logging: *default-logging # æŒ‡å®šä½¿ç”¨çš„è™šæ‹Ÿç½‘ç»œ networks: # - mynet1Composeå’ŒDockerå…¼å®¹æ€§ï¼š Compose æ–‡ä»¶æ ¼å¼æœ‰3ä¸ªç‰ˆæœ¬,åˆ†åˆ«ä¸º1, 2.x å’Œ 3.x ç›®å‰ä¸»æµçš„ä¸º 3.x å…¶æ”¯æŒ docker 1.13.0 åŠå…¶ä»¥ä¸Šçš„ç‰ˆæœ¬ å¸¸ç”¨å‚æ•°ï¼š version # æŒ‡å®š compose æ–‡ä»¶çš„ç‰ˆæœ¬ services # å®šä¹‰æ‰€æœ‰çš„ service ä¿¡æ¯, services ä¸‹é¢çš„ç¬¬ä¸€çº§åˆ«çš„ key æ—¢æ˜¯ä¸€ä¸ª service çš„åç§° build # æŒ‡å®šåŒ…å«æ„å»ºä¸Šä¸‹æ–‡çš„è·¯å¾„, æˆ–ä½œä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å…·æœ‰ context å’ŒæŒ‡å®šçš„ dockerfile æ–‡ä»¶ä»¥åŠ args å‚æ•°å€¼ context # context: æŒ‡å®š Dockerfile æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ dockerfile # dockerfile: æŒ‡å®š context æŒ‡å®šçš„ç›®å½•ä¸‹é¢çš„ Dockerfile çš„åç§°(é»˜è®¤ä¸º Dockerfile) args # args: Dockerfile åœ¨ build è¿‡ç¨‹ä¸­éœ€è¦çš„å‚æ•° (ç­‰åŒäº docker container build --build-arg çš„ä½œç”¨) cache_from # v3.2ä¸­æ–°å¢çš„å‚æ•°, æŒ‡å®šç¼“å­˜çš„é•œåƒåˆ—è¡¨ (ç­‰åŒäº docker container build --cache_from çš„ä½œç”¨) labels # v3.3ä¸­æ–°å¢çš„å‚æ•°, è®¾ç½®é•œåƒçš„å…ƒæ•°æ® (ç­‰åŒäº docker container build --labels çš„ä½œç”¨) shm_size # v3.5ä¸­æ–°å¢çš„å‚æ•°, è®¾ç½®å®¹å™¨ /dev/shm åˆ†åŒºçš„å¤§å° (ç­‰åŒäº docker container build --shm-size çš„ä½œç”¨) command # è¦†ç›–å®¹å™¨å¯åŠ¨åé»˜è®¤æ‰§è¡Œçš„å‘½ä»¤, æ”¯æŒ shell æ ¼å¼å’Œ [] æ ¼å¼ configs # ä¸çŸ¥é“æ€ä¹ˆç”¨ cgroup_parent # ä¸çŸ¥é“æ€ä¹ˆç”¨ container_name # æŒ‡å®šå®¹å™¨çš„åç§° (ç­‰åŒäº docker run --name çš„ä½œç”¨) credential_spec # ä¸çŸ¥é“æ€ä¹ˆç”¨ deploy # v3 ç‰ˆæœ¬ä»¥ä¸Š, æŒ‡å®šä¸éƒ¨ç½²å’Œè¿è¡ŒæœåŠ¡ç›¸å…³çš„é…ç½®, deploy éƒ¨åˆ†æ˜¯ docker stack ä½¿ç”¨çš„, docker stack ä¾èµ– docker swarm endpoint_mode # v3.3 ç‰ˆæœ¬ä¸­æ–°å¢çš„åŠŸèƒ½, æŒ‡å®šæœåŠ¡æš´éœ²çš„æ–¹å¼ vip # Docker ä¸ºè¯¥æœåŠ¡åˆ†é…äº†ä¸€ä¸ªè™šæ‹Ÿ IP(VIP), ä½œä¸ºå®¢æˆ·ç«¯çš„è®¿é—®æœåŠ¡çš„åœ°å€ dnsrr # DNSè½®è¯¢, Docker ä¸ºè¯¥æœåŠ¡è®¾ç½® DNS æ¡ç›®, ä½¿å¾—æœåŠ¡åç§°çš„ DNS æŸ¥è¯¢è¿”å›ä¸€ä¸ª IP åœ°å€åˆ—è¡¨, å®¢æˆ·ç«¯ç›´æ¥è®¿é—®å…¶ä¸­çš„ä¸€ä¸ªåœ°å€ labels # æŒ‡å®šæœåŠ¡çš„æ ‡ç­¾ï¼Œè¿™äº›æ ‡ç­¾ä»…åœ¨æœåŠ¡ä¸Šè®¾ç½® mode # æŒ‡å®š deploy çš„æ¨¡å¼ global # æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹éƒ½åªæœ‰ä¸€ä¸ªå®¹å™¨ replicated # ç”¨æˆ·å¯ä»¥æŒ‡å®šé›†ç¾¤ä¸­å®¹å™¨çš„æ•°é‡(é»˜è®¤) placement # ä¸çŸ¥é“æ€ä¹ˆç”¨ replicas # deploy çš„ mode ä¸º replicated æ—¶, æŒ‡å®šå®¹å™¨å‰¯æœ¬çš„æ•°é‡ resources # èµ„æºé™åˆ¶ limits # è®¾ç½®å®¹å™¨çš„èµ„æºé™åˆ¶ cpus: &quot;0.5&quot; # è®¾ç½®è¯¥å®¹å™¨æœ€å¤šåªèƒ½ä½¿ç”¨ 50% çš„ CPU memory: 50M # è®¾ç½®è¯¥å®¹å™¨æœ€å¤šåªèƒ½ä½¿ç”¨ 50M çš„å†…å­˜ç©ºé—´ reservations # è®¾ç½®ä¸ºå®¹å™¨é¢„ç•™çš„ç³»ç»Ÿèµ„æº(éšæ—¶å¯ç”¨) cpus: &quot;0.2&quot; # ä¸ºè¯¥å®¹å™¨ä¿ç•™ 20% çš„ CPU memory: 20M # ä¸ºè¯¥å®¹å™¨ä¿ç•™ 20M çš„å†…å­˜ç©ºé—´ restart_policy # å®šä¹‰å®¹å™¨é‡å¯ç­–ç•¥, ç”¨äºä»£æ›¿ restart å‚æ•° condition # å®šä¹‰å®¹å™¨é‡å¯ç­–ç•¥(æ¥å—ä¸‰ä¸ªå‚æ•°) none # ä¸å°è¯•é‡å¯ on-failure # åªæœ‰å½“å®¹å™¨å†…éƒ¨åº”ç”¨ç¨‹åºå‡ºç°é—®é¢˜æ‰ä¼šé‡å¯ any # æ— è®ºå¦‚ä½•éƒ½ä¼šå°è¯•é‡å¯(é»˜è®¤) delay # å°è¯•é‡å¯çš„é—´éš”æ—¶é—´(é»˜è®¤ä¸º 0s) max_attempts # å°è¯•é‡å¯æ¬¡æ•°(é»˜è®¤ä¸€ç›´å°è¯•é‡å¯) window # æ£€æŸ¥é‡å¯æ˜¯å¦æˆåŠŸä¹‹å‰çš„ç­‰å¾…æ—¶é—´(å³å¦‚æœå®¹å™¨å¯åŠ¨äº†, éš”å¤šå°‘ç§’ä¹‹åå»æ£€æµ‹å®¹å™¨æ˜¯å¦æ­£å¸¸, é»˜è®¤ 0s) update_config # ç”¨äºé…ç½®æ»šåŠ¨æ›´æ–°é…ç½® parallelism # ä¸€æ¬¡æ€§æ›´æ–°çš„å®¹å™¨æ•°é‡ delay # æ›´æ–°ä¸€ç»„å®¹å™¨ä¹‹é—´çš„é—´éš”æ—¶é—´ failure_action # å®šä¹‰æ›´æ–°å¤±è´¥çš„ç­–ç•¥ continue # ç»§ç»­æ›´æ–° rollback # å›æ»šæ›´æ–° pause # æš‚åœæ›´æ–°(é»˜è®¤) monitor # æ¯æ¬¡æ›´æ–°åçš„æŒç»­æ—¶é—´ä»¥ç›‘è§†æ›´æ–°æ˜¯å¦å¤±è´¥(å•ä½: ns|us|ms|s|m|h) (é»˜è®¤ä¸º0) max_failure_ratio # å›æ»šæœŸé—´å®¹å¿çš„å¤±è´¥ç‡(é»˜è®¤å€¼ä¸º0) order # v3.4 ç‰ˆæœ¬ä¸­æ–°å¢çš„å‚æ•°, å›æ»šæœŸé—´çš„æ“ä½œé¡ºåº stop-first #æ—§ä»»åŠ¡åœ¨å¯åŠ¨æ–°ä»»åŠ¡ä¹‹å‰åœæ­¢(é»˜è®¤) start-first #é¦–å…ˆå¯åŠ¨æ–°ä»»åŠ¡, å¹¶ä¸”æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡æš‚æ—¶é‡å  rollback_config # v3.7 ç‰ˆæœ¬ä¸­æ–°å¢çš„å‚æ•°, ç”¨äºå®šä¹‰åœ¨ update_config æ›´æ–°å¤±è´¥çš„å›æ»šç­–ç•¥ parallelism # ä¸€æ¬¡å›æ»šçš„å®¹å™¨æ•°, å¦‚æœè®¾ç½®ä¸º0, åˆ™æ‰€æœ‰å®¹å™¨åŒæ—¶å›æ»š delay # æ¯ä¸ªç»„å›æ»šä¹‹é—´çš„æ—¶é—´é—´éš”(é»˜è®¤ä¸º0) failure_action # å®šä¹‰å›æ»šå¤±è´¥çš„ç­–ç•¥ continue # ç»§ç»­å›æ»š pause # æš‚åœå›æ»š monitor # æ¯æ¬¡å›æ»šä»»åŠ¡åçš„æŒç»­æ—¶é—´ä»¥ç›‘è§†å¤±è´¥(å•ä½: ns|us|ms|s|m|h) (é»˜è®¤ä¸º0) max_failure_ratio # å›æ»šæœŸé—´å®¹å¿çš„å¤±è´¥ç‡(é»˜è®¤å€¼0) order # å›æ»šæœŸé—´çš„æ“ä½œé¡ºåº stop-first # æ—§ä»»åŠ¡åœ¨å¯åŠ¨æ–°ä»»åŠ¡ä¹‹å‰åœæ­¢(é»˜è®¤) start-first # é¦–å…ˆå¯åŠ¨æ–°ä»»åŠ¡, å¹¶ä¸”æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡æš‚æ—¶é‡å  æ³¨æ„ï¼š æ”¯æŒ docker-compose up å’Œ docker-compose run ä½†ä¸æ”¯æŒ docker stack deploy çš„å­é€‰é¡¹ security_opt container_name devices tmpfs stop_signal links cgroup_parent network_mode external_links restart build userns_mode sysctls devices # æŒ‡å®šè®¾å¤‡æ˜ å°„åˆ—è¡¨ (ç­‰åŒäº docker run --device çš„ä½œç”¨) depends_on # å®šä¹‰å®¹å™¨å¯åŠ¨é¡ºåº (æ­¤é€‰é¡¹è§£å†³äº†å®¹å™¨ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œ æ­¤é€‰é¡¹åœ¨ v3 ç‰ˆæœ¬ä¸­ ä½¿ç”¨ swarm éƒ¨ç½²æ—¶å°†å¿½ç•¥è¯¥é€‰é¡¹) ç¤ºä¾‹ï¼š docker-compose up ä»¥ä¾èµ–é¡ºåºå¯åŠ¨æœåŠ¡ï¼Œä¸‹é¢ä¾‹å­ä¸­ redis å’Œ db æœåŠ¡åœ¨ web å¯åŠ¨å‰å¯åŠ¨ é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ docker-compose up web è¿™æ ·çš„æ–¹å¼å¯åŠ¨ web æœåŠ¡æ—¶ï¼Œä¹Ÿä¼šå¯åŠ¨ redis å’Œ db ä¸¤ä¸ªæœåŠ¡ï¼Œå› ä¸ºåœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†ä¾èµ–å…³ç³» version: &#x27;3&#x27; services: web: build: . depends_on: - db - redis redis: image: redis db: image: postgres dns # è®¾ç½® DNS åœ°å€(ç­‰åŒäº docker run --dns çš„ä½œç”¨) dns_search # è®¾ç½® DNS æœç´¢åŸŸ(ç­‰åŒäº docker run --dns-search çš„ä½œç”¨) tmpfs # v2 ç‰ˆæœ¬ä»¥ä¸Š, æŒ‚è½½ç›®å½•åˆ°å®¹å™¨ä¸­, ä½œä¸ºå®¹å™¨çš„ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ(ç­‰åŒäº docker run --tmpfs çš„ä½œç”¨, åœ¨ä½¿ç”¨ swarm éƒ¨ç½²æ—¶å°†å¿½ç•¥è¯¥é€‰é¡¹) entrypoint # è¦†ç›–å®¹å™¨çš„é»˜è®¤ entrypoint æŒ‡ä»¤ (ç­‰åŒäº docker run --entrypoint çš„ä½œç”¨) env_file # ä»æŒ‡å®šæ–‡ä»¶ä¸­è¯»å–å˜é‡è®¾ç½®ä¸ºå®¹å™¨ä¸­çš„ç¯å¢ƒå˜é‡, å¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–è€…ä¸€ä¸ªæ–‡ä»¶åˆ—è¡¨, å¦‚æœå¤šä¸ªæ–‡ä»¶ä¸­çš„å˜é‡é‡ååˆ™åé¢çš„å˜é‡è¦†ç›–å‰é¢çš„å˜é‡, environment çš„å€¼è¦†ç›– env_file çš„å€¼ æ–‡ä»¶æ ¼å¼ï¼š RACK_ENV=development environment # è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œ environment çš„å€¼å¯ä»¥è¦†ç›– env_file çš„å€¼ (ç­‰åŒäº docker run --env çš„ä½œç”¨) expose # æš´éœ²ç«¯å£, ä½†æ˜¯ä¸èƒ½å’Œå®¿ä¸»æœºå»ºç«‹æ˜ å°„å…³ç³», ç±»ä¼¼äº Dockerfile çš„ EXPOSE æŒ‡ä»¤ external_links # è¿æ¥ä¸åœ¨ docker-compose.yml ä¸­å®šä¹‰çš„å®¹å™¨æˆ–è€…ä¸åœ¨ compose ç®¡ç†çš„å®¹å™¨(docker run å¯åŠ¨çš„å®¹å™¨, åœ¨ v3 ç‰ˆæœ¬ä¸­ä½¿ç”¨ swarm éƒ¨ç½²æ—¶å°†å¿½ç•¥è¯¥é€‰é¡¹) extra_hosts # æ·»åŠ  host è®°å½•åˆ°å®¹å™¨ä¸­çš„ /etc/hosts ä¸­ (ç­‰åŒäº docker run --add-host çš„ä½œç”¨) healthcheck # v2.1 ä»¥ä¸Šç‰ˆæœ¬, å®šä¹‰å®¹å™¨å¥åº·çŠ¶æ€æ£€æŸ¥, ç±»ä¼¼äº Dockerfile çš„ HEALTHCHECK æŒ‡ä»¤ test # æ£€æŸ¥å®¹å™¨æ£€æŸ¥çŠ¶æ€çš„å‘½ä»¤, è¯¥é€‰é¡¹å¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…åˆ—è¡¨, ç¬¬ä¸€é¡¹å¿…é¡»æ˜¯ NONE, CMD æˆ– CMD-SHELL, å¦‚æœå…¶æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²åˆ™ç›¸å½“äº CMD-SHELL åŠ è¯¥å­—ç¬¦ä¸² NONE # ç¦ç”¨å®¹å™¨çš„å¥åº·çŠ¶æ€æ£€æµ‹ CMD # test: [&quot;CMD&quot;, &quot;curl&quot;, &quot;-f&quot;, &quot;http://localhost&quot;] CMD-SHELL # test: [&quot;CMD-SHELL&quot;, &quot;curl -f http://localhost || exit 1&quot;] æˆ–è€… test: curl -f https://localhost || exit 1 interval: 1m30s # æ¯æ¬¡æ£€æŸ¥ä¹‹é—´çš„é—´éš”æ—¶é—´ timeout: 10s # è¿è¡Œå‘½ä»¤çš„è¶…æ—¶æ—¶é—´ retries: 3 # é‡è¯•æ¬¡æ•° start_period: 40s # v3.4 ä»¥ä¸Šæ–°å¢çš„é€‰é¡¹, å®šä¹‰å®¹å™¨å¯åŠ¨æ—¶é—´é—´éš” disable: true # true æˆ– false, è¡¨ç¤ºæ˜¯å¦ç¦ç”¨å¥åº·çŠ¶æ€æ£€æµ‹å’Œ test: NONE ç›¸åŒ image # æŒ‡å®š docker é•œåƒ, å¯ä»¥æ˜¯è¿œç¨‹ä»“åº“é•œåƒã€æœ¬åœ°é•œåƒ init # v3.7 ä¸­æ–°å¢çš„å‚æ•°, true æˆ– false è¡¨ç¤ºæ˜¯å¦åœ¨å®¹å™¨ä¸­è¿è¡Œä¸€ä¸ª init, å®ƒæ¥æ”¶ä¿¡å·å¹¶ä¼ é€’ç»™è¿›ç¨‹ isolation # éš”ç¦»å®¹å™¨æŠ€æœ¯, åœ¨ Linux ä¸­ä»…æ”¯æŒ default å€¼ labels # ä½¿ç”¨ Docker æ ‡ç­¾å°†å…ƒæ•°æ®æ·»åŠ åˆ°å®¹å™¨, ä¸ Dockerfile ä¸­çš„ LABELS ç±»ä¼¼ links # é“¾æ¥åˆ°å…¶å®ƒæœåŠ¡ä¸­çš„å®¹å™¨, è¯¥é€‰é¡¹æ˜¯ docker å†å²é—ç•™çš„é€‰é¡¹, ç›®å‰å·²è¢«ç”¨æˆ·è‡ªå®šä¹‰ç½‘ç»œåç§°ç©ºé—´å–ä»£, æœ€ç»ˆæœ‰å¯èƒ½è¢«åºŸå¼ƒ (åœ¨ä½¿ç”¨ swarm éƒ¨ç½²æ—¶å°†å¿½ç•¥è¯¥é€‰é¡¹) logging # è®¾ç½®å®¹å™¨æ—¥å¿—æœåŠ¡ driver # æŒ‡å®šæ—¥å¿—è®°å½•é©±åŠ¨ç¨‹åº, é»˜è®¤ json-file (ç­‰åŒäº docker run --log-driver çš„ä½œç”¨) options # æŒ‡å®šæ—¥å¿—çš„ç›¸å…³å‚æ•° (ç­‰åŒäº docker run --log-opt çš„ä½œç”¨) max-size # è®¾ç½®å•ä¸ªæ—¥å¿—æ–‡ä»¶çš„å¤§å°, å½“åˆ°è¾¾è¿™ä¸ªå€¼åä¼šè¿›è¡Œæ—¥å¿—æ»šåŠ¨æ“ä½œ max-file # æ—¥å¿—æ–‡ä»¶ä¿ç•™çš„æ•°é‡ network_mode # æŒ‡å®šç½‘ç»œæ¨¡å¼ (ç­‰åŒäº docker run --net çš„ä½œç”¨, åœ¨ä½¿ç”¨ swarm éƒ¨ç½²æ—¶å°†å¿½ç•¥è¯¥é€‰é¡¹) networks # å°†å®¹å™¨åŠ å…¥æŒ‡å®šç½‘ç»œ (ç­‰åŒäº docker network connect çš„ä½œç”¨), networks å¯ä»¥ä½äº compose æ–‡ä»¶é¡¶çº§é”®å’Œ services é”®çš„äºŒçº§é”® aliases # åŒä¸€ç½‘ç»œä¸Šçš„å®¹å™¨å¯ä»¥ä½¿ç”¨æœåŠ¡åç§°æˆ–åˆ«åè¿æ¥åˆ°å…¶ä¸­ä¸€ä¸ªæœåŠ¡çš„å®¹å™¨ ipv4_address # IP V4 æ ¼å¼ ipv6_address # IP V6 æ ¼å¼ ç¤ºä¾‹: version: &#x27;3.7&#x27; services: test: image: nginx:1.14-alpine container_name: mynginx command: ifconfig networks: app_net: # è°ƒç”¨ä¸‹é¢ networks å®šä¹‰çš„ app_net ç½‘ç»œ ipv4_address: 172.16.238.10 networks: app_net: driver: bridge ipam: driver: default config: - subnet: 172.16.238.0/24 pid: &#x27;host&#x27; # å…±äº«å®¿ä¸»æœºçš„ è¿›ç¨‹ç©ºé—´(PID) ports # å»ºç«‹å®¿ä¸»æœºå’Œå®¹å™¨ä¹‹é—´çš„ç«¯å£æ˜ å°„å…³ç³», ports æ”¯æŒä¸¤ç§è¯­æ³•æ ¼å¼ SHORT è¯­æ³•æ ¼å¼ç¤ºä¾‹: - &quot;3000&quot; # æš´éœ²å®¹å™¨çš„ 3000 ç«¯å£, å®¿ä¸»æœºçš„ç«¯å£ç”± docker éšæœºæ˜ å°„ä¸€ä¸ªæ²¡æœ‰è¢«å ç”¨çš„ç«¯å£ - &quot;3000-3005&quot; # æš´éœ²å®¹å™¨çš„ 3000 åˆ° 3005 ç«¯å£, å®¿ä¸»æœºçš„ç«¯å£ç”± docker éšæœºæ˜ å°„æ²¡æœ‰è¢«å ç”¨çš„ç«¯å£ - &quot;8000:8000&quot; # å®¹å™¨çš„ 8000 ç«¯å£å’Œå®¿ä¸»æœºçš„ 8000 ç«¯å£å»ºç«‹æ˜ å°„å…³ç³» - &quot;9090-9091:8080-8081&quot; - &quot;127.0.0.1:8001:8001&quot; # æŒ‡å®šæ˜ å°„å®¿ä¸»æœºçš„æŒ‡å®šåœ°å€çš„ - &quot;127.0.0.1:5000-5010:5000-5010&quot; - &quot;6060:6060/udp&quot; # æŒ‡å®šåè®® LONG è¯­æ³•æ ¼å¼ç¤ºä¾‹:(v3.2 æ–°å¢çš„è¯­æ³•æ ¼å¼) ports: - target: 80 # å®¹å™¨ç«¯å£ published: 8080 # å®¿ä¸»æœºç«¯å£ protocol: tcp # åè®®ç±»å‹ mode: host # host åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå‘å¸ƒä¸»æœºç«¯å£, ingress å¯¹äºç¾¤æ¨¡å¼ç«¯å£è¿›è¡Œè´Ÿè½½å‡è¡¡ secrets # ä¸çŸ¥é“æ€ä¹ˆç”¨ security_opt # ä¸ºæ¯ä¸ªå®¹å™¨è¦†ç›–é»˜è®¤çš„æ ‡ç­¾ (åœ¨ä½¿ç”¨ swarm éƒ¨ç½²æ—¶å°†å¿½ç•¥è¯¥é€‰é¡¹) stop_grace_period # æŒ‡å®šåœ¨å‘é€äº† SIGTERM ä¿¡å·ä¹‹å, å®¹å™¨ç­‰å¾…å¤šå°‘ç§’ä¹‹åé€€å‡º(é»˜è®¤ 10s) stop_signal # æŒ‡å®šåœæ­¢å®¹å™¨å‘é€çš„ä¿¡å· (é»˜è®¤ä¸º SIGTERM ç›¸å½“äº kill PID; SIGKILL ç›¸å½“äº kill -9 PID; åœ¨ä½¿ç”¨ swarm éƒ¨ç½²æ—¶å°†å¿½ç•¥è¯¥é€‰é¡¹) sysctls # è®¾ç½®å®¹å™¨ä¸­çš„å†…æ ¸å‚æ•° (åœ¨ä½¿ç”¨ swarm éƒ¨ç½²æ—¶å°†å¿½ç•¥è¯¥é€‰é¡¹) ulimits # è®¾ç½®å®¹å™¨çš„ limit userns_mode # å¦‚æœDockerå®ˆæŠ¤ç¨‹åºé…ç½®äº†ç”¨æˆ·åç§°ç©ºé—´, åˆ™ç¦ç”¨æ­¤æœåŠ¡çš„ç”¨æˆ·åç§°ç©ºé—´ (åœ¨ä½¿ç”¨ swarm éƒ¨ç½²æ—¶å°†å¿½ç•¥è¯¥é€‰é¡¹) volumes # å®šä¹‰å®¹å™¨å’Œå®¿ä¸»æœºçš„å·æ˜ å°„å…³ç³», å…¶å’Œ networks ä¸€æ ·å¯ä»¥ä½äº services é”®çš„äºŒçº§é”®å’Œ compose é¡¶çº§é”®, å¦‚æœéœ€è¦è·¨æœåŠ¡é—´ä½¿ç”¨åˆ™åœ¨é¡¶çº§é”®å®šä¹‰, åœ¨ services ä¸­å¼•ç”¨ SHORT è¯­æ³•æ ¼å¼ç¤ºä¾‹: volumes: - /var/lib/mysql # æ˜ å°„å®¹å™¨å†…çš„ /var/lib/mysql åˆ°å®¿ä¸»æœºçš„ä¸€ä¸ªéšæœºç›®å½•ä¸­ - /opt/data:/var/lib/mysql # æ˜ å°„å®¹å™¨å†…çš„ /var/lib/mysql åˆ°å®¿ä¸»æœºçš„ /opt/data - ./cache:/tmp/cache # æ˜ å°„å®¹å™¨å†…çš„ /var/lib/mysql åˆ°å®¿ä¸»æœº compose æ–‡ä»¶æ‰€åœ¨çš„ä½ç½® - ~/configs:/etc/configs/:ro # æ˜ å°„å®¹å™¨å®¿ä¸»æœºçš„ç›®å½•åˆ°å®¹å™¨ä¸­å», æƒé™åªè¯» - datavolume:/var/lib/mysql # datavolume ä¸º volumes é¡¶çº§é”®å®šä¹‰çš„ç›®å½•, åœ¨æ­¤å¤„ç›´æ¥è°ƒç”¨ LONG è¯­æ³•æ ¼å¼ç¤ºä¾‹:(v3.2 æ–°å¢çš„è¯­æ³•æ ¼å¼) version: &quot;3.2&quot; services: web: image: nginx:alpine ports: - &quot;80:80&quot; volumes: - type: volume # mount çš„ç±»å‹, å¿…é¡»æ˜¯ bindã€volume æˆ– tmpfs source: mydata # å®¿ä¸»æœºç›®å½• target: /data # å®¹å™¨ç›®å½• volume: # é…ç½®é¢å¤–çš„é€‰é¡¹, å…¶ key å¿…é¡»å’Œ type çš„å€¼ç›¸åŒ nocopy: true # volume é¢å¤–çš„é€‰é¡¹, åœ¨åˆ›å»ºå·æ—¶ç¦ç”¨ä»å®¹å™¨å¤åˆ¶æ•°æ® - type: bind # volume æ¨¡å¼åªæŒ‡å®šå®¹å™¨è·¯å¾„å³å¯, å®¿ä¸»æœºè·¯å¾„éšæœºç”Ÿæˆ; bind éœ€è¦æŒ‡å®šå®¹å™¨å’Œæ•°æ®æœºçš„æ˜ å°„è·¯å¾„ source: ./static target: /opt/app/static read_only: true # è®¾ç½®æ–‡ä»¶ç³»ç»Ÿä¸ºåªè¯»æ–‡ä»¶ç³»ç»Ÿ volumes: mydata: # å®šä¹‰åœ¨ volume, å¯åœ¨æ‰€æœ‰æœåŠ¡ä¸­è°ƒç”¨ restart # å®šä¹‰å®¹å™¨é‡å¯ç­–ç•¥(åœ¨ä½¿ç”¨ swarm éƒ¨ç½²æ—¶å°†å¿½ç•¥è¯¥é€‰é¡¹, åœ¨ swarm ä½¿ç”¨ restart_policy ä»£æ›¿ restart) no # ç¦æ­¢è‡ªåŠ¨é‡å¯å®¹å™¨(é»˜è®¤) always # æ— è®ºå¦‚ä½•å®¹å™¨éƒ½ä¼šé‡å¯ on-failure # å½“å‡ºç° on-failure æŠ¥é”™æ—¶, å®¹å™¨é‡æ–°å¯åŠ¨ å…¶ä»–é€‰é¡¹ï¼š domainname, hostname, ipc, mac_address, privileged, read_only, shm_size, stdin_open, tty, user, working_dir ä¸Šé¢è¿™äº›é€‰é¡¹éƒ½åªæ¥å—å•ä¸ªå€¼å’Œ docker run çš„å¯¹åº”å‚æ•°ç±»ä¼¼ å¯¹äºå€¼ä¸ºæ—¶é—´çš„å¯æ¥å—çš„å€¼ï¼š 2.5s 10s 1m30s 2h32m 5h34m56s æ—¶é—´å•ä½: us, ms, s, mï¼Œ h å¯¹äºå€¼ä¸ºå¤§å°çš„å¯æ¥å—çš„å€¼ï¼š 2b 1024kb 2048k 300m 1gb å•ä½: b, k, m, g æˆ–è€… kb, mb, gb networks # å®šä¹‰ networks ä¿¡æ¯ driver # æŒ‡å®šç½‘ç»œæ¨¡å¼, å¤§å¤šæ•°æƒ…å†µä¸‹, å®ƒ bridge äºå•ä¸ªä¸»æœºå’Œ overlay Swarm ä¸Š bridge # Docker é»˜è®¤ä½¿ç”¨ bridge è¿æ¥å•ä¸ªä¸»æœºä¸Šçš„ç½‘ç»œ overlay # overlay é©±åŠ¨ç¨‹åºåˆ›å»ºä¸€ä¸ªè·¨å¤šä¸ªèŠ‚ç‚¹å‘½åçš„ç½‘ç»œ host # å…±äº«ä¸»æœºç½‘ç»œåç§°ç©ºé—´(ç­‰åŒäº docker run --net=host) none # ç­‰åŒäº docker run --net=none driver_opts # v3.2ä»¥ä¸Šç‰ˆæœ¬, ä¼ é€’ç»™é©±åŠ¨ç¨‹åºçš„å‚æ•°, è¿™äº›å‚æ•°å–å†³äºé©±åŠ¨ç¨‹åº attachable # driver ä¸º overlay æ—¶ä½¿ç”¨, å¦‚æœè®¾ç½®ä¸º true åˆ™é™¤äº†æœåŠ¡ä¹‹å¤–ï¼Œç‹¬ç«‹å®¹å™¨ä¹Ÿå¯ä»¥é™„åŠ åˆ°è¯¥ç½‘ç»œ; å¦‚æœç‹¬ç«‹å®¹å™¨è¿æ¥åˆ°è¯¥ç½‘ç»œï¼Œåˆ™å®ƒå¯ä»¥ä¸å…¶ä»– Docker å®ˆæŠ¤è¿›ç¨‹è¿æ¥åˆ°çš„è¯¥ç½‘ç»œçš„æœåŠ¡å’Œç‹¬ç«‹å®¹å™¨è¿›è¡Œé€šä¿¡ ipam # è‡ªå®šä¹‰ IPAM é…ç½®. è¿™æ˜¯ä¸€ä¸ªå…·æœ‰å¤šä¸ªå±æ€§çš„å¯¹è±¡, æ¯ä¸ªå±æ€§éƒ½æ˜¯å¯é€‰çš„ driver # IPAM é©±åŠ¨ç¨‹åº, bridge æˆ–è€… default config # é…ç½®é¡¹ subnet # CIDRæ ¼å¼çš„å­ç½‘ï¼Œè¡¨ç¤ºè¯¥ç½‘ç»œçš„ç½‘æ®µ external # å¤–éƒ¨ç½‘ç»œ, å¦‚æœè®¾ç½®ä¸º true åˆ™ docker-compose up ä¸ä¼šå°è¯•åˆ›å»ºå®ƒ, å¦‚æœå®ƒä¸å­˜åœ¨åˆ™å¼•å‘é”™è¯¯ name # v3.5 ä»¥ä¸Šç‰ˆæœ¬, ä¸ºæ­¤ç½‘ç»œè®¾ç½®åç§°æ–‡ä»¶æ ¼å¼ç¤ºä¾‹ï¼š version: &quot;3&quot; services: redis: image: redis:alpine ports: - &quot;6379&quot; networks: - frontend deploy: replicas: 2 update_config: parallelism: 2 delay: 10s restart_policy: condition: on-failure db: image: postgres:9.4 volumes: - db-data:/var/lib/postgresql/data networks: - backend deploy: placement: constraints: [node.role == manager] 2.docker-compose å¸¸ç”¨å‘½ä»¤ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859# 1.æŸ¥çœ‹docker-composeçš„ç‰ˆæœ¬docker-compose --version# 2.éªŒè¯ï¼ˆdocker-compose.ymlï¼‰æ–‡ä»¶é…ç½®ï¼Œå½“é…ç½®æ­£ç¡®æ—¶ï¼Œä¸è¾“å‡ºä»»ä½•å†…å®¹ï¼Œå½“æ–‡ä»¶é…ç½®é”™è¯¯ï¼Œè¾“å‡ºé”™è¯¯ä¿¡æ¯ã€‚docker-compose config -q# 3.å¯åŠ¨compose(åå°è¿è¡Œï¼Œå³å®ˆæŠ¤è¿›ç¨‹)docker-compose up -d# 4.æŒ‡å®šæ–‡ä»¶åå°å¯åŠ¨docker-compose -f docker-compose.yml up -d# 5.æŸ¥çœ‹æ—¥å¿—docker-compose logs tomcat# 6.ç›‘å¬æ—¥å¿—docker-compose logs -f tomcat# 7.åœæ­¢å®¹å™¨docker-compose stop tomcat# 8.å¯åŠ¨å®¹å™¨docker-compose start tomcat# 9.é‡å¯å®¹å™¨docker-compose restart tomcat# 10.åˆ é™¤å®¹å™¨ï¼ˆæ¨èå…ˆæ‰§è¡Œåœæ­¢å®¹å™¨ï¼‰docker-compose rm tomcat# 11.è¿›å…¥tomcatæœåŠ¡ä¸‹å®¹å™¨docker-compose exec tomcat bash# 12.æŸ¥çœ‹å½“å‰æœ‰å“ªäº›å®¹å™¨ï¼ˆdocker-compose.yml æ‰€åœ¨æ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œï¼‰docker-compose ps# 13.æ˜¾ç¤ºè¿è¡Œçš„è¿›ç¨‹ï¼šdocker-compose top tomcat# 14.ä¸‹è½½æœåŠ¡é•œåƒdocker-compose pull é•œåƒåç§°# 15.åˆ—å‡ºé•œåƒdocker-compose images ä¾‹ï¼šæµ‹è¯•æ‰€ç”¨ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657version: &#x27;3.1&#x27; # ç‰ˆæœ¬å·services: ## æœåŠ¡ tomcat: #tomcat æœåŠ¡ restart: always image: tomcat:8 #é•œåƒ container_name: tomcat8 #å®¹å™¨å ports: #ç«¯å£ - 8080:8080 volumes: #æ•°æ®å· - /home/dabing/lzz/webapps/:/usr/local/tomcat/webapps/ mysql: #mysqlæœåŠ¡ build: . #é€šè¿‡MySQLçš„Dockerfileæ–‡ä»¶æ„å»ºMySQL restart: always image: mysql:5.7 container_name: mysql5.7 ports: - 3306:3306 environment: MYSQL_ROOT_PASSWORD: 123456 command: --character-set-server=utf8mb4 --collation-server=utf8mb4_general_ci --explicit_defaults_for_timestamp=true --lower_case_table_names=1 --max_allowed_packet=128M --sql-mode=&quot;STRICT_TRANS_TABLES,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO&quot; volumes: - /home/dabing/mysql:/var/lib/mysql DOCKERFile 12345678910111213141516171819# è¿™ä¸ªæ˜¯æ„å»ºMySQLçš„dockerfileFROM registry.saas.hand-china.com/tools/mysql:5.7.17# mysqlçš„å·¥ä½œä½ç½®ENV WORK_PATH /usr/local/# å®šä¹‰ä¼šè¢«å®¹å™¨è‡ªåŠ¨æ‰§è¡Œçš„ç›®å½•ENV AUTO_RUN_DIR /docker-entrypoint-initdb.d#å¤åˆ¶gropshop.sqlåˆ°/usr/local COPY grogshop.sql /usr/local/#æŠŠè¦æ‰§è¡Œçš„shellæ–‡ä»¶æ”¾åˆ°/docker-entrypoint-initdb.d/ç›®å½•ä¸‹ï¼Œå®¹å™¨ä¼šè‡ªåŠ¨æ‰§è¡Œè¿™ä¸ªshellCOPY docker-entrypoint.sh $AUTO_RUN_DIR/#ç»™æ‰§è¡Œæ–‡ä»¶å¢åŠ å¯æ‰§è¡Œæƒé™RUN chmod a+x $AUTO_RUN_DIR/docker-entrypoint.sh# è®¾ç½®å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤#CMD [&quot;sh&quot;, &quot;/docker-entrypoint-initdb.d/import.sh&quot;] ç›¸å…³èµ„æºï¼šDockerå®¹å™¨çš„åˆ›å»ºã€å¯åŠ¨ã€å’Œåœæ­¢çš„æ–¹æ³•_dockerå¯åŠ¨å·²åˆ›å»ºçš„å®¹å™¨â€¦","categories":[{"name":"Webå¼€å‘","slug":"Webå¼€å‘","permalink":"http://kaillliu.github.io/categories/Web%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://kaillliu.github.io/tags/Java/"},{"name":"Centos","slug":"Centos","permalink":"http://kaillliu.github.io/tags/Centos/"},{"name":"docket","slug":"docket","permalink":"http://kaillliu.github.io/tags/docket/"}]},{"title":"Nginxå­¦ä¹ ï¼ˆäº”ï¼‰--- ä¸Tomcatç»“åˆ","slug":"Nginxå­¦ä¹ å…¶äº”","date":"2022-04-21T09:00:00.000Z","updated":"2022-05-23T05:41:23.080Z","comments":true,"path":"2022/04/21/Nginxå­¦ä¹ å…¶äº”/","link":"","permalink":"http://kaillliu.github.io/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E4%BA%94/","excerpt":"","text":"Nginxå®ç°æœåŠ¡å™¨ç«¯é›†ç¾¤æ­å»º Nginxä¸Tomcatéƒ¨ç½² å‰é¢è¯¾ç¨‹å·²ç»å°†Nginxçš„å¤§éƒ¨åˆ†å†…å®¹è¿›è¡Œäº†è®²è§£ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“äº†Nginxåœ¨é«˜å¹¶å‘åœºæ™¯å’Œå¤„ç†é™æ€èµ„æºæ˜¯éå¸¸é«˜æ€§èƒ½çš„ï¼Œä½†æ˜¯åœ¨å®é™…é¡¹ç›®ä¸­é™¤äº†é™æ€èµ„æºè¿˜æœ‰å°±æ˜¯åå°ä¸šåŠ¡ä»£ç æ¨¡å—ï¼Œä¸€èˆ¬åå°ä¸šåŠ¡éƒ½ä¼šè¢«éƒ¨ç½²åœ¨Tomcatï¼Œweblogicæˆ–è€…æ˜¯websphereç­‰webæœåŠ¡å™¨ä¸Šã€‚é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨Nginxæ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚å¹¶æŠŠè¯·æ±‚è½¬å‘åˆ°åå°webæœåŠ¡å™¨ï¼Ÿ æ­¥éª¤åˆ†æ: 121.å‡†å¤‡Tomcatç¯å¢ƒï¼Œå¹¶åœ¨Tomcatä¸Šéƒ¨ç½²ä¸€ä¸ªwebé¡¹ç›®2.å‡†å¤‡Nginxç¯å¢ƒï¼Œä½¿ç”¨Nginxæ¥æ”¶è¯·æ±‚ï¼Œå¹¶æŠŠè¯·æ±‚åˆ†å‘åˆ°Tomatä¸Š ç¯å¢ƒå‡†å¤‡(Tomcat) æµè§ˆå™¨è®¿é—®: 1http://192.168.200.146:8080/demo/index.html è·å–åŠ¨æ€èµ„æºçš„é“¾æ¥åœ°å€: 1http://192.168.200.146:8080/demo/getAddress æœ¬æ¬¡è¯¾ç¨‹å°†é‡‡ç”¨Tomcatä½œä¸ºåå°webæœåŠ¡å™¨ ï¼ˆ1ï¼‰åœ¨Centosä¸Šå‡†å¤‡ä¸€ä¸ªTomcat 123451.Tomcatå®˜ç½‘åœ°å€:https://tomcat.apache.org/2.ä¸‹è½½tomcat,æœ¬æ¬¡è¯¾ç¨‹ä½¿ç”¨çš„æ˜¯apache-tomcat-8.5.59.tar.gz3.å°†tomcatè¿›è¡Œè§£å‹ç¼©mkdir web_tomcattar -zxf apache-tomcat-8.5.59.tar.gz -C /web_tomcat ï¼ˆ2ï¼‰å‡†å¤‡ä¸€ä¸ªwebé¡¹ç›®ï¼Œå°†å…¶æ‰“åŒ…ä¸ºwar 1231.å°†èµ„æ–™ä¸­çš„demo.warä¸Šä¼ åˆ°tomcat8ç›®å½•ä¸‹çš„webappsåŒ…ä¸‹2.å°†tomcatè¿›è¡Œå¯åŠ¨ï¼Œè¿›å…¥tomcat8çš„binç›®å½•ä¸‹./startup.sh ï¼ˆ3ï¼‰å¯åŠ¨tomcatè¿›è¡Œè®¿é—®æµ‹è¯•ã€‚ 12é™æ€èµ„æº: http://192.168.200.146:8080/demo/index.htmlåŠ¨æ€èµ„æº: http://192.168.200.146:8080/demo/getAddress ç¯å¢ƒå‡†å¤‡(Nginx) ï¼ˆ1ï¼‰ä½¿ç”¨Nginxçš„åå‘ä»£ç†ï¼Œå°†è¯·æ±‚è½¬ç»™Tomcatè¿›è¡Œå¤„ç†ã€‚ 12345678910upstream webservice &#123; server 192.168.200.146:8080;&#125;server&#123; listen 80; server_name localhost; location /demo &#123; proxy_pass http://webservice; &#125;&#125; ï¼ˆ2ï¼‰å¯åŠ¨è®¿é—®æµ‹è¯• å­¦ä¹ åˆ°è¿™ï¼Œå¯èƒ½å¤§å®¶ä¼šæœ‰ä¸€ä¸ªå›°æƒ‘ï¼Œæ˜æ˜ç›´æ¥é€šè¿‡tomcatå°±èƒ½è®¿é—®ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦å¤šåŠ ä¸€ä¸ªnginxï¼Œè¿™æ ·ä¸æ˜¯åè€Œæ˜¯ç³»ç»Ÿçš„å¤æ‚åº¦å˜é«˜äº†ä¹ˆ? é‚£æ¥ä¸‹æ¥æˆ‘ä»¬ä»ä¸¤ä¸ªæ–¹ä¾¿ç»™å¤§å®¶åˆ†æä¸‹è¿™ä¸ªé—®é¢˜ï¼Œ ç¬¬ä¸€ä¸ªä½¿ç”¨Nginxå®ç°åŠ¨é™åˆ†ç¦» ç¬¬äºŒä¸ªä½¿ç”¨Nginxæ­å»ºTomcatçš„é›†ç¾¤ Nginxå®ç°åŠ¨é™åˆ†ç¦» ä»€ä¹ˆæ˜¯åŠ¨é™åˆ†ç¦»? åŠ¨:åå°åº”ç”¨ç¨‹åºçš„ä¸šåŠ¡å¤„ç† é™:ç½‘ç«™çš„é™æ€èµ„æº(html,javaScript,css,imagesç­‰æ–‡ä»¶) åˆ†ç¦»:å°†ä¸¤è€…è¿›è¡Œåˆ†å¼€éƒ¨ç½²è®¿é—®ï¼Œæä¾›ç”¨æˆ·è¿›è¡Œè®¿é—®ã€‚ä¸¾ä¾‹è¯´æ˜å°±æ˜¯ä»¥åæ‰€æœ‰å’Œé™æ€èµ„æºç›¸å…³çš„å†…å®¹éƒ½äº¤ç»™Nginxæ¥éƒ¨ç½²è®¿é—®ï¼Œéé™æ€å†…å®¹åˆ™äº¤ä¸ªç±»ä¼¼äºTomcatçš„æœåŠ¡å™¨æ¥éƒ¨ç½²è®¿é—®ã€‚ ä¸ºä»€ä¹ˆè¦åŠ¨é™åˆ†ç¦»? â€‹ å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡Nginxåœ¨å¤„ç†é™æ€èµ„æºçš„æ—¶å€™ï¼Œæ•ˆç‡æ˜¯éå¸¸é«˜çš„ï¼Œè€Œä¸”Nginxçš„å¹¶å‘è®¿é—®é‡ä¹Ÿæ˜¯ååˆ—å‰èŒ…ï¼Œè€ŒTomcatåˆ™ç›¸å¯¹æ¯”è¾ƒå¼±ä¸€äº›ï¼Œæ‰€ä»¥æŠŠé™æ€èµ„æºäº¤ä¸ªNginxåï¼Œå¯ä»¥å‡è½»TomcatæœåŠ¡å™¨çš„è®¿é—®å‹åŠ›å¹¶æé«˜é™æ€èµ„æºçš„è®¿é—®é€Ÿåº¦ã€‚ â€‹ åŠ¨é™åˆ†ç¦»ä»¥åï¼Œé™ä½äº†åŠ¨æ€èµ„æºå’Œé™æ€èµ„æºçš„è€¦åˆåº¦ã€‚å¦‚åŠ¨æ€èµ„æºå®•æœºäº†ä¹Ÿä¸å½±å“é™æ€èµ„æºçš„å±•ç¤ºã€‚ å¦‚ä½•å®ç°åŠ¨é™åˆ†ç¦»? å®ç°åŠ¨é™åˆ†ç¦»çš„æ–¹å¼å¾ˆå¤šï¼Œæ¯”å¦‚é™æ€èµ„æºå¯ä»¥éƒ¨ç½²åˆ°fastlyã€Nginxç­‰æœåŠ¡å™¨ä¸Šï¼ŒåŠ¨æ€èµ„æºå¯ä»¥éƒ¨ç½²åˆ°Tomcat,weblogicæˆ–è€…websphereä¸Šã€‚æœ¬æ¬¡è¯¾ç¨‹åªè¦ä½¿ç”¨Nginx+Tomcatæ¥å®ç°åŠ¨é™åˆ†ç¦»ã€‚ éœ€æ±‚åˆ†æ åŠ¨é™åˆ†ç¦»å®ç°æ­¥éª¤ 1.å°†demo.waré¡¹ç›®ä¸­çš„é™æ€èµ„æºéƒ½åˆ é™¤æ‰ï¼Œé‡æ–°æ‰“åŒ…ç”Ÿæˆä¸€ä¸ªwaråŒ…ï¼Œåœ¨èµ„æ–™ä¸­æœ‰æä¾›ã€‚ 2.å°†waråŒ…éƒ¨ç½²åˆ°tomcatä¸­ï¼ŒæŠŠä¹‹å‰éƒ¨ç½²çš„å†…å®¹åˆ é™¤æ‰ 123è¿›å…¥åˆ°tomcatçš„webappsç›®å½•ä¸‹ï¼Œå°†ä¹‹å‰çš„å†…å®¹åˆ é™¤æ‰å°†æ–°çš„waråŒ…å¤åˆ¶åˆ°webappsä¸‹å°†tomcatå¯åŠ¨ 3.åœ¨Nginxæ‰€åœ¨æœåŠ¡å™¨åˆ›å»ºå¦‚ä¸‹ç›®å½•ï¼Œå¹¶å°†å¯¹åº”çš„é™æ€èµ„æºæ”¾å…¥æŒ‡å®šçš„ä½ç½® å…¶ä¸­index.htmlé¡µé¢çš„å†…å®¹å¦‚ä¸‹: 12345678910111213141516171819202122&lt;!DOCTYPE html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt; &lt;meta charset=&quot;UTF-8&quot;&gt; &lt;title&gt;Title&lt;/title&gt; &lt;script src=&quot;js/jquery.min.js&quot;&gt;&lt;/script&gt; &lt;script&gt; $(function()&#123; $.get(&#x27;http://192.168.200.133/demo/getAddress&#x27;,function(data)&#123; $(&quot;#msg&quot;).html(data); &#125;); &#125;); &lt;/script&gt;&lt;/head&gt;&lt;body&gt; &lt;img src=&quot;images/logo.png&quot;/&gt; &lt;h1&gt;Nginxå¦‚ä½•å°†è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨&lt;/h1&gt; &lt;h3 id=&quot;msg&quot;&gt;&lt;/h3&gt; &lt;img src=&quot;images/mv.png&quot;/&gt;&lt;/body&gt;&lt;/html&gt; 4.é…ç½®Nginxçš„é™æ€èµ„æºä¸åŠ¨æ€èµ„æºçš„è®¿é—® 12345678910111213141516171819202122upstream webservice&#123; server 192.168.200.146:8080;&#125;server &#123; listen 80; server_name localhost; #åŠ¨æ€èµ„æº location /demo &#123; proxy_pass http://webservice; &#125; #é™æ€èµ„æº location ~/.*\\.(png|jpg|gif|js)&#123; root html/web; gzip on; &#125; location / &#123; root html/web; index index.html index.htm; &#125;&#125; 5.å¯åŠ¨æµ‹è¯•ï¼Œè®¿é—®http://192.168.200.133/index.html å‡å¦‚æŸä¸ªæ—¶é—´ç‚¹ï¼Œç”±äºæŸä¸ªåŸå› å¯¼è‡´Tomcatåçš„æœåŠ¡å™¨å®•æœºäº†ï¼Œæˆ‘ä»¬å†æ¬¡è®¿é—®Nginx,ä¼šå¾—åˆ°å¦‚ä¸‹æ•ˆæœï¼Œç”¨æˆ·è¿˜æ˜¯èƒ½çœ‹åˆ°é¡µé¢ï¼Œåªæ˜¯ç¼ºå¤±äº†è®¿é—®æ¬¡æ•°çš„ç»Ÿè®¡ï¼Œè¿™å°±æ˜¯å‰åç«¯è€¦åˆåº¦é™ä½çš„æ•ˆæœï¼Œå¹¶ä¸”æ•´ä¸ªè¯·æ±‚åªå’Œåçš„æœåŠ¡å™¨äº¤äº’äº†ä¸€æ¬¡ï¼Œjså’Œimageséƒ½ç›´æ¥ä»Nginxè¿”å›ï¼Œæä¾›äº†æ•ˆç‡ï¼Œé™ä½äº†åçš„æœåŠ¡å™¨çš„å‹åŠ›ã€‚ Nginxå®ç°Tomcaté›†ç¾¤æ­å»º åœ¨ä½¿ç”¨Nginxå’ŒTomcatéƒ¨ç½²é¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä¸€å°NginxæœåŠ¡å™¨å’Œä¸€å°TomcatæœåŠ¡å™¨ï¼Œæ•ˆæœå›¾å¦‚ä¸‹: é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœTomcatçš„çœŸçš„å®•æœºäº†ï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¼šä¸å®Œæ•´ï¼Œæ‰€ä»¥å¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œä¸€å°æœåŠ¡å™¨å®¹æ˜“å®•æœºï¼Œé‚£å°±å¤šæ­å»ºå‡ å°TomcatæœåŠ¡å™¨ï¼Œè¿™æ ·çš„è¯å°±æå‡äº†åçš„æœåŠ¡å™¨çš„å¯ç”¨æ€§ã€‚è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„é›†ç¾¤ï¼Œæ­å»ºTomcatçš„é›†ç¾¤éœ€è¦ç”¨åˆ°äº†Nginxçš„åå‘ä»£ç†å’Œèµ‹å€¼å‡è¡¡çš„çŸ¥è¯†ï¼Œå…·ä½“å¦‚ä½•æ¥å®ç°?æˆ‘ä»¬å…ˆæ¥åˆ†æä¸‹åŸç† ç¯å¢ƒå‡†å¤‡ï¼š (1)å‡†å¤‡3å°tomcat,ä½¿ç”¨ç«¯å£è¿›è¡ŒåŒºåˆ†[å®é™…ç¯å¢ƒåº”è¯¥æ˜¯ä¸‰å°æœåŠ¡å™¨]ï¼Œä¿®æ”¹server.mlï¼Œå°†ç«¯å£ä¿®æ”¹åˆ†åˆ«ä¿®æ”¹ä¸º8080,8180,8280 (2)å¯åŠ¨tomcatå¹¶è®¿é—®æµ‹è¯•ï¼Œ 1http://192.168.200.146:8080/demo/getAddress 1http://192.168.200.146:8180/demo/getAddress 1http://192.168.200.146:8280/demo/getAddress (3)åœ¨Nginxå¯¹åº”çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹: 123456upstream webservice&#123; server 192.168.200.146:8080; server 192.168.200.146:8180; server 192.168.200.146:8280; &#125; å¥½äº†ï¼Œå®Œæˆäº†ä¸Šè¿°ç¯å¢ƒçš„éƒ¨ç½²ï¼Œæˆ‘ä»¬å·²ç»è§£å†³äº†Tomcatçš„é«˜å¯ç”¨æ€§ï¼Œä¸€å°æœåŠ¡å™¨å®•æœºï¼Œè¿˜æœ‰å…¶ä»–ä¸¤æ¡å¯¹å¤–æä¾›æœåŠ¡ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å®ç°åå°æœåŠ¡å™¨çš„ä¸é—´æ–­æ›´æ–°ã€‚ä½†æ˜¯æ–°é—®é¢˜å‡ºç°äº†ï¼Œä¸Šè¿°ç¯å¢ƒä¸­ï¼Œå¦‚æœæ˜¯Nginxå®•æœºäº†å‘¢ï¼Œé‚£ä¹ˆæ•´å¥—ç³»ç»Ÿéƒ½å°†æœåŠ¡å¯¹å¤–æä¾›æœåŠ¡äº†ï¼Œè¿™ä¸ªå¦‚ä½•è§£å†³ï¼Ÿ Nginxé«˜å¯ç”¨è§£å†³æ–¹æ¡ˆ é’ˆå¯¹äºä¸Šé¢æåˆ°çš„é—®é¢˜ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸‹è¦æƒ³è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œéœ€è¦é¢ä¸´å“ªäº›é—®é¢˜? 1éœ€è¦ä¸¤å°ä»¥ä¸Šçš„NginxæœåŠ¡å™¨å¯¹å¤–æä¾›æœåŠ¡ï¼Œè¿™æ ·çš„è¯å°±å¯ä»¥è§£å†³å…¶ä¸­ä¸€å°å®•æœºäº†ï¼Œå¦å¤–ä¸€å°è¿˜èƒ½å¯¹å¤–æä¾›æœåŠ¡ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸¤å°NginxæœåŠ¡å™¨çš„è¯ï¼Œä¼šæœ‰ä¸¤ä¸ªIPåœ°å€ï¼Œç”¨æˆ·è¯¥è®¿é—®å“ªå°æœåŠ¡å™¨ï¼Œç”¨æˆ·æ€ä¹ˆçŸ¥é“å“ªå°æ˜¯å¥½çš„ï¼Œå“ªå°æ˜¯å®•æœºäº†çš„? Keepalived ä½¿ç”¨Keepalivedæ¥è§£å†³ï¼ŒKeepalived è½¯ä»¶ç”± C ç¼–å†™çš„ï¼Œæœ€åˆæ˜¯ä¸“ä¸º LVS è´Ÿè½½å‡è¡¡è½¯ä»¶è®¾è®¡çš„ï¼ŒKeepalived è½¯ä»¶ä¸»è¦æ˜¯é€šè¿‡ VRRP åè®®å®ç°é«˜å¯ç”¨åŠŸèƒ½ã€‚ VRRPä»‹ç» VRRPï¼ˆVirtual Route Redundancy Protocolï¼‰åè®®ï¼Œç¿»è¯‘è¿‡æ¥ä¸ºè™šæ‹Ÿè·¯ç”±å†—ä½™åè®®ã€‚VRRPåè®®å°†ä¸¤å°æˆ–å¤šå°è·¯ç”±å™¨è®¾å¤‡è™šæ‹Ÿæˆä¸€ä¸ªè®¾å¤‡ï¼Œå¯¹å¤–æä¾›è™šæ‹Ÿè·¯ç”±å™¨IP,è€Œåœ¨è·¯ç”±å™¨ç»„å†…éƒ¨ï¼Œå¦‚æœå®é™…æ‹¥æœ‰è¿™ä¸ªå¯¹å¤–IPçš„è·¯ç”±å™¨å¦‚æœå·¥ä½œæ­£å¸¸çš„è¯å°±æ˜¯MASTER,MASTERå®ç°é’ˆå¯¹è™šæ‹Ÿè·¯ç”±å™¨IPçš„å„ç§ç½‘ç»œåŠŸèƒ½ã€‚å…¶ä»–è®¾å¤‡ä¸æ‹¥æœ‰è¯¥è™šæ‹ŸIPï¼ŒçŠ¶æ€ä¸ºBACKUP,å¤„äº†æ¥æ”¶MASTERçš„VRRPçŠ¶æ€é€šå‘Šä¿¡æ¯ä»¥å¤–ï¼Œä¸æ‰§è¡Œå¯¹å¤–çš„ç½‘ç»œåŠŸèƒ½ã€‚å½“ä¸»æœºå¤±æ•ˆæ—¶ï¼ŒBACKUPå°†æ¥ç®¡åŸå…ˆMASTERçš„ç½‘ç»œåŠŸèƒ½ã€‚ ä»ä¸Šé¢çš„ä»‹ç»ä¿¡æ¯è·å–åˆ°çš„å†…å®¹å°±æ˜¯VRRPæ˜¯ä¸€ç§åè®®ï¼Œé‚£è¿™ä¸ªåè®®æ˜¯ç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Ÿ 1.é€‰æ‹©åè®® 1VRRPå¯ä»¥æŠŠä¸€ä¸ªè™šæ‹Ÿè·¯ç”±å™¨çš„è´£ä»»åŠ¨æ€åˆ†é…åˆ°å±€åŸŸç½‘ä¸Šçš„ VRRP è·¯ç”±å™¨ä¸­çš„ä¸€å°ã€‚å…¶ä¸­çš„è™šæ‹Ÿè·¯ç”±å³Virtualè·¯ç”±æ˜¯ç”±VRRPè·¯ç”±ç¾¤ç»„åˆ›å»ºçš„ä¸€ä¸ªä¸çœŸå®å­˜åœ¨çš„è·¯ç”±ï¼Œè¿™ä¸ªè™šæ‹Ÿè·¯ç”±ä¹Ÿæ˜¯æœ‰å¯¹åº”çš„IPåœ°å€ã€‚è€Œä¸”VRRPè·¯ç”±1å’ŒVRRPè·¯ç”±2ä¹‹é—´ä¼šæœ‰ç«äº‰é€‰æ‹©ï¼Œé€šè¿‡é€‰æ‹©ä¼šäº§ç”Ÿä¸€ä¸ªMasterè·¯ç”±å’Œä¸€ä¸ªBackupè·¯ç”±ã€‚ 2.è·¯ç”±å®¹é”™åè®® 1Masterè·¯ç”±å’ŒBackupè·¯ç”±ä¹‹é—´ä¼šæœ‰ä¸€ä¸ªå¿ƒè·³æ£€æµ‹ï¼ŒMasterä¼šå®šæ—¶å‘ŠçŸ¥Backupè‡ªå·±çš„çŠ¶æ€ï¼Œå¦‚æœåœ¨æŒ‡å®šçš„æ—¶é—´å†…ï¼ŒBackupæ²¡æœ‰æ¥æ”¶åˆ°è¿™ä¸ªé€šçŸ¥å†…å®¹ï¼ŒBackupå°±ä¼šæ›¿ä»£Masteræˆä¸ºæ–°çš„Masterã€‚Masterè·¯ç”±æœ‰ä¸€ä¸ªç‰¹æƒå°±æ˜¯è™šæ‹Ÿè·¯ç”±å’Œåç«¯æœåŠ¡å™¨éƒ½æ˜¯é€šè¿‡Masterè¿›è¡Œæ•°æ®ä¼ é€’äº¤äº’çš„ï¼Œè€Œå¤‡ä»½èŠ‚ç‚¹åˆ™ä¼šç›´æ¥ä¸¢å¼ƒè¿™äº›è¯·æ±‚å’Œæ•°æ®ï¼Œä¸åšå¤„ç†ï¼Œåªæ˜¯å»ç›‘å¬Masterçš„çŠ¶æ€ ç”¨äº†Keepalivedåï¼Œè§£å†³æ–¹æ¡ˆå¦‚ä¸‹: ç¯å¢ƒæ­å»º ç¯å¢ƒå‡†å¤‡ VIP IP ä¸»æœºå ä¸»/ä» 192.168.200.133 keepalived1 Master 192.168.200.222 192.168.200.122 keepalived2 Backup keepalivedçš„å®‰è£… 1234567891011æ­¥éª¤1:ä»å®˜æ–¹ç½‘ç«™ä¸‹è½½keepalived,å®˜ç½‘åœ°å€https://keepalived.org/æ­¥éª¤2:å°†ä¸‹è½½çš„èµ„æºä¸Šä¼ åˆ°æœåŠ¡å™¨ keepalived-2.0.20.tar.gzæ­¥éª¤3:åˆ›å»ºkeepalivedç›®å½•ï¼Œæ–¹ä¾¿ç®¡ç†èµ„æº mkdir keepalivedæ­¥éª¤4:å°†å‹ç¼©æ–‡ä»¶è¿›è¡Œè§£å‹ç¼©ï¼Œè§£å‹ç¼©åˆ°æŒ‡å®šçš„ç›®å½• tar -zxf keepalived-2.0.20.tar.gz -C keepalived/æ­¥éª¤5:å¯¹keepalivedè¿›è¡Œé…ç½®ï¼Œç¼–è¯‘å’Œå®‰è£… cd keepalived/keepalived-2.0.20 ./configure --sysconf=/etc --prefix=/usr/local make &amp;&amp; make install å®‰è£…å®Œæˆåï¼Œæœ‰ä¸¤ä¸ªæ–‡ä»¶éœ€è¦æˆ‘ä»¬è®¤è¯†ä¸‹ï¼Œä¸€ä¸ªæ˜¯ /etc/keepalived/keepalived.conf(keepalivedçš„ç³»ç»Ÿé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¸»è¦æ“ä½œçš„å°±æ˜¯è¯¥æ–‡ä»¶)ï¼Œä¸€ä¸ªæ˜¯/usr/local/sbinç›®å½•ä¸‹çš„keepalived,æ˜¯ç³»ç»Ÿé…ç½®è„šæœ¬ï¼Œç”¨æ¥å¯åŠ¨å’Œå…³é—­keepalived Keepalivedé…ç½®æ–‡ä»¶ä»‹ç» æ‰“å¼€keepalived.confé…ç½®æ–‡ä»¶ è¿™é‡Œé¢ä¼šåˆ†ä¸‰éƒ¨ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯globalå…¨å±€é…ç½®ã€ç¬¬äºŒéƒ¨åˆ†æ˜¯vrrpç›¸å…³é…ç½®ã€ç¬¬ä¸‰éƒ¨åˆ†æ˜¯LVSç›¸å…³é…ç½®ã€‚ æœ¬æ¬¡è¯¾ç¨‹ä¸»è¦æ˜¯ä½¿ç”¨keepalivedå®ç°é«˜å¯ç”¨éƒ¨ç½²ï¼Œæ²¡æœ‰ç”¨åˆ°LVSï¼Œæ‰€ä»¥æˆ‘ä»¬é‡ç‚¹å…³æ³¨çš„æ˜¯å‰ä¸¤éƒ¨åˆ† 12345678910111213141516171819202122232425globalå…¨å±€éƒ¨åˆ†ï¼šglobal_defs &#123; #é€šçŸ¥é‚®ä»¶ï¼Œå½“keepalivedå‘é€åˆ‡æ¢æ—¶éœ€è¦å‘emailç»™å…·ä½“çš„é‚®ç®±åœ°å€ notification_email &#123; tom@itcast.cn jerry@itcast.cn &#125; #è®¾ç½®å‘ä»¶äººçš„é‚®ç®±ä¿¡æ¯ notification_email_from zhaomin@itcast.cn #æŒ‡å®šsmptæœåŠ¡åœ°å€ smtp_server 192.168.200.1 #æŒ‡å®šsmptæœåŠ¡è¿æ¥è¶…æ—¶æ—¶é—´ smtp_connect_timeout 30 #è¿è¡ŒkeepalivedæœåŠ¡å™¨çš„ä¸€ä¸ªæ ‡è¯†ï¼Œå¯ä»¥ç”¨ä½œå‘é€é‚®ä»¶çš„ä¸»é¢˜ä¿¡æ¯ router_id LVS_DEVEL #é»˜è®¤æ˜¯ä¸è·³è¿‡æ£€æŸ¥ã€‚æ£€æŸ¥æ”¶åˆ°çš„VRRPé€šå‘Šä¸­çš„æ‰€æœ‰åœ°å€å¯èƒ½ä¼šæ¯”è¾ƒè€—æ—¶ï¼Œè®¾ç½®æ­¤å‘½ä»¤çš„æ„æ€æ˜¯ï¼Œå¦‚æœé€šå‘Šä¸æ¥æ”¶çš„ä¸Šä¸€ä¸ªé€šå‘Šæ¥è‡ªç›¸åŒçš„masterè·¯ç”±å™¨ï¼Œåˆ™ä¸æ‰§è¡Œæ£€æŸ¥(è·³è¿‡æ£€æŸ¥) vrrp_skip_check_adv_addr #ä¸¥æ ¼éµå®ˆVRRPåè®®ã€‚ vrrp_strict #åœ¨ä¸€ä¸ªæ¥å£å‘é€çš„ä¸¤ä¸ªå…è´¹ARPä¹‹é—´çš„å»¶è¿Ÿã€‚å¯ä»¥ç²¾ç¡®åˆ°æ¯«ç§’çº§ã€‚é»˜è®¤æ˜¯0 vrrp_garp_interval 0 #åœ¨ä¸€ä¸ªç½‘å¡ä¸Šæ¯ç»„naæ¶ˆæ¯ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´ï¼Œé»˜è®¤ä¸º0 vrrp_gna_interval 0&#125; 123456789101112131415161718192021VRRPéƒ¨åˆ†ï¼Œè¯¥éƒ¨åˆ†å¯ä»¥åŒ…å«ä»¥ä¸‹å››ä¸ªå­æ¨¡å—1. vrrp_script2. vrrp_sync_group3. garp_group4. vrrp_instanceæˆ‘ä»¬ä¼šç”¨åˆ°ç¬¬ä¸€ä¸ªå’Œç¬¬å››ä¸ªï¼Œ#è®¾ç½®keepalivedå®ä¾‹çš„ç›¸å…³ä¿¡æ¯ï¼ŒVI_1ä¸ºVRRPå®ä¾‹åç§°vrrp_instance VI_1 &#123; state MASTER #æœ‰ä¸¤ä¸ªå€¼å¯é€‰MASTERä¸» BACKUPå¤‡ interface ens33 #vrrpå®ä¾‹ç»‘å®šçš„æ¥å£ï¼Œç”¨äºå‘é€VRRPåŒ…[å½“å‰æœåŠ¡å™¨ä½¿ç”¨çš„ç½‘å¡åç§°] virtual_router_id 51#æŒ‡å®šVRRPå®ä¾‹IDï¼ŒèŒƒå›´æ˜¯0-255 priority 100 #æŒ‡å®šä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§é«˜çš„å°†æˆä¸ºMASTER advert_int 1 #æŒ‡å®šå‘é€VRRPé€šå‘Šçš„é—´éš”ï¼Œå•ä½æ˜¯ç§’ authentication &#123; #vrrpä¹‹é—´é€šä¿¡çš„è®¤è¯ä¿¡æ¯ auth_type PASS #æŒ‡å®šè®¤è¯æ–¹å¼ã€‚PASSç®€å•å¯†ç è®¤è¯(æ¨è) auth_pass 1111 #æŒ‡å®šè®¤è¯ä½¿ç”¨çš„å¯†ç ï¼Œæœ€å¤š8ä½ &#125; virtual_ipaddress &#123; #è™šæ‹ŸIPåœ°å€è®¾ç½®è™šæ‹ŸIPåœ°å€ï¼Œä¾›ç”¨æˆ·è®¿é—®ä½¿ç”¨ï¼Œå¯è®¾ç½®å¤šä¸ªï¼Œä¸€è¡Œä¸€ä¸ª 192.168.200.222 &#125;&#125; é…ç½®å†…å®¹å¦‚ä¸‹: æœåŠ¡å™¨1 1234567891011121314151617181920212223242526272829global_defs &#123; notification_email &#123; tom@itcast.cn jerry@itcast.cn &#125; notification_email_from zhaomin@itcast.cn smtp_server 192.168.200.1 smtp_connect_timeout 30 router_id keepalived1 vrrp_skip_check_adv_addr vrrp_strict vrrp_garp_interval 0 vrrp_gna_interval 0&#125;vrrp_instance VI_1 &#123; state MASTER interface ens33 virtual_router_id 51 priority 100 advert_int 1 authentication &#123; auth_type PASS auth_pass 1111 &#125; virtual_ipaddress &#123; 192.168.200.222 &#125;&#125; æœåŠ¡å™¨2 12345678910111213141516171819202122232425262728293031! Configuration File for keepalivedglobal_defs &#123; notification_email &#123; tom@itcast.cn jerry@itcast.cn &#125; notification_email_from zhaomin@itcast.cn smtp_server 192.168.200.1 smtp_connect_timeout 30 router_id keepalived2 vrrp_skip_check_adv_addr vrrp_strict vrrp_garp_interval 0 vrrp_gna_interval 0&#125;vrrp_instance VI_1 &#123; state BACKUP interface ens33 virtual_router_id 51 priority 90 advert_int 1 authentication &#123; auth_type PASS auth_pass 1111 &#125; virtual_ipaddress &#123; 192.168.200.222 &#125;&#125; è®¿é—®æµ‹è¯• å¯åŠ¨keepalivedä¹‹å‰ï¼Œå’±ä»¬å…ˆä½¿ç”¨å‘½ä»¤ ip a,æŸ¥çœ‹192.168.200.133å’Œ192.168.200.122è¿™ä¸¤å°æœåŠ¡å™¨çš„IPæƒ…å†µã€‚ åˆ†åˆ«å¯åŠ¨ä¸¤å°æœåŠ¡å™¨çš„keepalived 12cd /usr/local/sbin./keepalived å†æ¬¡é€šè¿‡ ip aæŸ¥çœ‹ip å½“æŠŠ192.168.200.133æœåŠ¡å™¨ä¸Šçš„keepalivedå…³é—­åï¼Œå†æ¬¡æŸ¥çœ‹ip é€šè¿‡ä¸Šè¿°çš„æµ‹è¯•ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œè™šæ‹ŸIP(VIP)ä¼šåœ¨MASTERèŠ‚ç‚¹ä¸Šï¼Œå½“MASTERèŠ‚ç‚¹ä¸Šçš„keepalivedå‡ºé—®é¢˜ä»¥åï¼Œå› ä¸ºBACKUPæ— æ³•æ”¶åˆ°MASTERå‘å‡ºçš„VRRPçŠ¶æ€é€šè¿‡ä¿¡æ¯ï¼Œå°±ä¼šç›´æ¥å‡ä¸ºMASTERã€‚VIPä¹Ÿä¼š&quot;æ¼‚ç§»&quot;åˆ°æ–°çš„MASTERã€‚ ä¸Šé¢æµ‹è¯•å’ŒNginxæœ‰ä»€ä¹ˆå…³ç³»? æˆ‘ä»¬æŠŠ192.168.200.133æœåŠ¡å™¨çš„keepalivedå†æ¬¡å¯åŠ¨ä¸‹ï¼Œç”±äºå®ƒçš„ä¼˜å…ˆçº§é«˜äºæœåŠ¡å™¨192.168.200.122çš„ï¼Œæ‰€æœ‰å®ƒä¼šå†æ¬¡æˆä¸ºMASTERï¼ŒVIPä¹Ÿä¼š&quot;æ¼‚ç§»&quot;è¿‡å»ï¼Œç„¶åæˆ‘ä»¬å†æ¬¡é€šè¿‡æµè§ˆå™¨è®¿é—®: 1http://192.168.200.222/ å¦‚æœæŠŠ192.168.200.133æœåŠ¡å™¨çš„keepalivedå…³é—­æ‰ï¼Œå†æ¬¡è®¿é—®ç›¸åŒçš„åœ°å€ æ•ˆæœå®ç°äº†ä»¥åï¼Œ æˆ‘ä»¬ä¼šå‘ç°è¦æƒ³è®©vipè¿›è¡Œåˆ‡æ¢ï¼Œå°±å¿…é¡»è¦æŠŠæœåŠ¡å™¨ä¸Šçš„keepalivedè¿›è¡Œå…³é—­ï¼Œè€Œä»€ä¹ˆæ—¶å€™å…³é—­keepalivedå‘¢?åº”è¯¥æ˜¯åœ¨keepalivedæ‰€åœ¨æœåŠ¡å™¨çš„nginxå‡ºç°é—®é¢˜åï¼ŒæŠŠkeepalivedå…³é—­æ‰ï¼Œå°±å¯ä»¥è®©VIPæ‰§è¡Œå¦å¤–ä¸€å°æœåŠ¡å™¨ï¼Œä½†æ˜¯ç°åœ¨è¿™æ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯é€šè¿‡æ‰‹åŠ¨æ¥å®Œæˆçš„ï¼Œæˆ‘ä»¬å¦‚ä½•èƒ½è®©ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­å½“å‰æœåŠ¡å™¨çš„nginxæ˜¯å¦æ­£ç¡®å¯åŠ¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè¦èƒ½è®©VIPè‡ªåŠ¨è¿›è¡Œ&quot;æ¼‚ç§»&quot;ï¼Œè¿™ä¸ªé—®é¢˜è¯¥å¦‚ä½•è§£å†³? keepalivedä¹‹vrrp_script keepalivedåªèƒ½åšåˆ°å¯¹ç½‘ç»œæ•…éšœå’Œkeepalivedæœ¬èº«çš„ç›‘æ§ï¼Œå³å½“å‡ºç°ç½‘ç»œæ•…éšœæˆ–è€…keepalivedæœ¬èº«å‡ºç°é—®é¢˜æ—¶ï¼Œè¿›è¡Œåˆ‡æ¢ã€‚ä½†æ˜¯è¿™äº›è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç›‘æ§keepalivedæ‰€åœ¨æœåŠ¡å™¨ä¸Šçš„å…¶ä»–ä¸šåŠ¡ï¼Œæ¯”å¦‚Nginx,å¦‚æœNginxå‡ºç°å¼‚å¸¸äº†ï¼Œä»…ä»…keepalivedä¿æŒæ­£å¸¸ï¼Œæ˜¯æ— æ³•å®Œæˆç³»ç»Ÿçš„æ­£å¸¸å·¥ä½œçš„ï¼Œå› æ­¤éœ€è¦æ ¹æ®ä¸šåŠ¡è¿›ç¨‹çš„è¿è¡ŒçŠ¶æ€å†³å®šæ˜¯å¦éœ€è¦è¿›è¡Œä¸»å¤‡åˆ‡æ¢ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™è„šæœ¬å¯¹ä¸šåŠ¡è¿›ç¨‹è¿›è¡Œæ£€æµ‹ç›‘æ§ã€‚ å®ç°æ­¥éª¤: åœ¨keepalivedé…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¯¹åº”çš„é…ç½®åƒ 123456vrrp_script è„šæœ¬åç§°&#123; script &quot;è„šæœ¬ä½ç½®&quot; interval 3 #æ‰§è¡Œæ—¶é—´é—´éš” weight -20 #åŠ¨æ€è°ƒæ•´vrrp_instanceçš„ä¼˜å…ˆçº§&#125; ç¼–å†™è„šæœ¬ ck_nginx.sh 123456789#!/bin/bashnum=`ps -C nginx --no-header | wc -l`if [ $num -eq 0 ];then /usr/local/nginx/sbin/nginx sleep 2 if [ `ps -C nginx --no-header | wc -l` -eq 0 ]; then killall keepalived fifi Linux pså‘½ä»¤ç”¨äºæ˜¾ç¤ºå½“å‰è¿›ç¨‹ (process) çš„çŠ¶æ€ã€‚ -C(command) :æŒ‡å®šå‘½ä»¤çš„æ‰€æœ‰è¿›ç¨‹ â€“no-header æ’é™¤æ ‡é¢˜ ä¸ºè„šæœ¬æ–‡ä»¶è®¾ç½®æƒé™ 1chmod 755 ck_nginx.sh å°†è„šæœ¬æ·»åŠ åˆ° 12345678910111213141516171819202122vrrp_script ck_nginx &#123; script &quot;/etc/keepalived/ck_nginx.sh&quot; #æ‰§è¡Œè„šæœ¬çš„ä½ç½® interval 2 #æ‰§è¡Œè„šæœ¬çš„å‘¨æœŸï¼Œç§’ä¸ºå•ä½ weight -20 #æƒé‡çš„è®¡ç®—æ–¹å¼&#125;vrrp_instance VI_1 &#123; state MASTER interface ens33 virtual_router_id 10 priority 100 advert_int 1 authentication &#123; auth_type PASS auth_pass 1111 &#125; virtual_ipaddress &#123; 192.168.200.111 &#125; track_script &#123; ck_nginx &#125;&#125; å¦‚æœæ•ˆæœæ²¡æœ‰å‡ºæ¥ï¼Œå¯ä»¥ä½¿ç”¨ tail -f /var/log/messagesæŸ¥çœ‹æ—¥å¿—ä¿¡æ¯ï¼Œæ‰¾å¯¹åº”çš„é”™è¯¯ä¿¡æ¯ã€‚ æµ‹è¯• é—®é¢˜æ€è€ƒ: é€šå¸¸å¦‚æœmasteræœåŠ¡æ­»æ‰åbackupä¼šå˜æˆmasterï¼Œä½†æ˜¯å½“masteræœåŠ¡åˆå¥½äº†çš„æ—¶å€™ masteræ­¤æ—¶ä¼šæŠ¢å VIPï¼Œè¿™æ ·å°±ä¼šå‘ç”Ÿä¸¤æ¬¡åˆ‡æ¢å¯¹ä¸šåŠ¡ç¹å¿™çš„ç½‘ç«™æ¥è¯´æ˜¯ä¸å¥½çš„ã€‚æ‰€ä»¥æˆ‘ä»¬è¦åœ¨é…ç½®æ–‡ä»¶åŠ å…¥ nopreempt éæŠ¢å ï¼Œä½†æ˜¯è¿™ä¸ªå‚æ•°åªèƒ½ç”¨äºstate ä¸ºbackupï¼Œæ•…æˆ‘ä»¬åœ¨ç”¨HAçš„æ—¶å€™æœ€å¥½master å’Œbackupçš„stateéƒ½è®¾ç½®æˆbackup è®©å…¶é€šè¿‡priorityæ¥ç«äº‰ã€‚ Nginxåˆ¶ä½œä¸‹è½½ç«™ç‚¹ é¦–å…ˆæˆ‘ä»¬å…ˆè¦æ¸…æ¥šä»€ä¹ˆæ˜¯ä¸‹è½½ç«™ç‚¹? æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªç½‘ç«™http://nginx.org/download/è¿™ä¸ªæˆ‘ä»¬åˆšå¼€å§‹å­¦ä¹ Nginxçš„æ—¶å€™ç»™å¤§å®¶çœ‹è¿‡è¿™æ ·çš„ç½‘ç«™ï¼Œè¯¥ç½‘ç«™ä¸»è¦å°±æ˜¯ç”¨æ¥æä¾›ç”¨æˆ·æ¥ä¸‹è½½ç›¸å…³èµ„æºçš„ç½‘ç«™ï¼Œå°±å«åšä¸‹è½½ç½‘ç«™ã€‚ å¦‚ä½•åˆ¶ä½œä¸€ä¸ªä¸‹è½½ç«™ç‚¹: nginxä½¿ç”¨çš„æ˜¯æ¨¡å—ngx_http_autoindex_moduleæ¥å®ç°çš„ï¼Œè¯¥æ¨¡å—å¤„ç†ä»¥æ–œæ (â€œ/â€)ç»“å°¾çš„è¯·æ±‚ï¼Œå¹¶ç”Ÿæˆç›®å½•åˆ—è¡¨ã€‚ nginxç¼–è¯‘çš„æ—¶å€™ä¼šè‡ªåŠ¨åŠ è½½è¯¥æ¨¡å—ï¼Œä½†æ˜¯è¯¥æ¨¡å—é»˜è®¤æ˜¯å…³é—­çš„ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸‹æ¥æŒ‡ä»¤æ¥å®Œæˆå¯¹åº”çš„é…ç½® ï¼ˆ1ï¼‰autoindex:å¯ç”¨æˆ–ç¦ç”¨ç›®å½•åˆ—è¡¨è¾“å‡º è¯­æ³• autoindex on|off; é»˜è®¤å€¼ autoindex off; ä½ç½® httpã€serverã€location ï¼ˆ2ï¼‰autoindex_exact_size:å¯¹åº”HTLMæ ¼å¼ï¼ŒæŒ‡å®šæ˜¯å¦åœ¨ç›®å½•åˆ—è¡¨å±•ç¤ºæ–‡ä»¶çš„è¯¦ç»†å¤§å° é»˜è®¤ä¸ºonï¼Œæ˜¾ç¤ºå‡ºæ–‡ä»¶çš„ç¡®åˆ‡å¤§å°ï¼Œå•ä½æ˜¯bytesã€‚ æ”¹ä¸ºoffåï¼Œæ˜¾ç¤ºå‡ºæ–‡ä»¶çš„å¤§æ¦‚å¤§å°ï¼Œå•ä½æ˜¯kBæˆ–è€…MBæˆ–è€…GB è¯­æ³• autoindex_exact_size on|off; é»˜è®¤å€¼ autoindex_exact_size on; ä½ç½® httpã€serverã€location ï¼ˆ3ï¼‰autoindex_formatï¼šè®¾ç½®ç›®å½•åˆ—è¡¨çš„æ ¼å¼ è¯­æ³• autoindex_format html|xml|json|jsonp; é»˜è®¤å€¼ autoindex_format html; ä½ç½® httpã€serverã€location æ³¨æ„:è¯¥æŒ‡ä»¤åœ¨1.7.9åŠä»¥åç‰ˆæœ¬ä¸­å‡ºç° ï¼ˆ4ï¼‰autoindex_localtime:å¯¹åº”HTMLæ ¼å¼ï¼Œæ˜¯å¦åœ¨ç›®å½•åˆ—è¡¨ä¸Šæ˜¾ç¤ºæ—¶é—´ã€‚ é»˜è®¤ä¸ºoffï¼Œæ˜¾ç¤ºçš„æ–‡ä»¶æ—¶é—´ä¸ºGMTæ—¶é—´ã€‚ æ”¹ä¸ºonåï¼Œæ˜¾ç¤ºçš„æ–‡ä»¶æ—¶é—´ä¸ºæ–‡ä»¶çš„æœåŠ¡å™¨æ—¶é—´ è¯­æ³• autoindex_localtime on | off; é»˜è®¤å€¼ autoindex_localtime off; ä½ç½® httpã€serverã€location é…ç½®æ–¹å¼å¦‚ä¸‹: 12345678location /download&#123; root /usr/local; autoindex on; autoindex_exact_size on; autoindex_format html; autoindex_localtime on;&#125; XML/JSONæ ¼å¼[ä¸€èˆ¬ä¸ç”¨è¿™ä¸¤ç§æ–¹å¼] Nginxçš„ç”¨æˆ·è®¤è¯æ¨¡å— å¯¹åº”ç³»ç»Ÿèµ„æºçš„è®¿é—®ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦é™åˆ¶è°èƒ½è®¿é—®ï¼Œè°ä¸èƒ½è®¿é—®ã€‚è¿™å—å°±æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„è®¤è¯éƒ¨åˆ†ï¼Œè®¤è¯éœ€è¦åšçš„å°±æ˜¯æ ¹æ®ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åå’Œå¯†ç æ¥åˆ¤å®šç”¨æˆ·æ˜¯å¦ä¸ºåˆæ³•ç”¨æˆ·ï¼Œå¦‚æœæ˜¯åˆ™æ”¾è¡Œè®¿é—®ï¼Œå¦‚æœä¸æ˜¯åˆ™æ‹’ç»è®¿é—®ã€‚ Nginxå¯¹åº”ç”¨æˆ·è®¤è¯è¿™å—æ˜¯é€šè¿‡ngx_http_auth_basic_moduleæ¨¡å—æ¥å®ç°çš„ï¼Œå®ƒå…è®¸é€šè¿‡ä½¿ç”¨&quot;HTTPåŸºæœ¬èº«ä»½éªŒè¯&quot;åè®®éªŒè¯ç”¨æˆ·åå’Œå¯†ç æ¥é™åˆ¶å¯¹èµ„æºçš„è®¿é—®ã€‚é»˜è®¤æƒ…å†µä¸‹nginxæ˜¯å·²ç»å®‰è£…äº†è¯¥æ¨¡å—ï¼Œå¦‚æœä¸éœ€è¦åˆ™ä½¿ç”¨â€“without-http_auth_basic_moduleã€‚ è¯¥æ¨¡å—çš„æŒ‡ä»¤æ¯”è¾ƒç®€å•ï¼Œ ï¼ˆ1ï¼‰auth_basic:ä½¿ç”¨â€œ HTTPåŸºæœ¬è®¤è¯â€åè®®å¯ç”¨ç”¨æˆ·åå’Œå¯†ç çš„éªŒè¯ è¯­æ³• auth_basic string|off; é»˜è®¤å€¼ auth_basic off; ä½ç½® http,server,location,limit_except å¼€å¯åï¼ŒæœåŠ¡ç«¯ä¼šè¿”å›401ï¼ŒæŒ‡å®šçš„å­—ç¬¦ä¸²ä¼šè¿”å›åˆ°å®¢æˆ·ç«¯ï¼Œç»™ç”¨æˆ·ä»¥æç¤ºä¿¡æ¯ï¼Œä½†æ˜¯ä¸åŒçš„æµè§ˆå™¨å¯¹å†…å®¹çš„å±•ç¤ºä¸ä¸€è‡´ã€‚ ï¼ˆ2ï¼‰auth_basic_user_file:æŒ‡å®šç”¨æˆ·åå’Œå¯†ç æ‰€åœ¨æ–‡ä»¶ è¯­æ³• auth_basic_user_file file; é»˜è®¤å€¼ â€” ä½ç½® http,server,location,limit_except æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼Œè¯¥æ–‡ä»¶ä¸­çš„ç”¨æˆ·åå’Œå¯†ç çš„è®¾ç½®ï¼Œå¯†ç éœ€è¦è¿›è¡ŒåŠ å¯†ã€‚å¯ä»¥é‡‡ç”¨å·¥å…·è‡ªåŠ¨ç”Ÿæˆ å®ç°æ­¥éª¤: 1.nginx.confæ·»åŠ å¦‚ä¸‹å†…å®¹ 123456789location /download&#123; root /usr/local; autoindex on; autoindex_exact_size on; autoindex_format html; autoindex_localtime on; auth_basic &#x27;please input your auth&#x27;; auth_basic_user_file htpasswd;&#125; 2.æˆ‘ä»¬éœ€è¦ä½¿ç”¨htpasswdå·¥å…·ç”Ÿæˆ 1yum install -y httpd-tools 1234htpasswd -c /usr/local/nginx/conf/htpasswd username //åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶è®°å½•ç”¨æˆ·åå’Œå¯†ç htpasswd -b /usr/local/nginx/conf/htpasswd username password //åœ¨æŒ‡å®šæ–‡ä»¶æ–°å¢ä¸€ä¸ªç”¨æˆ·åå’Œå¯†ç htpasswd -D /usr/local/nginx/conf/htpasswd username //ä»æŒ‡å®šæ–‡ä»¶åˆ é™¤ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯htpasswd -v /usr/local/nginx/conf/htpasswd username //éªŒè¯ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡® ä¸Šè¿°æ–¹å¼è™½ç„¶èƒ½å®ç°ç”¨æˆ·åå’Œå¯†ç çš„éªŒè¯ï¼Œä½†æ˜¯å¤§å®¶ä¹Ÿçœ‹åˆ°äº†ï¼Œæ‰€æœ‰çš„ç”¨æˆ·åå’Œå¯†ç ä¿¡æ¯éƒ½è®°å½•åœ¨æ–‡ä»¶é‡Œé¢ï¼Œå¦‚æœç”¨æˆ·é‡è¿‡å¤§çš„è¯ï¼Œè¿™ç§æ–¹å¼å°±æ˜¾å¾—æœ‰ç‚¹éº»çƒ¦äº†ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¾—é€šè¿‡åå°ä¸šåŠ¡ä»£ç æ¥è¿›è¡Œç”¨æˆ·æƒé™çš„æ ¡éªŒäº†ã€‚ Nginxçš„æ‰©å±•æ¨¡å— Nginxæ˜¯å¯æ‰©å±•çš„ï¼Œå¯ç”¨äºå¤„ç†å„ç§ä½¿ç”¨åœºæ™¯ã€‚æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ä½¿ç”¨Luaæ‰©å±•Nginxçš„åŠŸèƒ½ã€‚ Lua æ¦‚å¿µ Luaæ˜¯ä¸€ç§è½»é‡ã€å°å·§çš„è„šæœ¬è¯­è¨€ï¼Œç”¨æ ‡å‡†Cè¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€å‘ã€‚è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†åµŒå…¥åˆ°å…¶ä»–åº”ç”¨ç¨‹åºä¸­ï¼Œä»è€Œä¸ºåº”ç”¨ç¨‹åºæä¾›çµæ´»çš„æ‰©å±•å’Œå®šåˆ¶åŠŸèƒ½ã€‚ ç‰¹æ€§ è·Ÿå…¶ä»–è¯­è¨€è¿›è¡Œæ¯”è¾ƒï¼ŒLuaæœ‰å…¶è‡ªèº«çš„ç‰¹ç‚¹ï¼š ï¼ˆ1ï¼‰è½»é‡çº§ 1Luaç”¨æ ‡å‡†Cè¯­è¨€ç¼–å†™å¹¶ä»¥æºä»£ç å½¢å¼å¼€å‘ï¼Œç¼–è¯‘åä»…ä»…ä¸€ç™¾ä½™åƒå­—èŠ‚ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åµŒå…¥åˆ°å…¶ä»–ç¨‹åºä¸­ã€‚ ï¼ˆ2ï¼‰å¯æ‰©å±• 1Luaæä¾›éå¸¸ä¸°å¯Œæ˜“äºä½¿ç”¨çš„æ‰©å±•æ¥å£å’Œæœºåˆ¶ï¼Œç”±å®¿ä¸»è¯­è¨€(é€šå¸¸æ˜¯Cæˆ–C++)æä¾›åŠŸèƒ½ï¼ŒLuaå¯ä»¥ä½¿ç”¨å®ƒä»¬ï¼Œå°±åƒå†…ç½®çš„åŠŸèƒ½ä¸€æ ·ã€‚ ï¼ˆ3ï¼‰æ”¯æŒé¢å‘è¿‡ç¨‹ç¼–ç¨‹å’Œå‡½æ•°å¼ç¼–ç¨‹ åº”ç”¨åœºæ™¯ Luaåœ¨ä¸åŒçš„ç³»ç»Ÿä¸­å¾—åˆ°å¤§é‡åº”ç”¨ï¼Œåœºæ™¯çš„åº”ç”¨åœºæ™¯å¦‚ä¸‹: æ¸¸æˆå¼€å‘ã€ç‹¬ç«‹åº”ç”¨è„šæœ¬ã€webåº”ç”¨è„šæœ¬ã€æ‰©å±•å’Œæ•°æ®åº“æ’ä»¶ã€ç³»ç»Ÿå®‰å…¨ä¸Šã€‚ Luaçš„å®‰è£… åœ¨linuxä¸Šå®‰è£…Luaéå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸‹è½½æºç åŒ…å¹¶åœ¨ç»ˆç«¯è§£å‹ã€ç¼–è¯‘å³å¯ä½¿ç”¨ã€‚ Luaçš„å®˜ç½‘åœ°å€ä¸º:https://www.lua.org ç‚¹å‡»downloadå¯ä»¥æ‰¾åˆ°å¯¹åº”ç‰ˆæœ¬çš„ä¸‹è½½åœ°å€ï¼Œæˆ‘ä»¬æœ¬æ¬¡è¯¾ç¨‹é‡‡ç”¨çš„æ˜¯lua-5.3.5,å…¶å¯¹åº”çš„èµ„æºé“¾æ¥åœ°å€ä¸ºhttps://www.lua.org/ftp/lua-5.4.1.tar.gz,ä¹Ÿå¯ä»¥ä½¿ç”¨wgetå‘½ä»¤ç›´æ¥ä¸‹è½½: 1wget https://www.lua.org/ftp/lua-5.4.1.tar.gz ç¼–è¯‘å®‰è£… 123cd lua-5.4.1make linux testmake install å¦‚æœåœ¨æ‰§è¡Œmake linux testå¤±è´¥ï¼ŒæŠ¥å¦‚ä¸‹é”™è¯¯: è¯´æ˜å½“å‰ç³»ç»Ÿç¼ºå°‘libreadline-devä¾èµ–åŒ…ï¼Œéœ€è¦é€šè¿‡å‘½ä»¤æ¥è¿›è¡Œå®‰è£… 1yum install -y readline-devel éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸ 1lua -v Luaçš„è¯­æ³• Luaå’ŒC/C++è¯­æ³•éå¸¸ç›¸ä¼¼ï¼Œæ•´ä½“ä¸Šæ¯”è¾ƒæ¸…æ™°ï¼Œç®€æ´ã€‚æ¡ä»¶è¯­å¥ã€å¾ªç¯è¯­å¥ã€å‡½æ•°è°ƒç”¨éƒ½ä¸C/C++åŸºæœ¬ä¸€è‡´ã€‚å¦‚æœå¯¹C/C++ä¸å¤ªç†Ÿæ‚‰çš„åŒå­¦æ¥è¯´ï¼Œä¹Ÿæ²¡å…³ç³»ï¼Œå› ä¸ºå¤©ä¸‹è¯­è¨€æ˜¯ä¸€å®¶ï¼ŒåŸºæœ¬ä¸Šç†è§£èµ·æ¥éƒ½ä¸ä¼šå¤ªå›°éš¾ã€‚æˆ‘ä»¬ä¸€ç‚¹ç‚¹æ¥è®²ã€‚ ç¬¬ä¸€ä¸ªLuaç¨‹åº å¤§å®¶éœ€è¦çŸ¥é“çš„æ˜¯ï¼ŒLuaæœ‰ä¸¤ç§äº¤äº’æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯:äº¤äº’å¼å’Œè„šæœ¬å¼ï¼Œè¿™ä¸¤è€…çš„åŒºåˆ«ï¼Œä¸‹é¢æˆ‘ä»¬åˆ†åˆ«æ¥è®²è§£ä¸‹ï¼š äº¤äº’å¼ä¹‹HELLOWORLD 1äº¤äº’å¼æ˜¯æŒ‡å¯ä»¥åœ¨å‘½ä»¤è¡Œè¾“å…¥ç¨‹åºï¼Œç„¶åå›è½¦å°±å¯ä»¥çœ‹åˆ°è¿è¡Œçš„æ•ˆæœã€‚ Luaäº¤äº’å¼ç¼–ç¨‹æ¨¡å¼å¯ä»¥é€šè¿‡å‘½ä»¤lua -i æˆ–luaæ¥å¯ç”¨: åœ¨å‘½ä»¤è¡Œä¸­keyè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œå¹¶æŒ‰å›è½¦,ä¼šæœ‰è¾“å‡ºåœ¨æ§åˆ¶å°ï¼š è„šæœ¬å¼ä¹‹HELLOWORLD è„šæœ¬å¼æ˜¯å°†ä»£ç ä¿å­˜åˆ°ä¸€ä¸ªä»¥luaä¸ºæ‰©å±•åçš„æ–‡ä»¶ä¸­å¹¶æ‰§è¡Œçš„æ–¹å¼ã€‚ æ–¹å¼ä¸€: æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–‡ä»¶åä¸º hello.lua,åœ¨æ–‡ä»¶ä¸­æ·»åŠ è¦æ‰§è¡Œçš„ä»£ç ï¼Œç„¶åé€šè¿‡å‘½ä»¤ lua hello.luaæ¥æ‰§è¡Œï¼Œä¼šåœ¨æ§åˆ¶å°è¾“å‡ºå¯¹åº”çš„ç»“æœã€‚ hello.lua 1print(&quot;Hello World!!&quot;) æ–¹å¼äºŒ: å°†hello.luaåšå¦‚ä¸‹ä¿®æ”¹ 12#!/usr/local/bin/luaprint(&quot;Hello World!!!&quot;) ç¬¬ä¸€è¡Œç”¨æ¥æŒ‡å®šLuaè§£é‡Šå™¨æ‰€åœ¨ä½ç½®ä¸º /usr/local/bin/luaï¼ŒåŠ ä¸Š#å·æ ‡è®°è§£é‡Šå™¨ä¼šå¿½ç•¥å®ƒã€‚ä¸€èˆ¬æƒ…å†µä¸‹#!å°±æ˜¯ç”¨æ¥æŒ‡å®šç”¨å“ªä¸ªç¨‹åºæ¥è¿è¡Œæœ¬æ–‡ä»¶ã€‚ä½†æ˜¯hello.luaå¹¶ä¸æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œéœ€è¦é€šè¿‡chmodæ¥è®¾ç½®å¯æ‰§è¡Œæƒé™ï¼Œæœ€ç®€å•çš„æ–¹å¼ä¸º: 1chmod 755 hello.lua ç„¶åæ‰§è¡Œè¯¥æ–‡ä»¶ 1./hello.lua è¡¥å……ä¸€ç‚¹ï¼Œå¦‚æœæƒ³åœ¨äº¤äº’å¼ä¸­è¿è¡Œè„šæœ¬å¼çš„hello.luaä¸­çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªdofileå‡½æ•°ï¼Œå¦‚ï¼š 1dofile(&quot;lua_demo/hello.lua&quot;) æ³¨æ„:åœ¨Luaè¯­è¨€ä¸­ï¼Œè¿ç»­è¯­å¥ä¹‹é—´çš„åˆ†éš”ç¬¦å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åé¢ä¸éœ€è¦åŠ åˆ†å·ï¼Œå½“ç„¶åŠ ä¸Šä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œ åœ¨Luaè¯­è¨€ä¸­ï¼Œè¡¨è¾¾å¼ä¹‹é—´çš„æ¢è¡Œä¹Ÿèµ·ä¸åˆ°ä»»ä½•ä½œç”¨ã€‚å¦‚ä»¥ä¸‹å››ä¸ªå†™æ³•ï¼Œå…¶å®éƒ½æ˜¯ç­‰æ•ˆçš„ 12345678910å†™æ³•ä¸€a=1b=a+2å†™æ³•äºŒa=1;b=a+2;å†™æ³•ä¸‰a=1; b=a+2;å†™æ³•å››a=1 b=a+2 ä¸å»ºè®®ä½¿ç”¨ç¬¬å››ç§æ–¹å¼ï¼Œå¯è¯»æ€§å¤ªå·®ã€‚ Luaçš„æ³¨é‡Š å…³äºLuaçš„æ³¨é‡Šè¦åˆ†ä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯å•è¡Œæ³¨é‡Šï¼Œç¬¬äºŒç§æ˜¯å¤šè¡Œæ³¨é‡Šã€‚ å•è¡Œæ³¨é‡Šçš„è¯­æ³•ä¸ºï¼š 1--æ³¨é‡Šå†…å®¹ å¤šè¡Œæ³¨é‡Šçš„è¯­æ³•ä¸º: 1234--[[ æ³¨é‡Šå†…å®¹ æ³¨é‡Šå†…å®¹--]] å¦‚æœæƒ³å–æ¶ˆå¤šè¡Œæ³¨é‡Šï¼Œåªéœ€è¦åœ¨ç¬¬ä¸€ä¸ªâ€“ä¹‹å‰åœ¨åŠ ä¸€ä¸ª-å³å¯ï¼Œå¦‚ï¼š 1234---[[ æ³¨é‡Šå†…å®¹ æ³¨é‡Šå†…å®¹--]] æ ‡è¯†ç¬¦ æ¢å¥è¯è¯´æ ‡è¯†ç¬¦å°±æ˜¯æˆ‘ä»¬çš„å˜é‡åï¼ŒLuaå®šä¹‰å˜é‡åä»¥ä¸€ä¸ªå­—æ¯ A åˆ° Z æˆ– a åˆ° z æˆ–ä¸‹åˆ’çº¿ _ å¼€å¤´ååŠ ä¸Š0ä¸ªæˆ–å¤šä¸ªå­—æ¯ï¼Œä¸‹åˆ’çº¿ï¼Œæ•°å­—ï¼ˆ0åˆ°9ï¼‰ã€‚è¿™å—å»ºè®®å¤§å®¶æœ€å¥½ä¸è¦ä½¿ç”¨ä¸‹åˆ’çº¿åŠ å¤§å†™å­—æ¯çš„æ ‡è¯†ç¬¦ï¼Œå› ä¸ºLuaçš„ä¿ç•™å­—ä¹Ÿæ˜¯è¿™æ ·å®šä¹‰çš„ï¼Œå®¹æ˜“å‘ç”Ÿå†²çªã€‚æ³¨æ„Luaæ˜¯åŒºåˆ†å¤§å°å†™å­—æ¯çš„ã€‚ A0 å…³é”®å­— ä¸‹åˆ—æ˜¯Luaçš„å…³é”®å­—ï¼Œå¤§å®¶åœ¨å®šä¹‰å¸¸é‡ã€å˜é‡æˆ–å…¶ä»–ç”¨æˆ·è‡ªå®šä¹‰æ ‡è¯†ç¬¦éƒ½è¦é¿å…ä½¿ç”¨ä»¥ä¸‹è¿™äº›å…³é”®å­—ï¼š and break do else elseif end false for function if in local nil not or repeat return then true until while goto ä¸€èˆ¬çº¦å®šï¼Œä»¥ä¸‹åˆ’çº¿å¼€å¤´è¿æ¥ä¸€ä¸²å¤§å†™å­—æ¯çš„åå­—ï¼ˆæ¯”å¦‚ _VERSIONï¼‰è¢«ä¿ç•™ç”¨äº Lua å†…éƒ¨å…¨å±€å˜é‡ã€‚è¿™ä¸ªä¹Ÿæ˜¯ä¸Šé¢æˆ‘ä»¬ä¸å»ºè®®è¿™ä¹ˆå®šä¹‰æ ‡è¯†ç¬¦çš„åŸå› ã€‚ è¿ç®—ç¬¦ Luaä¸­æ”¯æŒçš„è¿ç®—ç¬¦æœ‰ç®—æœ¯è¿ç®—ç¬¦ã€å…³ç³»è¿ç®—ç¬¦ã€é€»è¾‘è¿ç®—ç¬¦ã€å…¶ä»–è¿ç®—ç¬¦ã€‚ ç®—æœ¯è¿ç®—ç¬¦: 1234567+ åŠ æ³•- å‡æ³•* ä¹˜æ³•/ é™¤æ³•% å–ä½™^ ä¹˜å¹‚- è´Ÿå· ä¾‹å¦‚: 123456710+20 --&gt;3020-10 --&gt;1010*20 --&gt;20020/10 --&gt;23%2 --&gt;110^2 --&gt;100-10 --&gt;-10 å…³ç³»è¿ç®—ç¬¦ 123456== ç­‰äº~= ä¸ç­‰äº&gt; å¤§äº&lt; å°äº&gt;= å¤§äºç­‰äº&lt;= å°äºç­‰äº ä¾‹å¦‚: 12345610==10 --&gt;true10~=10 --&gt;false20&gt;10 --&gt;true20&lt;10 --&gt;false20&gt;=10 --&gt;true20&lt;=10 --&gt;false é€»è¾‘è¿ç®—ç¬¦ 123and é€»è¾‘ä¸ A and B &amp;&amp; or é€»è¾‘æˆ– A or B ||not é€»è¾‘é å–åï¼Œå¦‚æœä¸ºtrue,åˆ™è¿”å›false ! é€»è¾‘è¿ç®—ç¬¦å¯ä»¥ä½œä¸ºifçš„åˆ¤æ–­æ¡ä»¶ï¼Œè¿”å›çš„ç»“æœå¦‚ä¸‹: 123456789101112131415161718192021A = trueB = trueA and B --&gt;trueA or B --&gt;truenot A --&gt;falseA = trueB = falseA and B --&gt;falseA or B --&gt;truenot A --&gt;falseA = falseB = trueA and B --&gt;falseA or B --&gt;truenot A --&gt;true å…¶ä»–è¿ç®—ç¬¦ 12.. è¿æ¥ä¸¤ä¸ªå­—ç¬¦ä¸²# ä¸€å…ƒé¢„ç®—æ³•ï¼Œè¿”å›å­—ç¬¦ä¸²æˆ–è¡¨çš„é•¿åº¦ ä¾‹å¦‚: 12&gt; &quot;HELLO &quot;..&quot;WORLD&quot; --&gt;HELLO WORLD&gt; #&quot;HELLO&quot; --&gt;5 å…¨å±€å˜é‡&amp;å±€éƒ¨å˜é‡ åœ¨Luaè¯­è¨€ä¸­ï¼Œå…¨å±€å˜é‡æ— é¡»å£°æ˜å³å¯ä½¿ç”¨ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå˜é‡æ€»æ˜¯è®¤ä¸ºæ˜¯å…¨å±€çš„ï¼Œå¦‚æœæœªæå‰èµ‹å€¼ï¼Œé»˜è®¤ä¸ºnil: è¦æƒ³å£°æ˜ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œéœ€è¦ä½¿ç”¨localæ¥å£°æ˜ Luaæ•°æ®ç±»å‹ Luaæœ‰8ä¸ªæ•°æ®ç±»å‹ 12345678nil(ç©ºï¼Œæ— æ•ˆå€¼)boolean(å¸ƒå°”ï¼Œtrue/false)number(æ•°å€¼)string(å­—ç¬¦ä¸²)function(å‡½æ•°)tableï¼ˆè¡¨ï¼‰thread(çº¿ç¨‹)userdataï¼ˆç”¨æˆ·æ•°æ®ï¼‰ å¯ä»¥ä½¿ç”¨typeå‡½æ•°æµ‹è¯•ç»™å®šå˜é‡æˆ–è€…çš„ç±»å‹ï¼š 123456789print(type(nil)) --&gt;nilprint(type(true)) --&gt; booleanprint(type(1.1*1.1)) --&gt; numberprint(type(&quot;Hello world&quot;)) --&gt; stringprint(type(io.stdin)) --&gt;userdataprint(type(print)) --&gt; functionprint(type(type)) --&gt;functionprint(type&#123;&#125;) --&gt;tableprint(type(type(X))) --&gt; string nil nilæ˜¯ä¸€ç§åªæœ‰ä¸€ä¸ªnilå€¼çš„ç±»å‹ï¼Œå®ƒçš„ä½œç”¨å¯ä»¥ç”¨æ¥ä¸å…¶ä»–æ‰€æœ‰å€¼è¿›è¡ŒåŒºåˆ†ï¼Œä¹Ÿå¯ä»¥å½“æƒ³è¦ç§»é™¤ä¸€ä¸ªå˜é‡æ—¶ï¼Œåªéœ€è¦å°†è¯¥å˜é‡åèµ‹å€¼ä¸ºnil,åƒåœ¾å›æ”¶å°±ä¼šä¼šé‡Šæ”¾è¯¥å˜é‡æ‰€å ç”¨çš„å†…å­˜ã€‚ boolean booleanç±»å‹å…·æœ‰ä¸¤ä¸ªå€¼ï¼Œtrueå’Œfalseã€‚booleanç±»å‹ä¸€èˆ¬è¢«ç”¨æ¥åšæ¡ä»¶åˆ¤æ–­çš„çœŸä¸å‡ã€‚åœ¨Luaè¯­è¨€ä¸­ï¼Œåªä¼šå°†falseå’Œnilè§†ä¸ºå‡ï¼Œå…¶ä»–çš„éƒ½è§†ä¸ºçœŸï¼Œç‰¹åˆ«æ˜¯åœ¨æ¡ä»¶æ£€æµ‹ä¸­0å’Œç©ºå­—ç¬¦ä¸²éƒ½ä¼šè®¤ä¸ºæ˜¯çœŸï¼Œè¿™ä¸ªå’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„å¤§å¤šæ•°è¯­è¨€ä¸å¤ªä¸€æ ·ã€‚ number åœ¨Lua5.3ç‰ˆæœ¬å¼€å§‹ï¼ŒLuaè¯­è¨€ä¸ºæ•°å€¼æ ¼å¼æä¾›äº†ä¸¤ç§é€‰æ‹©:integer(æ•´å‹)å’Œfloat(åŒç²¾åº¦æµ®ç‚¹å‹)[å’Œå…¶ä»–è¯­è¨€ä¸å¤ªä¸€æ ·ï¼Œfloatä¸ä»£è¡¨å•ç²¾åº¦ç±»å‹]ã€‚ æ•°å€¼å¸¸é‡çš„è¡¨ç¤ºæ–¹å¼: 1234&gt;4 --&gt;4&gt;0.4 --&gt;0.4&gt;4.75e-3 --&gt;0.00475&gt;4.75e3 --&gt;4750 ä¸ç®¡æ˜¯æ•´å‹è¿˜æ˜¯åŒç²¾åº¦æµ®ç‚¹å‹ï¼Œä½¿ç”¨type()å‡½æ•°æ¥å–å…¶ç±»å‹ï¼Œéƒ½ä¼šè¿”å›çš„æ˜¯number 12&gt;type(3) --&gt;number&gt;type(3.3) --&gt;number æ‰€ä»¥å®ƒä»¬ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’è½¬æ¢çš„ï¼ŒåŒæ—¶ï¼Œå…·æœ‰ç›¸åŒç®—æœ¯å€¼çš„æ•´å‹å€¼å’Œæµ®ç‚¹å‹å€¼åœ¨Luaè¯­è¨€ä¸­æ˜¯ç›¸ç­‰çš„ string Luaè¯­è¨€ä¸­çš„å­—ç¬¦ä¸²å³å¯ä»¥è¡¨ç¤ºå•ä¸ªå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€æ•´æœ¬ä¹¦ç±ã€‚åœ¨Luaè¯­è¨€ä¸­ï¼Œæ“ä½œ100Kæˆ–è€…1Mä¸ªå­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²çš„ç¨‹åºå¾ˆå¸¸è§ã€‚ å¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·æ¥å£°æ˜å­—ç¬¦ä¸² 1234&gt;a = &quot;hello&quot;&gt;b = &#x27;world&#x27;&gt;print(a) --&gt;hello&gt;print(b) --&gt;world å¦‚æœå£°æ˜çš„å­—ç¬¦ä¸²æ¯”è¾ƒé•¿æˆ–è€…æœ‰å¤šè¡Œï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼è¿›è¡Œå£°æ˜ 12345678910html = [[&lt;html&gt;&lt;head&gt;&lt;title&gt;Lua-string&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;a href=&quot;http://www.lua.org&quot;&gt;Lua&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;]] table â€‹ tableæ˜¯Luaè¯­è¨€ä¸­æœ€ä¸»è¦å’Œå¼ºå¤§çš„æ•°æ®ç»“æ„ã€‚ä½¿ç”¨è¡¨ï¼Œ Lua è¯­è¨€å¯ä»¥ä»¥ä¸€ç§ç®€å•ã€ç»Ÿä¸€ä¸”é«˜æ•ˆçš„æ–¹å¼è¡¨ç¤ºæ•°ç»„ã€é›†åˆã€è®°å½•å’Œå…¶ä»–å¾ˆå¤šæ•°æ®ç»“æ„ã€‚ Luaè¯­è¨€ä¸­çš„è¡¨æœ¬è´¨ä¸Šæ˜¯ä¸€ç§è¾…åŠ©æ•°ç»„ã€‚è¿™ç§æ•°ç»„æ¯”Javaä¸­çš„æ•°ç»„æ›´åŠ çµæ´»ï¼Œå¯ä»¥ä½¿ç”¨æ•°å€¼åšç´¢å¼•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æˆ–å…¶ä»–ä»»æ„ç±»å‹çš„å€¼ä½œç´¢å¼•(é™¤nilå¤–)ã€‚ åˆ›å»ºè¡¨çš„æœ€ç®€å•æ–¹å¼: 1&gt; a = &#123;&#125; åˆ›å»ºæ•°ç»„: â€‹ æˆ‘ä»¬éƒ½çŸ¥é“æ•°ç»„å°±æ˜¯ç›¸åŒæ•°æ®ç±»å‹çš„å…ƒç´ æŒ‰ç…§ä¸€å®šé¡ºåºæ’åˆ—çš„é›†åˆï¼Œé‚£ä¹ˆä½¿ç”¨tableå¦‚ä½•åˆ›å»ºä¸€ä¸ªæ•°ç»„å‘¢? 1&gt;arr = &#123;&quot;TOM&quot;,&quot;JERRY&quot;,&quot;ROSE&quot;&#125; â€‹ è¦æƒ³è·å–æ•°ç»„ä¸­çš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å†…å®¹æ¥è·å–: 1234print(arr[0]) nilprint(arr[1]) TOMprint(arr[2]) JERRYprint(arr[3]) ROSE â€‹ ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å‡ºæ¥ï¼Œæ•°ç»„çš„ä¸‹æ ‡é»˜è®¤æ˜¯ä»1å¼€å§‹çš„ã€‚æ‰€ä»¥ä¸Šè¿°åˆ›å»ºæ•°ç»„ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼æ¥åˆ›å»º 1234&gt;arr = &#123;&#125;&gt;arr[1] = &quot;TOM&quot;&gt;arr[2] = &quot;JERRY&quot;&gt;arr[3] = &quot;ROSE&quot; ä¸Šé¢æˆ‘ä»¬è¯´è¿‡äº†ï¼Œè¡¨çš„ç´¢å¼•å³å¯ä»¥æ˜¯æ•°å­—ï¼Œä¹Ÿå¯ä»¥æ˜¯å­—ç¬¦ä¸²ç­‰å…¶ä»–çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ç´¢å¼•æ›´æ”¹ä¸ºå­—ç¬¦ä¸²æ¥åˆ›å»º 1234&gt;arr = &#123;&#125;&gt;arr[&quot;X&quot;] = 10&gt;arr[&quot;Y&quot;] = 20&gt;arr[&quot;Z&quot;] = 30 å½“ç„¶ï¼Œå¦‚æœæƒ³è¦è·å–è¿™äº›æ•°ç»„ä¸­çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼ 12345678æ–¹å¼ä¸€&gt;print(arr[&quot;X&quot;])&gt;print(arr[&quot;Y&quot;])&gt;print(arr[&quot;Z&quot;])æ–¹å¼äºŒ&gt;print(arr.X)&gt;print(arr.Y)&gt;print(arr.Z) å½“å‰tableçš„çµæ´»ä¸è¿›äºæ­¤ï¼Œè¿˜æœ‰æ›´çµæ´»çš„å£°æ˜æ–¹å¼ 1&gt;arr = &#123;&quot;TOM&quot;,X=10,&quot;JERRY&quot;,Y=20,&quot;ROSE&quot;,Z=30&#125; å¦‚ä½•è·å–ä¸Šé¢çš„å€¼? 12345TOM : arr[1]10 : arr[&quot;X&quot;] | arr.XJERRY: arr[2]20 : arr[&quot;Y&quot;] | arr.YROESE? function åœ¨ Luaè¯­è¨€ä¸­ï¼Œå‡½æ•°ï¼ˆ Function ï¼‰æ˜¯å¯¹è¯­å¥å’Œè¡¨è¾¾å¼è¿›è¡ŒæŠ½è±¡çš„ä¸»è¦æ–¹å¼ã€‚ å®šä¹‰å‡½æ•°çš„è¯­æ³•ä¸º: 123function functionName(params)end å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¼ å…¥çš„å‚æ•°ä¸ªæ•°ä¸å®šä¹‰å‡½æ•°æ—¶ä½¿ç”¨çš„å‚æ•°ä¸ªæ•°ä¸ä¸€è‡´çš„æ—¶å€™ï¼ŒLua è¯­è¨€ä¼šé€šè¿‡ æŠ›å¼ƒå¤šä½™å‚æ•°å’Œå°†ä¸è¶³çš„å‚æ•°è®¾ä¸º nil çš„æ–¹å¼æ¥è°ƒæ•´å‚æ•°çš„ä¸ªæ•°ã€‚ 12345678function f(a,b)print(a,b)endf() --&gt; nil nilf(2) --&gt; 2 nilf(2,6) --&gt; 2 6f(2.6.8) --&gt; 2 6 (8è¢«ä¸¢å¼ƒ) å¯å˜é•¿å‚æ•°å‡½æ•° 12345678function add(...)a,b,c=...print(a)print(b)print(c)endadd(1,2,3) --&gt; 1 2 3 å‡½æ•°è¿”å›å€¼å¯ä»¥æœ‰å¤šä¸ªï¼Œè¿™ç‚¹å’ŒJavaä¸å¤ªä¸€æ · 12345function f(a,b)return a,bendx,y=f(11,22) --&gt; x=11,y=22 thread threadç¿»è¯‘è¿‡æ¥æ˜¯çº¿ç¨‹çš„æ„æ€ï¼Œåœ¨Luaä¸­ï¼Œthreadç”¨æ¥è¡¨ç¤ºæ‰§è¡Œçš„ç‹¬ç«‹çº¿è·¯ï¼Œç”¨æ¥æ‰§è¡ŒååŒç¨‹åºã€‚ userdata userdataæ˜¯ä¸€ç§ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ï¼Œç”¨äºè¡¨ç¤ºä¸€ç§ç”±åº”ç”¨ç¨‹åºæˆ–C/C++è¯­è¨€åº“æ‰€åˆ›å»ºçš„ç±»å‹ã€‚ Luaæ§åˆ¶ç»“æ„ Lua è¯­è¨€æä¾›äº†ä¸€ç»„ç²¾ç®€ä¸”å¸¸ç”¨çš„æ§åˆ¶ç»“æ„ï¼ŒåŒ…æ‹¬ç”¨äºæ¡ä»¶æ‰§è¡Œçš„è¯ ä»¥åŠç”¨äºå¾ªç¯çš„ whileã€ repeat å’Œ forã€‚ æ‰€æœ‰çš„æ§åˆ¶ç»“æ„è¯­æ³•ä¸Šéƒ½æœ‰ä¸€ä¸ªæ˜¾å¼çš„ç»ˆç»“ç¬¦ï¼š end ç”¨äºç»ˆç»“ ifã€ for åŠ while ç»“æ„ï¼Œ until ç”¨äºç»ˆç»“ repeat ç»“æ„ã€‚ if then elseif else ifè¯­å¥å…ˆæµ‹è¯•å…¶æ¡ä»¶ï¼Œå¹¶æ ¹æ®æ¡ä»¶æ˜¯å¦æ»¡è¶³æ‰§è¡Œç›¸åº”çš„ then éƒ¨åˆ†æˆ– else éƒ¨åˆ†ã€‚ else éƒ¨åˆ† æ˜¯å¯é€‰çš„ã€‚ 12345678910111213function testif(a) if a&gt;0 then print(&quot;aæ˜¯æ­£æ•°&quot;) endendfunction testif(a) if a&gt;0 then print(&quot;aæ˜¯æ­£æ•°&quot;) else print(&quot;aæ˜¯è´Ÿæ•°&quot;) endend å¦‚æœè¦ç¼–å†™åµŒå¥—çš„ if è¯­å¥ï¼Œå¯ä»¥ä½¿ç”¨ elseifã€‚ å®ƒç±»ä¼¼äºåœ¨ else åé¢ç´§è·Ÿä¸€ä¸ªifã€‚æ ¹æ®ä¼ å…¥çš„å¹´é¾„è¿”å›ä¸åŒçš„ç»“æœï¼Œå¦‚ 12345678910111213141516age&lt;=18 é’å°‘å¹´ï¼Œage&gt;18 , age &lt;=45 é’å¹´age&gt;45 , age&lt;=60 ä¸­å¹´äººage&gt;60 è€å¹´äººfunction show(age)if age&lt;=18 then return &quot;é’å°‘å¹´&quot;elseif age&gt;18 and age&lt;=45 then return &quot;é’å¹´&quot;elseif age&gt;45 and age&lt;=60 then return &quot;ä¸­å¹´äºº&quot;elseif age&gt;60 then return &quot;è€å¹´äºº&quot;endend whileå¾ªç¯ é¡¾åæ€ä¹‰ï¼Œå½“æ¡ä»¶ä¸ºçœŸæ—¶ while å¾ªç¯ä¼šé‡å¤æ‰§è¡Œå…¶å¾ªç¯ä½“ã€‚ Lua è¯­è¨€å…ˆæµ‹è¯• while è¯­å¥ çš„æ¡ä»¶ï¼Œè‹¥æ¡ä»¶ä¸ºå‡åˆ™å¾ªç¯ç»“æŸï¼›å¦åˆ™ï¼Œ Lua ä¼šæ‰§è¡Œå¾ªç¯ä½“å¹¶ä¸æ–­åœ°é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚ è¯­æ³•ï¼š 123while æ¡ä»¶ do å¾ªç¯ä½“end ä¾‹å­:å®ç°æ•°ç»„çš„å¾ªç¯ 1234567function testWhile() local i = 1 while i&lt;=10 do print(i) i=i+1 endend repeatå¾ªç¯ é¡¾åæ€ä¹‰ï¼Œ repeat-untilè¯­å¥ä¼šé‡å¤æ‰§è¡Œå…¶å¾ªç¯ä½“ç›´åˆ°æ¡ä»¶ä¸ºçœŸæ—¶ç»“æŸã€‚ ç”±äºæ¡ä»¶æµ‹è¯•åœ¨å¾ªç¯ä½“ä¹‹åæ‰§è¡Œï¼Œæ‰€ä»¥å¾ªç¯ä½“è‡³å°‘ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ è¯­æ³• 123repeat å¾ªç¯ä½“ until æ¡ä»¶ 1234567function testRepeat() local i = 10 repeat print(i) i=i-1 until i &lt; 1end forå¾ªç¯ æ•°å€¼å‹forå¾ªç¯ è¯­æ³• 123for param=exp1,exp2,exp3 do å¾ªç¯ä½“end paramçš„å€¼ä»exp1å˜åŒ–åˆ°exp2ä¹‹å‰çš„æ¯æ¬¡å¾ªç¯ä¼šæ‰§è¡Œ å¾ªç¯ä½“ï¼Œå¹¶åœ¨æ¯æ¬¡å¾ªç¯ç»“æŸåå°†æ­¥é•¿(step)exp3å¢åŠ åˆ°paramä¸Šã€‚exp3å¯é€‰ï¼Œå¦‚æœä¸è®¾ç½®é»˜è®¤ä¸º1 123for i = 1,100,10 doprint(i)end æ³›å‹forå¾ªç¯ æ³›å‹forå¾ªç¯é€šè¿‡ä¸€ä¸ªè¿­ä»£å™¨å‡½æ•°æ¥éå†æ‰€æœ‰å€¼ï¼Œç±»ä¼¼äºjavaä¸­çš„foreachè¯­å¥ã€‚ è¯­æ³• 123for i,v in ipairs(x) do å¾ªç¯ä½“end iæ˜¯æ•°ç»„ç´¢å¼•å€¼ï¼Œvæ˜¯å¯¹åº”ç´¢å¼•çš„æ•°ç»„å…ƒç´ å€¼ï¼Œipairsæ˜¯Luaæä¾›çš„ä¸€ä¸ªè¿­ä»£å™¨å‡½æ•°ï¼Œç”¨æ¥è¿­ä»£æ•°ç»„ï¼Œxæ˜¯è¦éå†çš„æ•°ç»„ã€‚ ä¾‹å¦‚: 1234arr = &#123;&quot;TOME&quot;,&quot;JERRY&quot;,&quot;ROWS&quot;,&quot;LUCY&quot;&#125;for i,v in ipairs(arr) do print(i,v)end ä¸Šè¿°å®ä¾‹è¾“å‡ºçš„ç»“æœä¸º 12341 TOM2 JERRY3 ROWS4 LUCY ä½†æ˜¯å¦‚æœå°†arrçš„å€¼è¿›è¡Œä¿®æ”¹ä¸º 1arr = &#123;&quot;TOME&quot;,&quot;JERRY&quot;,&quot;ROWS&quot;,x=&quot;JACK&quot;,&quot;LUCY&quot;&#125; åŒæ ·çš„ä»£ç åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±åªèƒ½çœ‹åˆ°å’Œä¹‹å‰ä¸€æ ·çš„ç»“æœï¼Œè€Œå…¶ä¸­çš„xä¸ºJACKå°±æ— æ³•éå†å‡ºæ¥ï¼Œç¼ºå¤±äº†æ•°æ®ï¼Œå¦‚æœè§£å†³å‘¢? æˆ‘ä»¬å¯ä»¥å°†è¿­ä»£å™¨å‡½æ•°å˜æˆpairs,å¦‚ 123for i,v in pairs(arr) do print(i,v)end ä¸Šè¿°å®ä¾‹å°±è¾“å‡ºçš„ç»“æœä¸º 123451 TOM2 JERRY3 ROWS4 LUCYx JACK ngx_luaæ¨¡å—æ¦‚å¿µ æ·˜å®å¼€å‘çš„ngx_luaæ¨¡å—é€šè¿‡å°†luaè§£é‡Šå™¨é›†æˆè¿›Nginxï¼Œå¯ä»¥é‡‡ç”¨luaè„šæœ¬å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œç”±äºluaçš„ç´§å‡‘ã€å¿«é€Ÿä»¥åŠå†…å»ºåç¨‹ï¼Œæ‰€ä»¥åœ¨ä¿è¯é«˜å¹¶å‘æœåŠ¡èƒ½åŠ›çš„åŒæ—¶æå¤§åœ°é™ä½äº†ä¸šåŠ¡é€»è¾‘å®ç°æˆæœ¬ã€‚ ngx_luaæ¨¡å—ç¯å¢ƒå‡†å¤‡ æ–¹å¼ä¸€:lua-nginx-module LuaJITæ˜¯é‡‡ç”¨Cè¯­è¨€ç¼–å†™çš„Luaä»£è¡¨çš„è§£é‡Šå™¨ã€‚ å®˜ç½‘åœ°å€ä¸º:http://luajit.org/ åœ¨å®˜ç½‘ä¸Šæ‰¾åˆ°å¯¹åº”çš„ä¸‹è½½åœ°å€:http://luajit.org/download/LuaJIT-2.0.5.tar.gz åœ¨centosä¸Šä½¿ç”¨wgetæ¥ä¸‹è½½: wget http://luajit.org/download/LuaJIT-2.0.5.tar.gz å°†ä¸‹è½½çš„èµ„æºè¿›è¡Œè§£å‹: tar -zxf LuaJIT-2.0.5.tar.gz è¿›å…¥è§£å‹çš„ç›®å½•: cd LuaJIT-2.0.5 æ‰§è¡Œç¼–è¯‘å’Œå®‰è£…: make &amp;&amp; make install ä¸‹è½½lua-nginx-module ä¸‹è½½åœ°å€:https://github.com/openresty/lua-nginx-module/archive/v0.10.16rc4.tar.gz åœ¨centosä¸Šä½¿ç”¨wgetæ¥ä¸‹è½½: wget https://github.com/openresty/lua-nginx-module/archive/v0.10.16rc4.tar.gz å°†ä¸‹è½½çš„èµ„æºè¿›è¡Œè§£å‹: tar -zxf lua-nginx-module-0.10.16rc4.tar.gz æ›´æ”¹ç›®å½•å:mv lua-nginx-module-0.10.16rc4 lua-nginx-module å¯¼å…¥ç¯å¢ƒå˜é‡ï¼Œå‘Šè¯‰Nginxå»å“ªé‡Œæ‰¾luajit 12export LUAJIT_LIB=/usr/local/libexport LUAJIT_INC=/usr/local/include/luajit-2.0 è¿›å…¥Nginxçš„ç›®å½•æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤: 12./configure --prefix=/usr/local/nginx --add-module=../lua-nginx-modulemake &amp;&amp; make install æ³¨æ„äº‹é¡¹: ï¼ˆ1ï¼‰å¦‚æœå¯åŠ¨Nginxå‡ºç°å¦‚ä¸‹é”™è¯¯: è§£å†³æ–¹æ¡ˆ: è®¾ç½®è½¯é“¾æ¥ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ 1ln -s /usr/local/lib/libluajit-5.1.so.2 /lib64/libluajit-5.1.so.2 ï¼ˆ2ï¼‰å¦‚æœå¯åŠ¨Nginxå‡ºç°ä»¥ä¸‹é”™è¯¯ä¿¡æ¯ åˆ†æåŸå› :å› ä¸ºlua-nginx-moduleæ˜¯æ¥è‡ªopenrestry,é”™è¯¯ä¸­æç¤ºçš„resty.coreæ˜¯openrestryçš„æ ¸å¿ƒæ¨¡å—ï¼Œå¯¹å…¶ä¸‹çš„å¾ˆå¤šå‡½æ•°è¿›è¡Œäº†ä¼˜åŒ–ç­‰å·¥ä½œã€‚ä»¥å‰çš„ç‰ˆæœ¬é»˜è®¤ä¸ä¼šæŠŠè¯¥æ¨¡å—ç¼–è¯‘è¿›å»ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨çš„è¯ï¼Œæˆ‘ä»¬å¾—æ‰‹åŠ¨å®‰è£…ï¼Œæˆ–è€…ç¦ç”¨å°±å¯ä»¥ã€‚ä½†æ˜¯æœ€æ–°çš„lua-nginx-moduleæ¨¡å—å·²ç»å¼ºåˆ¶æ€§å®‰è£…äº†è¯¥æ¨¡å—ï¼Œæ‰€ä»¥æ­¤å¤„å› ä¸ºç¼ºå°‘restyæ¨¡å—å¯¼è‡´çš„æŠ¥é”™ä¿¡æ¯ã€‚ è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ä¸ª:ä¸€ç§æ˜¯ä¸‹è½½å¯¹åº”çš„æ¨¡å—ï¼Œå¦ä¸€ç§åˆ™æ˜¯ç¦ç”¨æ‰restryæ¨¡å—ï¼Œç¦ç”¨çš„æ–¹å¼ä¸º: 123http&#123; lua_load_resty_core off;&#125; æµ‹è¯• åœ¨nginx.confä¸‹é…ç½®å¦‚ä¸‹å†…å®¹: 1234location /lua&#123; default_type &#x27;text/html&#x27;; content_by_lua &#x27;ngx.say(&quot;&lt;h1&gt;HELLO,LUA&lt;/h1&gt;&quot;)&#x27;;&#125; é…ç½®æˆåŠŸåï¼Œå¯åŠ¨nginx,é€šè¿‡æµè§ˆå™¨è¿›è¡Œè®¿é—®ï¼Œå¦‚æœè·å–åˆ°å¦‚ä¸‹ç»“æœï¼Œåˆ™è¯æ˜å®‰è£…æˆåŠŸã€‚ æ–¹å¼äºŒ:OpenRestry æ¦‚è¿° â€‹ å‰é¢æˆ‘ä»¬æåˆ°è¿‡ï¼ŒOpenRestyæ˜¯ç”±æ·˜å®å·¥ç¨‹å¸ˆå¼€å‘çš„ï¼Œæ‰€ä»¥å…¶å®˜æ–¹ç½‘ç«™(http://openresty.org/)æˆ‘ä»¬è¯»èµ·æ¥æ˜¯éå¸¸çš„æ–¹ä¾¿ã€‚OpenRestyæ˜¯ä¸€ä¸ªåŸºäºNginxä¸ Lua çš„é«˜æ€§èƒ½ Web å¹³å°ï¼Œå…¶å†…éƒ¨é›†æˆäº†å¤§é‡ç²¾è‰¯çš„ Lua åº“ã€ç¬¬ä¸‰æ–¹æ¨¡å—ä»¥åŠå¤§å¤šæ•°çš„ä¾èµ–é¡¹ã€‚ç”¨äºæ–¹ä¾¿åœ°æ­å»ºèƒ½å¤Ÿå¤„ç†è¶…é«˜å¹¶å‘ã€æ‰©å±•æ€§æé«˜çš„åŠ¨æ€ Web åº”ç”¨ã€Web æœåŠ¡å’ŒåŠ¨æ€ç½‘å…³ã€‚æ‰€ä»¥æœ¬èº«OpenRestyå†…éƒ¨å°±å·²ç»é›†æˆäº†Nginxå’ŒLuaï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿ã€‚ å®‰è£… 1234567891011121314(1) ä¸‹è½½OpenRestyï¼šhttps://openresty.org/download/openresty-1.15.8.2.tar.gz(2)ä½¿ç”¨wgetä¸‹è½½: wget https://openresty.org/download/openresty-1.15.8.2.tar.gz(3)è§£å‹ç¼©: tar -zxf openresty-1.15.8.2.tar.gz(4)è¿›å…¥OpenRestyç›®å½•: cd openresty-1.15.8.2(5) æ‰§è¡Œå‘½ä»¤:./configure(6) æ‰§è¡Œå‘½ä»¤:make &amp;&amp; make install(7)è¿›å…¥OpenRestyçš„ç›®å½•ï¼Œæ‰¾åˆ°nginxï¼šcd /usr/local/openresty/nginx/(8)åœ¨confç›®å½•ä¸‹çš„nginx.confæ·»åŠ å¦‚ä¸‹å†…å®¹location /lua&#123; default_type &#x27;text/html&#x27;; content_by_lua &#x27;ngx.say(&quot;&lt;h1&gt;HELLO,OpenRestry&lt;/h1&gt;&quot;)&#x27;;&#125;(9)åœ¨sbinç›®å½•ä¸‹å¯åŠ¨nginx(10)é€šè¿‡æµè§ˆå™¨è®¿é—®æµ‹è¯• ngx_luaçš„ä½¿ç”¨ ä½¿ç”¨Luaç¼–å†™Nginxè„šæœ¬çš„åŸºæœ¬æ„å»ºå—æ˜¯æŒ‡ä»¤ã€‚æŒ‡ä»¤ç”¨äºæŒ‡å®šä½•æ—¶è¿è¡Œç”¨æˆ·Luaä»£ç ä»¥åŠå¦‚ä½•ä½¿ç”¨ç»“æœã€‚ä¸‹å›¾æ˜¾ç¤ºäº†æ‰§è¡ŒæŒ‡ä»¤çš„é¡ºåºã€‚ å…ˆæ¥è§£é‡Šä¸‹*çš„ä½œç”¨ 123*ï¼šæ—  ï¼Œ å³ xxx_by_lua ,æŒ‡ä»¤åé¢è·Ÿçš„æ˜¯ luaæŒ‡ä»¤*:_fileï¼Œå³ xxx_by_lua_file æŒ‡ä»¤åé¢è·Ÿçš„æ˜¯ luaæ–‡ä»¶*:_block,å³ xxx_by_lua_block åœ¨0.9.17ç‰ˆåæ›¿æ¢init_by_lua_file init_by_lua* 1è¯¥æŒ‡ä»¤åœ¨æ¯æ¬¡Nginxé‡æ–°åŠ è½½é…ç½®æ—¶æ‰§è¡Œï¼Œå¯ä»¥ç”¨æ¥å®Œæˆä¸€äº›è€—æ—¶æ¨¡å—çš„åŠ è½½ï¼Œæˆ–è€…åˆå§‹åŒ–ä¸€äº›å…¨å±€é…ç½®ã€‚ init_worker_by_lua* 1è¯¥æŒ‡ä»¤ç”¨äºå¯åŠ¨ä¸€äº›å®šæ—¶ä»»åŠ¡ï¼Œå¦‚å¿ƒè·³æ£€æŸ¥ã€å®šæ—¶æ‹‰å–æœåŠ¡å™¨é…ç½®ç­‰ã€‚ set_by_lua* 1è¯¥æŒ‡ä»¤åªè¦ç”¨æ¥åšå˜é‡èµ‹å€¼ï¼Œè¿™ä¸ªæŒ‡ä»¤ä¸€æ¬¡åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œå¹¶å°†ç»“æœèµ‹å€¼ç»™Nginxä¸­æŒ‡å®šçš„å˜é‡ã€‚ rewrite_by_lua* 1è¯¥æŒ‡ä»¤ç”¨äºæ‰§è¡Œå†…éƒ¨URLé‡å†™æˆ–è€…å¤–éƒ¨é‡å®šå‘ï¼Œå…¸å‹çš„å¦‚ä¼ªé™æ€åŒ–URLé‡å†™ï¼Œæœ¬é˜¶æ®µåœ¨rewriteå¤„ç†é˜¶æ®µçš„æœ€åé»˜è®¤æ‰§è¡Œã€‚ access_by_lua* 1è¯¥æŒ‡ä»¤ç”¨äºè®¿é—®æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåªå…è®¸å†…ç½‘IPè®¿é—®ã€‚ content_by_lua* 1è¯¥æŒ‡ä»¤æ˜¯åº”ç”¨æœ€å¤šçš„æŒ‡ä»¤ï¼Œå¤§éƒ¨åˆ†ä»»åŠ¡æ˜¯åœ¨è¿™ä¸ªé˜¶æ®µå®Œæˆçš„ï¼Œå…¶ä»–çš„è¿‡ç¨‹å¾€å¾€ä¸ºè¿™ä¸ªé˜¶æ®µå‡†å¤‡æ•°æ®ï¼Œæ­£å¼å¤„ç†åŸºæœ¬éƒ½åœ¨æœ¬é˜¶æ®µã€‚ header_filter_by_lua* 1è¯¥æŒ‡ä»¤ç”¨äºè®¾ç½®åº”ç­”æ¶ˆæ¯çš„å¤´éƒ¨ä¿¡æ¯ã€‚ body_filter_by_lua* 1è¯¥æŒ‡ä»¤æ˜¯å¯¹å“åº”æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œå¦‚æˆªæ–­ã€æ›¿æ¢ã€‚ log_by_lua* 1è¯¥æŒ‡ä»¤ç”¨äºåœ¨logè¯·æ±‚å¤„ç†é˜¶æ®µï¼Œç”¨Luaä»£ç å¤„ç†æ—¥å¿—ï¼Œä½†å¹¶ä¸æ›¿æ¢åŸæœ‰logå¤„ç†ã€‚ balancer_by_lua* 1è¯¥æŒ‡ä»¤ä¸»è¦çš„ä½œç”¨æ˜¯ç”¨æ¥å®ç°ä¸Šæ¸¸æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡å™¨ç®—æ³• ssl_certificate_by_* 1è¯¥æŒ‡ä»¤ä½œç”¨åœ¨Nginxå’Œä¸‹æ¸¸æœåŠ¡å¼€å§‹ä¸€ä¸ªSSLæ¡æ‰‹æ“ä½œæ—¶å°†å…è®¸æœ¬é…ç½®é¡¹çš„Luaä»£ç ã€‚ éœ€æ±‚: 123http://192.168.200.133?name=å¼ ä¸‰&amp;gender=1Nginxæ¥æ”¶åˆ°è¯·æ±‚åï¼Œæ ¹æ®genderä¼ å…¥çš„å€¼ï¼Œå¦‚æœgenderä¼ å…¥çš„æ˜¯1ï¼Œåˆ™åœ¨é¡µé¢ä¸Šå±•ç¤ºå¼ ä¸‰å…ˆç”Ÿ,å¦‚æœgenderä¼ å…¥çš„æ˜¯0ï¼Œåˆ™åœ¨é¡µé¢ä¸Šå±•ç¤ºå¼ ä¸‰å¥³å£«,å¦‚æœæœªä¼ æˆ–è€…ä¼ å…¥çš„ä¸æ˜¯1å’Œ2åˆ™åœ¨é¡µé¢ä¸Šå±•ç¤ºå¼ ä¸‰ã€‚ å®ç°ä»£ç  12345678910111213141516171819location /getByGender &#123; default_type &#x27;text/html&#x27;; set_by_lua $name &quot; local uri_args = ngx.req.get_uri_args() gender = uri_args[&#x27;gender&#x27;] name = uri_args[&#x27;name&#x27;] if gender==&#x27;1&#x27; then return name..&#x27;å…ˆç”Ÿ&#x27; elseif gender==&#x27;0&#x27; then return name..&#x27;å¥³å£«&#x27; else return name end &quot;; header_filter_by_lua &quot; ngx.header.aaa=&#x27;bbb&#x27; &quot;; return 200 $name;&#125; ngx_luaæ“ä½œRedis Redisåœ¨ç³»ç»Ÿä¸­ç»å¸¸ä½œä¸ºæ•°æ®ç¼“å­˜ã€å†…å­˜æ•°æ®åº“ä½¿ç”¨ï¼Œåœ¨å¤§å‹ç³»ç»Ÿä¸­æ‰®æ¼”ç€éå¸¸é‡è¦çš„ä½œç”¨ã€‚åœ¨Nginxæ ¸å¿ƒç³»ç»Ÿä¸­ï¼ŒRedisæ˜¯å¸¸å¤‡ç»„ä»¶ã€‚Nginxæ”¯æŒ3ç§æ–¹æ³•è®¿é—®Redis,åˆ†åˆ«æ˜¯HttpRedisæ¨¡å—ã€HttpRedis2Moduleã€lua-resty-redisåº“ã€‚è¿™ä¸‰ç§æ–¹å¼ä¸­HttpRedisæ¨¡å—æä¾›çš„æŒ‡ä»¤å°‘ï¼ŒåŠŸèƒ½å•ä¸€ï¼Œé€‚åˆåšç®€å•ç¼“å­˜ï¼ŒHttpRedis2Moduleæ¨¡å—æ¯”HttpRedisæ¨¡å—æ“ä½œæ›´çµæ´»ï¼ŒåŠŸèƒ½æ›´å¼ºå¤§ã€‚è€ŒLua-resty-redisåº“æ˜¯OpenRestyæä¾›çš„ä¸€ä¸ªæ“ä½œRedisçš„æ¥å£åº“ï¼Œå¯æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡æƒ…å†µåšä¸€äº›é€»è¾‘å¤„ç†ï¼Œé€‚åˆåšå¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€‚æ‰€ä»¥æœ¬æ¬¡è¯¾ç¨‹å°†ä¸»è¦ä»¥Lua-resty-redisæ¥è¿›è¡Œè®²è§£ã€‚ lua-resty-redisç¯å¢ƒå‡†å¤‡ æ­¥éª¤ä¸€:å‡†å¤‡ä¸€ä¸ªRedisç¯å¢ƒ 123è¿æ¥åœ°å€host= 192.168.200.111port=6379 æ­¥éª¤äºŒ:å‡†å¤‡å¯¹åº”çš„API 123456789101112131415lua-resty-redisæä¾›äº†è®¿é—®Redisçš„è¯¦ç»†APIï¼ŒåŒ…æ‹¬åˆ›å»ºå¯¹æ¥ã€è¿æ¥ã€æ“ä½œã€æ•°æ®å¤„ç†ç­‰ã€‚è¿™äº›APIåŸºæœ¬ä¸Šä¸Redisçš„æ“ä½œä¸€ä¸€å¯¹åº”ã€‚ï¼ˆ1ï¼‰redis = require &quot;resty.redis&quot;ï¼ˆ2ï¼‰new è¯­æ³•: redis,err = redis:new(),åˆ›å»ºä¸€ä¸ªRediså¯¹è±¡ã€‚ï¼ˆ3ï¼‰connect è¯­æ³•:ok,err=redis:connect(host,port[,options_table]),è®¾ç½®è¿æ¥Redisçš„è¿æ¥ä¿¡æ¯ã€‚ ok:è¿æ¥æˆåŠŸè¿”å› 1ï¼Œè¿æ¥å¤±è´¥è¿”å›nil err:è¿”å›å¯¹åº”çš„é”™è¯¯ä¿¡æ¯ï¼ˆ4ï¼‰set_timeout è¯­æ³•: redis:set_timeout(time) ï¼Œè®¾ç½®è¯·æ±‚æ“ä½œRedisçš„è¶…æ—¶æ—¶é—´ã€‚ï¼ˆ5ï¼‰close è¯­æ³•: ok,err = redis:close(),å…³é—­å½“å‰è¿æ¥ï¼ŒæˆåŠŸè¿”å›1ï¼Œå¤±è´¥è¿”å›nilå’Œé”™è¯¯ä¿¡æ¯ï¼ˆ6ï¼‰rediså‘½ä»¤å¯¹åº”çš„æ–¹æ³• åœ¨lua-resty-redisä¸­ï¼Œæ‰€æœ‰çš„Rediså‘½ä»¤éƒ½æœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œæ–¹æ³•åå­—å’Œå‘½ä»¤åå­—ç›¸åŒï¼Œåªæ˜¯å…¨éƒ¨ä¸ºå°å†™ã€‚ æ­¥éª¤ä¸‰:æ•ˆæœå®ç° 123456789101112131415161718192021location / &#123; default_type &quot;text/html&quot;; content_by_lua_block&#123; local redis = require &quot;resty.redis&quot; -- å¼•å…¥Redis local redisObj = redis:new() --åˆ›å»ºRediså¯¹è±¡ redisObj:set_timeout(1000) --è®¾ç½®è¶…æ—¶æ•°æ®ä¸º1s local ok,err = redisObj:connect(&quot;192.168.200.1&quot;,6379) --è®¾ç½®redisè¿æ¥ä¿¡æ¯ if not ok then --åˆ¤æ–­æ˜¯å¦è¿æ¥æˆåŠŸ ngx.say(&quot;failed to connection redis&quot;,err) return end ok,err = redisObj:set(&quot;username&quot;,&quot;TOM&quot;)--å­˜å…¥æ•°æ® if not ok then --åˆ¤æ–­æ˜¯å¦å­˜å…¥æˆåŠŸ ngx.say(&quot;failed to set username&quot;,err) return end local res,err = redisObj:get(&quot;username&quot;) --ä»redisä¸­è·å–æ•°æ® ngx.say(res) --å°†æ•°æ®å†™ä¼šæ¶ˆæ¯ä½“ä¸­ redisObj:close() &#125;&#125; æ­¥éª¤å››:è¿è¡Œæµ‹è¯•æ•ˆæœ ngx_luaæ“ä½œMysql MySQLæ˜¯ä¸€ä¸ªä½¿ç”¨å¹¿æ³›çš„å…³ç³»å‹æ•°æ®åº“ã€‚åœ¨ngx_luaä¸­ï¼ŒMySQLæœ‰ä¸¤ç§è®¿é—®æ¨¡å¼,åˆ†åˆ«æ˜¯ä½¿ ï¼ˆ1ï¼‰ç”¨ngx_luaæ¨¡å—å’Œlua-resty-mysqlæ¨¡å—ï¼šè¿™ä¸¤ä¸ªæ¨¡å—æ˜¯å®‰è£…OpenRestyæ—¶é»˜è®¤å®‰è£…çš„ã€‚ ï¼ˆ2ï¼‰ä½¿ç”¨drizzle_nginx_module(HttpDrizzleModule)æ¨¡å—ï¼šéœ€è¦å•ç‹¬å®‰è£…ï¼Œè¿™ä¸ªåº“ç°ä¸åœ¨OpenRestyä¸­ã€‚ lua-resty-mysql lua-resty-mysqlæ˜¯OpenRestyå¼€å‘çš„æ¨¡å—ï¼Œä½¿ç”¨çµæ´»ã€åŠŸèƒ½å¼ºå¤§ï¼Œé€‚åˆå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼ŒåŒæ—¶æ”¯æŒå­˜å‚¨è¿‡ç¨‹çš„è®¿é—®ã€‚ ä½¿ç”¨lua-resty-mysqlå®ç°æ•°æ®åº“çš„æŸ¥è¯¢ æ­¥éª¤ä¸€: å‡†å¤‡MYSQL 1234host: 192.168.200.111port: 3306username:rootpassword:123456 åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¡¨åŠè¡¨ä¸­çš„æ•°æ®ã€‚ 12345678910111213141516create database nginx_db;use nginx_db;create table users( id int primary key auto_increment, username varchar(30), birthday date, salary double);insert into users(id,username,birthday,salary) values(null,&quot;TOM&quot;,&quot;1988-11-11&quot;,10000.0);insert into users(id,username,birthday,salary) values(null,&quot;JERRY&quot;,&quot;1989-11-11&quot;,20000.0);insert into users(id,username,birthday,salary) values(null,&quot;ROWS&quot;,&quot;1990-11-11&quot;,30000.0);insert into users(id,username,birthday,salary) values(null,&quot;LUCY&quot;,&quot;1991-11-11&quot;,40000.0);insert into users(id,username,birthday,salary) values(null,&quot;JACK&quot;,&quot;1992-11-11&quot;,50000.0); æ•°æ®åº“è¿æ¥å››è¦ç´ : 1234driverClass=com.mysql.jdbc.Driverurl=jdbc:mysql://192.168.200.111:3306/nginx_dbusername=rootpassword=123456 æ­¥éª¤äºŒ:APIå­¦ä¹  12345678910111213141516171819202122232425262728293031323334353637383940414243444546ï¼ˆ1ï¼‰å¼•å…¥&quot;resty.mysql&quot;æ¨¡å— local mysql = require &quot;resty.mysql&quot;ï¼ˆ2ï¼‰new åˆ›å»ºä¸€ä¸ªMySQLè¿æ¥å¯¹è±¡ï¼Œé‡åˆ°é”™è¯¯æ—¶ï¼Œdbä¸ºnilï¼Œerrä¸ºé”™è¯¯æè¿°ä¿¡æ¯ è¯­æ³•: db,err = mysql:new()ï¼ˆ3ï¼‰connect å°è¯•è¿æ¥åˆ°ä¸€ä¸ªMySQLæœåŠ¡å™¨ è¯­æ³•:ok,err=db:connect(options),optionsæ˜¯ä¸€ä¸ªå‚æ•°çš„Luaè¡¨ç»“æ„ï¼Œé‡Œé¢åŒ…å«æ•°æ®åº“è¿æ¥çš„ç›¸å…³ä¿¡æ¯ host:æœåŠ¡å™¨ä¸»æœºåæˆ–IPåœ°å€ port:æœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œé»˜è®¤ä¸º3306 user:ç™»å½•çš„ç”¨æˆ·å password:ç™»å½•å¯†ç  database:ä½¿ç”¨çš„æ•°æ®åº“åï¼ˆ4ï¼‰set_timeout è®¾ç½®å­è¯·æ±‚çš„è¶…æ—¶æ—¶é—´(ms)ï¼ŒåŒ…æ‹¬connectæ–¹æ³• è¯­æ³•:db:set_timeout(time)ï¼ˆ5ï¼‰close å…³é—­å½“å‰MySQLè¿æ¥å¹¶è¿”å›çŠ¶æ€ã€‚å¦‚æœæˆåŠŸï¼Œåˆ™è¿”å›1ï¼›å¦‚æœå‡ºç°ä»»ä½•é”™è¯¯ï¼Œåˆ™å°†è¿”å›nilå’Œé”™è¯¯æè¿°ã€‚ è¯­æ³•:db:close()ï¼ˆ6ï¼‰send_query å¼‚æ­¥å‘è¿œç¨‹MySQLå‘é€ä¸€ä¸ªæŸ¥è¯¢ã€‚å¦‚æœæˆåŠŸåˆ™è¿”å›æˆåŠŸå‘é€çš„å­—èŠ‚æ•°ï¼›å¦‚æœé”™è¯¯ï¼Œåˆ™è¿”å›nilå’Œé”™è¯¯æè¿° è¯­æ³•:bytes,err=db:send_query(sql)ï¼ˆ7ï¼‰read_result ä»MySQLæœåŠ¡å™¨è¿”å›ç»“æœä¸­è¯»å–ä¸€è¡Œæ•°æ®ã€‚resè¿”å›ä¸€ä¸ªæè¿°OKåŒ…æˆ–ç»“æœé›†åŒ…çš„Luaè¡¨,è¯­æ³•: res, err, errcode, sqlstate = db:read_result() res, err, errcode, sqlstate = db:read_result(rows) :rowsæŒ‡å®šè¿”å›ç»“æœé›†çš„æœ€å¤§å€¼ï¼Œé»˜è®¤ä¸º4 å¦‚æœæ˜¯æŸ¥è¯¢ï¼Œåˆ™è¿”å›ä¸€ä¸ªå®¹çº³å¤šè¡Œçš„æ•°ç»„ã€‚æ¯è¡Œæ˜¯ä¸€ä¸ªæ•°æ®åˆ—çš„key-valueå¯¹ï¼Œå¦‚ &#123; &#123;id=1,username=&quot;TOM&quot;,birthday=&quot;1988-11-11&quot;,salary=10000.0&#125;, &#123;id=2,username=&quot;JERRY&quot;,birthday=&quot;1989-11-11&quot;,salary=20000.0&#125; &#125; å¦‚æœæ˜¯å¢åˆ æ”¹ï¼Œåˆ™è¿”å›ç±»ä¸Šå¦‚ä¸‹æ•°æ® &#123; insert_id = 0, server_status=2, warning_count=1, affected_rows=2, message=nil &#125; è¿”å›å€¼: res:æ“ä½œçš„ç»“æœé›† err:é”™è¯¯ä¿¡æ¯ errcode:MySQLçš„é”™è¯¯ç ï¼Œæ¯”å¦‚1064 sqlstate:è¿”å›ç”±5ä¸ªå­—ç¬¦ç»„æˆçš„æ ‡å‡†SQLé”™è¯¯ç ï¼Œæ¯”å¦‚42000 æ­¥éª¤ä¸‰:æ•ˆæœå®ç° 1234567891011121314151617181920location /&#123; content_by_lua_block&#123; local mysql = require &quot;resty.mysql&quot; local db = mysql:new() local ok,err = db:connect&#123; host=&quot;192.168.200.111&quot;, port=3306, user=&quot;root&quot;, password=&quot;123456&quot;, database=&quot;nginx_db&quot; &#125; db:set_timeout(1000) db:send_query(&quot;select * from users where id =1&quot;) local res,err,errcode,sqlstate = db:read_result() ngx.say(res[1].id..&quot;,&quot;..res[1].username..&quot;,&quot;..res[1].birthday..&quot;,&quot;..res[1].salary) db:close() &#125;&#125; é—®é¢˜: 1231.å¦‚ä½•è·å–è¿”å›æ•°æ®çš„å†…å®¹2.å¦‚ä½•å®ç°æŸ¥è¯¢å¤šæ¡æ•°æ®3.å¦‚ä½•å®ç°æ•°æ®åº“çš„å¢åˆ æ”¹æ“ä½œ ä½¿ç”¨lua-cjsonå¤„ç†æŸ¥è¯¢ç»“æœ é€šè¿‡ä¸Šè¿°çš„æ¡ˆä¾‹å­¦ä¹ ï¼Œread_result()å¾—åˆ°çš„ç»“æœreséƒ½æ˜¯tableç±»å‹ï¼Œè¦æƒ³åœ¨é¡µé¢ä¸Šå±•ç¤ºï¼Œå°±å¿…é¡»çŸ¥é“tableçš„å…·ä½“æ•°æ®ç»“æ„æ‰èƒ½è¿›è¡Œéå†è·å–ã€‚å¤„ç†èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»ä¸€ç§ç®€å•æ–¹å¼cjsonï¼Œä½¿ç”¨å®ƒå°±å¯ä»¥å°†tableç±»å‹çš„æ•°æ®è½¬æ¢æˆjsonå­—ç¬¦ä¸²ï¼ŒæŠŠjsonå­—ç¬¦ä¸²å±•ç¤ºåœ¨é¡µé¢ä¸Šå³å¯ã€‚å…·ä½“å¦‚ä½•ä½¿ç”¨? æ­¥éª¤ä¸€ï¼šå¼•å…¥cjson 1local cjson = require &quot;cjson&quot; æ­¥éª¤äºŒï¼šè°ƒç”¨cjsonçš„encodeæ–¹æ³•è¿›è¡Œç±»å‹è½¬æ¢ 1cjson.encode(res) æ­¥éª¤ä¸‰:ä½¿ç”¨ 12345678910111213141516171819202122232425262728location /&#123; content_by_lua_block&#123; local mysql = require &quot;resty.mysql&quot; local cjson = require &quot;cjson&quot; local db = mysql:new() local ok,err = db:connect&#123; host=&quot;192.168.200.111&quot;, port=3306, user=&quot;root&quot;, password=&quot;123456&quot;, database=&quot;nginx_db&quot; &#125; db:set_timeout(1000) --db:send_query(&quot;select * from users where id = 2&quot;) db:send_query(&quot;select * from users&quot;) local res,err,errcode,sqlstate = db:read_result() ngx.say(cjson.encode(res)) for i,v in ipairs(res) do ngx.say(v.id..&quot;,&quot;..v.username..&quot;,&quot;..v.birthday..&quot;,&quot;..v.salary) end db:close() &#125;&#125; lua-resty-mysqlå®ç°æ•°æ®åº“çš„å¢åˆ æ”¹ ä¼˜åŒ–send_queryå’Œread_result æœ¬æ–¹æ³•æ˜¯send_queryå’Œread_resultç»„åˆçš„å¿«æ·æ–¹æ³•ã€‚ è¯­æ³•: 1res, err, errcode, sqlstate = db:query(sql[,rows]) æœ‰äº†è¯¥APIï¼Œä¸Šé¢çš„ä»£ç æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œå¯¹åº”çš„ä¼˜åŒ–ï¼Œå¦‚ä¸‹: 12345678910111213141516171819202122232425location /&#123; content_by_lua_block&#123; local mysql = require &quot;resty.mysql&quot; local db = mysql:new() local ok,err = db:connect&#123; host=&quot;192.168.200.1&quot;, port=3306, user=&quot;root&quot;, password=&quot;123456&quot;, database=&quot;nginx_db&quot;, max_packet_size=1024, compact_arrays=false &#125; db:set_timeout(1000) local res,err,errcode,sqlstate = db:query(&quot;select * from users&quot;) --local res,err,errcode,sqlstate = db:query(&quot;insert into users(id,username,birthday,salary) values(null,&#x27;zhangsan&#x27;,&#x27;2020-11-11&#x27;,32222.0)&quot;) --local res,err,errcode,sqlstate = db:query(&quot;update users set username=&#x27;lisi&#x27; where id = 6&quot;) --local res,err,errcode,sqlstate = db:query(&quot;delete from users where id = 6&quot;) db:close() &#125;&#125; ç»¼åˆå°æ¡ˆä¾‹ ä½¿ç”¨ngx_luaæ¨¡å—å®ŒæˆRedisç¼“å­˜é¢„çƒ­ã€‚ åˆ†æ: ï¼ˆ1ï¼‰å…ˆå¾—æœ‰ä¸€å¼ è¡¨(users) ï¼ˆ2ï¼‰æµè§ˆå™¨è¾“å…¥å¦‚ä¸‹åœ°å€ 1http://191.168.200.133?username=TOM ï¼ˆ3ï¼‰ä»è¡¨ä¸­æŸ¥è¯¢å‡ºç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œæ­¤æ—¶è·å–çš„ç»“æœä¸ºtableç±»å‹ ï¼ˆ4ï¼‰ä½¿ç”¨cjsonå°†tableæ•°æ®è½¬æ¢æˆjsonå­—ç¬¦ä¸² ï¼ˆ5ï¼‰å°†æŸ¥è¯¢çš„ç»“æœæ•°æ®å­˜å…¥Redisä¸­ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657init_by_lua_block&#123; redis = require &quot;resty.redis&quot; mysql = require &quot;resty.mysql&quot; cjson = require &quot;cjson&quot;&#125;location /&#123; default_type &quot;text/html&quot;; content_by_lua_block&#123; --è·å–è¯·æ±‚çš„å‚æ•°username local param = ngx.req.get_uri_args()[&quot;username&quot;] --å»ºç«‹mysqlæ•°æ®åº“çš„è¿æ¥ local db = mysql:new() local ok,err = db:connect&#123; host=&quot;192.168.200.111&quot;, port=3306, user=&quot;root&quot;, password=&quot;123456&quot;, database=&quot;nginx_db&quot; &#125; if not ok then ngx.say(&quot;failed connect to mysql:&quot;,err) return end --è®¾ç½®è¿æ¥è¶…æ—¶æ—¶é—´ db:set_timeout(1000) --æŸ¥è¯¢æ•°æ® local sql = &quot;&quot;; if not param then sql=&quot;select * from users&quot; else sql=&quot;select * from users where username=&quot;..&quot;&#x27;&quot;..param..&quot;&#x27;&quot; end local res,err,errcode,sqlstate=db:query(sql) if not res then ngx.say(&quot;failed to query from mysql:&quot;,err) return end --è¿æ¥redis local rd = redis:new() ok,err = rd:connect(&quot;192.168.200.111&quot;,6379) if not ok then ngx.say(&quot;failed to connect to redis:&quot;,err) return end rd:set_timeout(1000) --å¾ªç¯éå†æ•°æ® for i,v in ipairs(res) do rd:set(&quot;user_&quot;..v.username,cjson.encode(v)) end ngx.say(&quot;success&quot;) rd:close() db:close() &#125; &#125;","categories":[{"name":"Webå¼€å‘","slug":"Webå¼€å‘","permalink":"http://kaillliu.github.io/categories/Web%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://kaillliu.github.io/tags/Java/"},{"name":"Centos","slug":"Centos","permalink":"http://kaillliu.github.io/tags/Centos/"},{"name":"Linux","slug":"Linux","permalink":"http://kaillliu.github.io/tags/Linux/"}]},{"title":"Nginxå­¦ä¹ ï¼ˆä¸‰ï¼‰--- åå‘ä»£ç†","slug":"Nginxå­¦ä¹ å…¶ä¸‰","date":"2022-04-21T08:53:00.000Z","updated":"2022-05-23T05:41:23.080Z","comments":true,"path":"2022/04/21/Nginxå­¦ä¹ å…¶ä¸‰/","link":"","permalink":"http://kaillliu.github.io/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E4%B8%89/","excerpt":"","text":"RewriteåŠŸèƒ½é…ç½® Rewriteæ˜¯NginxæœåŠ¡å™¨æä¾›çš„ä¸€ä¸ªé‡è¦åŸºæœ¬åŠŸèƒ½ï¼Œæ˜¯WebæœåŠ¡å™¨äº§å“ä¸­å‡ ä¹å¿…å¤‡çš„åŠŸèƒ½ã€‚ä¸»è¦çš„ä½œç”¨æ˜¯ç”¨æ¥å®ç°URLçš„é‡å†™ã€‚www.jd.com æ³¨æ„:NginxæœåŠ¡å™¨çš„RewriteåŠŸèƒ½çš„å®ç°ä¾èµ–äºPCREçš„æ”¯æŒï¼Œå› æ­¤åœ¨ç¼–è¯‘å®‰è£…NginxæœåŠ¡å™¨ä¹‹å‰ï¼Œéœ€è¦å®‰è£…PCREåº“ã€‚Nginxä½¿ç”¨çš„æ˜¯ngx_http_rewrite_moduleæ¨¡å—æ¥è§£æå’Œå¤„ç†RewriteåŠŸèƒ½çš„ç›¸å…³é…ç½®ã€‚ Rewriteçš„ç›¸å…³å‘½ä»¤ 123456setæŒ‡ä»¤ifæŒ‡ä»¤breakæŒ‡ä»¤returnæŒ‡ä»¤rewriteæŒ‡ä»¤rewrite_logæŒ‡ä»¤ Rewriteçš„åº”ç”¨åœºæ™¯ 123456åŸŸåè·³è½¬åŸŸåé•œåƒç‹¬ç«‹åŸŸåç›®å½•è‡ªåŠ¨æ·»åŠ &quot;/&quot;åˆå¹¶ç›®å½•é˜²ç›—é“¾çš„å®ç° Rewriteçš„ç›¸å…³æŒ‡ä»¤ setæŒ‡ä»¤ è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®ä¸€ä¸ªæ–°çš„å˜é‡ã€‚ è¯­æ³• set $variable value; é»˜è®¤å€¼ â€” ä½ç½® serverã€locationã€if variable:å˜é‡çš„åç§°ï¼Œè¯¥å˜é‡åç§°è¦ç”¨&quot;$&quot;ä½œä¸ºå˜é‡çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œä¸”ä¸è¦ä¸NginxæœåŠ¡å™¨é¢„è®¾çš„å…¨å±€å˜é‡åŒåã€‚ value:å˜é‡çš„å€¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å…¶ä»–å˜é‡æˆ–è€…å˜é‡çš„ç»„åˆç­‰ã€‚ Rewriteå¸¸ç”¨å…¨å±€å˜é‡ å˜é‡ è¯´æ˜ $args å˜é‡ä¸­å­˜æ”¾äº†è¯·æ±‚URLä¸­çš„è¯·æ±‚å‚æ•°ã€‚æ¯”å¦‚http://192.168.200.133/server?arg1=value1&amp;args2=value2ä¸­çš„&quot;arg1=value1&amp;arg2=value2&quot;ï¼ŒåŠŸèƒ½å’Œ$query_stringä¸€æ · $http_user_agent å˜é‡å­˜å‚¨çš„æ˜¯ç”¨æˆ·è®¿é—®æœåŠ¡çš„ä»£ç†ä¿¡æ¯(å¦‚æœé€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œè®°å½•çš„æ˜¯æµè§ˆå™¨çš„ç›¸å…³ç‰ˆæœ¬ä¿¡æ¯) $host å˜é‡å­˜å‚¨çš„æ˜¯è®¿é—®æœåŠ¡å™¨çš„server_nameå€¼ $document_uri å˜é‡å­˜å‚¨çš„æ˜¯å½“å‰è®¿é—®åœ°å€çš„URIã€‚æ¯”å¦‚http://192.168.200.133/server?id=10&amp;name=zhangsanä¸­çš„&quot;/server&quot;ï¼ŒåŠŸèƒ½å’Œ$uriä¸€æ · $document_root å˜é‡å­˜å‚¨çš„æ˜¯å½“å‰è¯·æ±‚å¯¹åº”locationçš„rootå€¼ï¼Œå¦‚æœæœªè®¾ç½®ï¼Œé»˜è®¤æŒ‡å‘Nginxè‡ªå¸¦htmlç›®å½•æ‰€åœ¨ä½ç½® $content_length å˜é‡å­˜å‚¨çš„æ˜¯è¯·æ±‚å¤´ä¸­çš„Content-Lengthçš„å€¼ $content_type å˜é‡å­˜å‚¨çš„æ˜¯è¯·æ±‚å¤´ä¸­çš„Content-Typeçš„å€¼ $http_cookie å˜é‡å­˜å‚¨çš„æ˜¯å®¢æˆ·ç«¯çš„cookieä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡add_header Set-Cookie 'cookieName=cookieValueâ€™æ¥æ·»åŠ cookieæ•°æ® $limit_rate å˜é‡ä¸­å­˜å‚¨çš„æ˜¯NginxæœåŠ¡å™¨å¯¹ç½‘ç»œè¿æ¥é€Ÿç‡çš„é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯Nginxé…ç½®ä¸­å¯¹limit_rateæŒ‡ä»¤è®¾ç½®çš„å€¼ï¼Œé»˜è®¤æ˜¯0ï¼Œä¸é™åˆ¶ã€‚ $remote_addr å˜é‡ä¸­å­˜å‚¨çš„æ˜¯å®¢æˆ·ç«¯çš„IPåœ°å€ $remote_port å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„ç«¯å£å· $remote_user å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯çš„ç”¨æˆ·åï¼Œéœ€è¦æœ‰è®¤è¯æ¨¡å—æ‰èƒ½è·å– $scheme å˜é‡ä¸­å­˜å‚¨äº†è®¿é—®åè®® $server_addr å˜é‡ä¸­å­˜å‚¨äº†æœåŠ¡ç«¯çš„åœ°å€ $server_name å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾çš„æœåŠ¡å™¨çš„åç§° $server_port å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨çš„ç«¯å£å· $server_protocol å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯è¯·æ±‚åè®®çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚&quot;HTTP/1.1&quot; $request_body_file å˜é‡ä¸­å­˜å‚¨äº†å‘ç»™åç«¯æœåŠ¡å™¨çš„æœ¬åœ°æ–‡ä»¶èµ„æºçš„åç§° $request_method å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯çš„è¯·æ±‚æ–¹å¼ï¼Œæ¯”å¦‚&quot;GET&quot;,&quot;POST&quot;ç­‰ $request_filename å˜é‡ä¸­å­˜å‚¨äº†å½“å‰è¯·æ±‚çš„èµ„æºæ–‡ä»¶çš„è·¯å¾„å $request_uri å˜é‡ä¸­å­˜å‚¨äº†å½“å‰è¯·æ±‚çš„URIï¼Œå¹¶ä¸”æºå¸¦è¯·æ±‚å‚æ•°ï¼Œæ¯”å¦‚http://192.168.200.133/server?id=10&amp;name=zhangsanä¸­çš„&quot;/server?id=10&amp;name=zhangsan&quot; ä¸Šè¿°å‚æ•°è¿˜å¯ä»¥åœ¨æ—¥å¿—æ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œè¿™ä¸ªå°±è¦ç”¨åˆ°å‰é¢æˆ‘ä»¬ä»‹ç»çš„log_formatæŒ‡ä»¤ 123log_format main &#x27;$remote_addr - $request - $status-$request_uri $http_user_agent&#x27;;access_log logs/access.log main; ifæŒ‡ä»¤ è¯¥æŒ‡ä»¤ç”¨æ¥æ”¯æŒæ¡ä»¶åˆ¤æ–­ï¼Œå¹¶æ ¹æ®æ¡ä»¶åˆ¤æ–­ç»“æœé€‰æ‹©ä¸åŒçš„Nginxé…ç½®ã€‚ è¯­æ³• if (condition){â€¦} é»˜è®¤å€¼ â€” ä½ç½® serverã€location conditionä¸ºåˆ¤å®šæ¡ä»¶ï¼Œå¯ä»¥æ”¯æŒä»¥ä¸‹å†™æ³•ï¼š å˜é‡åã€‚å¦‚æœå˜é‡åå¯¹åº”çš„å€¼ä¸ºç©ºå­—ç¬¦ä¸²æˆ–&quot;0&quot;ï¼Œiféƒ½åˆ¤æ–­ä¸ºfalse,å…¶ä»–æ¡ä»¶ä¸ºtrueã€‚ 123if ($param)&#123; &#125; ä½¿ç”¨&quot;=â€œå’Œâ€!=&quot;æ¯”è¾ƒå˜é‡å’Œå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œæ»¡è¶³æ¡ä»¶ä¸ºtrueï¼Œä¸æ»¡è¶³ä¸ºfalse 123if ($request_method = POST)&#123; return 405;&#125; æ³¨æ„ï¼šæ­¤å¤„å’ŒJavaä¸å¤ªä¸€æ ·çš„åœ°æ–¹æ˜¯å­—ç¬¦ä¸²ä¸éœ€è¦æ·»åŠ å¼•å·,å¹¶ä¸”ç­‰å·å’Œä¸ç­‰å·å‰ååˆ°éœ€è¦åŠ ç©ºæ ¼ã€‚ ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¯¹å˜é‡è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸè¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚å˜é‡ä¸æ­£åˆ™è¡¨è¾¾å¼ä¹‹é—´ä½¿ç”¨&quot;~â€œ,â€~*â€œ,â€!~â€œ,â€!~*&quot;æ¥è¿æ¥ã€‚ &quot;~&quot;ä»£è¡¨åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼è¿‡ç¨‹ä¸­åŒºåˆ†å¤§å°å†™ï¼Œ &quot;~*&quot;ä»£è¡¨åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼è¿‡ç¨‹ä¸­ä¸åŒºåˆ†å¤§å°å†™ &quot;!~â€œå’Œâ€!~*&quot;åˆšå¥½å’Œä¸Šé¢å–ç›¸åå€¼ï¼Œå¦‚æœåŒ¹é…ä¸Šè¿”å›false,åŒ¹é…ä¸ä¸Šè¿”å›true 123if ($http_user_agent ~ MSIE)&#123; #$http_user_agentçš„å€¼ä¸­æ˜¯å¦åŒ…å«MSIEå­—ç¬¦ä¸²ï¼Œå¦‚æœåŒ…å«è¿”å›true&#125; æ³¨æ„ï¼šæ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²ä¸€èˆ¬ä¸éœ€è¦åŠ å¼•å·ï¼Œä½†æ˜¯å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«&quot;}â€œæˆ–è€…æ˜¯â€;&quot;ç­‰å­—ç¬¦æ—¶ï¼Œå°±éœ€è¦æŠŠå¼•å·åŠ ä¸Šã€‚ åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä½¿ç”¨&quot;-f&quot;å’Œ&quot;!-f&quot;, 123456if (-f $request_filename)&#123; #åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨&#125;if (!-f $request_filename)&#123; #åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦ä¸å­˜åœ¨&#125; åˆ¤æ–­è¯·æ±‚çš„ç›®å½•æ˜¯å¦å­˜åœ¨ä½¿ç”¨&quot;-d&quot;å’Œ&quot;!-d&quot; åˆ¤æ–­è¯·æ±‚çš„ç›®å½•æˆ–è€…æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä½¿ç”¨&quot;-e&quot;å’Œ&quot;!-e&quot; åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œä½¿ç”¨&quot;-x&quot;å’Œ&quot;!-x&quot; breakæŒ‡ä»¤ è¯¥æŒ‡ä»¤ç”¨äºä¸­æ–­å½“å‰ç›¸åŒä½œç”¨åŸŸä¸­çš„å…¶ä»–Nginxé…ç½®ã€‚ä¸è¯¥æŒ‡ä»¤å¤„äºåŒä¸€ä½œç”¨åŸŸçš„Nginxé…ç½®ä¸­ï¼Œä½äºå®ƒå‰é¢çš„æŒ‡ä»¤é…ç½®ç”Ÿæ•ˆï¼Œä½äºåé¢çš„æŒ‡ä»¤é…ç½®æ— æ•ˆã€‚å¹¶ä¸”breakè¿˜æœ‰å¦å¤–ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯ç»ˆæ­¢å½“å‰çš„åŒ¹é…å¹¶æŠŠå½“å‰çš„URIåœ¨æœ¬locationè¿›è¡Œé‡å®šå‘è®¿é—®å¤„ç†ã€‚ è¯­æ³• break; é»˜è®¤å€¼ â€” ä½ç½® serverã€locationã€if ä¾‹å­: 1234567891011location /testbreak&#123; default_type text/plain; set $username TOM; if ($args)&#123; Set $username JERRY; break; set $username ROSE; &#125; add_header username $username; return 200 $username;&#125; returnæŒ‡ä»¤ è¯¥æŒ‡ä»¤ç”¨äºå®Œæˆå¯¹è¯·æ±‚çš„å¤„ç†ï¼Œç›´æ¥å‘å®¢æˆ·ç«¯è¿”å›ã€‚åœ¨returnåçš„æ‰€æœ‰Nginxé…ç½®éƒ½æ˜¯æ— æ•ˆçš„ã€‚ è¯­æ³• return code [text];return code URL;return URL; é»˜è®¤å€¼ â€” ä½ç½® serverã€locationã€if code:ä¸ºè¿”å›ç»™å®¢æˆ·ç«¯çš„HTTPçŠ¶æ€ä»£ç†ã€‚å¯ä»¥è¿”å›çš„çŠ¶æ€ä»£ç ä¸º0~999çš„ä»»æ„HTTPçŠ¶æ€ä»£ç† text:ä¸ºè¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”ä½“å†…å®¹ï¼Œæ”¯æŒå˜é‡çš„ä½¿ç”¨ URL:ä¸ºè¿”å›ç»™å®¢æˆ·ç«¯çš„URLåœ°å€ 1234567891011121314151617location /testreturn &#123; return 200 success;&#125;location /testreturn &#123; return https://www.baidu.com; // 302é‡å®šå‘åˆ°ç™¾åº¦&#125;location /testreturn &#123; return 302 https://www.baidu.com;&#125;location /testreturn &#123; return 302 www.baidu.com;//ä¸å…è®¸è¿™ä¹ˆå†™&#125; rewriteæŒ‡ä»¤ è¯¥æŒ‡ä»¤é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨æ¥æ”¹å˜URIã€‚å¯ä»¥åŒæ—¶å­˜åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªæŒ‡ä»¤ï¼ŒæŒ‰ç…§é¡ºåºä¾æ¬¡å¯¹URLè¿›è¡ŒåŒ¹é…å’Œå¤„ç†ã€‚ è¯­æ³• rewrite regex replacement [flag]; é»˜è®¤å€¼ â€” ä½ç½® serverã€locationã€if regex:ç”¨æ¥åŒ¹é…URIçš„æ­£åˆ™è¡¨è¾¾å¼ replacement:åŒ¹é…æˆåŠŸåï¼Œç”¨äºæ›¿æ¢URIä¸­è¢«æˆªå–å†…å®¹çš„å­—ç¬¦ä¸²ã€‚å¦‚æœè¯¥å­—ç¬¦ä¸²æ˜¯ä»¥&quot;http://&quot;æˆ–è€…&quot;https://&quot;å¼€å¤´çš„ï¼Œåˆ™ä¸ä¼šç»§ç»­å‘ä¸‹å¯¹URIè¿›è¡Œå…¶ä»–å¤„ç†ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›é‡å†™åçš„URIç»™å®¢æˆ·ç«¯ã€‚ 12345678910111213location rewrite &#123; rewrite ^/rewrite/url\\w*$ https://www.baidu.com; rewrite ^/rewrite/(test)\\w*$ /$1; rewrite ^/rewrite/(demo)\\w*$ /$1;&#125;location /test&#123; default_type text/plain; return 200 test_success;&#125;location /demo&#123; default_type text/plain; return 200 demo_success;&#125; flag:ç”¨æ¥è®¾ç½®rewriteå¯¹URIçš„å¤„ç†è¡Œä¸ºï¼Œå¯é€‰å€¼æœ‰å¦‚ä¸‹ï¼š last:ç»ˆæ­¢ç»§ç»­åœ¨æœ¬locationå—ä¸­å¤„ç†æ¥æ”¶åˆ°çš„URIï¼Œå¹¶å°†æ­¤å¤„é‡å†™çš„URIä½œä¸ºä¸€ä¸ªæ–°çš„URIï¼Œä½¿ç”¨å„locationå—è¿›è¡Œå¤„ç†ã€‚è¯¥æ ‡å¿—å°†é‡å†™åçš„URIé‡å†™åœ¨serverå—ä¸­æ‰§è¡Œï¼Œä¸ºé‡å†™åçš„URIæä¾›äº†è½¬å…¥åˆ°å…¶ä»–locationå—çš„æœºä¼šã€‚ 123456789101112location rewrite &#123; rewrite ^/rewrite/(test)\\w*$ /$1 last; rewrite ^/rewrite/(demo)\\w*$ /$1 last;&#125;location /test&#123; default_type text/plain; return 200 test_success;&#125;location /demo&#123; default_type text/plain; return 200 demo_success;&#125; è®¿é—® http://192.168.200.133:8081/rewrite/testabc,èƒ½æ­£ç¡®è®¿é—® breakï¼šå°†æ­¤å¤„é‡å†™çš„URIä½œä¸ºä¸€ä¸ªæ–°çš„URI,åœ¨æœ¬å—ä¸­ç»§ç»­è¿›è¡Œå¤„ç†ã€‚è¯¥æ ‡å¿—å°†é‡å†™åçš„åœ°å€åœ¨å½“å‰çš„locationå—ä¸­æ‰§è¡Œï¼Œä¸ä¼šå°†æ–°çš„URIè½¬å‘å…¶ä»–çš„locationå—ã€‚ 12345678910111213location rewrite &#123; #/test /usr/local/nginx/html/test/index.html rewrite ^/rewrite/(test)\\w*$ /$1 break; rewrite ^/rewrite/(demo)\\w*$ /$1 break;&#125;location /test&#123; default_type text/plain; return 200 test_success;&#125;location /demo&#123; default_type text/plain; return 200 demo_success;&#125; è®¿é—® http://192.168.200.133:8081/rewrite/demoabc,é¡µé¢æŠ¥404é”™è¯¯ redirectï¼šå°†é‡å†™åçš„URIè¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒçŠ¶æ€ç ä¸º302ï¼ŒæŒ‡æ˜æ˜¯ä¸´æ—¶é‡å®šå‘URI,ä¸»è¦ç”¨åœ¨replacementå˜é‡ä¸æ˜¯ä»¥&quot;http://&quot;æˆ–è€…&quot;https://&quot;å¼€å¤´çš„æƒ…å†µã€‚ 123456789101112location rewrite &#123; rewrite ^/rewrite/(test)\\w*$ /$1 redirect; rewrite ^/rewrite/(demo)\\w*$ /$1 redirect;&#125;location /test&#123; default_type text/plain; return 200 test_success;&#125;location /demo&#123; default_type text/plain; return 200 demo_success;&#125; è®¿é—®http://192.168.200.133:8081/rewrite/testabcè¯·æ±‚ä¼šè¢«ä¸´æ—¶é‡å®šå‘ï¼Œæµè§ˆå™¨åœ°å€ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ permanentï¼šå°†é‡å†™åçš„URIè¿”å›ç»™å®¢æˆ·ç«¯ï¼ŒçŠ¶æ€ç ä¸º301ï¼ŒæŒ‡æ˜æ˜¯æ°¸ä¹…é‡å®šå‘URI,ä¸»è¦ç”¨åœ¨replacementå˜é‡ä¸æ˜¯ä»¥&quot;http://&quot;æˆ–è€…&quot;https://&quot;å¼€å¤´çš„æƒ…å†µã€‚ 123456789101112location rewrite &#123; rewrite ^/rewrite/(test)\\w*$ /$1 permanent; rewrite ^/rewrite/(demo)\\w*$ /$1 permanent;&#125;location /test&#123; default_type text/plain; return 200 test_success;&#125;location /demo&#123; default_type text/plain; return 200 demo_success;&#125; è®¿é—®http://192.168.200.133:8081/rewrite/testabcè¯·æ±‚ä¼šè¢«æ°¸ä¹…é‡å®šå‘ï¼Œæµè§ˆå™¨åœ°å€ä¹Ÿä¼šå‘ç”Ÿæ”¹å˜ rewrite_logæŒ‡ä»¤ è¯¥æŒ‡ä»¤é…ç½®æ˜¯å¦å¼€å¯URLé‡å†™æ—¥å¿—çš„è¾“å‡ºåŠŸèƒ½ã€‚ è¯­æ³• rewrite_log on|off; é»˜è®¤å€¼ rewrite_log off; ä½ç½® httpã€serverã€locationã€if å¼€å¯åï¼ŒURLé‡å†™çš„ç›¸å…³æ—¥å¿—å°†ä»¥noticeçº§åˆ«è¾“å‡ºåˆ°error_logæŒ‡ä»¤é…ç½®çš„æ—¥å¿—æ–‡ä»¶æ±‡æ€»ã€‚ 12rewrite_log on;error_log logs/error.log notice; Rewriteçš„æ¡ˆä¾‹ åŸŸåè·³è½¬ ã€‹é—®é¢˜åˆ†æ å…ˆæ¥çœ‹ä¸€ä¸ªæ•ˆæœï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®¿é—®äº¬ä¸œç½‘ç«™ï¼Œå¤§å®¶éƒ½çŸ¥é“æˆ‘ä»¬å¯ä»¥è¾“å…¥www.jd.com,ä½†æ˜¯åŒæ ·çš„æˆ‘ä»¬ä¹Ÿå¯ä»¥è¾“å…¥www.360buy.comåŒæ ·ä¹Ÿéƒ½èƒ½è®¿é—®åˆ°äº¬ä¸œç½‘ç«™ã€‚è¿™ä¸ªå…¶å®æ˜¯å› ä¸ºäº¬ä¸œåˆšå¼€å§‹çš„æ—¶å€™åŸŸåå°±æ˜¯www.360buy.comï¼Œåé¢ç”±äºå„ç§åŸå› æŠŠè‡ªå·±çš„åŸŸåæ¢æˆäº†www.jd.com, è™½ç„¶è¯´åŸŸåå˜é‡ï¼Œä½†æ˜¯å¯¹äºä»¥å‰åªè®°ä½äº†www.360buy.comçš„ç”¨æˆ·æ¥è¯´ï¼Œæˆ‘ä»¬å¦‚ä½•æŠŠè¿™éƒ¨åˆ†ç”¨æˆ·ä¹Ÿè¿ç§»åˆ°æˆ‘ä»¬æ–°åŸŸåçš„è®¿é—®ä¸Šæ¥ï¼Œé’ˆå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Nginxä¸­Rewriteçš„åŸŸåè·³è½¬æ¥è§£å†³ã€‚ ã€‹ç¯å¢ƒå‡†å¤‡ å‡†å¤‡ä¸‰ä¸ªåŸŸåï¼š 1vim /etc/hosts 123127.0.0.1 www.itcast.cn127.0.0.1 www.itheima.cn127.0.0.1 www.itheima.com é€šè¿‡Nginxå®ç°è®¿é—®www.itcast.cn 12345678server &#123; listen 80; server_name www.itcast.cn; location /&#123; default_type text/html; return 200 &#x27;&lt;h1&gt;welcome to itcast&lt;/h1&gt;&#x27;; &#125;&#125; ã€‹é€šè¿‡Rewriteå®Œæˆå°†www.ithema.comå’Œwww.itheima.cnçš„è¯·æ±‚è·³è½¬åˆ°www.itcast.com 12345server &#123; listen 80; server_name www.itheima.com www.itheima.cn; rewrite ^/ http://www.itcast.cn;&#125; é—®é¢˜æè¿°:å¦‚ä½•åœ¨åŸŸåè·³è½¬çš„è¿‡ç¨‹ä¸­æºå¸¦è¯·æ±‚çš„URIï¼Ÿ ä¿®æ”¹é…ç½®ä¿¡æ¯ 12345server &#123; listen 80; server_name www.itheima.com www.itheima.cn; rewrite ^(.*) http://www.itcast.cn$1ï¼›&#125; åŸŸåé•œåƒ é•œåƒç½‘ç«™æŒ‡å®šæ˜¯å°†ä¸€ä¸ªå®Œå…¨ç›¸åŒçš„ç½‘ç«™åˆ†åˆ«æ”¾ç½®åˆ°å‡ å°æœåŠ¡å™¨ä¸Šï¼Œå¹¶åˆ†åˆ«ä½¿ç”¨ç‹¬ç«‹çš„URLè¿›è¡Œè®¿é—®ã€‚å…¶ä¸­ä¸€å°æœåŠ¡å™¨ä¸Šçš„ç½‘ç«™å«ä¸»ç«™ï¼Œå…¶ä»–çš„ä¸ºé•œåƒç½‘ç«™ã€‚é•œåƒç½‘ç«™å’Œä¸»ç«™æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œå¯ä»¥æŠŠé•œåƒç½‘ç«™ç†è§£ä¸ºä¸»ç«™çš„ä¸€ä¸ªå¤‡ä»½èŠ‚ç‚¹ã€‚å¯ä»¥é€šè¿‡é•œåƒç½‘ç«™æä¾›ç½‘ç«™åœ¨ä¸åŒåœ°åŒºçš„å“åº”é€Ÿåº¦ã€‚é•œåƒç½‘ç«™å¯ä»¥å¹³è¡¡ç½‘ç«™çš„æµé‡è´Ÿè½½ã€å¯ä»¥è§£å†³ç½‘ç»œå®½å¸¦é™åˆ¶ã€å°é”ç­‰ã€‚ è€Œæˆ‘ä»¬æ‰€è¯´çš„åŸŸåé•œåƒå’Œç½‘ç«™é•œåƒæ¯”è¾ƒç±»ä¼¼ï¼Œä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼Œå°†www.itheima.comå’Œ www.itheima.cnéƒ½èƒ½è·³è½¬åˆ°www.itcast.cnï¼Œé‚£ä¹ˆwww.itcast.cnæˆ‘ä»¬å°±å¯ä»¥æŠŠå®ƒèµ·åå«ä¸»åŸŸåï¼Œå…¶ä»–ä¸¤ä¸ªå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„é•œåƒåŸŸåï¼Œå½“ç„¶å¦‚æœæˆ‘ä»¬ä¸æƒ³æŠŠæ•´ä¸ªç½‘ç«™åšé•œåƒï¼Œåªæƒ³ä¸ºå…¶ä¸­æŸä¸€ä¸ªå­ç›®å½•ä¸‹çš„èµ„æºåšé•œåƒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨locationå—ä¸­é…ç½®rewriteåŠŸèƒ½ï¼Œæ¯”å¦‚: 123456789101112server &#123; listen 80; server_name www.itheima.cn www.itheima.com; location /user &#123; rewrite ^/user(.*)$ http://www.itcast.cn$1; &#125; location /emp&#123; default_type text/html; return 200 &#x27;&lt;h1&gt;emp_success&lt;/h1&gt;&#x27;; &#125;&#125; ç‹¬ç«‹åŸŸå ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®åŒ…å«å¤šä¸ªæ¨¡å—ï¼Œæ¯”å¦‚è´­ç‰©ç½‘ç«™æœ‰å•†å“æœç´¢æ¨¡å—ã€å•†å“è¯¦æƒ…æ¨¡å—å’Œè´­ç‰©è½¦æ¨¡å—ç­‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ä¸ºæ¯ä¸€ä¸ªæ¨¡å—è®¾ç½®ç‹¬ç«‹çš„åŸŸåã€‚ éœ€æ±‚ï¼š 123http://search.itcast.com:81 è®¿é—®å•†å“æœç´¢æ¨¡å—http://item.itcast.com:82 è®¿é—®å•†å“è¯¦æƒ…æ¨¡å—http://cart.itcast.com:83 è®¿é—®å•†å“è´­ç‰©è½¦æ¨¡å— 123456789101112131415server&#123; listen 81; server_name search.itcast.com; rewrite ^(.*) http://www.itcast.cn/search$1;&#125;server&#123; listen 82; server_name item.itcast.com; rewrite ^(.*) http://www.itcast.cn/item$1;&#125;server&#123; listen 83; server_name cart.itcast.com; rewrite ^(.*) http://www.itcast.cn/cart$1;&#125; ç›®å½•è‡ªåŠ¨æ·»åŠ &quot;/&quot; é—®é¢˜æè¿° é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤ºä¸‹é—®é¢˜: 123456789server &#123; listen 8082; server_name localhost; location /heima &#123; root html; index index.html; &#125;&#125; é€šè¿‡http://192.168.200.133:8082/heimaå’Œé€šè¿‡http://192.168.200.133:8082/heima/è®¿é—®çš„åŒºåˆ«ï¼Ÿ å¦‚æœä¸åŠ æ–œæ ï¼ŒNginxæœåŠ¡å™¨å†…éƒ¨ä¼šè‡ªåŠ¨åšä¸€ä¸ª301çš„é‡å®šå‘ï¼Œé‡å®šå‘çš„åœ°å€ä¼šæœ‰ä¸€ä¸ªæŒ‡ä»¤å«server_name_in_redirect on|off;æ¥å†³å®šé‡å®šå‘çš„åœ°å€ï¼š 123456å¦‚æœè¯¥æŒ‡ä»¤ä¸ºon é‡å®šå‘çš„åœ°å€ä¸º: http://server_name:8082/ç›®å½•å/; http://localhost:8082/heima/å¦‚æœè¯¥æŒ‡ä»¤ä¸ºoff é‡å®šå‘çš„åœ°å€ä¸º: http://åŸURLä¸­çš„åŸŸå:8082/ç›®å½•å/; http://192.168.200.133:8082/heima/ æ‰€ä»¥å°±æ‹¿åˆšæ‰çš„åœ°å€æ¥è¯´ï¼Œhttp://192.168.200.133:8082/heimaå¦‚æœä¸åŠ æ–œæ ï¼Œé‚£ä¹ˆæŒ‰ç…§ä¸Šè¿°è§„åˆ™ï¼Œå¦‚æœæŒ‡ä»¤server_name_in_redirectä¸ºonï¼Œåˆ™301é‡å®šå‘åœ°å€å˜ä¸º http://localhost:8082/heima/,å¦‚æœä¸ºoffï¼Œåˆ™301é‡å®šå‘åœ°å€å˜ä¸ºhttp://192.168.200.133:8082/heima/ã€‚åé¢è¿™ä¸ªæ˜¯æ­£å¸¸çš„ï¼Œå‰é¢åœ°å€å°±æœ‰é—®é¢˜ã€‚ æ³¨æ„server_name_in_redirectæŒ‡ä»¤åœ¨Nginxçš„0.8.48ç‰ˆæœ¬ä¹‹å‰é»˜è®¤éƒ½æ˜¯onï¼Œä¹‹åæ”¹æˆäº†off,æ‰€ä»¥ç°åœ¨æˆ‘ä»¬è¿™ä¸ªç‰ˆæœ¬ä¸éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ˜¯0.8.48ä»¥å‰çš„ç‰ˆæœ¬å¹¶ä¸”server_name_in_redirectè®¾ç½®ä¸ºonï¼Œæˆ‘ä»¬å¦‚ä½•é€šè¿‡rewriteæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ è§£å†³æ–¹æ¡ˆ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨rewriteåŠŸèƒ½ä¸ºæœ«å°¾æ²¡æœ‰æ–œæ çš„URLè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªæ–œæ  12345678910server &#123; listen 80; server_name localhost; server_name_in_redirect on; location /heima &#123; if (-d $request_filename)&#123; rewrite ^/(.*)([^/])$ http://$host/$1$2/ permanent; &#125; &#125;&#125; åˆå¹¶ç›®å½• æœç´¢å¼•æ“ä¼˜åŒ–(SEO)æ˜¯ä¸€ç§åˆ©ç”¨æœç´¢å¼•æ“çš„æœç´¢è§„åˆ™æ¥æé«˜ç›®çš„ç½‘ç«™åœ¨æœ‰å…³æœç´¢å¼•æ“å†…æ’åçš„æ–¹å¼ã€‚æˆ‘ä»¬åœ¨åˆ›å»ºè‡ªå·±çš„ç«™ç‚¹æ—¶ï¼Œå¯ä»¥é€šè¿‡å¾ˆå¤šä¸­æ–¹å¼æ¥æœ‰æ•ˆçš„æä¾›æœç´¢å¼•æ“ä¼˜åŒ–çš„ç¨‹åº¦ã€‚å…¶ä¸­æœ‰ä¸€é¡¹å°±åŒ…å«URLçš„ç›®å½•å±‚çº§ä¸€èˆ¬ä¸è¦è¶…è¿‡ä¸‰å±‚ï¼Œå¦åˆ™çš„è¯ä¸åˆ©äºæœç´¢å¼•æ“çš„æœç´¢ä¹Ÿç»™å®¢æˆ·ç«¯çš„è¾“å…¥å¸¦æ¥äº†è´Ÿæ‹…ï¼Œä½†æ˜¯å°†æ‰€æœ‰çš„æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹åˆä¼šå¯¼è‡´æ–‡ä»¶èµ„æºç®¡ç†æ··ä¹±å¹¶ä¸”è®¿é—®æ–‡ä»¶çš„é€Ÿåº¦ä¹Ÿä¼šéšç€æ–‡ä»¶å¢å¤šè€Œæ…¢ä¸‹æ¥ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜æ˜¯ç›¸äº’çŸ›ç›¾çš„ï¼Œé‚£ä¹ˆä½¿ç”¨rewriteå¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜? ä¸¾ä¾‹ï¼Œç½‘ç«™ä¸­æœ‰ä¸€ä¸ªèµ„æºæ–‡ä»¶çš„è®¿é—®è·¯å¾„æ—¶ /server/11/22/33/44/20.html,ä¹Ÿå°±æ˜¯è¯´20.htmlå­˜åœ¨äºç¬¬5çº§ç›®å½•ä¸‹ï¼Œå¦‚æœæƒ³è¦è®¿é—®è¯¥èµ„æºæ–‡ä»¶ï¼Œå®¢æˆ·ç«¯çš„URLåœ°å€å°±è¦å†™æˆ http://192.168.200.133/server/11/22/33/44/20.html, 1234567server &#123; listen 8083; server_name localhost; location /server&#123; root html; &#125;&#125; ä½†æ˜¯è¿™ä¸ªæ˜¯éå¸¸ä¸åˆ©äºSEOæœç´¢å¼•æ“ä¼˜åŒ–çš„ï¼ŒåŒæ—¶å®¢æˆ·ç«¯ä¹Ÿä¸å¥½è®°.ä½¿ç”¨rewriteæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¦‚ä¸‹é…ç½®: 1234567server &#123; listen 8083; server_name localhost; location /server&#123; rewrite ^/server-([0-9]+)-([0-9]+)-([0-9]+)-([0-9]+)\\.html$ /server/$1/$2/$3/$4/$5.html last; &#125;&#125; è¿™æ ·çš„èŠ±ï¼Œå®¢æˆ·ç«¯åªéœ€è¦è¾“å…¥http://www.web.name/server-11-22-33-44-20.htmlå°±å¯ä»¥è®¿é—®åˆ°20.htmlé¡µé¢äº†ã€‚è¿™é‡Œä¹Ÿå……åˆ†åˆ©ç”¨äº†rewriteæŒ‡ä»¤æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼çš„ç‰¹æ€§ã€‚ é˜²ç›—é“¾ é˜²ç›—é“¾ä¹‹å‰æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡äº†ç›¸å…³çš„çŸ¥è¯†ï¼Œåœ¨rewriteä¸­çš„é˜²ç›—é“¾å’Œä¹‹å‰å°†çš„åŸç†å…¶å®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡é€šè¿‡rewriteå¯ä»¥å°†é˜²ç›—é“¾çš„åŠŸèƒ½è¿›è¡Œå®Œå–„ä¸‹ï¼Œå½“å‡ºç°é˜²ç›—é“¾çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨rewriteå°†è¯·æ±‚è½¬å‘åˆ°è‡ªå®šä¹‰çš„ä¸€å¼ å›¾ç‰‡å’Œé¡µé¢ï¼Œç»™ç”¨æˆ·æ¯”è¾ƒå¥½çš„æç¤ºä¿¡æ¯ã€‚ä¸‹é¢æˆ‘ä»¬å°±é€šè¿‡æ ¹æ®æ–‡ä»¶ç±»å‹å®ç°é˜²ç›—é“¾çš„ä¸€ä¸ªé…ç½®å®ä¾‹: 123456789location /images &#123; root html; valid_referers none blocked www.baidu.com; if ($invalid_referer)&#123; #return 403; rewrite ^/ /images/forbidden.png break; &#125;&#125; Nginxåå‘ä»£ç† Nginxåå‘ä»£ç†æ¦‚è¿° å…³äºæ­£å‘ä»£ç†å’Œåå‘ä»£ç†ï¼Œæˆ‘ä»¬åœ¨å‰é¢çš„ç« èŠ‚å·²ç»é€šè¿‡ä¸€å¼ å›¾ç»™å¤§å®¶è¯¦ç»†çš„ä»‹ç»è¿‡äº†ï¼Œç®€è€Œè¨€ä¹‹å°±æ˜¯æ­£å‘ä»£ç†ä»£ç†çš„å¯¹è±¡æ˜¯å®¢æˆ·ç«¯ï¼Œåå‘ä»£ç†ä»£ç†çš„æ˜¯æœåŠ¡ç«¯ï¼Œè¿™æ˜¯ä¸¤è€…ä¹‹é—´æœ€å¤§çš„åŒºåˆ«ã€‚ Nginxå³å¯ä»¥å®ç°æ­£å‘ä»£ç†ï¼Œä¹Ÿå¯ä»¥å®ç°åå‘ä»£ç†ã€‚ æˆ‘ä»¬å…ˆæ¥é€šè¿‡ä¸€ä¸ªå°æ¡ˆä¾‹æ¼”ç¤ºä¸‹Nginxæ­£å‘ä»£ç†çš„ç®€å•åº”ç”¨ã€‚ å…ˆæéœ€æ±‚ï¼š (1)æœåŠ¡ç«¯çš„è®¾ç½®ï¼š 123456789101112http &#123; log_format main &#x27;client send request=&gt;clientIp=$remote_addr serverIp=&gt;$host&#x27;; server&#123; listen 80; server_name localhost; access_log logs/access.log main; location &#123; root html; index index.html index.htm; &#125; &#125;&#125; (2)ä½¿ç”¨å®¢æˆ·ç«¯è®¿é—®æœåŠ¡ç«¯ï¼Œæ‰“å¼€æ—¥å¿—æŸ¥çœ‹ç»“æœ (3)ä»£ç†æœåŠ¡å™¨è®¾ç½®ï¼š 123456789server &#123; listen 82; resolver 8.8.8.8; location /&#123; proxy_pass http://$host$request_uri; &#125; &#125; (4)æŸ¥çœ‹ä»£ç†æœåŠ¡å™¨çš„IP(192.168.200.146)å’ŒNginxé…ç½®ç›‘å¬çš„ç«¯å£(82) (5)åœ¨å®¢æˆ·ç«¯é…ç½®ä»£ç†æœåŠ¡å™¨ (6)è®¾ç½®å®Œæˆåï¼Œå†æ¬¡é€šè¿‡æµè§ˆå™¨è®¿é—®æœåŠ¡ç«¯ é€šè¿‡å¯¹æ¯”ï¼Œä¸Šä¸‹ä¸¤æ¬¡çš„æ—¥å¿—è®°å½•ï¼Œä¼šå‘ç°è™½ç„¶æˆ‘ä»¬æ˜¯å®¢æˆ·ç«¯è®¿é—®æœåŠ¡ç«¯ï¼Œä½†æ˜¯å¦‚ä½•ä½¿ç”¨äº†ä»£ç†ï¼Œé‚£ä¹ˆæœåŠ¡ç«¯èƒ½çœ‹åˆ°çš„åªæ˜¯ä»£ç†å‘é€è¿‡å»çš„è¯·æ±‚ï¼Œè¿™æ ·çš„åŒ–ï¼Œå°±ä½¿ç”¨Nginxå®ç°äº†æ­£å‘ä»£ç†çš„è®¾ç½®ã€‚ ä½†æ˜¯Nginxæ­£å‘ä»£ç†ï¼Œåœ¨å®é™…çš„åº”ç”¨ä¸­ä¸æ˜¯ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥æˆ‘ä»¬ç®€å•äº†è§£ä¸‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å­¦ä¹ Nginxçš„åå‘ä»£ç†ï¼Œè¿™æ˜¯Nginxæ¯”è¾ƒé‡è¦çš„ä¸€ä¸ªåŠŸèƒ½ã€‚ Nginxåå‘ä»£ç†çš„é…ç½®è¯­æ³• Nginxåå‘ä»£ç†æ¨¡å—çš„æŒ‡ä»¤æ˜¯ç”±ngx_http_proxy_moduleæ¨¡å—è¿›è¡Œè§£æï¼Œè¯¥æ¨¡å—åœ¨å®‰è£…Nginxçš„æ—¶å€™å·²ç»è‡ªå·±åŠ è£…åˆ°Nginxä¸­äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŠŠåå‘ä»£ç†ä¸­çš„å¸¸ç”¨æŒ‡ä»¤ä¸€ä¸€ä»‹ç»ä¸‹ï¼š 123proxy_passproxy_set_headerproxy_redirect proxy_pass è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®è¢«ä»£ç†æœåŠ¡å™¨åœ°å€ï¼Œå¯ä»¥æ˜¯ä¸»æœºåç§°ã€IPåœ°å€åŠ ç«¯å£å·å½¢å¼ã€‚ è¯­æ³• proxy_pass URL; é»˜è®¤å€¼ â€” ä½ç½® location URL:ä¸ºè¦è®¾ç½®çš„è¢«ä»£ç†æœåŠ¡å™¨åœ°å€ï¼ŒåŒ…å«ä¼ è¾“åè®®(http,https://)ã€ä¸»æœºåç§°æˆ–IPåœ°å€åŠ ç«¯å£å·ã€URIç­‰è¦ç´ ã€‚ ä¸¾ä¾‹ï¼š 123456proxy_pass http://www.baidu.com;location /server&#123;&#125;proxy_pass http://192.168.200.146; http://192.168.200.146/server/index.htmlproxy_pass http://192.168.200.146/; http://192.168.200.146/index.html å¤§å®¶åœ¨ç¼–å†™proxy_passçš„æ—¶å€™ï¼Œåé¢çš„å€¼è¦ä¸è¦åŠ &quot;/&quot;? æ¥ä¸‹æ¥é€šè¿‡ä¾‹å­æ¥è¯´æ˜åˆšæ‰æˆ‘ä»¬æåˆ°çš„é—®é¢˜ï¼š 1234567891011121314151617181920server &#123; listen 80; server_name localhost; location /&#123; #proxy_pass http://192.168.200.146; proxy_pass http://192.168.200.146/; &#125;&#125;å½“å®¢æˆ·ç«¯è®¿é—® http://localhost/index.html,æ•ˆæœæ˜¯ä¸€æ ·çš„server&#123; listen 80; server_name localhost; location /server&#123; #proxy_pass http://192.168.200.146; proxy_pass http://192.168.200.146/; &#125;&#125;å½“å®¢æˆ·ç«¯è®¿é—® http://localhost/server/index.htmlè¿™ä¸ªæ—¶å€™ï¼Œç¬¬ä¸€ä¸ªproxy_passå°±å˜æˆäº†http://localhost/server/index.htmlç¬¬äºŒä¸ªproxy_passå°±å˜æˆäº†http://localhost/index.htmlæ•ˆæœå°±ä¸ä¸€æ ·äº†ã€‚ proxy_set_header è¯¥æŒ‡ä»¤å¯ä»¥æ›´æ”¹NginxæœåŠ¡å™¨æ¥æ”¶åˆ°çš„å®¢æˆ·ç«¯è¯·æ±‚çš„è¯·æ±‚å¤´ä¿¡æ¯ï¼Œç„¶åå°†æ–°çš„è¯·æ±‚å¤´å‘é€ç»™ä»£ç†çš„æœåŠ¡å™¨ è¯­æ³• proxy_set_header field value; é»˜è®¤å€¼ proxy_set_header Host $proxy_host;proxy_set_header Connection close; ä½ç½® httpã€serverã€location éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæƒ³è¦çœ‹åˆ°ç»“æœï¼Œå¿…é¡»åœ¨è¢«ä»£ç†çš„æœåŠ¡å™¨ä¸Šæ¥è·å–æ·»åŠ çš„å¤´ä¿¡æ¯ã€‚ è¢«ä»£ç†æœåŠ¡å™¨ï¼š [192.168.200.146] 123456server &#123; listen 8080; server_name localhost; default_type text/plain; return 200 $http_username;&#125; ä»£ç†æœåŠ¡å™¨: [192.168.200.133] 123456789server &#123; listen 8080; server_name localhost; location /server &#123; proxy_pass http://192.168.200.146:8080/; proxy_set_header username TOM; &#125; &#125; è®¿é—®æµ‹è¯• proxy_redirect è¯¥æŒ‡ä»¤æ˜¯ç”¨æ¥é‡ç½®å¤´ä¿¡æ¯ä¸­çš„&quot;Location&quot;å’Œ&quot;Refresh&quot;çš„å€¼ã€‚ è¯­æ³• proxy_redirect redirect replacement;proxy_redirect default;proxy_redirect off; é»˜è®¤å€¼ proxy_redirect default; ä½ç½® httpã€serverã€location ã€‹ä¸ºä»€ä¹ˆè¦ç”¨è¯¥æŒ‡ä»¤? æœåŠ¡ç«¯[192.168.200.146] 12345678server &#123; listen 8081; server_name localhost; if (!-f $request_filename)&#123; return 302 http://192.168.200.146; &#125;&#125; ä»£ç†æœåŠ¡ç«¯[192.168.200.133] 12345678server &#123; listen 8081; server_name localhost; location / &#123; proxy_pass http://192.168.200.146:8081/; proxy_redirect http://192.168.200.146 http://192.168.200.133; &#125;&#125; ã€‹è¯¥æŒ‡ä»¤çš„å‡ ç»„é€‰é¡¹ proxy_redirect redirect replacement; 12redirect:ç›®æ ‡,Locationçš„å€¼replacement:è¦æ›¿æ¢çš„å€¼ proxy_redirect default; 123default;å°†locationå—çš„uriå˜é‡ä½œä¸ºreplacement,å°†proxy_passå˜é‡ä½œä¸ºredirectè¿›è¡Œæ›¿æ¢ proxy_redirect off; 1å…³é—­proxy_redirectçš„åŠŸèƒ½ Nginxåå‘ä»£ç†å®æˆ˜ æœåŠ¡å™¨1,2,3å­˜åœ¨ä¸¤ç§æƒ…å†µ 12ç¬¬ä¸€ç§æƒ…å†µ: ä¸‰å°æœåŠ¡å™¨çš„å†…å®¹ä¸ä¸€æ ·ã€‚ç¬¬äºŒç§æƒ…å†µ: ä¸‰å°æœåŠ¡å™¨çš„å†…å®¹æ˜¯ä¸€æ ·ã€‚ å¦‚æœæœåŠ¡å™¨1ã€æœåŠ¡å™¨2å’ŒæœåŠ¡å™¨3çš„å†…å®¹ä¸ä¸€æ ·ï¼Œé‚£æˆ‘ä»¬å¯ä»¥æ ¹æ®ç”¨æˆ·è¯·æ±‚æ¥åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ã€‚ 12345678910111213141516171819202122232425262728293031323334353637ä»£ç†æœåŠ¡å™¨server &#123; listen 8082; server_name localhost; location /server1 &#123; proxy_pass http://192.168.200.146:9001/; &#125; location /server2 &#123; proxy_pass http://192.168.200.146:9002/; &#125; location /server3 &#123; proxy_pass http://192.168.200.146:9003/; &#125;&#125;æœåŠ¡ç«¯server1server &#123; listen 9001; server_name localhost; default_type text/html; return 200 &#x27;&lt;h1&gt;192.168.200.146:9001&lt;/h1&gt;&#x27;&#125;server2server &#123; listen 9002; server_name localhost; default_type text/html; return 200 &#x27;&lt;h1&gt;192.168.200.146:9002&lt;/h1&gt;&#x27;&#125;server3server &#123; listen 9003; server_name localhost; default_type text/html; return 200 &#x27;&lt;h1&gt;192.168.200.146:9003&lt;/h1&gt;&#x27;&#125; å¦‚æœæœåŠ¡å™¨1ã€æœåŠ¡å™¨2å’ŒæœåŠ¡å™¨3çš„å†…å®¹æ˜¯ä¸€æ ·çš„ï¼Œè¯¥å¦‚ä½•å¤„ç†? Nginxçš„å®‰å…¨æ§åˆ¶ å…³äºwebæœåŠ¡å™¨çš„å®‰å…¨æ˜¯æ¯”è¾ƒå¤§çš„ä¸€ä¸ªè¯é¢˜ï¼Œé‡Œé¢æ‰€æ¶‰åŠçš„å†…å®¹å¾ˆå¤šï¼ŒNginxåå‘ä»£ç†æ˜¯å¦‚ä½•æ¥æå‡webæœåŠ¡å™¨çš„å®‰å…¨å‘¢ï¼Ÿ 1å®‰å…¨éš”ç¦» ä»€ä¹ˆæ˜¯å®‰å…¨éš”ç¦»? é€šè¿‡ä»£ç†åˆ†å¼€äº†å®¢æˆ·ç«¯åˆ°åº”ç”¨ç¨‹åºæœåŠ¡å™¨ç«¯çš„è¿æ¥ï¼Œå®ç°äº†å®‰å…¨æªæ–½ã€‚åœ¨åå‘ä»£ç†ä¹‹å‰è®¾ç½®é˜²ç«å¢™ï¼Œä»…ç•™ä¸€ä¸ªå…¥å£ä¾›ä»£ç†æœåŠ¡å™¨è®¿é—®ã€‚ å¦‚ä½•ä½¿ç”¨SSLå¯¹æµé‡è¿›è¡ŒåŠ å¯† ç¿»è¯‘æˆå¤§å®¶èƒ½ç†Ÿæ‚‰çš„è¯´æ³•å°±æ˜¯å°†æˆ‘ä»¬å¸¸ç”¨çš„httpè¯·æ±‚è½¬å˜æˆhttpsè¯·æ±‚ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªä¹‹é—´çš„åŒºåˆ«ç®€å•çš„æ¥è¯´ä¸¤ä¸ªéƒ½æ˜¯HTTPåè®®ï¼Œåªä¸è¿‡httpsæ˜¯èº«æŠ«SSLå¤–å£³çš„http. HTTPSæ˜¯ä¸€ç§é€šè¿‡è®¡ç®—æœºç½‘ç»œè¿›è¡Œå®‰å…¨é€šä¿¡çš„ä¼ è¾“åè®®ã€‚å®ƒç»ç”±HTTPè¿›è¡Œé€šä¿¡ï¼Œåˆ©ç”¨SSL/TLSå»ºç«‹å…¨é€šä¿¡ï¼ŒåŠ å¯†æ•°æ®åŒ…ï¼Œç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§ã€‚ SSL(Secure Sockets Layer)å®‰å…¨å¥—æ¥å±‚ TLS(Transport Layer Security)ä¼ è¾“å±‚å®‰å…¨ ä¸Šè¿°è¿™ä¸¤ä¸ªæ˜¯ä¸ºç½‘ç»œé€šä¿¡æä¾›å®‰å…¨åŠæ•°æ®å®Œæ•´æ€§çš„ä¸€ç§å®‰å…¨åè®®ï¼ŒTLSå’ŒSSLåœ¨ä¼ è¾“å±‚å’Œåº”ç”¨å±‚å¯¹ç½‘ç»œè¿æ¥è¿›è¡ŒåŠ å¯†ã€‚ æ€»ç»“æ¥è¯´ä¸ºä»€ä¹ˆè¦ä½¿ç”¨https: 1httpåè®®æ˜¯æ˜æ–‡ä¼ è¾“æ•°æ®ï¼Œå­˜åœ¨å®‰å…¨é—®é¢˜ï¼Œè€Œhttpsæ˜¯åŠ å¯†ä¼ è¾“ï¼Œç›¸å½“äºhttp+sslï¼Œå¹¶ä¸”å¯ä»¥é˜²æ­¢æµé‡åŠ«æŒã€‚ Nginxè¦æƒ³ä½¿ç”¨SSLï¼Œéœ€è¦æ»¡è¶³ä¸€ä¸ªæ¡ä»¶å³éœ€è¦æ·»åŠ ä¸€ä¸ªæ¨¡å—--with-http_ssl_module,è€Œè¯¥æ¨¡å—åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­åˆéœ€è¦OpenSSLçš„æ”¯æŒï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹‹å‰å·²ç»å‡†å¤‡å¥½äº†ã€‚ nginxæ·»åŠ SSLçš„æ”¯æŒ ï¼ˆ1ï¼‰å®Œæˆ --with-http_ssl_moduleæ¨¡å—çš„å¢é‡æ·»åŠ  123456ã€‹å°†åŸæœ‰/usr/local/nginx/sbin/nginxè¿›è¡Œå¤‡ä»½ã€‹æ‹·è´nginxä¹‹å‰çš„é…ç½®ä¿¡æ¯ã€‹åœ¨nginxçš„å®‰è£…æºç è¿›è¡Œé…ç½®æŒ‡å®šå¯¹åº”æ¨¡å— ./configure --with-http_ssl_moduleã€‹é€šè¿‡makeæ¨¡æ¿è¿›è¡Œç¼–è¯‘ã€‹å°†objsä¸‹é¢çš„nginxç§»åŠ¨åˆ°/usr/local/nginx/sbinä¸‹ã€‹åœ¨æºç ç›®å½•ä¸‹æ‰§è¡Œ make upgradeè¿›è¡Œå‡çº§ï¼Œè¿™ä¸ªå¯ä»¥å®ç°ä¸åœæœºæ·»åŠ æ–°æ¨¡å—çš„åŠŸèƒ½ Nginxçš„SSLç›¸å…³æŒ‡ä»¤ å› ä¸ºåˆšæ‰æˆ‘ä»¬ä»‹ç»è¿‡è¯¥æ¨¡å—çš„æŒ‡ä»¤éƒ½æ˜¯é€šè¿‡ngx_http_ssl_moduleæ¨¡å—æ¥è§£æçš„ã€‚ ã€‹ssl:è¯¥æŒ‡ä»¤ç”¨æ¥åœ¨æŒ‡å®šçš„æœåŠ¡å™¨å¼€å¯HTTPS,å¯ä»¥ä½¿ç”¨ listen 443 ssl,åé¢è¿™ç§æ–¹å¼æ›´é€šç”¨äº›ã€‚ è¯­æ³• ssl on | off; é»˜è®¤å€¼ ssl off; ä½ç½® httpã€server 123server&#123; listen 443 ssl;&#125; ã€‹ssl_certificate:ä¸ºå½“å‰è¿™ä¸ªè™šæ‹Ÿä¸»æœºæŒ‡å®šä¸€ä¸ªå¸¦æœ‰PEMæ ¼å¼è¯ä¹¦çš„è¯ä¹¦ã€‚ è¯­æ³• ssl_certificate file; é»˜è®¤å€¼ â€” ä½ç½® httpã€server ã€‹ssl_certificate_key:è¯¥æŒ‡ä»¤ç”¨æ¥æŒ‡å®šPEM secret keyæ–‡ä»¶çš„è·¯å¾„ è¯­æ³• ssl_ceritificate_key file; é»˜è®¤å€¼ â€” ä½ç½® httpã€server ã€‹ssl_session_cache:è¯¥æŒ‡ä»¤ç”¨æ¥é…ç½®ç”¨äºSSLä¼šè¯çš„ç¼“å­˜ è¯­æ³• ssl_sesion_cache off|none|[builtin[:size]] [shared:name:size] é»˜è®¤å€¼ ssl_session_cache none; ä½ç½® httpã€server off:ç¦ç”¨ä¼šè¯ç¼“å­˜ï¼Œå®¢æˆ·ç«¯ä¸å¾—é‡å¤ä½¿ç”¨ä¼šè¯ none:ç¦æ­¢ä½¿ç”¨ä¼šè¯ç¼“å­˜ï¼Œå®¢æˆ·ç«¯å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰åœ¨ç¼“å­˜ä¸­å­˜å‚¨ä¼šè¯å‚æ•° builtin:å†…ç½®OpenSSLç¼“å­˜ï¼Œä»…åœ¨ä¸€ä¸ªå·¥ä½œè¿›ç¨‹ä¸­ä½¿ç”¨ã€‚ shared:æ‰€æœ‰å·¥ä½œè¿›ç¨‹ä¹‹é—´å…±äº«ç¼“å­˜ï¼Œç¼“å­˜çš„ç›¸å…³ä¿¡æ¯ç”¨nameå’Œsizeæ¥æŒ‡å®š ã€‹ssl_session_timeoutï¼šå¼€å¯SSLä¼šè¯åŠŸèƒ½åï¼Œè®¾ç½®å®¢æˆ·ç«¯èƒ½å¤Ÿåå¤ä½¿ç”¨å‚¨å­˜åœ¨ç¼“å­˜ä¸­çš„ä¼šè¯å‚æ•°æ—¶é—´ã€‚ è¯­æ³• ssl_session_timeout time; é»˜è®¤å€¼ ssl_session_timeout 5m; ä½ç½® httpã€server ã€‹ssl_ciphers:æŒ‡å‡ºå…è®¸çš„å¯†ç ï¼Œå¯†ç æŒ‡å®šä¸ºOpenSSLæ”¯æŒçš„æ ¼å¼ è¯­æ³• ssl_ciphers ciphers; é»˜è®¤å€¼ ssl_ciphers HIGH:!aNULL:!MD5; ä½ç½® httpã€server å¯ä»¥ä½¿ç”¨openssl ciphersæŸ¥çœ‹opensslæ”¯æŒçš„æ ¼å¼ã€‚ ã€‹ssl_prefer_server_ciphersï¼šè¯¥æŒ‡ä»¤æŒ‡å®šæ˜¯å¦æœåŠ¡å™¨å¯†ç ä¼˜å…ˆå®¢æˆ·ç«¯å¯†ç  è¯­æ³• ssl_perfer_server_ciphers on|off; é»˜è®¤å€¼ ssl_perfer_server_ciphers off; ä½ç½® httpã€server ç”Ÿæˆè¯ä¹¦ æ–¹å¼ä¸€ï¼šä½¿ç”¨é˜¿é‡Œäº‘/è…¾è®¯äº‘ç­‰ç¬¬ä¸‰æ–¹æœåŠ¡è¿›è¡Œè´­ä¹°ã€‚ æ–¹å¼äºŒ:ä½¿ç”¨opensslç”Ÿæˆè¯ä¹¦ å…ˆè¦ç¡®è®¤å½“å‰ç³»ç»Ÿæ˜¯å¦æœ‰å®‰è£…openssl 1openssl version å®‰è£…ä¸‹é¢çš„å‘½ä»¤è¿›è¡Œç”Ÿæˆ 1234567mkdir /root/certcd /root/certopenssl genrsa -des3 -out server.key 1024openssl req -new -key server.key -out server.csrcp server.key server.key.orgopenssl rsa -in server.key.org -out server.keyopenssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt å¼€å¯SSLå®ä¾‹ 123456789101112131415161718server &#123; listen 443 ssl; server_name localhost; ssl_certificate server.cert; ssl_certificate_key server.key; ssl_session_cache shared:SSL:1m; ssl_session_timeout 5m; ssl_ciphers HIGH:!aNULL:!MD5; ssl_prefer_server_ciphers on; location / &#123; root html; index index.html index.htm; &#125;&#125; ï¼ˆ4ï¼‰éªŒè¯ åå‘ä»£ç†ç³»ç»Ÿè°ƒä¼˜ åå‘ä»£ç†å€¼Bufferå’ŒCache Bufferç¿»è¯‘è¿‡æ¥æ˜¯&quot;ç¼“å†²&quot;ï¼ŒCacheç¿»è¯‘è¿‡æ¥æ˜¯&quot;ç¼“å­˜&quot;ã€‚ æ€»ç»“ä¸‹ï¼š 12345ç›¸åŒç‚¹:ä¸¤ç§æ–¹å¼éƒ½æ˜¯ç”¨æ¥æä¾›IOååæ•ˆç‡ï¼Œéƒ½æ˜¯ç”¨æ¥æå‡Nginxä»£ç†çš„æ€§èƒ½ã€‚ä¸åŒç‚¹:ç¼“å†²ä¸»è¦ç”¨æ¥è§£å†³ä¸åŒè®¾å¤‡ä¹‹é—´æ•°æ®ä¼ é€’é€Ÿåº¦ä¸ä¸€è‡´å¯¼è‡´çš„æ€§èƒ½ä½çš„é—®é¢˜ï¼Œç¼“å†²ä¸­çš„æ•°æ®ä¸€æ—¦æ­¤æ¬¡æ“ä½œå®Œæˆåï¼Œå°±å¯ä»¥åˆ é™¤ã€‚ç¼“å­˜ä¸»è¦æ˜¯å¤‡ä»½ï¼Œå°†è¢«ä»£ç†æœåŠ¡å™¨çš„æ•°æ®ç¼“å­˜ä¸€ä»½åˆ°ä»£ç†æœåŠ¡å™¨ï¼Œè¿™æ ·çš„è¯ï¼Œå®¢æˆ·ç«¯å†æ¬¡è·å–ç›¸åŒæ•°æ®çš„æ—¶å€™ï¼Œå°±åªéœ€è¦ä»ä»£ç†æœåŠ¡å™¨ä¸Šè·å–ï¼Œæ•ˆç‡è¾ƒé«˜ï¼Œç¼“å­˜ä¸­çš„æ•°æ®å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œåªæœ‰æ»¡è¶³ç‰¹å®šæ¡ä»¶æ‰ä¼šåˆ é™¤. ï¼ˆ1ï¼‰Proxy Bufferç›¸å…³æŒ‡ä»¤ ã€‹proxy_buffering :è¯¥æŒ‡ä»¤ç”¨æ¥å¼€å¯æˆ–è€…å…³é—­ä»£ç†æœåŠ¡å™¨çš„ç¼“å†²åŒºï¼› è¯­æ³• proxy_buffering on|off; é»˜è®¤å€¼ proxy_buffering on; ä½ç½® httpã€serverã€location ã€‹proxy_buffers:è¯¥æŒ‡ä»¤ç”¨æ¥æŒ‡å®šå•ä¸ªè¿æ¥ä»ä»£ç†æœåŠ¡å™¨è¯»å–å“åº”çš„ç¼“å­˜åŒºçš„ä¸ªæ•°å’Œå¤§å°ã€‚ è¯­æ³• proxy_buffers number size; é»˜è®¤å€¼ proxy_buffers 8 4k | 8K;(ä¸ç³»ç»Ÿå¹³å°æœ‰å…³) ä½ç½® httpã€serverã€location number:ç¼“å†²åŒºçš„ä¸ªæ•° size:æ¯ä¸ªç¼“å†²åŒºçš„å¤§å°ï¼Œç¼“å†²åŒºçš„æ€»å¤§å°å°±æ˜¯number*size ã€‹proxy_buffer_size:è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®ä»è¢«ä»£ç†æœåŠ¡å™¨è·å–çš„ç¬¬ä¸€éƒ¨åˆ†å“åº”æ•°æ®çš„å¤§å°ã€‚ä¿æŒä¸proxy_buffersä¸­çš„sizeä¸€è‡´å³å¯ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ›´å°ã€‚ è¯­æ³• proxy_buffer_size size; é»˜è®¤å€¼ proxy_buffer_size 4k | 8k;(ä¸ç³»ç»Ÿå¹³å°æœ‰å…³) ä½ç½® httpã€serverã€location ã€‹proxy_busy_buffers_sizeï¼šè¯¥æŒ‡ä»¤ç”¨æ¥é™åˆ¶åŒæ—¶å¤„äºBUSYçŠ¶æ€çš„ç¼“å†²æ€»å¤§å°ã€‚ è¯­æ³• proxy_busy_buffers_size size; é»˜è®¤å€¼ proxy_busy_buffers_size 8k|16K; ä½ç½® httpã€serverã€location ã€‹proxy_temp_path:å½“ç¼“å†²åŒºå­˜æ»¡åï¼Œä»æœªè¢«NginxæœåŠ¡å™¨å®Œå…¨æ¥å—ï¼Œå“åº”æ•°æ®å°±ä¼šè¢«ä¸´æ—¶å­˜æ”¾åœ¨ç£ç›˜æ–‡ä»¶ä¸Šï¼Œè¯¥æŒ‡ä»¤è®¾ç½®æ–‡ä»¶è·¯å¾„ è¯­æ³• proxy_temp_path path; é»˜è®¤å€¼ proxy_temp_path proxy_temp; ä½ç½® httpã€serverã€location æ³¨æ„pathæœ€å¤šè®¾ç½®ä¸‰å±‚ã€‚ ã€‹proxy_temp_file_write_sizeï¼šè¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®ç£ç›˜ä¸Šç¼“å†²æ–‡ä»¶çš„å¤§å°ã€‚ è¯­æ³• proxy_temp_file_write_size size; é»˜è®¤å€¼ proxy_temp_file_write_size 8K|16K; ä½ç½® httpã€serverã€location é€šç”¨ç½‘ç«™çš„é…ç½® 1234proxy_buffering on;proxy_buffer_size 4 32k;proxy_busy_buffers_size 64k;proxy_temp_file_write_size 64k; æ ¹æ®é¡¹ç›®çš„å…·ä½“å†…å®¹è¿›è¡Œç›¸åº”çš„è°ƒèŠ‚ã€‚","categories":[{"name":"Webå¼€å‘","slug":"Webå¼€å‘","permalink":"http://kaillliu.github.io/categories/Web%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://kaillliu.github.io/tags/Java/"},{"name":"Centos","slug":"Centos","permalink":"http://kaillliu.github.io/tags/Centos/"},{"name":"Linux","slug":"Linux","permalink":"http://kaillliu.github.io/tags/Linux/"}]},{"title":"Nginxå­¦ä¹ ï¼ˆå››ï¼‰--- è´Ÿè½½å‡è¡¡","slug":"Nginxå­¦ä¹ å…¶å››","date":"2022-04-21T08:53:00.000Z","updated":"2022-05-23T05:41:23.080Z","comments":true,"path":"2022/04/21/Nginxå­¦ä¹ å…¶å››/","link":"","permalink":"http://kaillliu.github.io/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E5%9B%9B/","excerpt":"","text":"Nginxè´Ÿè½½å‡è¡¡ è´Ÿè½½å‡è¡¡æ¦‚è¿° æ—©æœŸçš„ç½‘ç«™æµé‡å’Œä¸šåŠ¡åŠŸèƒ½éƒ½æ¯”è¾ƒç®€å•ï¼Œå•å°æœåŠ¡å™¨è¶³ä»¥æ»¡è¶³åŸºæœ¬çš„éœ€æ±‚ï¼Œä½†æ˜¯éšç€äº’è”ç½‘çš„å‘å±•ï¼Œä¸šåŠ¡æµé‡è¶Šæ¥è¶Šå¤§å¹¶ä¸”ä¸šåŠ¡é€»è¾‘ä¹Ÿè·Ÿç€è¶Šæ¥è¶Šå¤æ‚ï¼Œå•å°æœåŠ¡å™¨çš„æ€§èƒ½åŠå•ç‚¹æ•…éšœé—®é¢˜å°±å‡¸æ˜¾å‡ºæ¥äº†ï¼Œå› æ­¤éœ€è¦å¤šå°æœåŠ¡å™¨è¿›è¡Œæ€§èƒ½çš„æ°´å¹³æ‰©å±•åŠé¿å…å•ç‚¹æ•…éšœå‡ºç°ã€‚é‚£ä¹ˆå¦‚ä½•å°†ä¸åŒç”¨æˆ·çš„è¯·æ±‚æµé‡åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šå‘¢ï¼Ÿ è´Ÿè½½å‡è¡¡çš„åŸç†åŠå¤„ç†æµç¨‹ ç³»ç»Ÿçš„æ‰©å±•å¯ä»¥åˆ†ä¸ºçºµå‘æ‰©å±•å’Œæ¨ªå‘æ‰©å±•ã€‚ çºµå‘æ‰©å±•æ˜¯ä»å•æœºçš„è§’åº¦å‡ºå‘ï¼Œé€šè¿‡å¢åŠ ç³»ç»Ÿçš„ç¡¬ä»¶å¤„ç†èƒ½åŠ›æ¥æå‡æœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ› æ¨ªå‘æ‰©å±•æ˜¯é€šè¿‡æ·»åŠ æœºå™¨æ¥æ»¡è¶³å¤§å‹ç½‘ç«™æœåŠ¡çš„å¤„ç†èƒ½åŠ›ã€‚ è¿™é‡Œé¢æ¶‰åŠåˆ°ä¸¤ä¸ªé‡è¦çš„è§’è‰²åˆ†åˆ«æ˜¯&quot;åº”ç”¨é›†ç¾¤&quot;å’Œ&quot;è´Ÿè½½å‡è¡¡å™¨&quot;ã€‚ åº”ç”¨é›†ç¾¤ï¼šå°†åŒä¸€åº”ç”¨éƒ¨ç½²åˆ°å¤šå°æœºå™¨ä¸Šï¼Œç»„æˆå¤„ç†é›†ç¾¤ï¼Œæ¥æ”¶è´Ÿè½½å‡è¡¡è®¾å¤‡åˆ†å‘çš„è¯·æ±‚ï¼Œè¿›è¡Œå¤„ç†å¹¶è¿”å›å“åº”çš„æ•°æ®ã€‚ è´Ÿè½½å‡è¡¡å™¨:å°†ç”¨æˆ·è®¿é—®çš„è¯·æ±‚æ ¹æ®å¯¹åº”çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œåˆ†å‘åˆ°é›†ç¾¤ä¸­çš„ä¸€å°æœåŠ¡å™¨è¿›è¡Œå¤„ç†ã€‚ è´Ÿè½½å‡è¡¡çš„ä½œç”¨ 1ã€è§£å†³æœåŠ¡å™¨çš„é«˜å¹¶å‘å‹åŠ›ï¼Œæé«˜åº”ç”¨ç¨‹åºçš„å¤„ç†æ€§èƒ½ã€‚ 2ã€æä¾›æ•…éšœè½¬ç§»ï¼Œå®ç°é«˜å¯ç”¨ã€‚ 3ã€é€šè¿‡æ·»åŠ æˆ–å‡å°‘æœåŠ¡å™¨æ•°é‡ï¼Œå¢å¼ºç½‘ç«™çš„å¯æ‰©å±•æ€§ã€‚ 4ã€åœ¨è´Ÿè½½å‡è¡¡å™¨ä¸Šè¿›è¡Œè¿‡æ»¤ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚ è´Ÿè½½å‡è¡¡å¸¸ç”¨çš„å¤„ç†æ–¹å¼ æ–¹å¼ä¸€:ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹© è¿™ç§æ–¹å¼æ¯”è¾ƒåŸå§‹ï¼Œåªè¦å®ç°çš„æ–¹å¼å°±æ˜¯åœ¨ç½‘ç«™ä¸»é¡µä¸Šé¢æä¾›ä¸åŒçº¿è·¯ã€ä¸åŒæœåŠ¡å™¨é“¾æ¥æ–¹å¼ï¼Œè®©ç”¨æˆ·æ¥é€‰æ‹©è‡ªå·±è®¿é—®çš„å…·ä½“æœåŠ¡å™¨ï¼Œæ¥å®ç°è´Ÿè½½å‡è¡¡ã€‚ æ–¹å¼äºŒ:DNSè½®è¯¢æ–¹å¼ DNS 1åŸŸåç³»ç»Ÿï¼ˆæœåŠ¡ï¼‰åè®®ï¼ˆDNSï¼‰æ˜¯ä¸€ç§åˆ†å¸ƒå¼ç½‘ç»œç›®å½•æœåŠ¡ï¼Œä¸»è¦ç”¨äºåŸŸåä¸ IP åœ°å€çš„ç›¸äº’è½¬æ¢ã€‚ å¤§å¤šåŸŸåæ³¨å†Œå•†éƒ½æ”¯æŒå¯¹åŒä¸€ä¸ªä¸»æœºåæ·»åŠ å¤šæ¡Aè®°å½•ï¼Œè¿™å°±æ˜¯DNSè½®è¯¢ï¼ŒDNSæœåŠ¡å™¨å°†è§£æè¯·æ±‚æŒ‰ç…§Aè®°å½•çš„é¡ºåºï¼Œéšæœºåˆ†é…åˆ°ä¸åŒçš„IPä¸Šï¼Œè¿™æ ·å°±èƒ½å®Œæˆç®€å•çš„è´Ÿè½½å‡è¡¡ã€‚DNSè½®è¯¢çš„æˆæœ¬éå¸¸ä½ï¼Œåœ¨ä¸€äº›ä¸é‡è¦çš„æœåŠ¡å™¨ï¼Œè¢«ç»å¸¸ä½¿ç”¨ã€‚ å¦‚ä¸‹æ˜¯æˆ‘ä»¬ä¸ºæŸä¸€ä¸ªåŸŸåæ·»åŠ çš„IPåœ°å€ï¼Œç”¨2å°æœåŠ¡å™¨æ¥åšè´Ÿè½½å‡è¡¡ã€‚ éªŒè¯: 1ping www.nginx521.cn æ¸…ç©ºæœ¬åœ°çš„dnsç¼“å­˜ 1ipconfig/flushdns æˆ‘ä»¬å‘ç°ä½¿ç”¨DNSæ¥å®ç°è½®è¯¢ï¼Œä¸éœ€è¦æŠ•å…¥è¿‡å¤šçš„æˆæœ¬ï¼Œè™½ç„¶DNSè½®è¯¢æˆæœ¬ä½å»‰ï¼Œä½†æ˜¯DNSè´Ÿè½½å‡è¡¡å­˜åœ¨æ˜æ˜¾çš„ç¼ºç‚¹ã€‚ 1.å¯é æ€§ä½ å‡è®¾ä¸€ä¸ªåŸŸåDNSè½®è¯¢å¤šå°æœåŠ¡å™¨ï¼Œå¦‚æœå…¶ä¸­çš„ä¸€å°æœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è®¿é—®è¯¥æœåŠ¡å™¨çš„è¯·æ±‚å°†ä¸ä¼šæœ‰æ‰€å›åº”ï¼Œå³ä½¿ä½ å°†è¯¥æœåŠ¡å™¨çš„IPä»DNSä¸­å»æ‰ï¼Œä½†æ˜¯ç”±äºå„å¤§å®½å¸¦æ¥å…¥å•†å°†ä¼—å¤šçš„DNSå­˜æ”¾åœ¨ç¼“å­˜ä¸­ï¼Œä»¥èŠ‚çœè®¿é—®æ—¶é—´ï¼Œå¯¼è‡´DNSä¸ä¼šå®æ—¶æ›´æ–°ã€‚æ‰€ä»¥DNSè½®æµä¸Šä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†è´Ÿè½½å‡è¡¡é—®é¢˜ï¼Œä½†æ˜¯å´å­˜åœ¨å¯é æ€§ä¸é«˜çš„ç¼ºç‚¹ã€‚ 2.è´Ÿè½½å‡è¡¡ä¸å‡è¡¡ DNSè´Ÿè½½å‡è¡¡é‡‡ç”¨çš„æ˜¯ç®€å•çš„è½®è¯¢è´Ÿè½½ç®—æ³•ï¼Œä¸èƒ½åŒºåˆ†æœåŠ¡å™¨çš„å·®å¼‚ï¼Œä¸èƒ½åæ˜ æœåŠ¡å™¨çš„å½“å‰è¿è¡ŒçŠ¶æ€ï¼Œä¸èƒ½åšåˆ°ä¸ºæ€§èƒ½å¥½çš„æœåŠ¡å™¨å¤šåˆ†é…è¯·æ±‚ï¼Œå¦å¤–æœ¬åœ°è®¡ç®—æœºä¹Ÿä¼šç¼“å­˜å·²ç»è§£æçš„åŸŸååˆ°IPåœ°å€çš„æ˜ å°„ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´ä½¿ç”¨è¯¥DNSæœåŠ¡å™¨çš„ç”¨æˆ·åœ¨ä¸€å®šæ—¶é—´å†…è®¿é—®çš„æ˜¯åŒä¸€å°WebæœåŠ¡å™¨ï¼Œä»è€Œå¼•å‘WebæœåŠ¡å™¨å‡çš„è´Ÿè½½ä¸å‡è¡¡ã€‚ è´Ÿè½½ä¸å‡è¡¡åˆ™ä¼šå¯¼è‡´æŸå‡ å°æœåŠ¡å™¨è´Ÿè·å¾ˆä½ï¼Œè€Œå¦å¤–å‡ å°æœåŠ¡å™¨è´Ÿè·ç¡®å¾ˆé«˜ï¼Œå¤„ç†è¯·æ±‚çš„é€Ÿåº¦æ…¢ï¼Œé…ç½®é«˜çš„æœåŠ¡å™¨åˆ†é…åˆ°çš„è¯·æ±‚å°‘ï¼Œè€Œé…ç½®ä½çš„æœåŠ¡å™¨åˆ†é…åˆ°çš„è¯·æ±‚å¤šã€‚ æ–¹å¼ä¸‰:å››/ä¸ƒå±‚è´Ÿè½½å‡è¡¡ ä»‹ç»å››/ä¸ƒå±‚è´Ÿè½½å‡è¡¡ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸ªæ¦‚å¿µï¼ŒOSI(open system interconnection),å«å¼€æ”¾å¼ç³»ç»Ÿäº’è”æ¨¡å‹ï¼Œè¿™ä¸ªæ˜¯ç”±å›½é™…æ ‡å‡†åŒ–ç»„ç»‡ISOæŒ‡å®šçš„ä¸€ä¸ªä¸åŸºäºå…·ä½“æœºå‹ã€æ“ä½œç³»ç»Ÿæˆ–å…¬å¸çš„ç½‘ç»œä½“ç³»ç»“æ„ã€‚è¯¥æ¨¡å‹å°†ç½‘ç»œé€šä¿¡çš„å·¥ä½œåˆ†ä¸ºä¸ƒå±‚ã€‚ åº”ç”¨å±‚ï¼šä¸ºåº”ç”¨ç¨‹åºæä¾›ç½‘ç»œæœåŠ¡ã€‚ è¡¨ç¤ºå±‚ï¼šå¯¹æ•°æ®è¿›è¡Œæ ¼å¼åŒ–ã€ç¼–ç ã€åŠ å¯†ã€å‹ç¼©ç­‰æ“ä½œã€‚ ä¼šè¯å±‚ï¼šå»ºç«‹ã€ç»´æŠ¤ã€ç®¡ç†ä¼šè¯è¿æ¥ã€‚ ä¼ è¾“å±‚ï¼šå»ºç«‹ã€ç»´æŠ¤ã€ç®¡ç†ç«¯åˆ°ç«¯çš„è¿æ¥ï¼Œå¸¸è§çš„æœ‰TCP/UDPã€‚ ç½‘ç»œå±‚ï¼šIPå¯»å€å’Œè·¯ç”±é€‰æ‹© æ•°æ®é“¾è·¯å±‚ï¼šæ§åˆ¶ç½‘ç»œå±‚ä¸ç‰©ç†å±‚ä¹‹é—´çš„é€šä¿¡ã€‚ ç‰©ç†å±‚ï¼šæ¯”ç‰¹æµä¼ è¾“ã€‚ æ‰€è°“å››å±‚è´Ÿè½½å‡è¡¡æŒ‡çš„æ˜¯OSIä¸ƒå±‚æ¨¡å‹ä¸­çš„ä¼ è¾“å±‚ï¼Œä¸»è¦æ˜¯åŸºäºIP+PORTçš„è´Ÿè½½å‡è¡¡ 123å®ç°å››å±‚è´Ÿè½½å‡è¡¡çš„æ–¹å¼ï¼šç¡¬ä»¶ï¼šF5 BIG-IPã€Radwareç­‰è½¯ä»¶ï¼šLVSã€Nginxã€Hayproxyç­‰ æ‰€è°“çš„ä¸ƒå±‚è´Ÿè½½å‡è¡¡æŒ‡çš„æ˜¯åœ¨åº”ç”¨å±‚ï¼Œä¸»è¦æ˜¯åŸºäºè™šæ‹Ÿçš„URLæˆ–ä¸»æœºIPçš„è´Ÿè½½å‡è¡¡ 12å®ç°ä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„æ–¹å¼ï¼šè½¯ä»¶ï¼šNginxã€Hayproxyç­‰ å››å±‚å’Œä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„åŒºåˆ« 12å››å±‚è´Ÿè½½å‡è¡¡æ•°æ®åŒ…æ˜¯åœ¨åº•å±‚å°±è¿›è¡Œäº†åˆ†å‘ï¼Œè€Œä¸ƒå±‚è´Ÿè½½å‡è¡¡æ•°æ®åŒ…åˆ™åœ¨æœ€é¡¶ç«¯è¿›è¡Œåˆ†å‘ï¼Œæ‰€ä»¥å››å±‚è´Ÿè½½å‡è¡¡çš„æ•ˆç‡æ¯”ä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„è¦é«˜ã€‚å››å±‚è´Ÿè½½å‡è¡¡ä¸è¯†åˆ«åŸŸåï¼Œè€Œä¸ƒå±‚è´Ÿè½½å‡è¡¡è¯†åˆ«åŸŸåã€‚ å¤„ç†å››å±‚å’Œä¸ƒå±‚è´Ÿè½½ä»¥ä¸ºå…¶å®è¿˜æœ‰äºŒå±‚ã€ä¸‰å±‚è´Ÿè½½å‡è¡¡ï¼ŒäºŒå±‚æ˜¯åœ¨æ•°æ®é“¾è·¯å±‚åŸºäºmacåœ°å€æ¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œä¸‰å±‚æ˜¯åœ¨ç½‘ç»œå±‚ä¸€èˆ¬é‡‡ç”¨è™šæ‹ŸIPåœ°å€çš„æ–¹å¼å®ç°è´Ÿè½½å‡è¡¡ã€‚ å®é™…ç¯å¢ƒé‡‡ç”¨çš„æ¨¡å¼ 1å››å±‚è´Ÿè½½(LVS)+ä¸ƒå±‚è´Ÿè½½(Nginx) Nginxä¸ƒå±‚è´Ÿè½½å‡è¡¡ Nginxè¦å®ç°ä¸ƒå±‚è´Ÿè½½å‡è¡¡éœ€è¦ç”¨åˆ°proxy_passä»£ç†æ¨¡å—é…ç½®ã€‚Nginxé»˜è®¤å®‰è£…æ”¯æŒè¿™ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†åšä»»ä½•å¤„ç†ã€‚Nginxçš„è´Ÿè½½å‡è¡¡æ˜¯åœ¨Nginxçš„åå‘ä»£ç†åŸºç¡€ä¸ŠæŠŠç”¨æˆ·çš„è¯·æ±‚æ ¹æ®æŒ‡å®šçš„ç®—æ³•åˆ†å‘åˆ°ä¸€ç»„ã€upstreamè™šæ‹ŸæœåŠ¡æ± ã€‘ã€‚ Nginxä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„æŒ‡ä»¤ upstreamæŒ‡ä»¤ è¯¥æŒ‡ä»¤æ˜¯ç”¨æ¥å®šä¹‰ä¸€ç»„æœåŠ¡å™¨ï¼Œå®ƒä»¬å¯ä»¥æ˜¯ç›‘å¬ä¸åŒç«¯å£çš„æœåŠ¡å™¨ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥æ˜¯åŒæ—¶ç›‘å¬TCPå’ŒUnix socketçš„æœåŠ¡å™¨ã€‚æœåŠ¡å™¨å¯ä»¥æŒ‡å®šä¸åŒçš„æƒé‡ï¼Œé»˜è®¤ä¸º1ã€‚ è¯­æ³• upstream name {â€¦} é»˜è®¤å€¼ â€” ä½ç½® http serveræŒ‡ä»¤ è¯¥æŒ‡ä»¤ç”¨æ¥æŒ‡å®šåç«¯æœåŠ¡å™¨çš„åç§°å’Œä¸€äº›å‚æ•°ï¼Œå¯ä»¥ä½¿ç”¨åŸŸåã€IPã€ç«¯å£æˆ–è€…unix socket è¯­æ³• server name [paramerters] é»˜è®¤å€¼ â€” ä½ç½® upstream Nginxä¸ƒå±‚è´Ÿè½½å‡è¡¡çš„å®ç°æµç¨‹ æœåŠ¡ç«¯è®¾ç½® 123456789101112131415161718192021222324server &#123; listen 9001; server_name localhost; default_type text/html; location /&#123; return 200 &#x27;&lt;h1&gt;192.168.200.146:9001&lt;/h1&gt;&#x27;; &#125;&#125;server &#123; listen 9002; server_name localhost; default_type text/html; location /&#123; return 200 &#x27;&lt;h1&gt;192.168.200.146:9002&lt;/h1&gt;&#x27;; &#125;&#125;server &#123; listen 9003; server_name localhost; default_type text/html; location /&#123; return 200 &#x27;&lt;h1&gt;192.168.200.146:9003&lt;/h1&gt;&#x27;; &#125;&#125; è´Ÿè½½å‡è¡¡å™¨è®¾ç½® 123456789101112upstream backend&#123; server 192.168.200.146:9091; server 192.168.200.146:9092; server 192.168.200.146:9093;&#125;server &#123; listen 8083; server_name localhost; location /&#123; proxy_pass http://backend; &#125;&#125; è´Ÿè½½å‡è¡¡çŠ¶æ€ ä»£ç†æœåŠ¡å™¨åœ¨è´Ÿè´£å‡è¡¡è°ƒåº¦ä¸­çš„çŠ¶æ€æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š çŠ¶æ€ æ¦‚è¿° down å½“å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½å‡è¡¡ backup é¢„ç•™çš„å¤‡ä»½æœåŠ¡å™¨ max_fails å…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•° fail_timeout ç»è¿‡max_failså¤±è´¥å, æœåŠ¡æš‚åœæ—¶é—´ max_conns é™åˆ¶æœ€å¤§çš„æ¥æ”¶è¿æ¥æ•° down down:å°†è¯¥æœåŠ¡å™¨æ ‡è®°ä¸ºæ°¸ä¹…ä¸å¯ç”¨ï¼Œé‚£ä¹ˆè¯¥ä»£ç†æœåŠ¡å™¨å°†ä¸å‚ä¸è´Ÿè½½å‡è¡¡ã€‚ 123456789101112upstream backend&#123; server 192.168.200.146:9001 down; server 192.168.200.146:9002 server 192.168.200.146:9003;&#125;server &#123; listen 8083; server_name localhost; location /&#123; proxy_pass http://backend; &#125;&#125; è¯¥çŠ¶æ€ä¸€èˆ¬ä¼šå¯¹éœ€è¦åœæœºç»´æŠ¤çš„æœåŠ¡å™¨è¿›è¡Œè®¾ç½®ã€‚ backup backup:å°†è¯¥æœåŠ¡å™¨æ ‡è®°ä¸ºå¤‡ä»½æœåŠ¡å™¨ï¼Œå½“ä¸»æœåŠ¡å™¨ä¸å¯ç”¨æ—¶ï¼Œå°†ç”¨æ¥ä¼ é€’è¯·æ±‚ã€‚ 123456789101112upstream backend&#123; server 192.168.200.146:9001 down; server 192.168.200.146:9002 backup; server 192.168.200.146:9003;&#125;server &#123; listen 8083; server_name localhost; location /&#123; proxy_pass http://backend; &#125;&#125; æ­¤æ—¶éœ€è¦å°†9094ç«¯å£çš„è®¿é—®ç¦æ­¢æ‰æ¥æ¨¡æ‹Ÿä¸‹å”¯ä¸€èƒ½å¯¹å¤–æä¾›è®¿é—®çš„æœåŠ¡å®•æœºä»¥åï¼Œbackupçš„å¤‡ä»½æœåŠ¡å™¨å°±è¦å¼€å§‹å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ­¤æ—¶ä¸ºäº†æµ‹è¯•éªŒè¯ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨é˜²ç«å¢™æ¥è¿›è¡Œæ‹¦æˆªã€‚ ä»‹ç»ä¸€ä¸ªå·¥å…·firewall-cmd,è¯¥å·¥å…·æ˜¯Linuxæä¾›çš„ä¸“é—¨ç”¨æ¥æ“ä½œfirewallçš„ã€‚ æŸ¥è¯¢é˜²ç«å¢™ä¸­æŒ‡å®šçš„ç«¯å£æ˜¯å¦å¼€æ”¾ 1firewall-cmd --query-port=9001/tcp å¦‚ä½•å¼€æ”¾ä¸€ä¸ªæŒ‡å®šçš„ç«¯å£ 1firewall-cmd --permanent --add-port=9002/tcp æ‰¹é‡æ·»åŠ å¼€å‘ç«¯å£ 1firewall-cmd --permanent --add-port=9001-9003/tcp å¦‚ä½•ç§»é™¤ä¸€ä¸ªæŒ‡å®šçš„ç«¯å£ 1firewall-cmd --permanent --remove-port=9003/tcp é‡æ–°åŠ è½½ 1firewall-cmd --reload å…¶ä¸­ â€‹ --permanentè¡¨ç¤ºè®¾ç½®ä¸ºæŒä¹… â€‹ --add-portè¡¨ç¤ºæ·»åŠ æŒ‡å®šç«¯å£ â€‹ --remove-portè¡¨ç¤ºç§»é™¤æŒ‡å®šç«¯å£ max_conns max_conns=number:ç”¨æ¥è®¾ç½®ä»£ç†æœåŠ¡å™¨åŒæ—¶æ´»åŠ¨é“¾æ¥çš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º0ï¼Œè¡¨ç¤ºä¸é™åˆ¶ï¼Œä½¿ç”¨è¯¥é…ç½®å¯ä»¥æ ¹æ®åç«¯æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„å¹¶å‘é‡æ¥è¿›è¡Œè®¾ç½®ï¼Œé˜²æ­¢åç«¯æœåŠ¡å™¨è¢«å‹å®ã€‚ max_failså’Œfail_timeout max_fails=number:è®¾ç½®å…è®¸è¯·æ±‚ä»£ç†æœåŠ¡å™¨å¤±è´¥çš„æ¬¡æ•°ï¼Œé»˜è®¤ä¸º1ã€‚ fail_timeout=time:è®¾ç½®ç»è¿‡max_failså¤±è´¥åï¼ŒæœåŠ¡æš‚åœçš„æ—¶é—´ï¼Œé»˜è®¤æ˜¯10ç§’ã€‚ 123456789101112upstream backend&#123; server 192.168.200.133:9001 down; server 192.168.200.133:9002 backup; server 192.168.200.133:9003 max_fails=3 fail_timeout=15;&#125;server &#123; listen 8083; server_name localhost; location /&#123; proxy_pass http://backend; &#125;&#125; è´Ÿè½½å‡è¡¡ç­–ç•¥ ä»‹ç»å®ŒNginxè´Ÿè½½å‡è¡¡çš„ç›¸å…³æŒ‡ä»¤åï¼Œæˆ‘ä»¬å·²ç»èƒ½å®ç°å°†ç”¨æˆ·çš„è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œé‚£ä¹ˆé™¤äº†é‡‡ç”¨é»˜è®¤çš„åˆ†é…æ–¹å¼ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½é‡‡ç”¨ä»€ä¹ˆæ ·çš„è´Ÿè½½ç®—æ³•? Nginxçš„upstreamæ”¯æŒå¦‚ä¸‹å…­ç§æ–¹å¼çš„åˆ†é…ç®—æ³•ï¼Œåˆ†åˆ«æ˜¯: ç®—æ³•åç§° è¯´æ˜ è½®è¯¢ é»˜è®¤æ–¹å¼ weight æƒé‡æ–¹å¼ ip_hash ä¾æ®ipåˆ†é…æ–¹å¼ least_conn ä¾æ®æœ€å°‘è¿æ¥æ–¹å¼ url_hash ä¾æ®URLåˆ†é…æ–¹å¼ fair ä¾æ®å“åº”æ—¶é—´æ–¹å¼ è½®è¯¢ æ˜¯upstreamæ¨¡å—è´Ÿè½½å‡è¡¡é»˜è®¤çš„ç­–ç•¥ã€‚æ¯ä¸ªè¯·æ±‚ä¼šæŒ‰æ—¶é—´é¡ºåºé€ä¸ªåˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ã€‚è½®è¯¢ä¸éœ€è¦é¢å¤–çš„é…ç½®ã€‚ 123456789101112upstream backend&#123; server 192.168.200.146:9001 weight=1; server 192.168.200.146:9002; server 192.168.200.146:9003;&#125;server &#123; listen 8083; server_name localhost; location /&#123; proxy_pass http://backend; &#125;&#125; weightåŠ æƒ[åŠ æƒè½®è¯¢] weight=number:ç”¨æ¥è®¾ç½®æœåŠ¡å™¨çš„æƒé‡ï¼Œé»˜è®¤ä¸º1ï¼Œæƒé‡æ•°æ®è¶Šå¤§ï¼Œè¢«åˆ†é…åˆ°è¯·æ±‚çš„å‡ ç‡è¶Šå¤§ï¼›è¯¥æƒé‡å€¼ï¼Œä¸»è¦æ˜¯é’ˆå¯¹å®é™…å·¥ä½œç¯å¢ƒä¸­ä¸åŒçš„åç«¯æœåŠ¡å™¨ç¡¬ä»¶é…ç½®è¿›è¡Œè°ƒæ•´çš„ï¼Œæ‰€æœ‰æ­¤ç­–ç•¥æ¯”è¾ƒé€‚åˆæœåŠ¡å™¨çš„ç¡¬ä»¶é…ç½®å·®åˆ«æ¯”è¾ƒå¤§çš„æƒ…å†µã€‚ 123456789101112upstream backend&#123; server 192.168.200.146:9001 weight=10; server 192.168.200.146:9002 weight=5; server 192.168.200.146:9003 weight=3;&#125;server &#123; listen 8083; server_name localhost; location /&#123; proxy_pass http://backend; &#125;&#125; ip_hash å½“å¯¹åç«¯çš„å¤šå°åŠ¨æ€åº”ç”¨æœåŠ¡å™¨åšè´Ÿè½½å‡è¡¡æ—¶ï¼Œip_hashæŒ‡ä»¤èƒ½å¤Ÿå°†æŸä¸ªå®¢æˆ·ç«¯IPçš„è¯·æ±‚é€šè¿‡å“ˆå¸Œç®—æ³•å®šä½åˆ°åŒä¸€å°åç«¯æœåŠ¡å™¨ä¸Šã€‚è¿™æ ·ï¼Œå½“æ¥è‡ªæŸä¸€ä¸ªIPçš„ç”¨æˆ·åœ¨åç«¯WebæœåŠ¡å™¨Aä¸Šç™»å½•åï¼Œåœ¨è®¿é—®è¯¥ç«™ç‚¹çš„å…¶ä»–URLï¼Œèƒ½ä¿è¯å…¶è®¿é—®çš„è¿˜æ˜¯åç«¯webæœåŠ¡å™¨Aã€‚ è¯­æ³• ip_hash; é»˜è®¤å€¼ â€” ä½ç½® upstream 12345678910111213upstream backend&#123; ip_hash; server 192.168.200.146:9001; server 192.168.200.146:9002; server 192.168.200.146:9003;&#125;server &#123; listen 8083; server_name localhost; location /&#123; proxy_pass http://backend; &#125;&#125; éœ€è¦é¢å¤–å¤šè¯´ä¸€ç‚¹çš„æ˜¯ä½¿ç”¨ip_hashæŒ‡ä»¤æ— æ³•ä¿è¯åç«¯æœåŠ¡å™¨çš„è´Ÿè½½å‡è¡¡ï¼Œå¯èƒ½å¯¼è‡´æœ‰äº›åç«¯æœåŠ¡å™¨æ¥æ”¶åˆ°çš„è¯·æ±‚å¤šï¼Œæœ‰äº›åç«¯æœåŠ¡å™¨æ¥æ”¶çš„è¯·æ±‚å°‘ï¼Œè€Œä¸”è®¾ç½®åç«¯æœåŠ¡å™¨æƒé‡ç­‰æ–¹æ³•å°†ä¸èµ·ä½œç”¨ã€‚ least_conn æœ€å°‘è¿æ¥ï¼ŒæŠŠè¯·æ±‚è½¬å‘ç»™è¿æ¥æ•°è¾ƒå°‘çš„åç«¯æœåŠ¡å™¨ã€‚è½®è¯¢ç®—æ³•æ˜¯æŠŠè¯·æ±‚å¹³å‡çš„è½¬å‘ç»™å„ä¸ªåç«¯ï¼Œä½¿å®ƒä»¬çš„è´Ÿè½½å¤§è‡´ç›¸åŒï¼›ä½†æ˜¯ï¼Œæœ‰äº›è¯·æ±‚å ç”¨çš„æ—¶é—´å¾ˆé•¿ï¼Œä¼šå¯¼è‡´å…¶æ‰€åœ¨çš„åç«¯è´Ÿè½½è¾ƒé«˜ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œleast_connè¿™ç§æ–¹å¼å°±å¯ä»¥è¾¾åˆ°æ›´å¥½çš„è´Ÿè½½å‡è¡¡æ•ˆæœã€‚ 12345678910111213upstream backend&#123; least_conn; server 192.168.200.146:9001; server 192.168.200.146:9002; server 192.168.200.146:9003;&#125;server &#123; listen 8083; server_name localhost; location /&#123; proxy_pass http://backend; &#125;&#125; æ­¤è´Ÿè½½å‡è¡¡ç­–ç•¥é€‚åˆè¯·æ±‚å¤„ç†æ—¶é—´é•¿çŸ­ä¸ä¸€é€ æˆæœåŠ¡å™¨è¿‡è½½çš„æƒ…å†µã€‚ url_hash æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œè¦é…åˆç¼“å­˜å‘½ä¸­æ¥ä½¿ç”¨ã€‚åŒä¸€ä¸ªèµ„æºå¤šæ¬¡è¯·æ±‚ï¼Œå¯èƒ½ä¼šåˆ°è¾¾ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œå¯¼è‡´ä¸å¿…è¦çš„å¤šæ¬¡ä¸‹è½½ï¼Œç¼“å­˜å‘½ä¸­ç‡ä¸é«˜ï¼Œä»¥åŠä¸€äº›èµ„æºæ—¶é—´çš„æµªè´¹ã€‚è€Œä½¿ç”¨url_hashï¼Œå¯ä»¥ä½¿å¾—åŒä¸€ä¸ªurlï¼ˆä¹Ÿå°±æ˜¯åŒä¸€ä¸ªèµ„æºè¯·æ±‚ï¼‰ä¼šåˆ°è¾¾åŒä¸€å°æœåŠ¡å™¨ï¼Œä¸€æ—¦ç¼“å­˜ä½äº†èµ„æºï¼Œå†æ­¤æ”¶åˆ°è¯·æ±‚ï¼Œå°±å¯ä»¥ä»ç¼“å­˜ä¸­è¯»å–ã€‚ 12345678910111213upstream backend&#123; hash &amp;request_uri; server 192.168.200.146:9001; server 192.168.200.146:9002; server 192.168.200.146:9003;&#125;server &#123; listen 8083; server_name localhost; location /&#123; proxy_pass http://backend; &#125;&#125; è®¿é—®å¦‚ä¸‹åœ°å€ï¼š 123http://192.168.200.133:8083/ahttp://192.168.200.133:8083/bhttp://192.168.200.133:8083/c fair fairé‡‡ç”¨çš„ä¸æ˜¯å†…å»ºè´Ÿè½½å‡è¡¡ä½¿ç”¨çš„è½®æ¢çš„å‡è¡¡ç®—æ³•ï¼Œè€Œæ˜¯å¯ä»¥æ ¹æ®é¡µé¢å¤§å°ã€åŠ è½½æ—¶é—´é•¿çŸ­æ™ºèƒ½çš„è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚é‚£ä¹ˆå¦‚ä½•ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—çš„fairè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚ 12345678910111213upstream backend&#123; fair; server 192.168.200.146:9001; server 192.168.200.146:9002; server 192.168.200.146:9003;&#125;server &#123; listen 8083; server_name localhost; location /&#123; proxy_pass http://backend; &#125;&#125; ä½†æ˜¯å¦‚ä½•ç›´æ¥ä½¿ç”¨ä¼šæŠ¥é”™ï¼Œå› ä¸ºfairå±äºç¬¬ä¸‰æ–¹æ¨¡å—å®ç°çš„è´Ÿè½½å‡è¡¡ã€‚éœ€è¦æ·»åŠ nginx-upstream-fair,å¦‚ä½•æ·»åŠ å¯¹åº”çš„æ¨¡å—: ä¸‹è½½nginx-upstream-fairæ¨¡å— 12ä¸‹è½½åœ°å€ä¸º: https://github.com/gnosek/nginx-upstream-fair å°†ä¸‹è½½çš„æ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨å¹¶è¿›è¡Œè§£å‹ç¼© 1unzip nginx-upstream-fair-master.zip é‡å‘½åèµ„æº 1mv nginx-upstream-fair-master fair ä½¿ç”¨./configureå‘½ä»¤å°†èµ„æºæ·»åŠ åˆ°Nginxæ¨¡å—ä¸­ 1./configure --add-module=/root/fair ç¼–è¯‘ 1make ç¼–è¯‘å¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼Œngx_http_upstream_srv_conf_tç»“æ„ä¸­ç¼ºå°‘default_port è§£å†³æ–¹æ¡ˆ: åœ¨Nginxçš„æºç ä¸­ src/http/ngx_http_upstream.h,æ‰¾åˆ°ngx_http_upstream_srv_conf_sï¼Œåœ¨æ¨¡å—ä¸­æ·»åŠ æ·»åŠ default_portå±æ€§ 1in_port_t default_port ç„¶åå†è¿›è¡Œmake. æ›´æ–°Nginx â€‹ 6.1 å°†sbinç›®å½•ä¸‹çš„nginxè¿›è¡Œå¤‡ä»½ 1mv /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginxold â€‹ 6.2 å°†å®‰è£…ç›®å½•ä¸‹çš„objsä¸­çš„nginxæ‹·è´åˆ°sbinç›®å½• 12cd objscp nginx /usr/local/nginx/sbin â€‹ 6.3 æ›´æ–°Nginx 12cd ../make upgrade ç¼–è¯‘æµ‹è¯•ä½¿ç”¨Nginx ä¸Šé¢ä»‹ç»äº†Nginxå¸¸ç”¨çš„è´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼Œæœ‰äººè¯´æ˜¯5ç§ï¼Œæ˜¯æŠŠè½®è¯¢å’ŒåŠ æƒè½®è¯¢å½’ä¸ºä¸€ç§ï¼Œä¹Ÿæœ‰äººè¯´æ˜¯6ç§ã€‚é‚£ä¹ˆåœ¨å’±ä»¬ä»¥åçš„å¼€å‘ä¸­åˆ°åº•ä½¿ç”¨å“ªç§ï¼Œè¿™ä¸ªéœ€è¦æ ¹æ®å®é™…é¡¹ç›®çš„åº”ç”¨åœºæ™¯æ¥å†³å®šçš„ã€‚ è´Ÿè½½å‡è¡¡æ¡ˆä¾‹ æ¡ˆä¾‹ä¸€ï¼šå¯¹æ‰€æœ‰è¯·æ±‚å®ç°ä¸€èˆ¬è½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡ 123456789101112upstream backend&#123; server 192.168.200.146:9001; server 192.168.200.146:9002; server 192.168.200.146:9003;&#125;server &#123; listen 8083; server_name localhost; location /&#123; proxy_pass http://backend; &#125;&#125; æ¡ˆä¾‹äºŒï¼šå¯¹æ‰€æœ‰è¯·æ±‚å®ç°åŠ æƒè½®è¯¢è§„åˆ™çš„è´Ÿè½½å‡è¡¡ 123456789101112upstream backend&#123; server 192.168.200.146:9001 weight=7; server 192.168.200.146:9002 weight=5; server 192.168.200.146:9003 weight=3;&#125;server &#123; listen 8083; server_name localhost; location /&#123; proxy_pass http://backend; &#125;&#125; æ¡ˆä¾‹ä¸‰ï¼šå¯¹ç‰¹å®šèµ„æºå®ç°è´Ÿè½½å‡è¡¡ 123456789101112131415161718upstream videobackend&#123; server 192.168.200.146:9001; server 192.168.200.146:9002;&#125;upstream filebackend&#123; server 192.168.200.146:9003; server 192.168.200.146:9004;&#125;server &#123; listen 8084; server_name localhost; location /video/ &#123; proxy_pass http://videobackend; &#125; location /file/ &#123; proxy_pass http://filebackend; &#125;&#125; æ¡ˆä¾‹å››ï¼šå¯¹ä¸åŒåŸŸåå®ç°è´Ÿè½½å‡è¡¡ 12345678910111213141516171819202122upstream itcastbackend&#123; server 192.168.200.146:9001; server 192.168.200.146:9002;&#125;upstream itheimabackend&#123; server 192.168.200.146:9003; server 192.168.200.146:9004;&#125;server &#123; listen 8085; server_name www.itcast.cn; location / &#123; proxy_pass http://itcastbackend; &#125;&#125;server &#123; listen 8086; server_name www.itheima.cn; location / &#123; proxy_pass http://itheimabackend; &#125;&#125; æ¡ˆä¾‹äº”ï¼šå®ç°å¸¦æœ‰URLé‡å†™çš„è´Ÿè½½å‡è¡¡ 123456789101112131415upstream backend&#123; server 192.168.200.146:9001; server 192.168.200.146:9002; server 192.168.200.146:9003;&#125;server &#123; listen 80; server_name localhost; location /file/ &#123; rewrite ^(/file/.*) /server/$1 last; &#125; location / &#123; proxy_pass http://backend; &#125;&#125; Nginxå››å±‚è´Ÿè½½å‡è¡¡ Nginxåœ¨1.9ä¹‹åï¼Œå¢åŠ äº†ä¸€ä¸ªstreamæ¨¡å—ï¼Œç”¨æ¥å®ç°å››å±‚åè®®çš„è½¬å‘ã€ä»£ç†ã€è´Ÿè½½å‡è¡¡ç­‰ã€‚streamæ¨¡å—çš„ç”¨æ³•è·Ÿhttpçš„ç”¨æ³•ç±»ä¼¼ï¼Œå…è®¸æˆ‘ä»¬é…ç½®ä¸€ç»„TCPæˆ–è€…UDPç­‰åè®®çš„ç›‘å¬ï¼Œç„¶åé€šè¿‡proxy_passæ¥è½¬å‘æˆ‘ä»¬çš„è¯·æ±‚ï¼Œé€šè¿‡upstreamæ·»åŠ å¤šä¸ªåç«¯æœåŠ¡ï¼Œå®ç°è´Ÿè½½å‡è¡¡ã€‚ å››å±‚åè®®è´Ÿè½½å‡è¡¡çš„å®ç°ï¼Œä¸€èˆ¬éƒ½ä¼šç”¨åˆ°LVSã€HAProxyã€F5ç­‰ï¼Œè¦ä¹ˆå¾ˆè´µè¦ä¹ˆé…ç½®å¾ˆéº»çƒ¦ï¼Œè€ŒNginxçš„é…ç½®ç›¸å¯¹æ¥è¯´æ›´ç®€å•ï¼Œæ›´èƒ½å¿«é€Ÿå®Œæˆå·¥ä½œã€‚ æ·»åŠ streamæ¨¡å—çš„æ”¯æŒ Nginxé»˜è®¤æ˜¯æ²¡æœ‰ç¼–è¯‘è¿™ä¸ªæ¨¡å—çš„ï¼Œéœ€è¦ä½¿ç”¨åˆ°streamæ¨¡å—ï¼Œé‚£ä¹ˆéœ€è¦åœ¨ç¼–è¯‘çš„æ—¶å€™åŠ ä¸Š--with-streamã€‚ å®Œæˆæ·»åŠ --with-streamçš„å®ç°æ­¥éª¤: 123456ã€‹å°†åŸæœ‰/usr/local/nginx/sbin/nginxè¿›è¡Œå¤‡ä»½ã€‹æ‹·è´nginxä¹‹å‰çš„é…ç½®ä¿¡æ¯ã€‹åœ¨nginxçš„å®‰è£…æºç è¿›è¡Œé…ç½®æŒ‡å®šå¯¹åº”æ¨¡å— ./configure --with-streamã€‹é€šè¿‡makeæ¨¡æ¿è¿›è¡Œç¼–è¯‘ã€‹å°†objsä¸‹é¢çš„nginxç§»åŠ¨åˆ°/usr/local/nginx/sbinä¸‹ã€‹åœ¨æºç ç›®å½•ä¸‹æ‰§è¡Œ make upgradeè¿›è¡Œå‡çº§ï¼Œè¿™ä¸ªå¯ä»¥å®ç°ä¸åœæœºæ·»åŠ æ–°æ¨¡å—çš„åŠŸèƒ½ Nginxå››å±‚è´Ÿè½½å‡è¡¡çš„æŒ‡ä»¤ streamæŒ‡ä»¤ è¯¥æŒ‡ä»¤æä¾›åœ¨å…¶ä¸­æŒ‡å®šæµæœåŠ¡å™¨æŒ‡ä»¤çš„é…ç½®æ–‡ä»¶ä¸Šä¸‹æ–‡ã€‚å’ŒhttpæŒ‡ä»¤åŒçº§ã€‚ è¯­æ³• stream { â€¦ } é»˜è®¤å€¼ â€” ä½ç½® main upstreamæŒ‡ä»¤ è¯¥æŒ‡ä»¤å’Œhttpçš„upstreamæŒ‡ä»¤æ˜¯ç±»ä¼¼çš„ã€‚ å››å±‚è´Ÿè½½å‡è¡¡çš„æ¡ˆä¾‹ éœ€æ±‚åˆ†æ å®ç°æ­¥éª¤ (1)å‡†å¤‡RedisæœåŠ¡å™¨,åœ¨ä¸€æ¡æœåŠ¡å™¨ä¸Šå‡†å¤‡ä¸‰ä¸ªRedisï¼Œç«¯å£åˆ†åˆ«æ˜¯6379,6378 1.ä¸Šä¼ redisçš„å®‰è£…åŒ…ï¼Œredis-4.0.14.tar.gz 2.å°†å®‰è£…åŒ…è¿›è¡Œè§£å‹ç¼© 1tar -zxf redis-4.0.14.tar.gz 3.è¿›å…¥redisçš„å®‰è£…åŒ… 1cd redis-4.0.14 4.ä½¿ç”¨makeå’Œinstallè¿›è¡Œç¼–è¯‘å’Œå®‰è£… 1make PREFIX=/usr/local/redis/redis01 install 5.æ‹·è´redisé…ç½®æ–‡ä»¶redis.confåˆ°/usr/local/redis/redis01/binç›®å½•ä¸­ 1cp redis.conf /usr/local/redis/redis01/bin 6.ä¿®æ”¹redis.confé…ç½®æ–‡ä»¶ 12port 6379 #redisçš„ç«¯å£daemonize yes #åå°å¯åŠ¨redis 7.å°†redis01å¤åˆ¶ä¸€ä»½ä¸ºredis02 12cd /usr/local/rediscp -r redis01 redis02 8.å°†redis02æ–‡ä»¶æ–‡ä»¶å¤¹ä¸­çš„redis.confè¿›è¡Œä¿®æ”¹ 12port 6378 #redisçš„ç«¯å£daemonize yes #åå°å¯åŠ¨redis 9.åˆ†åˆ«å¯åŠ¨ï¼Œå³å¯è·å–ä¸¤ä¸ªRedis.å¹¶æŸ¥çœ‹ 1ps -ef | grep redis ä½¿ç”¨Nginxå°†è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„RedisæœåŠ¡å™¨ä¸Šã€‚ (2)å‡†å¤‡TomcatæœåŠ¡å™¨. 1.ä¸Šä¼ tomcatçš„å®‰è£…åŒ…ï¼Œapache-tomcat-8.5.56.tar.gz 2.å°†å®‰è£…åŒ…è¿›è¡Œè§£å‹ç¼© 1tar -zxf apache-tomcat-8.5.56.tar.gz 3.è¿›å…¥tomcatçš„binç›®å½• 12cd apache-tomcat-8.5.56/bin./startup nginx.confé…ç½® 1234567891011121314151617stream &#123; upstream redisbackend &#123; server 192.168.200.146:6379; server 192.168.200.146:6378; &#125; upstream tomcatbackend &#123; server 192.168.200.146:8080; &#125; server &#123; listen 81; proxy_pass redisbackend; &#125; server &#123; listen 82; proxy_pass tomcatbackend; &#125;&#125; è®¿é—®æµ‹è¯•ã€‚ Nginxç¼“å­˜é›†æˆ ç¼“å­˜çš„æ¦‚å¿µ ç¼“å­˜å°±æ˜¯æ•°æ®äº¤æ¢çš„ç¼“å†²åŒº(ç§°ä½œ:Cache),å½“ç”¨æˆ·è¦è·å–æ•°æ®çš„æ—¶å€™ï¼Œä¼šå…ˆä»ç¼“å­˜ä¸­å»æŸ¥è¯¢è·å–æ•°æ®ï¼Œå¦‚æœç¼“å­˜ä¸­æœ‰å°±ä¼šç›´æ¥è¿”å›ç»™ç”¨æˆ·ï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰ï¼Œåˆ™ä¼šå‘è¯·æ±‚ä»æœåŠ¡å™¨é‡æ–°æŸ¥è¯¢æ•°æ®ï¼Œå°†æ•°æ®è¿”å›ç»™ç”¨æˆ·çš„åŒæ—¶å°†æ•°æ®æ”¾å…¥ç¼“å­˜ï¼Œä¸‹æ¬¡ç”¨æˆ·å°±ä¼šç›´æ¥ä»ç¼“å­˜ä¸­è·å–æ•°æ®ã€‚ ç¼“å­˜å…¶å®åœ¨å¾ˆå¤šåœºæ™¯ä¸­éƒ½æœ‰ç”¨åˆ°ï¼Œæ¯”å¦‚ï¼š åœºæ™¯ ä½œç”¨ æ“ä½œç³»ç»Ÿç£ç›˜ç¼“å­˜ å‡å°‘ç£ç›˜æœºæ¢°æ“ä½œ æ•°æ®åº“ç¼“å­˜ å‡å°‘æ–‡ä»¶ç³»ç»Ÿçš„IOæ“ä½œ åº”ç”¨ç¨‹åºç¼“å­˜ å‡å°‘å¯¹æ•°æ®åº“çš„æŸ¥è¯¢ WebæœåŠ¡å™¨ç¼“å­˜ å‡å°‘å¯¹åº”ç”¨æœåŠ¡å™¨è¯·æ±‚æ¬¡æ•° æµè§ˆå™¨ç¼“å­˜ å‡å°‘ä¸åå°çš„äº¤äº’æ¬¡æ•° ç¼“å­˜çš„ä¼˜ç‚¹ â€‹ 1.å‡å°‘æ•°æ®ä¼ è¾“ï¼ŒèŠ‚çœç½‘ç»œæµé‡ï¼ŒåŠ å¿«å“åº”é€Ÿåº¦ï¼Œæå‡ç”¨æˆ·ä½“éªŒï¼› â€‹ 2.å‡è½»æœåŠ¡å™¨å‹åŠ›ï¼› â€‹ 3.æä¾›æœåŠ¡ç«¯çš„é«˜å¯ç”¨æ€§ï¼› ç¼“å­˜çš„ç¼ºç‚¹ â€‹ 1.æ•°æ®çš„ä¸ä¸€è‡´ â€‹ 2.å¢åŠ æˆæœ¬ æœ¬æ¬¡è¯¾ç¨‹æ³¨è§£è®²è§£çš„æ˜¯Nginx,Nginxä½œä¸ºwebæœåŠ¡å™¨ï¼ŒNginxä½œä¸ºWebç¼“å­˜æœåŠ¡å™¨ï¼Œå®ƒä»‹äºå®¢æˆ·ç«¯å’Œåº”ç”¨æœåŠ¡å™¨ä¹‹é—´ï¼Œå½“ç”¨æˆ·é€šè¿‡æµè§ˆå™¨è®¿é—®ä¸€ä¸ªURLæ—¶ï¼Œwebç¼“å­˜æœåŠ¡å™¨ä¼šå»åº”ç”¨æœåŠ¡å™¨è·å–è¦å±•ç¤ºç»™ç”¨æˆ·çš„å†…å®¹ï¼Œå°†å†…å®¹ç¼“å­˜åˆ°è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œå½“ä¸‹ä¸€æ¬¡è¯·æ±‚åˆ°æ¥æ—¶ï¼Œå¦‚æœè®¿é—®çš„æ˜¯åŒä¸€ä¸ªURLï¼Œwebç¼“å­˜æœåŠ¡å™¨å°±ä¼šç›´æ¥å°†ä¹‹å‰ç¼“å­˜çš„å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸æ˜¯å‘åº”ç”¨æœåŠ¡å™¨å†æ¬¡å‘é€è¯·æ±‚ã€‚webç¼“å­˜é™ä½äº†åº”ç”¨æœåŠ¡å™¨ã€æ•°æ®åº“çš„è´Ÿè½½ï¼Œå‡å°‘äº†ç½‘ç»œå»¶è¿Ÿï¼Œæé«˜äº†ç”¨æˆ·è®¿é—®çš„å“åº”é€Ÿåº¦ï¼Œå¢å¼ºäº†ç”¨æˆ·çš„ä½“éªŒã€‚ Nginxçš„webç¼“å­˜æœåŠ¡ Nginxæ˜¯ä»0.7.48ç‰ˆå¼€å§‹æä¾›ç¼“å­˜åŠŸèƒ½ã€‚Nginxæ˜¯åŸºäºProxy Storeæ¥å®ç°çš„ï¼Œå…¶åŸç†æ˜¯æŠŠURLåŠç›¸å…³ç»„åˆå½“åšKey,åœ¨ä½¿ç”¨MD5ç®—æ³•å¯¹Keyè¿›è¡Œå“ˆå¸Œï¼Œå¾—åˆ°ç¡¬ç›˜ä¸Šå¯¹åº”çš„å“ˆå¸Œç›®å½•è·¯å¾„ï¼Œä»è€Œå°†ç¼“å­˜å†…å®¹ä¿å­˜åœ¨è¯¥ç›®å½•ä¸­ã€‚å®ƒå¯ä»¥æ”¯æŒä»»æ„URLè¿æ¥ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒ404/301/302è¿™æ ·çš„é200çŠ¶æ€ç ã€‚Nginxå³å¯ä»¥æ”¯æŒå¯¹æŒ‡å®šURLæˆ–è€…çŠ¶æ€ç è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨purgeå‘½ä»¤æ¥æ‰‹åŠ¨æ¸…é™¤æŒ‡å®šURLçš„ç¼“å­˜ã€‚ Nginxç¼“å­˜è®¾ç½®çš„ç›¸å…³æŒ‡ä»¤ Nginxçš„webç¼“å­˜æœåŠ¡ä¸»è¦æ˜¯ä½¿ç”¨ngx_http_proxy_moduleæ¨¡å—ç›¸å…³æŒ‡ä»¤é›†æ¥å®Œæˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æŠŠå¸¸ç”¨çš„æŒ‡ä»¤æ¥è¿›è¡Œä»‹ç»ä¸‹ã€‚ proxy_cache_path è¯¥æŒ‡å®šç”¨äºè®¾ç½®ç¼“å­˜æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ è¯­æ³• proxy_cache_path path [levels=number] keys_zone=zone_name:zone_size [inactive=time][max_size=size]; é»˜è®¤å€¼ â€” ä½ç½® http path:ç¼“å­˜è·¯å¾„åœ°å€,å¦‚ï¼š 1/usr/local/proxy_cache levels: æŒ‡å®šè¯¥ç¼“å­˜ç©ºé—´å¯¹åº”çš„ç›®å½•ï¼Œæœ€å¤šå¯ä»¥è®¾ç½®3å±‚ï¼Œæ¯å±‚å–å€¼ä¸º1|2å¦‚ : 123456levels=1:2 ç¼“å­˜ç©ºé—´æœ‰ä¸¤å±‚ç›®å½•ï¼Œç¬¬ä¸€æ¬¡æ˜¯1ä¸ªå­—æ¯ï¼Œç¬¬äºŒæ¬¡æ˜¯2ä¸ªå­—æ¯ä¸¾ä¾‹è¯´æ˜:itheima[key]é€šè¿‡MD5åŠ å¯†ä»¥åçš„å€¼ä¸º 43c8233266edce38c2c9af0694e2107dlevels=1:2 æœ€ç»ˆçš„å­˜å‚¨è·¯å¾„ä¸º/usr/local/proxy_cache/d/07levels=2:1:2 æœ€ç»ˆçš„å­˜å‚¨è·¯å¾„ä¸º/usr/local/proxy_cache/7d/0/21levels=2:2:2 æœ€ç»ˆçš„å­˜å‚¨è·¯å¾„ä¸º??/usr/local/proxy_cache/7d/10/e2 keys_zone:ç”¨æ¥ä¸ºè¿™ä¸ªç¼“å­˜åŒºè®¾ç½®åç§°å’ŒæŒ‡å®šå¤§å°ï¼Œå¦‚ï¼š 1keys_zone=itcast:200m ç¼“å­˜åŒºçš„åç§°æ˜¯itcast,å¤§å°ä¸º200M,1Må¤§æ¦‚èƒ½å­˜å‚¨8000ä¸ªkeys inactive:æŒ‡å®šç¼“å­˜çš„æ•°æ®å¤šæ¬¡æ—¶é—´æœªè¢«è®¿é—®å°±å°†è¢«åˆ é™¤ï¼Œå¦‚ï¼š 1inactive=1d ç¼“å­˜æ•°æ®åœ¨1å¤©å†…æ²¡æœ‰è¢«è®¿é—®å°±ä¼šè¢«åˆ é™¤ max_size:è®¾ç½®æœ€å¤§ç¼“å­˜ç©ºé—´ï¼Œå¦‚æœç¼“å­˜ç©ºé—´å­˜æ»¡ï¼Œé»˜è®¤ä¼šè¦†ç›–ç¼“å­˜æ—¶é—´æœ€é•¿çš„èµ„æºï¼Œå¦‚: 1max_size=20g é…ç½®å®ä¾‹: 123http&#123; proxy_cache_path /usr/local/proxy_cache keys_zone=itcast:200m levels=1:2:1 inactive=1d max_size=20g;&#125; proxy_cache è¯¥æŒ‡ä»¤ç”¨æ¥å¼€å¯æˆ–å…³é—­ä»£ç†ç¼“å­˜ï¼Œå¦‚æœæ˜¯å¼€å¯åˆ™è‡ªå®šä½¿ç”¨å“ªä¸ªç¼“å­˜åŒºæ¥è¿›è¡Œç¼“å­˜ã€‚ è¯­æ³• proxy_cache zone_name|off; é»˜è®¤å€¼ proxy_cache off; ä½ç½® httpã€serverã€location zone_nameï¼šæŒ‡å®šä½¿ç”¨ç¼“å­˜åŒºçš„åç§° proxy_cache_key è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®webç¼“å­˜çš„keyå€¼ï¼ŒNginxä¼šæ ¹æ®keyå€¼MD5å“ˆå¸Œå­˜ç¼“å­˜ã€‚ è¯­æ³• proxy_cache_key key; é»˜è®¤å€¼ proxy_cache_key $scheme$proxy_host$request_uri; ä½ç½® httpã€serverã€location proxy_cache_valid è¯¥æŒ‡ä»¤ç”¨æ¥å¯¹ä¸åŒè¿”å›çŠ¶æ€ç çš„URLè®¾ç½®ä¸åŒçš„ç¼“å­˜æ—¶é—´ è¯­æ³• proxy_cache_valid [code â€¦] time; é»˜è®¤å€¼ â€” ä½ç½® httpã€serverã€location å¦‚ï¼š 12345proxy_cache_valid 200 302 10m;proxy_cache_valid 404 1m;ä¸º200å’Œ302çš„å“åº”URLè®¾ç½®10åˆ†é’Ÿç¼“å­˜ï¼Œä¸º404çš„å“åº”URLè®¾ç½®1åˆ†é’Ÿç¼“å­˜proxy_cache_valid any 1m;å¯¹æ‰€æœ‰å“åº”çŠ¶æ€ç çš„URLéƒ½è®¾ç½®1åˆ†é’Ÿç¼“å­˜ proxy_cache_min_uses è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®èµ„æºè¢«è®¿é—®å¤šå°‘æ¬¡åè¢«ç¼“å­˜ è¯­æ³• proxy_cache_min_uses number; é»˜è®¤å€¼ proxy_cache_min_uses 1; ä½ç½® httpã€serverã€location proxy_cache_methods è¯¥æŒ‡ä»¤ç”¨æˆ·è®¾ç½®ç¼“å­˜å“ªäº›HTTPæ–¹æ³• è¯­æ³• proxy_cache_methods GET|HEAD|POST; é»˜è®¤å€¼ proxy_cache_methods GET HEAD; ä½ç½® httpã€serverã€location é»˜è®¤ç¼“å­˜HTTPçš„GETå’ŒHEADæ–¹æ³•ï¼Œä¸ç¼“å­˜POSTæ–¹æ³•ã€‚ Nginxç¼“å­˜è®¾ç½®æ¡ˆä¾‹ éœ€æ±‚åˆ†æ æ­¥éª¤å®ç° 1.ç¯å¢ƒå‡†å¤‡ åº”ç”¨æœåŠ¡å™¨çš„ç¯å¢ƒå‡†å¤‡ ï¼ˆ1ï¼‰åœ¨192.168.200.146æœåŠ¡å™¨ä¸Šçš„tomcatçš„webappsä¸‹é¢æ·»åŠ ä¸€ä¸ªjsç›®å½•ï¼Œå¹¶åœ¨jsç›®å½•ä¸­æ·»åŠ ä¸€ä¸ªjquery.jsæ–‡ä»¶ ï¼ˆ2ï¼‰å¯åŠ¨tomcat ï¼ˆ3ï¼‰è®¿é—®æµ‹è¯• 1http://192.168.200.146:8080/js/jquery.js Nginxçš„ç¯å¢ƒå‡†å¤‡ ï¼ˆ1ï¼‰å®ŒæˆNginxåå‘ä»£ç†é…ç½® 123456789101112http&#123; upstream backend&#123; server 192.168.200.146:8080; &#125; server &#123; listen 8080; server_name localhost; location / &#123; proxy_pass http://backend/js/; &#125; &#125;&#125; ï¼ˆ2ï¼‰å®ŒæˆNginxç¼“å­˜é…ç½® 4.æ·»åŠ ç¼“å­˜é…ç½® 1234567891011121314151617181920http&#123; proxy_cache_path /usr/local/proxy_cache levels=2:1 keys_zone=itcast:200m inactive=1d max_size=20g; upstream backend&#123; server 192.168.200.146:8080; &#125; server &#123; listen 8080; server_name localhost; location / &#123; proxy_cache itcast; proxy_cache_key itheima; proxy_cache_min_uses 5; proxy_cache_valid 200 5d; proxy_cache_valid 404 30s; proxy_cache_valid any 1m; add_header nginx-cache &quot;$upstream_cache_status&quot;; proxy_pass http://backend/js/; &#125; &#125;&#125; Nginxç¼“å­˜çš„æ¸…é™¤ æ–¹å¼ä¸€:åˆ é™¤å¯¹åº”çš„ç¼“å­˜ç›®å½• 1rm -rf /usr/local/proxy_cache/...... æ–¹å¼äºŒ:ä½¿ç”¨ç¬¬ä¸‰æ–¹æ‰©å±•æ¨¡å— ngx_cache_purge ï¼ˆ1ï¼‰ä¸‹è½½ngx_cache_purgeæ¨¡å—å¯¹åº”çš„èµ„æºåŒ…ï¼Œå¹¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šã€‚ 1ngx_cache_purge-2.3.tar.gz ï¼ˆ2ï¼‰å¯¹èµ„æºæ–‡ä»¶è¿›è¡Œè§£å‹ç¼© 1tar -zxf ngx_cache_purge-2.3.tar.gz ï¼ˆ3ï¼‰ä¿®æ”¹æ–‡ä»¶å¤¹åç§°ï¼Œæ–¹ä¾¿åæœŸé…ç½® 1mv ngx_cache_purge-2.3 purge ï¼ˆ4ï¼‰æŸ¥è¯¢Nginxçš„é…ç½®å‚æ•° 1nginx -V ï¼ˆ5ï¼‰è¿›å…¥Nginxçš„å®‰è£…ç›®å½•ï¼Œä½¿ç”¨./configureè¿›è¡Œå‚æ•°é…ç½® 1./configure --add-module=/root/nginx/module/purge ï¼ˆ6ï¼‰ä½¿ç”¨makeè¿›è¡Œç¼–è¯‘ 1make ï¼ˆ7ï¼‰å°†nginxå®‰è£…ç›®å½•çš„nginxäºŒçº§åˆ¶å¯æ‰§è¡Œæ–‡ä»¶å¤‡ä»½ 1mv /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginxold ï¼ˆ8ï¼‰å°†ç¼–è¯‘åçš„objsä¸­çš„nginxæ‹·è´åˆ°nginxçš„sbinç›®å½•ä¸‹ 1cp objs/nginx /usr/local/nginx/sbin ï¼ˆ9ï¼‰ä½¿ç”¨makeè¿›è¡Œå‡çº§ 1make upgrade ï¼ˆ10ï¼‰åœ¨nginxé…ç½®æ–‡ä»¶ä¸­è¿›è¡Œå¦‚ä¸‹é…ç½® 12345server&#123; location ~/purge(/.*) &#123; proxy_cache_purge itcast itheima; &#125;&#125; Nginxè®¾ç½®èµ„æºä¸ç¼“å­˜ å‰é¢å’±ä»¬å·²ç»å®Œæˆäº†Nginxä½œä¸ºwebç¼“å­˜æœåŠ¡å™¨çš„ä½¿ç”¨ã€‚ä½†æ˜¯æˆ‘ä»¬å¾—æ€è€ƒä¸€ä¸ªé—®é¢˜å°±æ˜¯ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®éƒ½é€‚åˆè¿›è¡Œç¼“å­˜ã€‚æ¯”å¦‚è¯´å¯¹äºä¸€äº›ç»å¸¸å‘ç”Ÿå˜åŒ–çš„æ•°æ®ã€‚å¦‚æœè¿›è¡Œç¼“å­˜çš„è¯ï¼Œå°±å¾ˆå®¹æ˜“å‡ºç°ç”¨æˆ·è®¿é—®åˆ°çš„æ•°æ®ä¸æ˜¯æœåŠ¡å™¨çœŸå®çš„æ•°æ®ã€‚æ‰€ä»¥å¯¹äºè¿™äº›èµ„æºæˆ‘ä»¬åœ¨ç¼“å­˜çš„è¿‡ç¨‹ä¸­å°±éœ€è¦è¿›è¡Œè¿‡æ»¤ï¼Œä¸è¿›è¡Œç¼“å­˜ã€‚ Nginxä¹Ÿæä¾›äº†è¿™å—çš„åŠŸèƒ½è®¾ç½®ï¼Œéœ€è¦ä½¿ç”¨åˆ°å¦‚ä¸‹ä¸¤ä¸ªæŒ‡ä»¤ proxy_no_cache è¯¥æŒ‡ä»¤æ˜¯ç”¨æ¥å®šä¹‰ä¸å°†æ•°æ®è¿›è¡Œç¼“å­˜çš„æ¡ä»¶ã€‚ è¯­æ³• proxy_no_cache string â€¦; é»˜è®¤å€¼ â€” ä½ç½® httpã€serverã€location é…ç½®å®ä¾‹ 1proxy_no_cache $cookie_nocache $arg_nocache $arg_comment; proxy_cache_bypass è¯¥æŒ‡ä»¤æ˜¯ç”¨æ¥è®¾ç½®ä¸ä»ç¼“å­˜ä¸­è·å–æ•°æ®çš„æ¡ä»¶ã€‚ è¯­æ³• proxy_cache_bypass string â€¦; é»˜è®¤å€¼ â€” ä½ç½® httpã€serverã€location é…ç½®å®ä¾‹ 1proxy_cache_bypass $cookie_nocache $arg_nocache $arg_comment; ä¸Šè¿°ä¸¤ä¸ªæŒ‡ä»¤éƒ½æœ‰ä¸€ä¸ªæŒ‡å®šçš„æ¡ä»¶ï¼Œè¿™ä¸ªæ¡ä»¶å¯ä»¥æ˜¯å¤šä¸ªï¼Œå¹¶ä¸”å¤šä¸ªæ¡ä»¶ä¸­è‡³å°‘æœ‰ä¸€ä¸ªä¸ä¸ºç©ºä¸”ä¸ç­‰äº&quot;0&quot;,åˆ™æ¡ä»¶æ»¡è¶³æˆç«‹ã€‚ä¸Šé¢ç»™çš„é…ç½®å®ä¾‹æ˜¯ä»å®˜æ–¹ç½‘ç«™è·å–çš„ï¼Œé‡Œé¢ä½¿ç”¨åˆ°äº†ä¸‰ä¸ªå˜é‡ï¼Œåˆ†åˆ«æ˜¯$cookie_nocacheã€$arg_nocacheã€$arg_comment $cookie_nocacheã€$arg_nocacheã€$arg_comment è¿™ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä»£è¡¨çš„å«ä¹‰æ˜¯: 1234$cookie_nocacheæŒ‡çš„æ˜¯å½“å‰è¯·æ±‚çš„cookieä¸­é”®çš„åç§°ä¸ºnocacheå¯¹åº”çš„å€¼$arg_nocacheå’Œ$arg_commentæŒ‡çš„æ˜¯å½“å‰è¯·æ±‚çš„å‚æ•°ä¸­å±æ€§åä¸ºnocacheå’Œcommentå¯¹åº”çš„å±æ€§å€¼ æ¡ˆä¾‹æ¼”ç¤ºä¸‹: 1234567891011log_format params $cookie_nocache | $arg_nocache | $arg_commentï¼›server&#123; listen 8081; server_name localhost; location /&#123; access_log logs/access_params.log params; add_header Set-Cookie &#x27;nocache=999&#x27;; root html; index index.html; &#125;&#125; æ¡ˆä¾‹å®ç° è®¾ç½®ä¸ç¼“å­˜èµ„æºçš„é…ç½®æ–¹æ¡ˆ 1234567891011server&#123; listen 8080; server_name localhost; location / &#123; if ($request_uri ~ /.*\\.js$)&#123; set $nocache 1; &#125; proxy_no_cache $nocache $cookie_nocache $arg_nocache $arg_comment; proxy_cache_bypass $nocache $cookie_nocache $arg_nocache $arg_comment; &#125;&#125;","categories":[{"name":"Webå¼€å‘","slug":"Webå¼€å‘","permalink":"http://kaillliu.github.io/categories/Web%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://kaillliu.github.io/tags/Java/"},{"name":"Centos","slug":"Centos","permalink":"http://kaillliu.github.io/tags/Centos/"},{"name":"Linux","slug":"Linux","permalink":"http://kaillliu.github.io/tags/Linux/"}]},{"title":"Nginxå­¦ä¹ ï¼ˆäºŒï¼‰","slug":"Nginxå­¦ä¹ å…¶äºŒ","date":"2022-04-21T08:27:00.000Z","updated":"2022-05-23T05:41:23.080Z","comments":true,"path":"2022/04/21/Nginxå­¦ä¹ å…¶äºŒ/","link":"","permalink":"http://kaillliu.github.io/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E4%BA%8C/","excerpt":"","text":"Nginxè¿›é˜¶ç¯‡ NginxæœåŠ¡å™¨åŸºç¡€é…ç½®å®ä¾‹ å‰é¢æˆ‘ä»¬å·²ç»å¯¹NginxæœåŠ¡å™¨é»˜è®¤é…ç½®æ–‡ä»¶çš„ç»“æ„å’Œæ¶‰åŠçš„åŸºæœ¬æŒ‡ä»¤åšäº†è¯¦ç»†çš„é˜è¿°ã€‚é€šè¿‡è¿™äº›æŒ‡ä»¤çš„åˆç†é…ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©ä¸€å°NginxæœåŠ¡å™¨æ­£å¸¸å·¥ä½œï¼Œå¹¶ä¸”æä¾›åŸºæœ¬çš„webæœåŠ¡å™¨åŠŸèƒ½ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´å’Œæœ€ç®€å•çš„åŸºç¡€é…ç½®å®ä¾‹ï¼Œæ¥å·©å›ºä¸‹å‰é¢æ‰€å­¦ä¹ çš„æŒ‡ä»¤åŠå…¶é…ç½®ã€‚ éœ€æ±‚å¦‚ä¸‹: 1234567891011121314ï¼ˆ1ï¼‰æœ‰å¦‚ä¸‹è®¿é—®ï¼š http://192.168.200.133:8081/server1/location1 è®¿é—®çš„æ˜¯ï¼šindex_sr1_location1.html http://192.168.200.133:8081/server1/location2 è®¿é—®çš„æ˜¯ï¼šindex_sr1_location2.html http://192.168.200.133:8082/server2/location1 è®¿é—®çš„æ˜¯ï¼šindex_sr2_location1.html http://192.168.200.133:8082/server2/location2 è®¿é—®çš„æ˜¯ï¼šindex_sr2_location2.htmlï¼ˆ2ï¼‰å¦‚æœè®¿é—®çš„èµ„æºä¸å­˜åœ¨ï¼Œ è¿”å›è‡ªå®šä¹‰çš„404é¡µé¢ï¼ˆ3ï¼‰å°†/server1å’Œ/server2çš„é…ç½®ä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶åˆ†å‰² å°†æ–‡ä»¶æ”¾åˆ°/home/www/conf.dç›®å½•ä¸‹ï¼Œç„¶åä½¿ç”¨includeè¿›è¡Œåˆå¹¶ï¼ˆ4ï¼‰ä¸º/server1å’Œ/server2å„è‡ªåˆ›å»ºä¸€ä¸ªè®¿é—®æ—¥å¿—æ–‡ä»¶ å‡†å¤‡ç›¸å…³æ–‡ä»¶ï¼Œç›®å½•å¦‚ä¸‹ï¼š é…ç½®çš„å†…å®¹å¦‚ä¸‹: 12345678910111213141516171819202122232425262728293031323334353637383940414243##å…¨å±€å— begin###é…ç½®å…è®¸è¿è¡ŒNginxå·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„user www;#é…ç½®è¿è¡ŒNginxè¿›ç¨‹ç”Ÿæˆçš„workerè¿›ç¨‹æ•°worker_processes 2;#é…ç½®NginxæœåŠ¡å™¨è¿è¡Œå¯¹é”™è¯¯æ—¥å¿—å­˜æ”¾çš„è·¯å¾„error_log logs/error.log;#é…ç½®NginxæœåŠ¡å™¨å…è®¸æ—¶è®°å½•Nginxçš„masterè¿›ç¨‹çš„PIDæ–‡ä»¶è·¯å¾„å’Œåç§°pid logs/nginx.pid;#é…ç½®NginxæœåŠ¡æ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹æ³•å¯åŠ¨#daemon on;##å…¨å±€å— end####eventså— begin##events&#123; #è®¾ç½®Nginxç½‘ç»œè¿æ¥åºåˆ—åŒ– accept_mutex on; #è®¾ç½®Nginxçš„workerè¿›ç¨‹æ˜¯å¦å¯ä»¥åŒæ—¶æ¥æ”¶å¤šä¸ªè¯·æ±‚ multi_accept on; #è®¾ç½®Nginxçš„workerè¿›ç¨‹æœ€å¤§çš„è¿æ¥æ•° worker_connections 1024; #è®¾ç½®Nginxä½¿ç”¨çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹ use epoll;&#125;##eventså— end####httpå— start##http&#123; #å®šä¹‰MIME-Type include mime.types; default_type application/octet-stream; #é…ç½®å…è®¸ä½¿ç”¨sendfileæ–¹å¼è¿è¾“ sendfile on; #é…ç½®è¿æ¥è¶…æ—¶æ—¶é—´ keepalive_timeout 65; #é…ç½®è¯·æ±‚å¤„ç†æ—¥å¿—æ ¼å¼ log_format server1 &#x27;===&gt;server1 access log&#x27;; log_format server2 &#x27;===&gt;server2 access log&#x27;; ##serverå— å¼€å§‹## include /home/www/conf.d/*.conf; ##serverå— ç»“æŸ##&#125;##httpå— end## server1.conf 123456789101112131415161718192021222324server&#123; #é…ç½®ç›‘å¬ç«¯å£å’Œä¸»æœºåç§° listen 8081; server_name localhost; #é…ç½®è¯·æ±‚å¤„ç†æ—¥å¿—å­˜æ”¾è·¯å¾„ access_log /home/www/myweb/server1/logs/access.log server1; #é…ç½®é”™è¯¯é¡µé¢ error_page 404 /404.html; #é…ç½®å¤„ç†/server1/location1è¯·æ±‚çš„location location /server1/location1&#123; root /home/www/myweb; index index_sr1_location1.html; &#125; #é…ç½®å¤„ç†/server1/location2è¯·æ±‚çš„location location /server1/location2&#123; root /home/www/myweb; index index_sr1_location2.html; &#125; #é…ç½®é”™è¯¯é¡µé¢è½¬å‘ location = /404.html &#123; root /home/www/myweb; index 404.html; &#125;&#125; server2.conf 123456789101112131415161718192021222324server&#123; #é…ç½®ç›‘å¬ç«¯å£å’Œä¸»æœºåç§° listen 8082; server_name localhost; #é…ç½®è¯·æ±‚å¤„ç†æ—¥å¿—å­˜æ”¾è·¯å¾„ access_log /home/www/myweb/server2/logs/access.log server2; #é…ç½®é”™è¯¯é¡µé¢,å¯¹404.htmlåšäº†å®šå‘é…ç½® error_page 404 /404.html; #é…ç½®å¤„ç†/server1/location1è¯·æ±‚çš„location location /server2/location1&#123; root /home/www/myweb; index index_sr2_location1.html; &#125; #é…ç½®å¤„ç†/server2/location2è¯·æ±‚çš„location location /server2/location2&#123; root /home/www/myweb; index index_sr2_location2.html; &#125; #é…ç½®é”™è¯¯é¡µé¢è½¬å‘ location = /404.html &#123; root /home/www/myweb; index 404.html; &#125; &#125; è®¿é—®æµ‹è¯•ï¼š NginxæœåŠ¡æ“ä½œçš„é—®é¢˜ ç»è¿‡å‰é¢çš„æ“ä½œï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œå¦‚æœæƒ³è¦å¯åŠ¨ã€å…³é—­æˆ–é‡æ–°åŠ è½½nginxé…ç½®æ–‡ä»¶ï¼Œéƒ½éœ€è¦å…ˆè¿›å…¥åˆ°nginxçš„å®‰è£…ç›®å½•çš„sbinç›®å½•ï¼Œç„¶åä½¿ç”¨nginxçš„äºŒçº§åˆ¶å¯æ‰§è¡Œæ–‡ä»¶æ¥æ“ä½œï¼Œç›¸å¯¹æ¥è¯´æ“ä½œæ¯”è¾ƒç¹çï¼Œè¿™å—è¯¥å¦‚ä½•ä¼˜åŒ–ï¼Ÿå¦å¤–å¦‚æœæˆ‘ä»¬æƒ³æŠŠNginxè®¾ç½®æˆéšç€æœåŠ¡å™¨å¯åŠ¨å°±è‡ªåŠ¨å®Œæˆå¯åŠ¨æ“ä½œï¼Œåˆè¯¥å¦‚ä½•æ¥å®ç°?è¿™å°±éœ€è¦ç”¨åˆ°æ¥ä¸‹æ¥æˆ‘ä»¬è¦è®²è§£çš„ä¸¤ä¸ªçŸ¥è¯†ç‚¹ï¼š 12Nginxé…ç½®æˆç³»ç»ŸæœåŠ¡Nginxå‘½ä»¤é…ç½®åˆ°ç³»ç»Ÿç¯å¢ƒ Nginxé…ç½®æˆç³»ç»ŸæœåŠ¡ æŠŠNginxåº”ç”¨æœåŠ¡è®¾ç½®æˆä¸ºç³»ç»ŸæœåŠ¡ï¼Œæ–¹ä¾¿å¯¹NginxæœåŠ¡çš„å¯åŠ¨å’Œåœæ­¢ç­‰ç›¸å…³æ“ä½œï¼Œå…·ä½“å®ç°æ­¥éª¤: (1) åœ¨/usr/lib/systemd/systemç›®å½•ä¸‹æ·»åŠ nginx.service,å†…å®¹å¦‚ä¸‹: 1vim /usr/lib/systemd/system/nginx.service 12345678910111213141516[Unit]Description=nginx web serviceDocumentation=http://nginx.org/en/docs/After=network.target[Service]Type=forkingPIDFile=/usr/local/nginx/logs/nginx.pidExecStartPre=/usr/local/nginx/sbin/nginx -t -c /usr/local/nginx/conf/nginx.confExecStart=/usr/local/nginx/sbin/nginxExecReload=/usr/local/nginx/sbin/nginx -s reloadExecStop=/usr/local/nginx/sbin/nginx -s stopPrivateTmp=true[Install]WantedBy=default.target (2)æ·»åŠ å®Œæˆåå¦‚æœæƒé™æœ‰é—®é¢˜éœ€è¦è¿›è¡Œæƒé™è®¾ç½® 1chmod 755 /usr/lib/systemd/system/nginx.service (3)ä½¿ç”¨ç³»ç»Ÿå‘½ä»¤æ¥æ“ä½œNginxæœåŠ¡ å¯åŠ¨: systemctl start nginx åœæ­¢: systemctl stop nginx é‡å¯: systemctl restart nginx é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶: systemctl reload nginx æŸ¥çœ‹nginxçŠ¶æ€: systemctl status nginx å¼€æœºå¯åŠ¨: systemctl enable nginx Nginxå‘½ä»¤é…ç½®åˆ°ç³»ç»Ÿç¯å¢ƒ å‰é¢æˆ‘ä»¬ä»‹ç»è¿‡Nginxå®‰è£…ç›®å½•ä¸‹çš„äºŒçº§åˆ¶å¯æ‰§è¡Œæ–‡ä»¶nginxçš„å¾ˆå¤šå‘½ä»¤ï¼Œè¦æƒ³ä½¿ç”¨è¿™äº›å‘½ä»¤å‰ææ˜¯éœ€è¦è¿›å…¥sbinç›®å½•ä¸‹æ‰èƒ½ä½¿ç”¨ï¼Œå¾ˆä¸æ–¹ä¾¿ï¼Œå¦‚ä½•å»ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¯¥äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶åŠ å…¥åˆ°ç³»ç»Ÿçš„ç¯å¢ƒå˜é‡ï¼Œè¿™æ ·çš„è¯åœ¨ä»»ä½•ç›®å½•éƒ½å¯ä»¥ä½¿ç”¨nginxå¯¹åº”çš„ç›¸å…³å‘½ä»¤ã€‚å…·ä½“å®ç°æ­¥éª¤å¦‚ä¸‹: æ¼”ç¤ºå¯åˆ é™¤ 123/usr/local/nginx/sbin/nginx -Vcd /usr/local/nginx/sbin nginx -V#å¦‚ä½•ä¼˜åŒ–ï¼Ÿï¼Ÿï¼Ÿ (1)ä¿®æ”¹/etc/profileæ–‡ä»¶ 123vim /etc/profile#åœ¨æœ€åä¸€è¡Œæ·»åŠ export PATH=$PATH:/usr/local/nginx/sbin (2)ä½¿ä¹‹ç«‹å³ç”Ÿæ•ˆ 1source /etc/profile (3)æ‰§è¡Œnginxå‘½ä»¤ 1nginx -V Nginxé™æ€èµ„æºéƒ¨ç½² Nginxé™æ€èµ„æºæ¦‚è¿° ä¸Šç½‘å»æœç´¢è®¿é—®èµ„æºå¯¹äºæˆ‘ä»¬æ¥è¯´å¹¶ä¸é™Œç”Ÿï¼Œé€šè¿‡æµè§ˆå™¨å‘é€ä¸€ä¸ªHTTPè¯·æ±‚å®ç°ä»å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨ç«¯è·å–æ‰€éœ€è¦å†…å®¹åå¹¶æŠŠå†…å®¹å›æ˜¾å±•ç¤ºåœ¨é¡µé¢çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æ‰€è¯· æ±‚çš„å†…å®¹å°±åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼Œä¸€ç±»æ˜¯é™æ€èµ„æºã€ä¸€ç±»æ˜¯åŠ¨æ€èµ„æºã€‚ é™æ€èµ„æºå³æŒ‡åœ¨æœåŠ¡å™¨ç«¯çœŸå®å­˜åœ¨å¹¶ä¸”èƒ½ç›´æ¥æ‹¿æ¥å±•ç¤ºçš„ä¸€äº›æ–‡ä»¶ï¼Œæ¯”å¦‚å¸¸è§çš„htmlé¡µé¢ã€cssæ–‡ä»¶ã€jsæ–‡ä»¶ã€å›¾ ç‰‡ã€è§†é¢‘ç­‰èµ„æºï¼› åŠ¨æ€èµ„æºå³æŒ‡åœ¨æœåŠ¡å™¨ç«¯çœŸå®å­˜åœ¨ä½†æ˜¯è¦æƒ³è·å–éœ€è¦ç»è¿‡ä¸€å®šçš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œæ ¹æ®ä¸åŒçš„æ¡ä»¶å±•ç¤ºåœ¨é¡µé¢ä¸åŒè¿™ ä¸€éƒ¨åˆ†å†…å®¹ï¼Œæ¯”å¦‚è¯´æŠ¥è¡¨æ•°æ®å±•ç¤ºã€æ ¹æ®å½“å‰ç™»å½•ç”¨æˆ·å±•ç¤ºç›¸å…³å…·ä½“æ•°æ®ç­‰èµ„æºï¼› Nginxå¤„ç†é™æ€èµ„æºçš„å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸‹é¢è¿™å‡ ä¸ªé—®é¢˜ï¼š ï¼ˆ1ï¼‰é™æ€èµ„æºçš„é…ç½®æŒ‡ä»¤ ï¼ˆ2ï¼‰é™æ€èµ„æºçš„é…ç½®ä¼˜åŒ– ï¼ˆ3ï¼‰é™æ€èµ„æºçš„å‹ç¼©é…ç½®æŒ‡ä»¤ ï¼ˆ4ï¼‰é™æ€èµ„æºçš„ç¼“å­˜å¤„ç† ï¼ˆ5ï¼‰é™æ€èµ„æºçš„è®¿é—®æ§åˆ¶ï¼ŒåŒ…æ‹¬è·¨åŸŸé—®é¢˜å’Œé˜²ç›—é“¾é—®é¢˜ Nginxé™æ€èµ„æºçš„é…ç½®æŒ‡ä»¤ listenæŒ‡ä»¤ listen:ç”¨æ¥é…ç½®ç›‘å¬ç«¯å£ã€‚ è¯­æ³• listen address[:port] [default_server]â€¦;listen port [default_server]â€¦; é»˜è®¤å€¼ listen *:80 | *:8000 ä½ç½® server listençš„è®¾ç½®æ¯”è¾ƒçµæ´»ï¼Œæˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­æ¥æŠŠå¸¸ç”¨çš„è®¾ç½®æ–¹å¼ç†Ÿæ‚‰ä¸‹ï¼š 1234listen 127.0.0.1:8000; // listen localhost:8000 ç›‘å¬æŒ‡å®šçš„IPå’Œç«¯å£listen 127.0.0.1; ç›‘å¬æŒ‡å®šIPçš„æ‰€æœ‰ç«¯å£listen 8000; ç›‘å¬æŒ‡å®šç«¯å£ä¸Šçš„è¿æ¥listen *:8000; ç›‘å¬æŒ‡å®šç«¯å£ä¸Šçš„è¿æ¥ default_serverå±æ€§æ˜¯æ ‡è¯†ç¬¦ï¼Œç”¨æ¥å°†æ­¤è™šæ‹Ÿä¸»æœºè®¾ç½®æˆé»˜è®¤ä¸»æœºã€‚æ‰€è°“çš„é»˜è®¤ä¸»æœºæŒ‡çš„æ˜¯å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°å¯¹åº”çš„address:portï¼Œåˆ™ä¼šé»˜è®¤æ‰§è¡Œçš„ã€‚å¦‚æœä¸æŒ‡å®šé»˜è®¤ä½¿ç”¨çš„æ˜¯ç¬¬ä¸€ä¸ªserverã€‚ 1234567891011121314server&#123; listen 8080; server_name 127.0.0.1; location /&#123; root html; index index.html; &#125;&#125;server&#123; listen 8080 default_server; server_name localhost; default_type text/plain; return 444 &#x27;This is a error request&#x27;;&#125; server_nameæŒ‡ä»¤ server_nameï¼šç”¨æ¥è®¾ç½®è™šæ‹Ÿä¸»æœºæœåŠ¡åç§°ã€‚ 127.0.0.1 ã€ localhost ã€åŸŸå[www.baidu.com | www.jd.com] è¯­æ³• server_name name â€¦;nameå¯ä»¥æä¾›å¤šä¸ªä¸­é—´ç”¨ç©ºæ ¼åˆ†éš” é»˜è®¤å€¼ server_name â€œâ€; ä½ç½® server å…³äºserver_nameçš„é…ç½®æ–¹å¼æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯ï¼š 123ç²¾ç¡®åŒ¹é…é€šé…ç¬¦åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… é…ç½®æ–¹å¼ä¸€ï¼šç²¾ç¡®åŒ¹é… å¦‚ï¼š 12345server &#123; listen 80; server_name www.itcast.cn www.itheima.cn; ...&#125; è¡¥å……å°çŸ¥è¯†ç‚¹: 1hostsæ˜¯ä¸€ä¸ªæ²¡æœ‰æ‰©å±•åçš„ç³»ç»Ÿæ–‡ä»¶ï¼Œå¯ä»¥ç”¨è®°äº‹æœ¬ç­‰å·¥å…·æ‰“å¼€ï¼Œå…¶ä½œç”¨å°±æ˜¯å°†ä¸€äº›å¸¸ç”¨çš„ç½‘å€åŸŸåä¸å…¶å¯¹åº”çš„IPåœ°å€å»ºç«‹ä¸€ä¸ªå…³è”â€œæ•°æ®åº“â€ï¼Œå½“ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ªéœ€è¦ç™»å½•çš„ç½‘å€æ—¶ï¼Œç³»ç»Ÿä¼šé¦–å…ˆè‡ªåŠ¨ä»hostsæ–‡ä»¶ä¸­å¯»æ‰¾å¯¹åº”çš„IPåœ°å€ï¼Œä¸€æ—¦æ‰¾åˆ°ï¼Œç³»ç»Ÿä¼šç«‹å³æ‰“å¼€å¯¹åº”ç½‘é¡µï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ç³»ç»Ÿä¼šå†å°†ç½‘å€æäº¤DNSåŸŸåè§£ææœåŠ¡å™¨è¿›è¡ŒIPåœ°å€çš„è§£æã€‚ windows:C:\\Windows\\System32\\drivers\\etc centosï¼š/etc/hosts å› ä¸ºåŸŸåæ˜¯è¦æ”¶å–ä¸€å®šçš„è´¹ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¿®æ”¹hostsæ–‡ä»¶æ¥åˆ¶ä½œä¸€äº›è™šæ‹ŸåŸŸåæ¥ä½¿ç”¨ã€‚éœ€è¦ä¿®æ”¹ /etc/hostsæ–‡ä»¶æ¥æ·»åŠ  123vim /etc/hosts127.0.0.1 www.itcast.cn127.0.0.1 www.itheima.cn é…ç½®æ–¹å¼äºŒ:ä½¿ç”¨é€šé…ç¬¦é…ç½® server_nameä¸­æ”¯æŒé€šé…ç¬¦&quot;*&quot;,ä½†éœ€è¦æ³¨æ„çš„æ˜¯é€šé…ç¬¦ä¸èƒ½å‡ºç°åœ¨åŸŸåçš„ä¸­é—´ï¼Œåªèƒ½å‡ºç°åœ¨é¦–æ®µæˆ–å°¾æ®µï¼Œå¦‚ï¼š 123456server &#123; listen 80; server_name *.itcast.cn www.itheima.*; # www.itcast.cn abc.itcast.cn www.itheima.cn www.itheima.com ...&#125; ä¸‹é¢çš„é…ç½®å°±ä¼šæŠ¥é”™ 12345server &#123; listen 80; server_name www.*.cn www.itheima.c* ...&#125; é…ç½®ä¸‰:ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼é…ç½® server_nameä¸­å¯ä»¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”ä½¿ç”¨~ä½œä¸ºæ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²çš„å¼€å§‹æ ‡è®°ã€‚ å¸¸è§çš„æ­£åˆ™è¡¨è¾¾å¼ ä»£ç  è¯´æ˜ ^ åŒ¹é…æœç´¢å­—ç¬¦ä¸²å¼€å§‹ä½ç½® $ åŒ¹é…æœç´¢å­—ç¬¦ä¸²ç»“æŸä½ç½® . åŒ¹é…é™¤æ¢è¡Œç¬¦\\nä¹‹å¤–çš„ä»»ä½•å•ä¸ªå­—ç¬¦ \\ è½¬ä¹‰å­—ç¬¦ï¼Œå°†ä¸‹ä¸€ä¸ªå­—ç¬¦æ ‡è®°ä¸ºç‰¹æ®Šå­—ç¬¦ [xyz] å­—ç¬¦é›†ï¼Œä¸ä»»æ„ä¸€ä¸ªæŒ‡å®šå­—ç¬¦åŒ¹é… [a-z] å­—ç¬¦èŒƒå›´ï¼ŒåŒ¹é…æŒ‡å®šèŒƒå›´å†…çš„ä»»ä½•å­—ç¬¦ \\w ä¸ä»¥ä¸‹ä»»æ„å­—ç¬¦åŒ¹é… A-Z a-z 0-9 å’Œä¸‹åˆ’çº¿,ç­‰æ•ˆäº[A-Za-z0-9_] \\d æ•°å­—å­—ç¬¦åŒ¹é…ï¼Œç­‰æ•ˆäº[0-9] {n} æ­£å¥½åŒ¹é…næ¬¡ {n,} è‡³å°‘åŒ¹é…næ¬¡ {n,m} åŒ¹é…è‡³å°‘næ¬¡è‡³å¤šmæ¬¡ * é›¶æ¬¡æˆ–å¤šæ¬¡ï¼Œç­‰æ•ˆäº{0,} + ä¸€æ¬¡æˆ–å¤šæ¬¡ï¼Œç­‰æ•ˆäº{1,} ? é›¶æ¬¡æˆ–ä¸€æ¬¡ï¼Œç­‰æ•ˆäº{0,1} é…ç½®å¦‚ä¸‹ï¼š 1234567server&#123; listen 80; server_name ~^www\\.(\\w+)\\.com$; default_type text/plain; return 200 $1 $2 ..;&#125;æ³¨æ„ ~åé¢ä¸èƒ½åŠ ç©ºæ ¼ï¼Œæ‹¬å·å¯ä»¥å–å€¼ åŒ¹é…æ‰§è¡Œé¡ºåº ç”±äºserver_nameæŒ‡ä»¤æ”¯æŒé€šé…ç¬¦å’Œæ­£åˆ™è¡¨è¾¾å¼ï¼Œå› æ­¤åœ¨åŒ…å«å¤šä¸ªè™šæ‹Ÿä¸»æœºçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªåç§°è¢«å¤šä¸ªè™šæ‹Ÿä¸»æœºçš„server_nameåŒ¹é…æˆåŠŸï¼Œå½“é‡åˆ°è¿™ç§æƒ…å†µï¼Œå½“å‰çš„è¯·æ±‚äº¤ç»™è°æ¥å¤„ç†å‘¢ï¼Ÿ 12345678910111213141516171819202122232425262728293031323334server&#123; listen 80; server_name ~^www\\.\\w+\\.com$; default_type text/plain; return 200 &#x27;regex_success&#x27;;&#125;server&#123; listen 80; server_name www.itheima.*; default_type text/plain; return 200 &#x27;wildcard_after_success&#x27;;&#125;server&#123; listen 80; server_name *.itheima.com; default_type text/plain; return 200 &#x27;wildcard_before_success&#x27;;&#125;server&#123; listen 80; server_name www.itheima.com; default_type text/plain; return 200 &#x27;exact_success&#x27;;&#125;server&#123; listen 80 default_server; server_name _; default_type text/plain; return 444 &#x27;default_server not found server&#x27;;&#125; ç»“è®ºï¼š 12345exact_successwildcard_before_successwildcard_after_successregex_successdefault_server not found server!! 123456789No1:å‡†ç¡®åŒ¹é…server_nameNo2:é€šé…ç¬¦åœ¨å¼€å§‹æ—¶åŒ¹é…server_nameæˆåŠŸNo3:é€šé…ç¬¦åœ¨ç»“æŸæ—¶åŒ¹é…server_nameæˆåŠŸNo4:æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…server_nameæˆåŠŸNo5:è¢«é»˜è®¤çš„default_serverå¤„ç†ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šé»˜è®¤æ‰¾ç¬¬ä¸€ä¸ªserver locationæŒ‡ä»¤ 1234567891011server&#123; listen 80; server_name localhost; location / &#123; &#125; location /abc&#123; &#125; ...&#125; location:ç”¨æ¥è®¾ç½®è¯·æ±‚çš„URI è¯­æ³• location [ = | ~ | ~* | ^~ |@ ] uri{â€¦} é»˜è®¤å€¼ â€” ä½ç½® server,location uriå˜é‡æ˜¯å¾…åŒ¹é…çš„è¯·æ±‚å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¹Ÿå¯ä»¥åŒ…å«æ­£åˆ™è¡¨è¾¾å¼ï¼Œé‚£ä¹ˆnginxæœåŠ¡å™¨åœ¨æœç´¢åŒ¹é…locationçš„æ—¶å€™ï¼Œæ˜¯å…ˆä½¿ç”¨ä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…ï¼Œæ‰¾åˆ°ä¸€ä¸ªåŒ¹é…åº¦æœ€é«˜çš„ä¸€ä¸ªï¼Œç„¶ååœ¨é€šè¿‡åŒ…å«æ­£åˆ™è¡¨è¾¾å¼çš„è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœèƒ½åŒ¹é…åˆ°ç›´æ¥è®¿é—®ï¼ŒåŒ¹é…ä¸åˆ°ï¼Œå°±ä½¿ç”¨åˆšæ‰åŒ¹é…åº¦æœ€é«˜çš„é‚£ä¸ªlocationæ¥å¤„ç†è¯·æ±‚ã€‚ å±æ€§ä»‹ç»: ä¸å¸¦ç¬¦å·ï¼Œè¦æ±‚å¿…é¡»ä»¥æŒ‡å®šæ¨¡å¼å¼€å§‹ 12345678910111213server &#123; listen 80; server_name 127.0.0.1; location /abc&#123; default_type text/plain; return 200 &quot;access success&quot;; &#125;&#125;ä»¥ä¸‹è®¿é—®éƒ½æ˜¯æ­£ç¡®çš„http://192.168.200.133/abchttp://192.168.200.133/abc?p1=TOMhttp://192.168.200.133/abc/http://192.168.200.133/abcdef = : ç”¨äºä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼çš„uriå‰ï¼Œå¿…é¡»ä¸æŒ‡å®šçš„æ¨¡å¼ç²¾ç¡®åŒ¹é… 1234567891011121314server &#123; listen 80; server_name 127.0.0.1; location =/abc&#123; default_type text/plain; return 200 &quot;access success&quot;; &#125;&#125;å¯ä»¥åŒ¹é…åˆ°http://192.168.200.133/abchttp://192.168.200.133/abc?p1=TOMåŒ¹é…ä¸åˆ°http://192.168.200.133/abc/http://192.168.200.133/abcdef ~ ï¼š ç”¨äºè¡¨ç¤ºå½“å‰uriä¸­åŒ…å«äº†æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”åŒºåˆ†å¤§å°å†™ ~*: ç”¨äºè¡¨ç¤ºå½“å‰uriä¸­åŒ…å«äº†æ­£åˆ™è¡¨è¾¾å¼ï¼Œå¹¶ä¸”ä¸åŒºåˆ†å¤§å°å†™ æ¢å¥è¯è¯´ï¼Œå¦‚æœuriåŒ…å«äº†æ­£åˆ™è¡¨è¾¾å¼ï¼Œéœ€è¦ç”¨ä¸Šè¿°ä¸¤ä¸ªç¬¦åˆæ¥æ ‡è¯† 12345678910111213141516server &#123; listen 80; server_name 127.0.0.1; location ~^/abc\\w$&#123; default_type text/plain; return 200 &quot;access success&quot;; &#125;&#125;server &#123; listen 80; server_name 127.0.0.1; location ~*^/abc\\w$&#123; default_type text/plain; return 200 &quot;access success&quot;; &#125;&#125; ^~: ç”¨äºä¸åŒ…å«æ­£åˆ™è¡¨è¾¾å¼çš„uriå‰ï¼ŒåŠŸèƒ½å’Œä¸åŠ ç¬¦å·çš„ä¸€è‡´ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œå¦‚æœæ¨¡å¼åŒ¹é…ï¼Œé‚£ä¹ˆå°±åœæ­¢æœç´¢å…¶ä»–æ¨¡å¼äº†ã€‚ 12345678server &#123; listen 80; server_name 127.0.0.1; location ^~/abc&#123; default_type text/plain; return 200 &quot;access success&quot;; &#125;&#125; è®¾ç½®è¯·æ±‚èµ„æºçš„ç›®å½•root / alias rootï¼šè®¾ç½®è¯·æ±‚çš„æ ¹ç›®å½• è¯­æ³• root path; é»˜è®¤å€¼ root html; ä½ç½® httpã€serverã€location pathä¸ºNginxæœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚ä»¥åæŸ¥æ‰¾èµ„æºçš„æ ¹ç›®å½•è·¯å¾„ã€‚ aliasï¼šç”¨æ¥æ›´æ”¹locationçš„URI è¯­æ³• alias path; é»˜è®¤å€¼ â€” ä½ç½® location pathä¸ºä¿®æ”¹åçš„æ ¹è·¯å¾„ã€‚ ä»¥ä¸Šä¸¤ä¸ªæŒ‡ä»¤éƒ½å¯ä»¥æ¥æŒ‡å®šè®¿é—®èµ„æºçš„è·¯å¾„ï¼Œé‚£ä¹ˆè¿™ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«æ˜¯ä»€ä¹ˆ? ä¸¾ä¾‹è¯´æ˜ï¼š ï¼ˆ1ï¼‰åœ¨/usr/local/nginx/htmlç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª imagesç›®å½•,å¹¶åœ¨ç›®å½•ä¸‹æ”¾å…¥ä¸€å¼ å›¾ç‰‡mv.pngå›¾ç‰‡ 123location /images &#123; root /usr/local/nginx/html;&#125; è®¿é—®å›¾ç‰‡çš„è·¯å¾„ä¸º: 1http://192.168.200.133/images/mv.png ï¼ˆ2ï¼‰å¦‚æœæŠŠrootæ”¹ä¸ºalias 123location /images &#123; alias /usr/local/nginx/html;&#125; å†æ¬¡è®¿é—®ä¸Šè¿°åœ°å€ï¼Œé¡µé¢ä¼šå‡ºç°404çš„é”™è¯¯ï¼ŒæŸ¥çœ‹é”™è¯¯æ—¥å¿—ä¼šå‘ç°æ˜¯å› ä¸ºåœ°å€ä¸å¯¹ï¼Œæ‰€ä»¥éªŒè¯äº†ï¼š 1234rootçš„å¤„ç†ç»“æœæ˜¯: rootè·¯å¾„+locationè·¯å¾„/usr/local/nginx/html/images/mv.pngaliasçš„å¤„ç†ç»“æœæ˜¯:ä½¿ç”¨aliasè·¯å¾„æ›¿æ¢locationè·¯å¾„/usr/local/nginx/html/images éœ€è¦åœ¨aliasåé¢è·¯å¾„æ”¹ä¸º 123location /images &#123; alias /usr/local/nginx/html/images;&#125; ï¼ˆ3ï¼‰å¦‚æœlocationè·¯å¾„æ˜¯ä»¥/ç»“å°¾,åˆ™aliasä¹Ÿå¿…é¡»æ˜¯ä»¥/ç»“å°¾ï¼Œrootæ²¡æœ‰è¦æ±‚ å°†ä¸Šè¿°é…ç½®ä¿®æ”¹ä¸º 123location /images/ &#123; alias /usr/local/nginx/html/images;&#125; è®¿é—®å°±ä¼šå‡ºé—®é¢˜ï¼ŒæŸ¥çœ‹é”™è¯¯æ—¥å¿—è¿˜æ˜¯è·¯å¾„ä¸å¯¹ï¼Œæ‰€ä»¥éœ€è¦æŠŠaliasåé¢åŠ ä¸Š / å°ç»“ï¼š 1234rootçš„å¤„ç†ç»“æœæ˜¯: rootè·¯å¾„+locationè·¯å¾„aliasçš„å¤„ç†ç»“æœæ˜¯:ä½¿ç”¨aliasè·¯å¾„æ›¿æ¢locationè·¯å¾„aliasæ˜¯ä¸€ä¸ªç›®å½•åˆ«åçš„å®šä¹‰ï¼Œrootåˆ™æ˜¯æœ€ä¸Šå±‚ç›®å½•çš„å«ä¹‰ã€‚å¦‚æœlocationè·¯å¾„æ˜¯ä»¥/ç»“å°¾,åˆ™aliasä¹Ÿå¿…é¡»æ˜¯ä»¥/ç»“å°¾ï¼Œrootæ²¡æœ‰è¦æ±‚ indexæŒ‡ä»¤ index:è®¾ç½®ç½‘ç«™çš„é»˜è®¤é¦–é¡µ è¯­æ³• index file â€¦; é»˜è®¤å€¼ index index.html; ä½ç½® httpã€serverã€location indexåé¢å¯ä»¥è·Ÿå¤šä¸ªè®¾ç½®ï¼Œå¦‚æœè®¿é—®çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šå…·ä½“è®¿é—®çš„èµ„æºï¼Œåˆ™ä¼šä¾æ¬¡è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸ºæ­¢ã€‚ ä¸¾ä¾‹è¯´æ˜ï¼š 12345location / &#123; root /usr/local/nginx/html; index index.html index.htm;&#125;è®¿é—®è¯¥locationçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ http://ip:port/ï¼Œåœ°å€åé¢å¦‚æœä¸æ·»åŠ ä»»ä½•å†…å®¹ï¼Œåˆ™é»˜è®¤ä¾æ¬¡è®¿é—®index.htmlå’Œindex.htmï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ¥è¿›è¡Œè¿”å› error_pageæŒ‡ä»¤ error_page:è®¾ç½®ç½‘ç«™çš„é”™è¯¯é¡µé¢ è¯­æ³• error_page code â€¦ [=[response]] uri; é»˜è®¤å€¼ â€” ä½ç½® httpã€serverã€locationâ€¦ å½“å‡ºç°å¯¹åº”çš„å“åº”codeåï¼Œå¦‚ä½•æ¥å¤„ç†ã€‚ ä¸¾ä¾‹è¯´æ˜ï¼š ï¼ˆ1ï¼‰å¯ä»¥æŒ‡å®šå…·ä½“è·³è½¬çš„åœ°å€ 123server &#123; error_page 404 http://www.itcast.cn;&#125; ï¼ˆ2ï¼‰å¯ä»¥æŒ‡å®šé‡å®šå‘åœ°å€ 1234567server&#123; error_page 404 /50x.html; error_page 500 502 503 504 /50x.html; location =/50x.html&#123; root html; &#125;&#125; ï¼ˆ3ï¼‰ä½¿ç”¨locationçš„@ç¬¦åˆå®Œæˆé”™è¯¯ä¿¡æ¯å±•ç¤º 1234567server&#123; error_page 404 @jump_to_error; location @jump_to_error &#123; default_type text/plain; return 404 &#x27;Not Found Page...&#x27;; &#125;&#125; å¯é€‰é¡¹=[response]çš„ä½œç”¨æ˜¯ç”¨æ¥å°†ç›¸åº”ä»£ç æ›´æ”¹ä¸ºå¦å¤–ä¸€ä¸ª 1234567server&#123; error_page 404 =200 /50x.html; location =/50x.html&#123; root html; &#125;&#125;è¿™æ ·çš„è¯ï¼Œå½“è¿”å›404æ‰¾ä¸åˆ°å¯¹åº”çš„èµ„æºçš„æ—¶å€™ï¼Œåœ¨æµè§ˆå™¨ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œæœ€ç»ˆè¿”å›çš„çŠ¶æ€ç æ˜¯200ï¼Œè¿™å—éœ€è¦æ³¨æ„ä¸‹ï¼Œç¼–å†™error_pageåé¢çš„å†…å®¹ï¼Œ404åé¢éœ€è¦åŠ ç©ºæ ¼ï¼Œ200å‰é¢ä¸èƒ½åŠ ç©ºæ ¼ é™æ€èµ„æºä¼˜åŒ–é…ç½®è¯­æ³• Nginxå¯¹é™æ€èµ„æºå¦‚ä½•è¿›è¡Œä¼˜åŒ–é…ç½®ã€‚è¿™é‡Œä»ä¸‰ä¸ªå±æ€§é…ç½®è¿›è¡Œä¼˜åŒ–ï¼š 123sendfile on;tcp_nopush on;tcp_nodeplay on; ï¼ˆ1ï¼‰sendï¬leï¼Œç”¨æ¥å¼€å¯é«˜æ•ˆçš„æ–‡ä»¶ä¼ è¾“æ¨¡å¼ã€‚ è¯­æ³• sendï¬le on |oï¬€; é»˜è®¤å€¼ sendï¬le oï¬€; ä½ç½® httpã€serverã€locationâ€¦ è¯·æ±‚é™æ€èµ„æºçš„è¿‡ç¨‹ï¼šå®¢æˆ·ç«¯é€šè¿‡ç½‘ç»œæ¥å£å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼Œæ“ä½œç³»ç»Ÿå°†è¿™äº›å®¢æˆ·ç«¯çš„è¯·æ±‚ä¼ é€’ç»™æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºï¼ŒæœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºä¼šå¤„ç†è¿™äº›è¯·æ±‚ï¼Œè¯·æ±‚å¤„ç†å®Œæˆä»¥åï¼Œæ“ä½œç³»ç»Ÿè¿˜éœ€è¦å°†å¤„ç†å¾—åˆ°çš„ç»“æœé€šè¿‡ç½‘ç»œé€‚é…å™¨ä¼ é€’å›å»ã€‚ å¦‚ï¼š 12345678910server &#123; listen 80; server_name localhostï¼› location / &#123; root html; index index.html; &#125;&#125;åœ¨htmlç›®å½•ä¸‹æœ‰ä¸€ä¸ªwelcome.htmlé¡µé¢ï¼Œè®¿é—®åœ°å€http://192.168.200.133/welcome.html ï¼ˆ2ï¼‰tcp_nopushï¼šè¯¥æŒ‡ä»¤å¿…é¡»åœ¨sendfileæ‰“å¼€çš„çŠ¶æ€ä¸‹æ‰ä¼šç”Ÿæ•ˆï¼Œä¸»è¦æ˜¯ç”¨æ¥æå‡ç½‘ç»œåŒ…çš„ä¼ è¾“â€™æ•ˆç‡â€™ è¯­æ³• tcp_nopush on|off; é»˜è®¤å€¼ tcp_nopush oï¬€; ä½ç½® httpã€serverã€location ï¼ˆ3ï¼‰tcp_nodelayï¼šè¯¥æŒ‡ä»¤å¿…é¡»åœ¨keep-aliveè¿æ¥å¼€å¯çš„æƒ…å†µä¸‹æ‰ç”Ÿæ•ˆï¼Œæ¥æé«˜ç½‘ç»œåŒ…ä¼ è¾“çš„â€™å®æ—¶æ€§â€™ è¯­æ³• tcp_nodelay on|off; é»˜è®¤å€¼ tcp_nodelay on; ä½ç½® httpã€serverã€location ç»è¿‡åˆšæ‰çš„åˆ†æï¼Œâ€œtcp_nopush&quot;å’Œâ€tcp_nodelayâ€œçœ‹èµ·æ¥æ˜¯&quot;äº’æ–¥çš„â€ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦å°†è¿™ä¸¤ä¸ªå€¼éƒ½æ‰“å¼€ï¼Œè¿™ä¸ªå¤§å®¶éœ€è¦çŸ¥é“çš„æ˜¯åœ¨linux2.5.9ä»¥åçš„ç‰ˆæœ¬ä¸­ä¸¤è€…æ˜¯å¯ä»¥å…¼å®¹çš„ï¼Œä¸‰ä¸ªæŒ‡ä»¤éƒ½å¼€å¯çš„å¥½å¤„æ˜¯ï¼Œsendfileå¯ä»¥å¼€å¯é«˜æ•ˆçš„æ–‡ä»¶ä¼ è¾“æ¨¡å¼ï¼Œtcp_nopushå¼€å¯å¯ä»¥ç¡®ä¿åœ¨å‘é€åˆ°å®¢æˆ·ç«¯ä¹‹å‰æ•°æ®åŒ…å·²ç»å……åˆ†â€œå¡«æ»¡â€ï¼Œ è¿™å¤§å¤§å‡å°‘äº†ç½‘ç»œå¼€é”€ï¼Œå¹¶åŠ å¿«äº†æ–‡ä»¶å‘é€çš„é€Ÿåº¦ã€‚ ç„¶åï¼Œå½“å®ƒåˆ°è¾¾æœ€åä¸€ä¸ªå¯èƒ½å› ä¸ºæ²¡æœ‰â€œå¡«æ»¡â€è€Œæš‚åœçš„æ•°æ®åŒ…æ—¶ï¼ŒNginxä¼šå¿½ç•¥tcp_nopushå‚æ•°ï¼Œ ç„¶åï¼Œtcp_nodelayå¼ºåˆ¶å¥—æ¥å­—å‘é€æ•°æ®ã€‚ç”±æ­¤å¯çŸ¥ï¼ŒTCP_NOPUSHå¯ä»¥ä¸TCP_NODELAYä¸€èµ·è®¾ç½®ï¼Œå®ƒæ¯”å•ç‹¬é…ç½®TCP_NODELAYå…·æœ‰æ›´å¼ºçš„æ€§èƒ½ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹é…ç½®æ¥ä¼˜åŒ–Nginxé™æ€èµ„æºçš„å¤„ç† 123sendfile on;tcp_nopush on;tcp_nodelay on; Nginxé™æ€èµ„æºå‹ç¼©å®æˆ˜ ç»è¿‡ä¸Šè¿°å†…å®¹çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬å†æ¬¡æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œå‡å¦‚åœ¨æ»¡è¶³ä¸Šè¿°ä¼˜åŒ–çš„å‰æä¸‹ï¼Œæˆ‘ä»¬ä¼ é€ä¸€ä¸ª1Mçš„æ•°æ®å’Œä¸€ä¸ª10Mçš„æ•°æ®é‚£ä¸ªæ•ˆç‡é«˜?ï¼Œç­”æ¡ˆæ˜¾è€Œæ˜“è§ï¼Œä¼ è¾“å†…å®¹å°ï¼Œé€Ÿåº¦å°±ä¼šå¿«ã€‚é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼ŒåŒæ ·çš„å†…å®¹ï¼Œå¦‚æœæŠŠå¤§å°é™ä¸‹æ¥ï¼Œæˆ‘ä»¬è„‘è¢‹é‡Œé¢è¦è¹¦å‡ºä¸€ä¸ªè¯å°±æ˜¯&quot;å‹ç¼©&quot;ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ Nginxçš„é™æ€èµ„æºå‹ç¼©æ¨¡å—ã€‚ åœ¨Nginxçš„é…ç½®æ–‡ä»¶ä¸­å¯ä»¥é€šè¿‡é…ç½®gzipæ¥å¯¹é™æ€èµ„æºè¿›è¡Œå‹ç¼©ï¼Œç›¸å…³çš„æŒ‡ä»¤å¯ä»¥é…ç½®åœ¨httpå—ã€serverå—å’Œlocationå—ä¸­ï¼ŒNginxå¯ä»¥é€šè¿‡ 123ngx_http_gzip_moduleæ¨¡å—ngx_http_gzip_static_moduleæ¨¡å—ngx_http_gunzip_moduleæ¨¡å— å¯¹è¿™äº›æŒ‡ä»¤è¿›è¡Œè§£æå’Œå¤„ç†ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬ä»ä»¥ä¸‹å†…å®¹è¿›è¡Œå­¦ä¹  1234ï¼ˆ1ï¼‰Gzipå„æ¨¡å—æ”¯æŒçš„é…ç½®æŒ‡ä»¤ï¼ˆ2ï¼‰Gzipå‹ç¼©åŠŸèƒ½çš„é…ç½®ï¼ˆ3ï¼‰Gzipå’Œsendfileçš„å†²çªè§£å†³ï¼ˆ4ï¼‰æµè§ˆå™¨ä¸æ”¯æŒGzipçš„è§£å†³æ–¹æ¡ˆ Gzipæ¨¡å—é…ç½®æŒ‡ä»¤ æ¥ä¸‹æ¥æ‰€å­¦ä¹ çš„æŒ‡ä»¤éƒ½æ¥è‡ªngx_http_gzip_moduleæ¨¡å—ï¼Œè¯¥æ¨¡å—ä¼šåœ¨nginxå®‰è£…çš„æ—¶å€™å†…ç½®åˆ°nginxçš„å®‰è£…ç¯å¢ƒä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›æŒ‡ä»¤ã€‚ gzipæŒ‡ä»¤ï¼šè¯¥æŒ‡ä»¤ç”¨äºå¼€å¯æˆ–è€…å…³é—­gzipåŠŸèƒ½ è¯­æ³• gzip on|off; é»˜è®¤å€¼ gzip off; ä½ç½® httpã€serverã€locationâ€¦ æ³¨æ„åªæœ‰è¯¥æŒ‡ä»¤ä¸ºæ‰“å¼€çŠ¶æ€ï¼Œä¸‹é¢çš„æŒ‡ä»¤æ‰æœ‰æ•ˆæœ 123http&#123; gzip on;&#125; gzip_typesæŒ‡ä»¤ï¼šè¯¥æŒ‡ä»¤å¯ä»¥æ ¹æ®å“åº”é¡µçš„MIMEç±»å‹é€‰æ‹©æ€§åœ°å¼€å¯Gzipå‹ç¼©åŠŸèƒ½ è¯­æ³• gzip_types mime-type â€¦; é»˜è®¤å€¼ gzip_types text/html; ä½ç½® httpã€serverã€location æ‰€é€‰æ‹©çš„å€¼å¯ä»¥ä»mime.typesæ–‡ä»¶ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨&quot;*&quot;ä»£è¡¨æ‰€æœ‰ã€‚ 123http&#123; gzip_types application/javascript;&#125; gzip_comp_levelæŒ‡ä»¤ï¼šè¯¥æŒ‡ä»¤ç”¨äºè®¾ç½®Gzipå‹ç¼©ç¨‹åº¦ï¼Œçº§åˆ«ä»1-9,1è¡¨ç¤ºè¦æ˜¯ç¨‹åº¦æœ€ä½ï¼Œè¦æ˜¯æ•ˆç‡æœ€é«˜ï¼Œ9åˆšå¥½ç›¸åï¼Œå‹ç¼©ç¨‹åº¦æœ€é«˜ï¼Œä½†æ˜¯æ•ˆç‡æœ€ä½æœ€è´¹æ—¶é—´ã€‚ è¯­æ³• gzip_comp_level level; é»˜è®¤å€¼ gzip_comp_level 1; ä½ç½® httpã€serverã€location 123http&#123; gzip_comp_level 6;&#125; gzip_varyæŒ‡ä»¤ï¼šè¯¥æŒ‡ä»¤ç”¨äºè®¾ç½®ä½¿ç”¨Gzipè¿›è¡Œå‹ç¼©å‘é€æ˜¯å¦æºå¸¦â€œVary:Accept-Encodingâ€å¤´åŸŸçš„å“åº”å¤´éƒ¨ã€‚ä¸»è¦æ˜¯å‘Šè¯‰æ¥æ”¶æ–¹ï¼Œæ‰€å‘é€çš„æ•°æ®ç»è¿‡äº†Gzipå‹ç¼©å¤„ç† è¯­æ³• gzip_vary on|off; é»˜è®¤å€¼ gzip_vary off; ä½ç½® httpã€serverã€location gzip_buffersæŒ‡ä»¤ï¼šè¯¥æŒ‡ä»¤ç”¨äºå¤„ç†è¯·æ±‚å‹ç¼©çš„ç¼“å†²åŒºæ•°é‡å’Œå¤§å°ã€‚ è¯­æ³• gzip_buffers number size; é»˜è®¤å€¼ gzip_buffers 32 4k|16 8k; ä½ç½® httpã€serverã€location å…¶ä¸­number:æŒ‡å®šNginxæœåŠ¡å™¨å‘ç³»ç»Ÿç”³è¯·ç¼“å­˜ç©ºé—´ä¸ªæ•°ï¼ŒsizeæŒ‡çš„æ˜¯æ¯ä¸ªç¼“å­˜ç©ºé—´çš„å¤§å°ã€‚ä¸»è¦å®ç°çš„æ˜¯ç”³è¯·numberä¸ªæ¯ä¸ªå¤§å°ä¸ºsizeçš„å†…å­˜ç©ºé—´ã€‚è¿™ä¸ªå€¼çš„è®¾å®šä¸€èˆ¬ä¼šå’ŒæœåŠ¡å™¨çš„æ“ä½œç³»ç»Ÿæœ‰å…³ï¼Œæ‰€ä»¥å»ºè®®æ­¤é¡¹ä¸è®¾ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼å³å¯ã€‚ 1gzip_buffers 4 16K; #ç¼“å­˜ç©ºé—´å¤§å° gzip_disableæŒ‡ä»¤ï¼šé’ˆå¯¹ä¸åŒç§ç±»å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°å¼€å¯å’Œå…³é—­GzipåŠŸèƒ½ã€‚ è¯­æ³• gzip_disable regex â€¦; é»˜è®¤å€¼ â€” ä½ç½® httpã€serverã€location regex:æ ¹æ®å®¢æˆ·ç«¯çš„æµè§ˆå™¨æ ‡å¿—(user-agent)æ¥è®¾ç½®ï¼Œæ”¯æŒä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ã€‚æŒ‡å®šçš„æµè§ˆå™¨æ ‡å¿—ä¸ä½¿ç”¨Gzip.è¯¥æŒ‡ä»¤ä¸€èˆ¬æ˜¯ç”¨æ¥æ’é™¤ä¸€äº›æ˜æ˜¾ä¸æ”¯æŒGzipçš„æµè§ˆå™¨ã€‚ 1gzip_disable &quot;MSIE [1-6]\\.&quot;; gzip_http_versionæŒ‡ä»¤ï¼šé’ˆå¯¹ä¸åŒçš„HTTPåè®®ç‰ˆæœ¬ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°å¼€å¯å’Œå…³é—­GzipåŠŸèƒ½ã€‚ è¯­æ³• gzip_http_version 1.0|1.1; é»˜è®¤å€¼ gzip_http_version 1.1; ä½ç½® httpã€serverã€location è¯¥æŒ‡ä»¤æ˜¯æŒ‡å®šä½¿ç”¨Gzipçš„HTTPæœ€ä½ç‰ˆæœ¬ï¼Œè¯¥æŒ‡ä»¤ä¸€èˆ¬é‡‡ç”¨é»˜è®¤å€¼å³å¯ã€‚ gzip_min_lengthæŒ‡ä»¤ï¼šè¯¥æŒ‡ä»¤é’ˆå¯¹ä¼ è¾“æ•°æ®çš„å¤§å°ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°å¼€å¯å’Œå…³é—­GzipåŠŸèƒ½ è¯­æ³• gzip_min_length length; é»˜è®¤å€¼ gzip_min_length 20; ä½ç½® httpã€serverã€location 12nignxè®¡é‡å¤§å°çš„å•ä½ï¼šbytes[å­—èŠ‚] / kb[åƒå­—èŠ‚] / M[å…†]ä¾‹å¦‚: 1024 / 10k|K / 10m|M Gzipå‹ç¼©åŠŸèƒ½å¯¹å¤§æ•°æ®çš„å‹ç¼©æ•ˆæœæ˜æ˜¾ï¼Œä½†æ˜¯å¦‚æœè¦å‹ç¼©çš„æ•°æ®æ¯”è¾ƒå°çš„åŒ–ï¼Œå¯èƒ½å‡ºç°è¶Šå‹ç¼©æ•°æ®é‡è¶Šå¤§çš„æƒ…å†µï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ ¹æ®å“åº”å†…å®¹çš„å¤§å°æ¥å†³å®šæ˜¯å¦ä½¿ç”¨GzipåŠŸèƒ½ï¼Œå“åº”é¡µé¢çš„å¤§å°å¯ä»¥é€šè¿‡å¤´ä¿¡æ¯ä¸­çš„Content-Lengthæ¥è·å–ã€‚ä½†æ˜¯å¦‚ä½•ä½¿ç”¨äº†Chunkç¼–ç åŠ¨æ€å‹ç¼©ï¼Œè¯¥æŒ‡ä»¤å°†è¢«å¿½ç•¥ã€‚å»ºè®®è®¾ç½®ä¸º1Kæˆ–ä»¥ä¸Šã€‚ gzip_proxiedæŒ‡ä»¤ï¼šè¯¥æŒ‡ä»¤è®¾ç½®æ˜¯å¦å¯¹æœåŠ¡ç«¯è¿”å›çš„ç»“æœè¿›è¡ŒGzipå‹ç¼©ã€‚ è¯­æ³• gzip_proxied off|expired|no-cache|no-store|private|no_last_modified|no_etag|auth|any; é»˜è®¤å€¼ gzip_proxied off; ä½ç½® httpã€serverã€location off - å…³é—­NginxæœåŠ¡å™¨å¯¹åå°æœåŠ¡å™¨è¿”å›ç»“æœçš„Gzipå‹ç¼© expired - å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« â€œExpiresâ€ å¤´ä¿¡æ¯ no-cache - å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« â€œCache-Control:no-cacheâ€ å¤´ä¿¡æ¯ no-store - å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« â€œCache-Control:no-storeâ€ å¤´ä¿¡æ¯ private - å¯ç”¨å‹ç¼©ï¼Œå¦‚æœheaderå¤´ä¸­åŒ…å« â€œCache-Control:privateâ€ å¤´ä¿¡æ¯ no_last_modified - å¯ç”¨å‹ç¼©,å¦‚æœheaderå¤´ä¸­ä¸åŒ…å« â€œLast-Modifiedâ€ å¤´ä¿¡æ¯ no_etag - å¯ç”¨å‹ç¼© ,å¦‚æœheaderå¤´ä¸­ä¸åŒ…å« â€œETagâ€ å¤´ä¿¡æ¯ auth - å¯ç”¨å‹ç¼© , å¦‚æœheaderå¤´ä¸­åŒ…å« â€œAuthorizationâ€ å¤´ä¿¡æ¯ any - æ— æ¡ä»¶å¯ç”¨å‹ç¼© Gzipå‹ç¼©åŠŸèƒ½çš„å®ä¾‹é…ç½® 123456789gzip on; #å¼€å¯gzipåŠŸèƒ½gzip_types *; #å‹ç¼©æºæ–‡ä»¶ç±»å‹,æ ¹æ®å…·ä½“çš„è®¿é—®èµ„æºç±»å‹è®¾å®šgzip_comp_level 6; #gzipå‹ç¼©çº§åˆ«gzip_min_length 1024; #è¿›è¡Œå‹ç¼©å“åº”é¡µé¢çš„æœ€å°é•¿åº¦,content-lengthgzip_buffers 4 16K; #ç¼“å­˜ç©ºé—´å¤§å°gzip_http_version 1.1; #æŒ‡å®šå‹ç¼©å“åº”æ‰€éœ€è¦çš„æœ€ä½HTTPè¯·æ±‚ç‰ˆæœ¬gzip_vary on; #å¾€å¤´ä¿¡æ¯ä¸­æ·»åŠ å‹ç¼©æ ‡è¯†gzip_disable &quot;MSIE [1-6]\\.&quot;; #å¯¹IE6ä»¥ä¸‹çš„ç‰ˆæœ¬éƒ½ä¸è¿›è¡Œå‹ç¼©gzip_proxied offï¼› #nginxä½œä¸ºåå‘ä»£ç†å‹ç¼©æœåŠ¡ç«¯è¿”å›æ•°æ®çš„æ¡ä»¶ è¿™äº›é…ç½®åœ¨å¾ˆå¤šåœ°æ–¹å¯èƒ½éƒ½ä¼šç”¨åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†è¿™äº›å†…å®¹æŠ½å–åˆ°ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡includeæŒ‡ä»¤æŠŠé…ç½®æ–‡ä»¶å†æ¬¡åŠ è½½åˆ°nginx.confé…ç½®æ–‡ä»¶ä¸­ï¼Œæ–¹æ³•ä½¿ç”¨ã€‚ nginx_gzip.conf 123456789gzip on;gzip_types *;gzip_comp_level 6;gzip_min_length 1024;gzip_buffers 4 16K;gzip_http_version 1.1;gzip_vary on;gzip_disable &quot;MSIE [1-6]\\.&quot;;gzip_proxied off; nginx.conf 1include nginx_gzip.conf Gzipå’Œsendfileå…±å­˜é—®é¢˜ å‰é¢åœ¨è®²è§£sendfileçš„æ—¶å€™ï¼Œæåˆ°è¿‡ï¼Œå¼€å¯sendfileä»¥åï¼Œåœ¨è¯»å–ç£ç›˜ä¸Šçš„é™æ€èµ„æºæ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥å‡å°‘æ‹·è´çš„æ¬¡æ•°ï¼Œå¯ä»¥ä¸ç»è¿‡ç”¨æˆ·è¿›ç¨‹å°†é™æ€æ–‡ä»¶é€šè¿‡ç½‘ç»œè®¾å¤‡å‘é€å‡ºå»ï¼Œä½†æ˜¯Gzipè¦æƒ³å¯¹èµ„æºå‹ç¼©ï¼Œæ˜¯éœ€è¦ç»è¿‡ç”¨æˆ·è¿›ç¨‹è¿›è¡Œæ“ä½œçš„ã€‚æ‰€ä»¥å¦‚ä½•è§£å†³ä¸¤ä¸ªè®¾ç½®çš„å…±å­˜é—®é¢˜ã€‚ å¯ä»¥ä½¿ç”¨ngx_http_gzip_static_moduleæ¨¡å—çš„gzip_staticæŒ‡ä»¤æ¥è§£å†³ã€‚ gzip_staticæŒ‡ä»¤ gzip_static: æ£€æŸ¥ä¸è®¿é—®èµ„æºåŒåçš„.gzæ–‡ä»¶æ—¶ï¼Œresponseä¸­ä»¥gzipç›¸å…³çš„headerè¿”å›.gzæ–‡ä»¶çš„å†…å®¹ã€‚ è¯­æ³• gzip_static on | off | always; é»˜è®¤å€¼ gzip_static off; ä½ç½® httpã€serverã€location æ·»åŠ ä¸Šè¿°å‘½ä»¤åï¼Œä¼šæŠ¥ä¸€ä¸ªé”™è¯¯ï¼Œunknown directive &quot;gzip_static&quot;ä¸»è¦çš„åŸå› æ˜¯Nginxé»˜è®¤æ˜¯æ²¡æœ‰æ·»åŠ ngx_http_gzip_static_moduleæ¨¡å—ã€‚å¦‚ä½•æ¥æ·»åŠ ? æ·»åŠ æ¨¡å—åˆ°Nginxçš„å®ç°æ­¥éª¤ (1)æŸ¥è¯¢å½“å‰Nginxçš„é…ç½®å‚æ•° 1nginx -V (2)å°†nginxå®‰è£…ç›®å½•ä¸‹sbinç›®å½•ä¸­çš„nginxäºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œæ›´å 12cd /usr/local/nginx/sbinmv nginx nginxold (3) è¿›å…¥Nginxçš„å®‰è£…ç›®å½• 1cd /root/nginx/core/nginx-1.16.1 (4)æ‰§è¡Œmake cleanæ¸…ç©ºä¹‹å‰ç¼–è¯‘çš„å†…å®¹ 1make clean (5)ä½¿ç”¨configureæ¥é…ç½®å‚æ•° 1./configure --with-http_gzip_static_module (6)ä½¿ç”¨makeå‘½ä»¤è¿›è¡Œç¼–è¯‘ 1make (7) å°†objsç›®å½•ä¸‹çš„nginxäºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ç§»åŠ¨åˆ°nginxå®‰è£…ç›®å½•ä¸‹çš„sbinç›®å½•ä¸­ 1mv objs/nginx /usr/local/nginx/sbin (8)æ‰§è¡Œæ›´æ–°å‘½ä»¤ 1make upgrade gzip_staticæµ‹è¯•ä½¿ç”¨ (1)ç›´æ¥è®¿é—®http://192.168.200.133/jquery.js (2)ä½¿ç”¨gzipå‘½ä»¤è¿›è¡Œå‹ç¼© 12cd /usr/local/nginx/htmlgzip jquery.js (3)å†æ¬¡è®¿é—®http://192.168.200.133/jquery.js é™æ€èµ„æºçš„ç¼“å­˜å¤„ç† ä»€ä¹ˆæ˜¯ç¼“å­˜ 1ç¼“å­˜ï¼ˆcacheï¼‰ï¼ŒåŸå§‹æ„ä¹‰æ˜¯æŒ‡è®¿é—®é€Ÿåº¦æ¯”ä¸€èˆ¬éšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆRAMï¼‰å¿«çš„ä¸€ç§é«˜é€Ÿå­˜å‚¨å™¨ï¼Œé€šå¸¸å®ƒä¸åƒç³»ç»Ÿä¸»å­˜é‚£æ ·ä½¿ç”¨DRAMæŠ€æœ¯ï¼Œè€Œä½¿ç”¨æ˜‚è´µä½†è¾ƒå¿«é€Ÿçš„SRAMæŠ€æœ¯ã€‚ç¼“å­˜çš„è®¾ç½®æ˜¯æ‰€æœ‰ç°ä»£è®¡ç®—æœºç³»ç»Ÿå‘æŒ¥é«˜æ€§èƒ½çš„é‡è¦å› ç´ ä¹‹ä¸€ã€‚ ä»€ä¹ˆæ˜¯webç¼“å­˜ 1Webç¼“å­˜æ˜¯æŒ‡ä¸€ä¸ªWebèµ„æºï¼ˆå¦‚htmlé¡µé¢ï¼Œå›¾ç‰‡ï¼Œjsï¼Œæ•°æ®ç­‰ï¼‰å­˜åœ¨äºWebæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰ä¹‹é—´çš„å‰¯æœ¬ã€‚ç¼“å­˜ä¼šæ ¹æ®è¿›æ¥çš„è¯·æ±‚ä¿å­˜è¾“å‡ºå†…å®¹çš„å‰¯æœ¬ï¼›å½“ä¸‹ä¸€ä¸ªè¯·æ±‚æ¥åˆ°çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯ç›¸åŒçš„URLï¼Œç¼“å­˜ä¼šæ ¹æ®ç¼“å­˜æœºåˆ¶å†³å®šæ˜¯ç›´æ¥ä½¿ç”¨å‰¯æœ¬å“åº”è®¿é—®è¯·æ±‚ï¼Œè¿˜æ˜¯å‘æºæœåŠ¡å™¨å†æ¬¡å‘é€è¯·æ±‚ã€‚æ¯”è¾ƒå¸¸è§çš„å°±æ˜¯æµè§ˆå™¨ä¼šç¼“å­˜è®¿é—®è¿‡ç½‘ç«™çš„ç½‘é¡µï¼Œå½“å†æ¬¡è®¿é—®è¿™ä¸ªURLåœ°å€çš„æ—¶å€™ï¼Œå¦‚æœç½‘é¡µæ²¡æœ‰æ›´æ–°ï¼Œå°±ä¸ä¼šå†æ¬¡ä¸‹è½½ç½‘é¡µï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨æœ¬åœ°ç¼“å­˜çš„ç½‘é¡µã€‚åªæœ‰å½“ç½‘ç«™æ˜ç¡®æ ‡è¯†èµ„æºå·²ç»æ›´æ–°ï¼Œæµè§ˆå™¨æ‰ä¼šå†æ¬¡ä¸‹è½½ç½‘é¡µ webç¼“å­˜çš„ç§ç±» 1234å®¢æˆ·ç«¯ç¼“å­˜ æµè§ˆå™¨ç¼“å­˜æœåŠ¡ç«¯ç¼“å­˜ Nginx / Redis / Memcachedç­‰ æµè§ˆå™¨ç¼“å­˜ 1æ˜¯ä¸ºäº†èŠ‚çº¦ç½‘ç»œçš„èµ„æºåŠ é€Ÿæµè§ˆï¼Œæµè§ˆå™¨åœ¨ç”¨æˆ·ç£ç›˜ä¸Šå¯¹æœ€è¿‘è¯·æ±‚è¿‡çš„æ–‡æ¡£è¿›è¡Œå­˜å‚¨ï¼Œå½“è®¿é—®è€…å†æ¬¡è¯·æ±‚è¿™ä¸ªé¡µé¢æ—¶ï¼Œæµè§ˆå™¨å°±å¯ä»¥ä»æœ¬åœ°ç£ç›˜æ˜¾ç¤ºæ–‡æ¡£ï¼Œè¿™æ ·å°±å¯ä»¥åŠ é€Ÿé¡µé¢çš„é˜…è§ˆ. ä¸ºä»€ä¹ˆè¦ç”¨æµè§ˆå™¨ç¼“å­˜ 1234æˆæœ¬æœ€ä½çš„ä¸€ç§ç¼“å­˜å®ç°å‡å°‘ç½‘ç»œå¸¦å®½æ¶ˆè€—é™ä½æœåŠ¡å™¨å‹åŠ›å‡å°‘ç½‘ç»œå»¶è¿Ÿï¼ŒåŠ å¿«é¡µé¢æ‰“å¼€é€Ÿåº¦ æµè§ˆå™¨ç¼“å­˜çš„æ‰§è¡Œæµç¨‹ HTTPåè®®ä¸­å’Œé¡µé¢ç¼“å­˜ç›¸å…³çš„å­—æ®µï¼Œæˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸‹ï¼š header è¯´æ˜ Expires ç¼“å­˜è¿‡æœŸçš„æ—¥æœŸå’Œæ—¶é—´ Cache-Control è®¾ç½®å’Œç¼“å­˜ç›¸å…³çš„é…ç½®ä¿¡æ¯ Last-Modified è¯·æ±‚èµ„æºæœ€åä¿®æ”¹æ—¶é—´ ETag è¯·æ±‚å˜é‡çš„å®ä½“æ ‡ç­¾çš„å½“å‰å€¼ï¼Œæ¯”å¦‚æ–‡ä»¶çš„MD5å€¼ ï¼ˆ1ï¼‰ç”¨æˆ·é¦–æ¬¡é€šè¿‡æµè§ˆå™¨å‘é€è¯·æ±‚åˆ°æœåŠ¡ç«¯è·å–æ•°æ®ï¼Œå®¢æˆ·ç«¯æ˜¯æ²¡æœ‰å¯¹åº”çš„ç¼“å­˜ï¼Œæ‰€ä»¥éœ€è¦å‘é€requestè¯·æ±‚æ¥è·å–æ•°æ®ï¼› ï¼ˆ2ï¼‰æœåŠ¡ç«¯æ¥æ”¶åˆ°è¯·æ±‚åï¼Œè·å–æœåŠ¡ç«¯çš„æ•°æ®åŠæœåŠ¡ç«¯ç¼“å­˜çš„å…è®¸åï¼Œè¿”å›200çš„æˆåŠŸçŠ¶æ€ç å¹¶ä¸”åœ¨å“åº”å¤´ä¸Šé™„ä¸Šå¯¹åº”èµ„æºä»¥åŠç¼“å­˜ä¿¡æ¯ï¼› ï¼ˆ3ï¼‰å½“ç”¨æˆ·å†æ¬¡è®¿é—®ç›¸åŒèµ„æºçš„æ—¶å€™ï¼Œå®¢æˆ·ç«¯ä¼šåœ¨æµè§ˆå™¨çš„ç¼“å­˜ç›®å½•ä¸­æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨å“åº”çš„ç¼“å­˜æ–‡ä»¶ ï¼ˆ4ï¼‰å¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç¼“å­˜æ–‡ä»¶ï¼Œåˆ™èµ°(2)æ­¥ ï¼ˆ5ï¼‰å¦‚æœæœ‰ç¼“å­˜æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥å¯¹ç¼“å­˜æ–‡ä»¶æ˜¯å¦è¿‡æœŸè¿›è¡Œåˆ¤æ–­ï¼Œè¿‡æœŸçš„åˆ¤æ–­æ ‡å‡†æ˜¯(Expires), ï¼ˆ6ï¼‰å¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œåˆ™ç›´æ¥ä»æœ¬åœ°ç¼“å­˜ä¸­è¿”å›æ•°æ®è¿›è¡Œå±•ç¤º ï¼ˆ7ï¼‰å¦‚æœExpiresè¿‡æœŸï¼Œæ¥ä¸‹æ¥éœ€è¦åˆ¤æ–­ç¼“å­˜æ–‡ä»¶æ˜¯å¦å‘ç”Ÿè¿‡å˜åŒ– ï¼ˆ8ï¼‰åˆ¤æ–­çš„æ ‡å‡†æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ETag(Entity Tag),ä¸€ä¸ªæ˜¯Last-Modified ï¼ˆ9ï¼‰åˆ¤æ–­ç»“æœæ˜¯æœªå‘ç”Ÿå˜åŒ–ï¼Œåˆ™æœåŠ¡ç«¯è¿”å›304ï¼Œç›´æ¥ä»ç¼“å­˜æ–‡ä»¶ä¸­è·å–æ•°æ® ï¼ˆ10ï¼‰å¦‚æœåˆ¤æ–­æ˜¯å‘ç”Ÿäº†å˜åŒ–ï¼Œé‡æ–°ä»æœåŠ¡ç«¯è·å–æ•°æ®ï¼Œå¹¶æ ¹æ®ç¼“å­˜åå•†(æœåŠ¡ç«¯æ‰€è®¾ç½®çš„æ˜¯å¦éœ€è¦è¿›è¡Œç¼“å­˜æ•°æ®çš„è®¾ç½®)æ¥è¿›è¡Œæ•°æ®ç¼“å­˜ã€‚ æµè§ˆå™¨ç¼“å­˜ç›¸å…³æŒ‡ä»¤ Nginxéœ€è¦è¿›è¡Œç¼“å­˜ç›¸å…³è®¾ç½®ï¼Œå°±éœ€è¦ç”¨åˆ°å¦‚ä¸‹çš„æŒ‡ä»¤ expiresæŒ‡ä»¤ expires:è¯¥æŒ‡ä»¤ç”¨æ¥æ§åˆ¶é¡µé¢ç¼“å­˜çš„ä½œç”¨ã€‚å¯ä»¥é€šè¿‡è¯¥æŒ‡ä»¤æ§åˆ¶HTTPåº”ç­”ä¸­çš„â€œExpires&quot;å’Œâ€Cache-Control&quot; è¯­æ³• expires [modified] timeexpires epoch|max|off; é»˜è®¤å€¼ expires off; ä½ç½® httpã€serverã€location time:å¯ä»¥æ•´æ•°ä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ï¼ŒæŒ‡å®šè¿‡æœŸæ—¶é—´ï¼Œå¦‚æœæ˜¯è´Ÿæ•°ï¼ŒCache-Controlåˆ™ä¸ºno-cache,å¦‚æœä¸ºæ•´æ•°æˆ–0ï¼Œåˆ™Cache-Controlçš„å€¼ä¸ºmax-age=time; epoch: æŒ‡å®šExpiresçš„å€¼ä¸ºâ€™1 January,1970,00:00:01 GMTâ€™(1970-01-01 00:00:00)ï¼ŒCache-Controlçš„å€¼no-cache max:æŒ‡å®šExpiresçš„å€¼ä¸ºâ€™31 December2037 23:59:59GMTâ€™ (2037-12-31 23:59:59) ï¼ŒCache-Controlçš„å€¼ä¸º10å¹´ off:é»˜è®¤ä¸ç¼“å­˜ã€‚ add_headeræŒ‡ä»¤ add_headeræŒ‡ä»¤æ˜¯ç”¨æ¥æ·»åŠ æŒ‡å®šçš„å“åº”å¤´å’Œå“åº”å€¼ã€‚ è¯­æ³• add_header name value [always]; é»˜è®¤å€¼ â€” ä½ç½® httpã€serverã€locationâ€¦ Cache-Controlä½œä¸ºå“åº”å¤´ä¿¡æ¯ï¼Œå¯ä»¥è®¾ç½®å¦‚ä¸‹å€¼ï¼š ç¼“å­˜å“åº”æŒ‡ä»¤ï¼š 123456789Cache-control: must-revalidateCache-control: no-cacheCache-control: no-storeCache-control: no-transformCache-control: publicCache-control: privateCache-control: proxy-revalidateCache-Control: max-age=&lt;seconds&gt;Cache-control: s-maxage=&lt;seconds&gt; æŒ‡ä»¤ è¯´æ˜ must-revalidate å¯ç¼“å­˜ä½†å¿…é¡»å†å‘æºæœåŠ¡å™¨è¿›è¡Œç¡®è®¤ no-cache ç¼“å­˜å‰å¿…é¡»ç¡®è®¤å…¶æœ‰æ•ˆæ€§ no-store ä¸ç¼“å­˜è¯·æ±‚æˆ–å“åº”çš„ä»»ä½•å†…å®¹ no-transform ä»£ç†ä¸å¯æ›´æ”¹åª’ä½“ç±»å‹ public å¯å‘ä»»æ„æ–¹æä¾›å“åº”çš„ç¼“å­˜ private ä»…å‘ç‰¹å®šç”¨æˆ·è¿”å›å“åº” proxy-revalidate è¦æ±‚ä¸­é—´ç¼“å­˜æœåŠ¡å™¨å¯¹ç¼“å­˜çš„å“åº”æœ‰æ•ˆæ€§å†è¿›è¡Œç¡®è®¤ max-age=&lt;ç§’&gt; å“åº”æœ€å¤§Ageå€¼ s-maxage=&lt;ç§’&gt; å…¬å…±ç¼“å­˜æœåŠ¡å™¨å“åº”çš„æœ€å¤§Ageå€¼ max-age=[ç§’]ï¼š Nginxçš„è·¨åŸŸé—®é¢˜è§£å†³ è¿™å—å†…å®¹ï¼Œæˆ‘ä»¬ä¸»è¦ä»ä»¥ä¸‹æ–¹é¢è¿›è¡Œè§£å†³ï¼š 123ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°è·¨åŸŸé—®é¢˜?å®ä¾‹æ¼”ç¤ºè·¨åŸŸé—®é¢˜å…·ä½“çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆ? åŒæºç­–ç•¥ æµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼šæ˜¯ä¸€ç§çº¦å®šï¼Œæ˜¯æµè§ˆå™¨æœ€æ ¸å¿ƒä¹Ÿæ˜¯æœ€åŸºæœ¬çš„å®‰å…¨åŠŸèƒ½ï¼Œå¦‚æœæµè§ˆå™¨å°‘äº†åŒæºç­–ç•¥ï¼Œåˆ™æµè§ˆå™¨çš„æ­£å¸¸åŠŸèƒ½å¯èƒ½éƒ½ä¼šå—åˆ°å½±å“ã€‚ åŒæº: åè®®ã€åŸŸå(IP)ã€ç«¯å£ç›¸åŒå³ä¸ºåŒæº 1234567891011121314151617181920212223http://192.168.200.131/user/1https://192.168.200.131/user/1ä¸http://192.168.200.131/user/1http://192.168.200.132/user/1ä¸http://192.168.200.131/user/1http://192.168.200.131:8080/user/1ä¸http://www.nginx.com/user/1http://www.nginx.org/user/1ä¸http://192.168.200.131/user/1http://192.168.200.131:8080/user/1ä¸http://www.nginx.org:80/user/1http://www.nginx.org/user/1æ»¡è¶³ è·¨åŸŸé—®é¢˜ ç®€å•æè¿°ä¸‹: 1æœ‰ä¸¤å°æœåŠ¡å™¨åˆ†åˆ«ä¸ºA,B,å¦‚æœä»æœåŠ¡å™¨Açš„é¡µé¢å‘é€å¼‚æ­¥è¯·æ±‚åˆ°æœåŠ¡å™¨Bè·å–æ•°æ®ï¼Œå¦‚æœæœåŠ¡å™¨Aå’ŒæœåŠ¡å™¨Bä¸æ»¡è¶³åŒæºç­–ç•¥ï¼Œåˆ™å°±ä¼šå‡ºç°è·¨åŸŸé—®é¢˜ã€‚ è·¨åŸŸé—®é¢˜çš„æ¡ˆä¾‹æ¼”ç¤º å‡ºç°è·¨åŸŸé—®é¢˜ä¼šæœ‰ä»€ä¹ˆæ•ˆæœ?,æ¥ä¸‹æ¥é€šè¿‡ä¸€ä¸ªéœ€æ±‚æ¥ç»™å¤§å®¶æ¼”ç¤ºä¸‹ï¼š ï¼ˆ1ï¼‰nginxçš„htmlç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªa.html 1234567891011121314151617181920&lt;html&gt; &lt;head&gt; &lt;meta charset=&quot;utf-8&quot;&gt; &lt;title&gt;è·¨åŸŸé—®é¢˜æ¼”ç¤º&lt;/title&gt; &lt;script src=&quot;jquery.js&quot;&gt;&lt;/script&gt; &lt;script&gt; $(function()&#123; $(&quot;#btn&quot;).click(function()&#123; $.get(&#x27;http://192.168.200.133:8080/getUser&#x27;,function(data)&#123; alert(JSON.stringify(data)); &#125;); &#125;); &#125;); &lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;input type=&quot;button&quot; value=&quot;è·å–æ•°æ®&quot; id=&quot;btn&quot;/&gt; &lt;/body&gt;&lt;/html&gt; ï¼ˆ2ï¼‰åœ¨nginx.confé…ç½®å¦‚ä¸‹å†…å®¹ 12345678910111213141516server&#123; listen 8080; server_name localhost; location /getUser&#123; default_type application/json; return 200 &#x27;&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;TOM&quot;,&quot;age&quot;:18&#125;&#x27;; &#125;&#125;server&#123; listen 80; server_name localhost; location /&#123; root html; index index.html; &#125;&#125; (3)é€šè¿‡æµè§ˆå™¨è®¿é—®æµ‹è¯• è§£å†³æ–¹æ¡ˆ ä½¿ç”¨add_headeræŒ‡ä»¤ï¼Œè¯¥æŒ‡ä»¤å¯ä»¥ç”¨æ¥æ·»åŠ ä¸€äº›å¤´ä¿¡æ¯ è¯­æ³• add_header name valueâ€¦ é»˜è®¤å€¼ â€” ä½ç½® httpã€serverã€location æ­¤å¤„ç”¨æ¥è§£å†³è·¨åŸŸé—®é¢˜ï¼Œéœ€è¦æ·»åŠ ä¸¤ä¸ªå¤´ä¿¡æ¯ï¼Œä¸€ä¸ªæ˜¯Access-Control-Allow-Origin,Access-Control-Allow-Methods Access-Control-Allow-Origin: ç›´è¯‘è¿‡æ¥æ˜¯å…è®¸è·¨åŸŸè®¿é—®çš„æºåœ°å€ä¿¡æ¯ï¼Œå¯ä»¥é…ç½®å¤šä¸ª(å¤šä¸ªç”¨é€—å·åˆ†éš”)ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨*ä»£è¡¨æ‰€æœ‰æº Access-Control-Allow-Methods:ç›´è¯‘è¿‡æ¥æ˜¯å…è®¸è·¨åŸŸè®¿é—®çš„è¯·æ±‚æ–¹å¼ï¼Œå€¼å¯ä»¥ä¸º GET POST PUT DELETEâ€¦,å¯ä»¥å…¨éƒ¨è®¾ç½®ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®ï¼Œå¤šä¸ªç”¨é€—å·åˆ†éš” å…·ä½“é…ç½®æ–¹å¼ 123456location /getUser&#123; add_header Access-Control-Allow-Origin *; add_header Access-Control-Allow-Methods GET,POST,PUT,DELETE; default_type application/json; return 200 &#x27;&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;TOM&quot;,&quot;age&quot;:18&#125;&#x27;;&#125; é™æ€èµ„æºé˜²ç›—é“¾ ä»€ä¹ˆæ˜¯èµ„æºç›—é“¾ èµ„æºç›—é“¾æŒ‡çš„æ˜¯æ­¤å†…å®¹ä¸åœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šï¼Œè€Œæ˜¯é€šè¿‡æŠ€æœ¯æ‰‹æ®µï¼Œç»•è¿‡åˆ«äººçš„é™åˆ¶å°†åˆ«äººçš„å†…å®¹æ”¾åˆ°è‡ªå·±é¡µé¢ä¸Šæœ€ç»ˆå±•ç¤ºç»™ç”¨æˆ·ã€‚ä»¥æ­¤æ¥ç›—å–å¤§ç½‘ç«™çš„ç©ºé—´å’Œæµé‡ã€‚ç®€è€Œè¨€ä¹‹å°±æ˜¯ç”¨åˆ«äººçš„ä¸œè¥¿æˆå°±è‡ªå·±çš„ç½‘ç«™ã€‚ æ•ˆæœæ¼”ç¤º äº¬ä¸œ:https://img14.360buyimg.com/n7/jfs/t1/101062/37/2153/254169/5dcbd410E6d10ba22/4ddbd212be225fcd.jpg ç™¾åº¦:https://pics7.baidu.com/feed/cf1b9d16fdfaaf516f7e2011a7cda1e8f11f7a1a.jpeg?token=551979a23a0995e5e5279b8fa1a48b34&amp;s=BD385394D2E963072FD48543030030BB æˆ‘ä»¬è‡ªå·±å‡†å¤‡ä¸€ä¸ªé¡µé¢ï¼Œåœ¨é¡µé¢ä¸Šå¼•å…¥è¿™ä¸¤ä¸ªå›¾ç‰‡æŸ¥çœ‹æ•ˆæœ ä»ä¸Šé¢çš„æ•ˆæœï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œä¸‹é¢çš„å›¾ç‰‡åœ°å€æ·»åŠ äº†é˜²æ­¢ç›—é“¾çš„åŠŸèƒ½ï¼Œäº¬ä¸œè¿™è¾¹æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨å…¶å›¾ç‰‡ã€‚ Nginxé˜²ç›—é“¾çš„å®ç°åŸç†ï¼š äº†è§£é˜²ç›—é“¾çš„åŸç†ä¹‹å‰ï¼Œæˆ‘ä»¬å¾—å…ˆå­¦ä¹ ä¸€ä¸ªHTTPçš„å¤´ä¿¡æ¯Referer,å½“æµè§ˆå™¨å‘webæœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½ä¼šå¸¦ä¸ŠReferer,æ¥å‘Šè¯‰æµè§ˆå™¨è¯¥ç½‘é¡µæ˜¯ä»å“ªä¸ªé¡µé¢é“¾æ¥è¿‡æ¥çš„ã€‚ åå°æœåŠ¡å™¨å¯ä»¥æ ¹æ®è·å–åˆ°çš„è¿™ä¸ªRefererä¿¡æ¯æ¥åˆ¤æ–­æ˜¯å¦ä¸ºè‡ªå·±ä¿¡ä»»çš„ç½‘ç«™åœ°å€ï¼Œå¦‚æœæ˜¯åˆ™æ”¾è¡Œç»§ç»­è®¿é—®ï¼Œå¦‚æœä¸æ˜¯åˆ™å¯ä»¥è¿”å›403(æœåŠ¡ç«¯æ‹’ç»è®¿é—®)çš„çŠ¶æ€ä¿¡æ¯ã€‚ åœ¨æœ¬åœ°æ¨¡æ‹Ÿä¸Šè¿°çš„æœåŠ¡å™¨æ•ˆæœï¼š Nginxé˜²ç›—é“¾çš„å…·ä½“å®ç°: valid_referers:nginxä¼šé€šå°±è¿‡æŸ¥çœ‹refererè‡ªåŠ¨å’Œvalid_referersåé¢çš„å†…å®¹è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ°äº†å°±å°†$invalid_refererå˜é‡ç½®0ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ï¼Œåˆ™å°†$invalid_refererå˜é‡ç½®ä¸º1ï¼ŒåŒ¹é…çš„è¿‡ç¨‹ä¸­ä¸åŒºåˆ†å¤§å°å†™ã€‚ è¯­æ³• valid_referers none|blocked|server_names|stringâ€¦ é»˜è®¤å€¼ â€” ä½ç½® serverã€location none: å¦‚æœHeaderä¸­çš„Refererä¸ºç©ºï¼Œå…è®¸è®¿é—® blocked:åœ¨Headerä¸­çš„Refererä¸ä¸ºç©ºï¼Œä½†æ˜¯è¯¥å€¼è¢«é˜²ç«å¢™æˆ–ä»£ç†è¿›è¡Œä¼ªè£…è¿‡ï¼Œå¦‚ä¸å¸¦&quot;http://&quot; ã€&quot;https://&quot;ç­‰åè®®å¤´çš„èµ„æºå…è®¸è®¿é—®ã€‚ server_names:æŒ‡å®šå…·ä½“çš„åŸŸåæˆ–è€…IP string: å¯ä»¥æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼å’Œ*çš„å­—ç¬¦ä¸²ã€‚å¦‚æœæ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œéœ€è¦ä»¥~å¼€å¤´è¡¨ç¤ºï¼Œä¾‹å¦‚ 12345678location ~*\\.(png|jpg|gif)&#123; valid_referers none blocked www.baidu.com 192.168.200.222 *.example.com example.* www.example.org ~\\.google\\.; if ($invalid_referer)&#123; return 403; &#125; root /usr/local/nginx/html;&#125; é‡åˆ°çš„é—®é¢˜:å›¾ç‰‡æœ‰å¾ˆå¤šï¼Œè¯¥å¦‚ä½•æ‰¹é‡è¿›è¡Œé˜²ç›—é“¾ï¼Ÿ é’ˆå¯¹ç›®å½•è¿›è¡Œé˜²ç›—é“¾ é…ç½®å¦‚ä¸‹ï¼š 12345678location /images &#123; valid_referers none blocked www.baidu.com 192.168.200.222 *.example.com example.* www.example.org ~\\.google\\.; if ($invalid_referer)&#123; return 403; &#125; root /usr/local/nginx/html;&#125; è¿™æ ·æˆ‘ä»¬å¯ä»¥å¯¹ä¸€ä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰èµ„æºè¿›è¡Œç¿»åˆ°äº†æ“ä½œã€‚ é‡åˆ°çš„é—®é¢˜ï¼šRefererçš„é™åˆ¶æ¯”è¾ƒç²—ï¼Œæ¯”å¦‚éšæ„åŠ ä¸€ä¸ªRefererï¼Œä¸Šé¢çš„æ–¹å¼æ˜¯æ— æ³•è¿›è¡Œé™åˆ¶çš„ã€‚é‚£ä¹ˆè¿™ä¸ªé—®é¢˜æ”¹å¦‚ä½•è§£å†³ï¼Ÿ æ­¤å¤„æˆ‘ä»¬éœ€è¦ç”¨åˆ°Nginxçš„ç¬¬ä¸‰æ–¹æ¨¡å—ngx_http_accesskey_moduleï¼Œç¬¬ä¸‰æ–¹æ¨¡å—å¦‚ä½•å®ç°ç›—é“¾ï¼Œå¦‚æœåœ¨Nginxä¸­ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—çš„åŠŸèƒ½ï¼Œè¿™äº›æˆ‘ä»¬åœ¨åé¢çš„Nginxçš„æ¨¡å—ç¯‡å†è¿›è¡Œè¯¦ç»†çš„è®²è§£ã€‚ RewriteåŠŸèƒ½é…ç½® Rewriteæ˜¯NginxæœåŠ¡å™¨æä¾›çš„ä¸€ä¸ªé‡è¦åŸºæœ¬åŠŸèƒ½ï¼Œæ˜¯WebæœåŠ¡å™¨äº§å“ä¸­å‡ ä¹å¿…å¤‡çš„åŠŸèƒ½ã€‚ä¸»è¦çš„ä½œç”¨æ˜¯ç”¨æ¥å®ç°URLçš„é‡å†™ã€‚ æ³¨æ„:NginxæœåŠ¡å™¨çš„RewriteåŠŸèƒ½çš„å®ç°ä¾èµ–äºPCREçš„æ”¯æŒï¼Œå› æ­¤åœ¨ç¼–è¯‘å®‰è£…NginxæœåŠ¡å™¨ä¹‹å‰ï¼Œéœ€è¦å®‰è£…PCREåº“ã€‚Nginxä½¿ç”¨çš„æ˜¯ngx_http_rewrite_moduleæ¨¡å—æ¥è§£æå’Œå¤„ç†RewriteåŠŸèƒ½çš„ç›¸å…³é…ç½®ã€‚ â€œåœ°å€é‡å†™&quot;ä¸&quot;åœ°å€è½¬å‘â€ é‡å†™å’Œè½¬å‘çš„åŒºåˆ«: 12345åœ°å€é‡å†™æµè§ˆå™¨åœ°å€ä¼šå‘ç”Ÿå˜åŒ–è€Œåœ°å€è½¬å‘åˆ™ä¸å˜ä¸€æ¬¡åœ°å€é‡å†™ä¼šäº§ç”Ÿä¸¤æ¬¡è¯·æ±‚è€Œä¸€æ¬¡åœ°å€è½¬å‘åªä¼šäº§ç”Ÿä¸€æ¬¡è¯·æ±‚åœ°å€é‡å†™åˆ°çš„é¡µé¢å¿…é¡»æ˜¯ä¸€ä¸ªå®Œæ•´çš„è·¯å¾„è€Œåœ°å€è½¬å‘åˆ™ä¸éœ€è¦åœ°å€é‡å†™å› ä¸ºæ˜¯ä¸¤æ¬¡è¯·æ±‚æ‰€ä»¥requestèŒƒå›´å†…å±æ€§ä¸èƒ½ä¼ é€’ç»™æ–°é¡µé¢è€Œåœ°å€è½¬å‘å› ä¸ºæ˜¯ä¸€æ¬¡è¯·æ±‚æ‰€ä»¥å¯ä»¥ä¼ é€’å€¼åœ°å€è½¬å‘é€Ÿåº¦å¿«äºåœ°å€é‡å†™ Rewriteè§„åˆ™ setæŒ‡ä»¤ è¯¥æŒ‡ä»¤ç”¨æ¥è®¾ç½®ä¸€ä¸ªæ–°çš„å˜é‡ã€‚ è¯­æ³• set $variable value; é»˜è®¤å€¼ â€” ä½ç½® serverã€locationã€if variable:å˜é‡çš„åç§°ï¼Œè¯¥å˜é‡åç§°è¦ç”¨&quot;$&quot;ä½œä¸ºå˜é‡çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ï¼Œä¸”ä¸èƒ½ä¸NginxæœåŠ¡å™¨é¢„è®¾çš„å…¨å±€å˜é‡åŒåã€‚ value:å˜é‡çš„å€¼ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å…¶ä»–å˜é‡æˆ–è€…å˜é‡çš„ç»„åˆç­‰ã€‚ Rewriteå¸¸ç”¨å…¨å±€å˜é‡ å˜é‡ è¯´æ˜ $args å˜é‡ä¸­å­˜æ”¾äº†è¯·æ±‚URLä¸­çš„è¯·æ±‚æŒ‡ä»¤ã€‚æ¯”å¦‚http://192.168.200.133:8080?arg1=value1&amp;args2=value2ä¸­çš„&quot;arg1=value1&amp;arg2=value2&quot;ï¼ŒåŠŸèƒ½å’Œ$query_stringä¸€æ · $http_user_agent å˜é‡å­˜å‚¨çš„æ˜¯ç”¨æˆ·è®¿é—®æœåŠ¡çš„ä»£ç†ä¿¡æ¯(å¦‚æœé€šè¿‡æµè§ˆå™¨è®¿é—®ï¼Œè®°å½•çš„æ˜¯æµè§ˆå™¨çš„ç›¸å…³ç‰ˆæœ¬ä¿¡æ¯) $host å˜é‡å­˜å‚¨çš„æ˜¯è®¿é—®æœåŠ¡å™¨çš„server_nameå€¼ $document_uri å˜é‡å­˜å‚¨çš„æ˜¯å½“å‰è®¿é—®åœ°å€çš„URIã€‚æ¯”å¦‚http://192.168.200.133/server?id=10&amp;name=zhangsanä¸­çš„&quot;/server&quot;ï¼ŒåŠŸèƒ½å’Œ$uriä¸€æ · $document_root å˜é‡å­˜å‚¨çš„æ˜¯å½“å‰è¯·æ±‚å¯¹åº”locationçš„rootå€¼ï¼Œå¦‚æœæœªè®¾ç½®ï¼Œé»˜è®¤æŒ‡å‘Nginxè‡ªå¸¦htmlç›®å½•æ‰€åœ¨ä½ç½® $content_length å˜é‡å­˜å‚¨çš„æ˜¯è¯·æ±‚å¤´ä¸­çš„Content-Lengthçš„å€¼ $content_type å˜é‡å­˜å‚¨çš„æ˜¯è¯·æ±‚å¤´ä¸­çš„Content-Typeçš„å€¼ $http_cookie å˜é‡å­˜å‚¨çš„æ˜¯å®¢æˆ·ç«¯çš„cookieä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡add_header Set-Cookie 'cookieName=cookieValueâ€™æ¥æ·»åŠ cookieæ•°æ® $limit_rate å˜é‡ä¸­å­˜å‚¨çš„æ˜¯NginxæœåŠ¡å™¨å¯¹ç½‘ç»œè¿æ¥é€Ÿç‡çš„é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯Nginxé…ç½®ä¸­å¯¹limit_rateæŒ‡ä»¤è®¾ç½®çš„å€¼ï¼Œé»˜è®¤æ˜¯0ï¼Œä¸é™åˆ¶ã€‚ $remote_addr å˜é‡ä¸­å­˜å‚¨çš„æ˜¯å®¢æˆ·ç«¯çš„IPåœ°å€ $remote_port å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯å»ºç«‹è¿æ¥çš„ç«¯å£å· $remote_user å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯çš„ç”¨æˆ·åï¼Œéœ€è¦æœ‰è®¤è¯æ¨¡å—æ‰èƒ½è·å– $scheme å˜é‡ä¸­å­˜å‚¨äº†è®¿é—®åè®® $server_addr å˜é‡ä¸­å­˜å‚¨äº†æœåŠ¡ç«¯çš„åœ°å€ $server_name å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾çš„æœåŠ¡å™¨çš„åç§° $server_port å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯è¯·æ±‚åˆ°è¾¾æœåŠ¡å™¨çš„ç«¯å£å· $server_protocol å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯è¯·æ±‚åè®®çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚&quot;HTTP/1.1&quot; $request_body_file å˜é‡ä¸­å­˜å‚¨äº†å‘ç»™åç«¯æœåŠ¡å™¨çš„æœ¬åœ°æ–‡ä»¶èµ„æºçš„åç§° $request_method å˜é‡ä¸­å­˜å‚¨äº†å®¢æˆ·ç«¯çš„è¯·æ±‚æ–¹å¼ï¼Œæ¯”å¦‚&quot;GET&quot;,&quot;POST&quot;ç­‰ $request_filename å˜é‡ä¸­å­˜å‚¨äº†å½“å‰è¯·æ±‚çš„èµ„æºæ–‡ä»¶çš„è·¯å¾„å $request_uri å˜é‡ä¸­å­˜å‚¨äº†å½“å‰è¯·æ±‚çš„URIï¼Œå¹¶ä¸”æºå¸¦è¯·æ±‚å‚æ•°ï¼Œæ¯”å¦‚http://192.168.200.133/server?id=10&amp;name=zhangsanä¸­çš„&quot;/server?id=10&amp;name=zhangsan&quot; ifæŒ‡ä»¤ è¯¥æŒ‡ä»¤ç”¨æ¥æ”¯æŒæ¡ä»¶åˆ¤æ–­ï¼Œå¹¶æ ¹æ®æ¡ä»¶åˆ¤æ–­ç»“æœé€‰æ‹©ä¸åŒçš„Nginxé…ç½®ã€‚ è¯­æ³• if (condition){â€¦} é»˜è®¤å€¼ â€” ä½ç½® serverã€location conditionä¸ºåˆ¤å®šæ¡ä»¶ï¼Œå¯ä»¥æ”¯æŒä»¥ä¸‹å†™æ³•ï¼š å˜é‡åã€‚å¦‚æœå˜é‡åå¯¹åº”çš„å€¼ä¸ºç©ºæˆ–è€…æ˜¯0ï¼Œiféƒ½åˆ¤æ–­ä¸ºfalse,å…¶ä»–æ¡ä»¶ä¸ºtrueã€‚ 123if ($param)&#123; &#125; 12. ä½¿ç”¨&quot;=&quot;å’Œ&quot;!=&quot;æ¯”è¾ƒå˜é‡å’Œå­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰ï¼Œæ»¡è¶³æ¡ä»¶ä¸ºtrueï¼Œä¸æ»¡è¶³ä¸ºfalse 123if ($request_method = POST)&#123; return 405;&#125; æ³¨æ„ï¼šæ­¤å¤„å’ŒJavaä¸å¤ªä¸€æ ·çš„åœ°æ–¹æ˜¯å­—ç¬¦ä¸²ä¸éœ€è¦æ·»åŠ å¼•å·ã€‚ ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å¯¹å˜é‡è¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸè¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚å˜é‡ä¸æ­£åˆ™è¡¨è¾¾å¼ä¹‹é—´ä½¿ç”¨&quot;~â€œ,â€~*â€œ,â€!~â€œ,â€!~*&quot;æ¥è¿æ¥ã€‚ &quot;~&quot;ä»£è¡¨åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼è¿‡ç¨‹ä¸­åŒºåˆ†å¤§å°å†™ï¼Œ &quot;~*&quot;ä»£è¡¨åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼è¿‡ç¨‹ä¸­ä¸åŒºåˆ†å¤§å°å†™ &quot;!~â€œå’Œâ€!~*&quot;åˆšå¥½å’Œä¸Šé¢å–ç›¸åå€¼ï¼Œå¦‚æœåŒ¹é…ä¸Šè¿”å›false,åŒ¹é…ä¸ä¸Šè¿”å›true 123if ($http_user_agent ~ MSIE)&#123; #$http_user_agentçš„å€¼ä¸­æ˜¯å¦åŒ…å«MSIEå­—ç¬¦ä¸²ï¼Œå¦‚æœåŒ…å«è¿”å›true&#125; æ³¨æ„ï¼šæ­£åˆ™è¡¨è¾¾å¼å­—ç¬¦ä¸²ä¸€èˆ¬ä¸éœ€è¦åŠ å¼•å·ï¼Œä½†æ˜¯å¦‚æœå­—ç¬¦ä¸²ä¸­åŒ…å«&quot;}â€œæˆ–è€…æ˜¯â€;&quot;ç­‰å­—ç¬¦æ—¶ï¼Œå°±éœ€è¦æŠŠå¼•å·åŠ ä¸Šã€‚ åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä½¿ç”¨&quot;-f&quot;å’Œ&quot;!-f&quot;, å½“ä½¿ç”¨&quot;-f&quot;æ—¶ï¼Œå¦‚æœè¯·æ±‚çš„æ–‡ä»¶å­˜åœ¨è¿”å›trueï¼Œä¸å­˜åœ¨è¿”å›falseã€‚ å½“ä½¿ç”¨&quot;!f&quot;æ—¶ï¼Œå¦‚æœè¯·æ±‚æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½†è¯¥æ–‡ä»¶æ‰€åœ¨ç›®å½•å­˜åœ¨è¿”å›true,æ–‡ä»¶å’Œç›®å½•éƒ½ä¸å­˜åœ¨è¿”å›false,å¦‚æœæ–‡ä»¶å­˜åœ¨è¿”å›false 123456if (-f $request_filename)&#123; #åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦å­˜åœ¨&#125;if (!-f $request_filename)&#123; #åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦ä¸å­˜åœ¨&#125; åˆ¤æ–­è¯·æ±‚çš„ç›®å½•æ˜¯å¦å­˜åœ¨ä½¿ç”¨&quot;-d&quot;å’Œ&quot;!-d&quot;, å½“ä½¿ç”¨&quot;-d&quot;æ—¶ï¼Œå¦‚æœè¯·æ±‚çš„ç›®å½•å­˜åœ¨ï¼Œifè¿”å›trueï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨åˆ™è¿”å›false å½“ä½¿ç”¨&quot;!-d&quot;æ—¶ï¼Œå¦‚æœè¯·æ±‚çš„ç›®å½•ä¸å­˜åœ¨ä½†è¯¥ç›®å½•çš„ä¸Šçº§ç›®å½•å­˜åœ¨åˆ™è¿”å›trueï¼Œè¯¥ç›®å½•å’Œå®ƒä¸Šçº§ç›®å½•éƒ½ä¸å­˜åœ¨åˆ™è¿”å›false,å¦‚æœè¯·æ±‚ç›®å½•å­˜åœ¨ä¹Ÿè¿”å›false. åˆ¤æ–­è¯·æ±‚çš„ç›®å½•æˆ–è€…æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä½¿ç”¨&quot;-e&quot;å’Œ&quot;!-e&quot; å½“ä½¿ç”¨&quot;-e&quot;,å¦‚æœè¯·æ±‚çš„ç›®å½•æˆ–è€…æ–‡ä»¶å­˜åœ¨æ—¶ï¼Œifè¿”å›true,å¦åˆ™è¿”å›false. å½“ä½¿ç”¨&quot;!-e&quot;,å¦‚æœè¯·æ±‚çš„æ–‡ä»¶å’Œæ–‡ä»¶æ‰€åœ¨è·¯å¾„ä¸Šçš„ç›®å½•éƒ½ä¸å­˜åœ¨è¿”å›true,å¦åˆ™è¿”å›false åˆ¤æ–­è¯·æ±‚çš„æ–‡ä»¶æ˜¯å¦å¯æ‰§è¡Œä½¿ç”¨&quot;-x&quot;å’Œ&quot;!-x&quot; å½“ä½¿ç”¨&quot;-x&quot;,å¦‚æœè¯·æ±‚çš„æ–‡ä»¶å¯æ‰§è¡Œï¼Œifè¿”å›true,å¦åˆ™è¿”å›false å½“ä½¿ç”¨&quot;!-x&quot;,å¦‚æœè¯·æ±‚æ–‡ä»¶ä¸å¯æ‰§è¡Œï¼Œè¿”å›true,å¦åˆ™è¿”å›false breakæŒ‡ä»¤ è¯¥æŒ‡ä»¤ç”¨äºä¸­æ–­å½“å‰ç›¸åŒä½œç”¨åŸŸä¸­çš„å…¶ä»–Nginxé…ç½®ã€‚ä¸è¯¥æŒ‡ä»¤å¤„äºåŒä¸€ä½œç”¨åŸŸçš„Nginxé…ç½®ä¸­ï¼Œä½äºå®ƒå‰é¢çš„æŒ‡ä»¤é…ç½®ç”Ÿæ•ˆï¼Œä½äºåé¢çš„æŒ‡ä»¤é…ç½®æ— æ•ˆã€‚ è¯­æ³• break; é»˜è®¤å€¼ â€” ä½ç½® serverã€locationã€if ä¾‹å­: 1234567location /&#123; if ($param)&#123; set $id $1; break; limit_rate 10k; &#125;&#125; returnæŒ‡ä»¤ è¯¥æŒ‡ä»¤ç”¨äºå®Œæˆå¯¹è¯·æ±‚çš„å¤„ç†ï¼Œç›´æ¥å‘å®¢æˆ·ç«¯è¿”å›å“åº”çŠ¶æ€ä»£ç ã€‚åœ¨returnåçš„æ‰€æœ‰Nginxé…ç½®éƒ½æ˜¯æ— æ•ˆçš„ã€‚ è¯­æ³• return code [text];return code URL;return URL; é»˜è®¤å€¼ â€” ä½ç½® serverã€locationã€if code:ä¸ºè¿”å›ç»™å®¢æˆ·ç«¯çš„HTTPçŠ¶æ€ä»£ç†ã€‚å¯ä»¥è¿”å›çš„çŠ¶æ€ä»£ç ä¸º0~999çš„ä»»æ„HTTPçŠ¶æ€ä»£ç† text:ä¸ºè¿”å›ç»™å®¢æˆ·ç«¯çš„å“åº”ä½“å†…å®¹ï¼Œæ”¯æŒå˜é‡çš„ä½¿ç”¨ URL:ä¸ºè¿”å›ç»™å®¢æˆ·ç«¯çš„URLåœ°å€ rewriteæŒ‡ä»¤ è¯¥æŒ‡ä»¤é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨æ¥æ”¹å˜URIã€‚å¯ä»¥åŒæ—¶å­˜åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªæŒ‡ä»¤ï¼ŒæŒ‰ç…§é¡ºåºä¾æ¬¡å¯¹URLè¿›è¡ŒåŒ¹é…å’Œå¤„ç†ã€‚ URLå’ŒURIçš„åŒºåˆ«ï¼š 12URI:ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦URL:ç»Ÿä¸€èµ„æºå®šä½ç¬¦ è¯­æ³• rewrite regex replacement [flag]; é»˜è®¤å€¼ â€” ä½ç½® serverã€locationã€if regex:ç”¨æ¥åŒ¹é…URIçš„æ­£åˆ™è¡¨è¾¾å¼ replacement:åŒ¹é…æˆåŠŸåï¼Œç”¨äºæ›¿æ¢URIä¸­è¢«æˆªå–å†…å®¹çš„å­—ç¬¦ä¸²ã€‚å¦‚æœè¯¥å­—ç¬¦ä¸²æ˜¯ä»¥&quot;http://&quot;æˆ–è€…&quot;https://&quot;å¼€å¤´çš„ï¼Œåˆ™ä¸ä¼šç»§ç»­å‘ä¸‹å¯¹URIè¿›è¡Œå…¶ä»–å¤„ç†ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›é‡å†™åçš„URIç»™å®¢æˆ·ç«¯ã€‚ flag:ç”¨æ¥è®¾ç½®rewriteå¯¹URIçš„å¤„ç†è¡Œä¸ºï¼Œå¯é€‰å€¼æœ‰å¦‚ä¸‹ï¼š last: break redirect permanent rewrite_logæŒ‡ä»¤ è¯¥æŒ‡ä»¤é…ç½®æ˜¯å¦å¼€å¯URLé‡å†™æ—¥å¿—çš„è¾“å‡ºåŠŸèƒ½ã€‚ è¯­æ³• rewrite_log on|off; é»˜è®¤å€¼ rewrite_log off; ä½ç½® httpã€serverã€locationã€if å¼€å¯åï¼ŒURLé‡å†™çš„ç›¸å…³æ—¥å¿—å°†ä»¥noticeçº§åˆ«è¾“å‡ºåˆ°error_logæŒ‡ä»¤é…ç½®çš„æ—¥å¿—æ–‡ä»¶æ±‡æ€»ã€‚ Rewriteçš„æ¡ˆä¾‹ åŸŸåè·³è½¬ ã€‹é—®é¢˜åˆ†æ å…ˆæ¥çœ‹ä¸€ä¸ªæ•ˆæœï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®¿é—®äº¬ä¸œç½‘ç«™ï¼Œå¤§å®¶éƒ½çŸ¥é“æˆ‘ä»¬å¯ä»¥è¾“å…¥www.jd.com,ä½†æ˜¯åŒæ ·çš„æˆ‘ä»¬ä¹Ÿå¯ä»¥è¾“å…¥www.360buy.comåŒæ ·ä¹Ÿéƒ½èƒ½è®¿é—®åˆ°äº¬ä¸œç½‘ç«™ã€‚è¿™ä¸ªå…¶å®æ˜¯å› ä¸ºäº¬ä¸œåˆšå¼€å§‹çš„æ—¶å€™åŸŸåå°±æ˜¯www.360buy.comï¼Œåé¢ç”±äºå„ç§åŸå› æŠŠè‡ªå·±çš„åŸŸåæ¢æˆäº†www.jd.com, è™½ç„¶è¯´åŸŸåå˜é‡ï¼Œä½†æ˜¯å¯¹äºä»¥å‰åªè®°ä½äº†www.360buy.comçš„ç”¨æˆ·æ¥è¯´ï¼Œæˆ‘ä»¬å¦‚ä½•æŠŠè¿™éƒ¨åˆ†ç”¨æˆ·ä¹Ÿè¿ç§»åˆ°æˆ‘ä»¬æ–°åŸŸåçš„è®¿é—®ä¸Šæ¥ï¼Œé’ˆå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Nginxä¸­Rewriteçš„åŸŸåè·³è½¬æ¥è§£å†³ã€‚ ã€‹ç¯å¢ƒå‡†å¤‡ å‡†å¤‡ä¸¤ä¸ªåŸŸå www.360buy.com | www.jd.com 1vim /etc/hosts 12192.168.200.133 www.360buy.com192.168.200.133 www.jd.com åœ¨/usr/local/nginx/html/hmç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªè®¿é—®é¡µé¢ 123456&lt;html&gt; &lt;title&gt;&lt;/title&gt; &lt;body&gt; &lt;h1&gt;æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„ç½‘ç«™&lt;/h1&gt; &lt;/body&gt;&lt;/html&gt; é€šè¿‡Nginxå®ç°å½“è®¿é—®www.è®¿é—®åˆ°ç³»ç»Ÿçš„é¦–é¡µ 12345678server &#123; listen 80; server_name www.hm.com; location /&#123; root /usr/local/nginx/html/hm; index index.html; &#125;&#125; ã€‹é€šè¿‡Rewriteå®Œæˆå°†www.360buy.comçš„è¯·æ±‚è·³è½¬åˆ°www.jd.com 12345server &#123; listen 80; server_name www.360buy.com; rewrite ^/ http://www.jd.com permanent;&#125; é—®é¢˜æè¿°:å¦‚ä½•åœ¨åŸŸåè·³è½¬çš„è¿‡ç¨‹ä¸­æºå¸¦è¯·æ±‚çš„URIï¼Ÿ ä¿®æ”¹é…ç½®ä¿¡æ¯ 12345server &#123; listen 80; server_name www.itheima.com; rewrite ^(.*) http://www.hm.com$1 permanent;&#125; é—®é¢˜æè¿°:æˆ‘ä»¬é™¤äº†ä¸Šè¿°è¯´çš„www.jd.com ã€www.360buy.comå…¶å®è¿˜æœ‰æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡www.jingdong.comæ¥è®¿é—®ï¼Œé‚£ä¹ˆå¦‚ä½•é€šè¿‡Rewriteæ¥å®ç°å¤šä¸ªåŸŸåçš„è·³è½¬? æ·»åŠ åŸŸå 12vim /etc/hosts192.168.200.133 www.jingdong.com ä¿®æ”¹é…ç½®ä¿¡æ¯ 12345server&#123; listen 80; server_name www.360buy.com www.jingdong.com; rewrite ^(.*) http://www.jd.com$1 permanent;&#125; åŸŸåé•œåƒ ä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼Œå°†www.360buy.com å’Œ www.jingdong.coméƒ½èƒ½è·³è½¬åˆ°www.jd.comï¼Œé‚£ä¹ˆwww.jd.comæˆ‘ä»¬å°±å¯ä»¥æŠŠå®ƒèµ·åå«ä¸»åŸŸåï¼Œå…¶ä»–ä¸¤ä¸ªå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„é•œåƒåŸŸåï¼Œå½“ç„¶å¦‚æœæˆ‘ä»¬ä¸æƒ³æŠŠæ•´ä¸ªç½‘ç«™åšé•œåƒï¼Œåªæƒ³ä¸ºå…¶ä¸­æŸä¸€ä¸ªå­ç›®å½•ä¸‹çš„èµ„æºåšé•œåƒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨locationå—ä¸­é…ç½®rewriteåŠŸèƒ½ï¼Œæ¯”å¦‚: 12345678910server &#123; listen 80; server_name rewrite.myweb.com; location ^~ /source1&#123; rewrite ^/resource1(.*) http://rewrite.myweb.com/web$1 last; &#125; location ^~ /source2&#123; rewrite ^/resource2(.*) http://rewrite.myweb.com/web$1 last; &#125;&#125; ç‹¬ç«‹åŸŸå ä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®åŒ…å«å¤šä¸ªæ¨¡å—ï¼Œæ¯”å¦‚è´­ç‰©ç½‘ç«™æœ‰å•†å“å•†å“æœç´¢æ¨¡å—ã€å•†å“è¯¦æƒ…æ¨¡å—å·²ç»è´­ç‰©è½¦æ¨¡å—ç­‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•ä¸ºæ¯ä¸€ä¸ªæ¨¡å—è®¾ç½®ç‹¬ç«‹çš„åŸŸåã€‚ éœ€æ±‚ï¼š 123http://search.hm.com è®¿é—®å•†å“æœç´¢æ¨¡å—http://item.hm.com è®¿é—®å•†å“è¯¦æƒ…æ¨¡å—http://cart.hm.com è®¿é—®å•†å“è´­ç‰©è½¦æ¨¡å— 123456789101112131415server&#123; listen 80; server_name search.hm.com; rewrite ^(.*) http://www.hm.com/bbs$1 last;&#125;server&#123; listen 81; server_name item.hm.com; rewrite ^(.*) http://www.hm.com/item$1 last;&#125;server&#123; listen 82; server_name cart.hm.com; rewrite ^(.*) http://www.hm.com/cart$1 last;&#125; ç›®å½•è‡ªåŠ¨æ·»åŠ &quot;/&quot; é—®é¢˜æè¿° é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥æ¼”ç¤ºä¸‹é—®é¢˜: 123456789server &#123; listen 80; server_name localhost; location / &#123; root html; index index.html; &#125;&#125; è¦æƒ³è®¿é—®ä¸Šè¿°èµ„æºï¼Œå¾ˆç®€å•ï¼Œåªéœ€è¦é€šè¿‡http://192.168.200.133ç›´æ¥å°±èƒ½è®¿é—®ï¼Œåœ°å€åé¢ä¸éœ€è¦åŠ /,ä½†æ˜¯å¦‚æœå°†ä¸Šè¿°çš„é…ç½®ä¿®æ”¹ä¸ºå¦‚ä¸‹å†…å®¹: 12345678server &#123; listen 80; server_name localhost; location /hm &#123; root html; index index.html; &#125;&#125; è¿™ä¸ªæ—¶å€™ï¼Œè¦æƒ³è®¿é—®ä¸Šè¿°èµ„æºï¼ŒæŒ‰ç…§ä¸Šè¿°çš„è®¿é—®æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡http://192.168.200.133/hm/æ¥è®¿é—®,ä½†æ˜¯å¦‚æœåœ°å€åé¢ä¸åŠ æ–œæ ï¼Œé¡µé¢å°±ä¼šå‡ºé—®é¢˜ã€‚å¦‚æœä¸åŠ æ–œæ ï¼ŒNginxæœåŠ¡å™¨å†…éƒ¨ä¼šè‡ªåŠ¨åšä¸€ä¸ª301çš„é‡å®šå‘ï¼Œé‡å®šå‘çš„åœ°å€ä¼šæœ‰ä¸€ä¸ªæŒ‡ä»¤å«server_name_in_redirect on|off;æ¥å†³å®šé‡å®šå‘çš„åœ°å€ï¼š 1234å¦‚æœè¯¥æŒ‡ä»¤ä¸ºon é‡å®šå‘çš„åœ°å€ä¸º: http://server_name/ç›®å½•å/;å¦‚æœè¯¥æŒ‡ä»¤ä¸ºoff é‡å®šå‘çš„åœ°å€ä¸º: http://åŸURLä¸­çš„åŸŸå/ç›®å½•å/; æ‰€ä»¥å°±æ‹¿åˆšæ‰çš„åœ°å€æ¥è¯´ï¼Œhttp://192.168.200.133/hmå¦‚æœä¸åŠ æ–œæ ï¼Œé‚£ä¹ˆæŒ‰ç…§ä¸Šè¿°è§„åˆ™ï¼Œå¦‚æœæŒ‡ä»¤server_name_in_redirectä¸ºonï¼Œåˆ™301é‡å®šå‘åœ°å€å˜ä¸º http://localhost/hm/,å¦‚æœä¸ºoffï¼Œåˆ™301é‡å®šå‘åœ°å€å˜ä¸ºhttp://192.168.200.133/ht/ã€‚åé¢è¿™ä¸ªæ˜¯æ­£å¸¸çš„ï¼Œå‰é¢åœ°å€å°±æœ‰é—®é¢˜ã€‚ æ³¨æ„server_name_in_redirectæŒ‡ä»¤åœ¨Nginxçš„0.8.48ç‰ˆæœ¬ä¹‹å‰é»˜è®¤éƒ½æ˜¯onï¼Œä¹‹åæ”¹æˆäº†off,æ‰€ä»¥ç°åœ¨æˆ‘ä»¬è¿™ä¸ªç‰ˆæœ¬ä¸éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ˜¯0.8.48ä»¥å‰çš„ç‰ˆæœ¬å¹¶ä¸”server_name_in_redirectè®¾ç½®ä¸ºonï¼Œæˆ‘ä»¬å¦‚ä½•é€šè¿‡rewriteæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ è§£å†³æ–¹æ¡ˆ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨rewriteåŠŸèƒ½ä¸ºæœ«å°¾æ²¡æœ‰æ–œæ çš„URLè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªæ–œæ  12345678910server &#123; listen 80; server_name localhost; server_name_in_redirect on; location /hm &#123; if (-d $request_filename)&#123; rewrite ^/(.*)([^/])$ http://$host/$1$2/ permanent; &#125; &#125;&#125; åˆå¹¶ç›®å½• æœç´¢å¼•æ“ä¼˜åŒ–(SEO)æ˜¯ä¸€ç§åˆ©ç”¨æœç´¢å¼•æ“çš„æœç´¢è§„åˆ™æ¥æä¾›ç›®çš„ç½‘ç«™çš„æœ‰å…³æœç´¢å¼•æ“å†…æ’åçš„æ–¹å¼ã€‚æˆ‘ä»¬åœ¨åˆ›å»ºè‡ªå·±çš„ç«™ç‚¹æ—¶ï¼Œå¯ä»¥é€šè¿‡å¾ˆå¤šä¸­æ–¹å¼æ¥æœ‰æ•ˆçš„æä¾›æœç´¢å¼•æ“ä¼˜åŒ–çš„ç¨‹åº¦ã€‚å…¶ä¸­æœ‰ä¸€é¡¹å°±åŒ…å«URLçš„ç›®å½•å±‚çº§ä¸€èˆ¬ä¸è¦è¶…è¿‡ä¸‰å±‚ï¼Œå¦åˆ™çš„è¯ä¸åˆ©äºæœç´¢å¼•æ“çš„æœç´¢ä¹Ÿç»™å®¢æˆ·ç«¯çš„è¾“å…¥å¸¦æ¥äº†è´Ÿæ‹…ï¼Œä½†æ˜¯å°†æ‰€æœ‰çš„æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹åˆä¼šå¯¼è‡´æ–‡ä»¶èµ„æºç®¡ç†æ··ä¹±å¹¶ä¸”è®¿é—®æ–‡ä»¶çš„é€Ÿåº¦ä¹Ÿä¼šéšç€æ–‡ä»¶å¢å¤šè€Œæ…¢ä¸‹æ¥ï¼Œè¿™ä¸¤ä¸ªé—®é¢˜æ˜¯ç›¸äº’çŸ›ç›¾çš„ï¼Œé‚£ä¹ˆä½¿ç”¨rewriteå¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜? ä¸¾ä¾‹ï¼Œç½‘ç«™ä¸­æœ‰ä¸€ä¸ªèµ„æºæ–‡ä»¶çš„è®¿é—®è·¯å¾„æ—¶ /server/11/22/33/44/20.html,ä¹Ÿå°±æ˜¯è¯´20.htmlå­˜åœ¨äºç¬¬5çº§ç›®å½•ä¸‹ï¼Œå¦‚æœæƒ³è¦è®¿é—®è¯¥èµ„æºæ–‡ä»¶ï¼Œå®¢æˆ·ç«¯çš„URLåœ°å€å°±è¦å†™æˆ http://www.web.name/server/11/22/33/44/20.html, 1234567server &#123; listen 80; server_name www.web.name; location /server&#123; root html; &#125;&#125; ä½†æ˜¯è¿™ä¸ªæ˜¯éå¸¸ä¸åˆ©äºSEOæœç´¢å¼•æ“ä¼˜åŒ–çš„ï¼ŒåŒæ—¶å®¢æˆ·ç«¯ä¹Ÿä¸å¥½è®°.ä½¿ç”¨rewriteæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¦‚ä¸‹é…ç½®: 1234567server &#123; listen 80; server_name www.web.name; location /server&#123; rewrite ^/server-([0-9]+)-([0-9]+)-([0-9]+)-([0-9]+)\\.html$ /server/$1/$2/$3/$4/$5.html last; &#125;&#125; è¿™æ ·çš„èŠ±ï¼Œå®¢æˆ·ç«¯åªéœ€è¦è¾“å…¥http://www.web.name/server-11-22-33-44-20.htmlå°±å¯ä»¥è®¿é—®åˆ°20.htmlé¡µé¢äº†ã€‚è¿™é‡Œä¹Ÿå……åˆ†åˆ©ç”¨äº†rewriteæŒ‡ä»¤æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼çš„ç‰¹æ€§ã€‚ é˜²ç›—é“¾ é˜²ç›—é“¾ä¹‹å‰æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡äº†ç›¸å…³çš„çŸ¥è¯†ï¼Œåœ¨rewriteä¸­çš„é˜²ç›—é“¾å’Œä¹‹å‰å°†çš„åŸç†å…¶å®éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡é€šè¿‡rewriteå¯ä»¥å°†é˜²ç›—é“¾çš„åŠŸèƒ½è¿›è¡Œå®Œå–„ä¸‹ï¼Œå½“å‡ºç°é˜²ç›—é“¾çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨rewriteå°†è¯·æ±‚è½¬å‘åˆ°è‡ªå®šä¹‰çš„ä¸€å¼ å›¾ç‰‡å’Œé¡µé¢ï¼Œç»™ç”¨æˆ·æ¯”è¾ƒå¥½çš„æç¤ºä¿¡æ¯ã€‚ä¸‹é¢æˆ‘ä»¬å°±é€šè¿‡æ ¹æ®æ–‡ä»¶ç±»å‹å®ç°é˜²ç›—é“¾çš„ä¸€ä¸ªé…ç½®å®ä¾‹: 12345678910server&#123; listen 80; server_name www.web.com; locatin ~* ^.+\\.(gif|jpg|png|swf|flv|rar|zip)$&#123; valid_referers none blocked server_names *.web.com; if ($invalid_referer)&#123; rewrite ^/ http://www.web.com/images/forbidden.png; &#125; &#125;&#125; æ ¹æ®ç›®å½•å®ç°é˜²ç›—é“¾é…ç½®ï¼š 1234567891011server&#123; listen 80; server_name www.web.com; location /file/&#123; root /server/file/; valid_referers none blocked server_names *.web.com; if ($invalid_referer)&#123; rewrite ^/ http://www.web.com/images/forbidden.png; &#125; &#125;&#125;","categories":[{"name":"Webå¼€å‘","slug":"Webå¼€å‘","permalink":"http://kaillliu.github.io/categories/Web%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://kaillliu.github.io/tags/Java/"},{"name":"Centos","slug":"Centos","permalink":"http://kaillliu.github.io/tags/Centos/"},{"name":"Linux","slug":"Linux","permalink":"http://kaillliu.github.io/tags/Linux/"}]},{"title":"Nginxå­¦ä¹ ï¼ˆä¸€ï¼‰","slug":"Nginxå­¦ä¹ å…¶ä¸€","date":"2022-04-21T08:17:00.000Z","updated":"2022-05-23T05:41:23.080Z","comments":true,"path":"2022/04/21/Nginxå­¦ä¹ å…¶ä¸€/","link":"","permalink":"http://kaillliu.github.io/2022/04/21/Nginx%E5%AD%A6%E4%B9%A0%E5%85%B6%E4%B8%80/","excerpt":"","text":"Nginxç®€ä»‹ èƒŒæ™¯ä»‹ç» Nginxï¼ˆâ€œengine xâ€ï¼‰ä¸€ä¸ªå…·æœ‰é«˜æ€§èƒ½çš„ã€HTTPã€‘å’Œã€åå‘ä»£ç†ã€‘çš„ã€WEBæœåŠ¡å™¨ã€‘ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªã€POP3/SMTP/IMAPä»£ç†æœåŠ¡å™¨ã€‘ï¼Œæ˜¯ç”±ä¼Šæˆˆå°”Â·èµ›ç´¢è€¶å¤«(ä¿„ç½—æ–¯äºº)ä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„ï¼ŒNginxçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬æ˜¯2004å¹´10æœˆ4å·å‘å¸ƒçš„0.1.0ç‰ˆæœ¬ã€‚å¦å¤–å€¼å¾—ä¸€æçš„æ˜¯ä¼Šæˆˆå°”Â·èµ›ç´¢è€¶å¤«å°†Nginxçš„æºç è¿›è¡Œäº†å¼€æºï¼Œè¿™ä¹Ÿä¸ºNginxçš„å‘å±•æä¾›äº†è‰¯å¥½çš„ä¿éšœã€‚ åè¯è§£é‡Š WEBæœåŠ¡å™¨ï¼š WEBæœåŠ¡å™¨ä¹Ÿå«ç½‘é¡µæœåŠ¡å™¨ï¼Œè‹±æ–‡åå«Web Serverï¼Œä¸»è¦åŠŸèƒ½æ˜¯ä¸ºç”¨æˆ·æä¾›ç½‘ä¸Šä¿¡æ¯æµè§ˆæœåŠ¡ã€‚ HTTP: HTTPæ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®çš„ç¼©å†™ï¼Œæ˜¯ç”¨äºä»WEBæœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ è¾“åè®®ï¼Œä¹Ÿæ˜¯äº’è”ç½‘ä¸Šåº”ç”¨æœ€ä¸ºå¹¿æ³›çš„ä¸€ç§ç½‘ç»œåè®®ã€‚HTTPæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯è¯·æ±‚å’Œåº”ç­”çš„æ ‡å‡†ï¼Œå®¢æˆ·ç«¯æ˜¯ç»ˆç«¯ç”¨æˆ·ï¼ŒæœåŠ¡ç«¯æ˜¯ç½‘ç«™ï¼Œé€šè¿‡ä½¿ç”¨Webæµè§ˆå™¨ã€ç½‘ç»œçˆ¬è™«æˆ–è€…å…¶ä»–å·¥å…·ï¼Œå®¢æˆ·ç«¯å‘èµ·ä¸€ä¸ªåˆ°æœåŠ¡å™¨ä¸ŠæŒ‡å®šç«¯å£çš„HTTPè¯·æ±‚ã€‚ POP3/SMTP/IMAPï¼š POP3(Post Offic Protocol 3)é‚®å±€åè®®çš„ç¬¬ä¸‰ä¸ªç‰ˆæœ¬ï¼Œ SMTP(Simple Mail Transfer Protocol)ç®€å•é‚®ä»¶ä¼ è¾“åè®®ï¼Œ IMAP(Internet Mail Access Protocol)äº¤äº’å¼é‚®ä»¶å­˜å–åè®®ï¼Œ é€šè¿‡ä¸Šè¿°åè¯çš„è§£é‡Šï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°Nginxä¹Ÿå¯ä»¥ä½œä¸ºç”µå­é‚®ä»¶ä»£ç†æœåŠ¡å™¨ã€‚ åå‘ä»£ç† æ­£å‘ä»£ç† åå‘ä»£ç† å¸¸è§æœåŠ¡å™¨å¯¹æ¯” åœ¨ä»‹ç»è¿™ä¸€èŠ‚å†…å®¹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸€å®¶å…¬å¸å«Netcraftã€‚ 1Netcraftå…¬å¸äº1994å¹´åº•åœ¨è‹±å›½æˆç«‹ï¼Œå¤šå¹´æ¥ä¸€ç›´è‡´åŠ›äºäº’è”ç½‘å¸‚åœºä»¥åŠåœ¨çº¿å®‰å…¨æ–¹é¢çš„å’¨è¯¢æœåŠ¡ï¼Œå…¶ä¸­åœ¨å›½é™…ä¸Šæœ€å…·å½±å“åŠ›çš„å½“å±å…¶é’ˆå¯¹ç½‘ç«™æœåŠ¡å™¨ã€SSLå¸‚åœºæ‰€åšçš„å®¢è§‚ä¸¥è°¨çš„åˆ†æç ”ç©¶ï¼Œå…¬å¸å®˜ç½‘æ¯æœˆå…¬å¸ƒçš„è°ƒç ”æ•°æ®ï¼ˆWeb Server Surveyï¼‰å·²æˆä¸ºå½“ä»Šäººä»¬äº†è§£å…¨çƒç½‘ç«™æ•°é‡ä»¥åŠæœåŠ¡å™¨å¸‚åœºåˆ†é¢æƒ…å†µçš„ä¸»è¦å‚è€ƒä¾æ®ï¼Œæ—¶å¸¸è¢«è¯¸å¦‚åå°”è¡—æ‚å¿—ï¼Œè‹±å›½BBCï¼ŒSlashdotç­‰åª’ä½“æŠ¥é“æˆ–å¼•ç”¨ã€‚ æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ç»„æ•°æ®ï¼Œæˆ‘ä»¬å…ˆæ‰“å¼€Nginxçš„å®˜æ–¹ç½‘ç«™ http://nginx.org/,æ‰¾åˆ°Netcraftå…¬å¸å…¬å¸ƒçš„æ•°æ®ï¼Œå¯¹å½“å‰ä¸»æµæœåŠ¡å™¨äº§å“è¿›è¡Œä»‹ç»ã€‚ ä¸Šé¢è¿™å¼ å›¾å±•ç¤ºäº†2019å¹´å…¨çƒä¸»æµWebæœåŠ¡å™¨çš„å¸‚åœºæƒ…å†µï¼Œå…¶ä¸­æœ‰Apacheã€Microsoft-IISã€google Serversã€Nginxã€Tomcatç­‰ï¼Œè€Œæˆ‘ä»¬åœ¨äº†è§£æ–°äº‹ç‰©çš„æ—¶å€™ï¼Œå¾€å¾€ä¹ æƒ¯é€šè¿‡ç±»æ¯”æ¥å¸®åŠ©è‡ªå·±ç†è§£äº‹ç‰©çš„æ¦‚è²Œã€‚æ‰€ä»¥ä¸‹é¢æˆ‘ä»¬æŠŠå‡ ç§å¸¸è§çš„æœåŠ¡å™¨æ¥ç»™å¤§å®¶ç®€å•ä»‹ç»ä¸‹ï¼š IIS â€‹ å…¨ç§°(Internet Information Services)å³äº’è”ç½‘ä¿¡æ¯æœåŠ¡ï¼Œæ˜¯ç”±å¾®è½¯å…¬å¸æä¾›çš„åŸºäºwindowsç³»ç»Ÿçš„äº’è”ç½‘åŸºæœ¬æœåŠ¡ã€‚windowsä½œä¸ºæœåŠ¡å™¨åœ¨ç¨³å®šæ€§ä¸å…¶ä»–ä¸€äº›æ€§èƒ½ä¸Šéƒ½ä¸å¦‚ç±»UNIXæ“ä½œç³»ç»Ÿï¼Œå› æ­¤åœ¨éœ€è¦é«˜æ€§èƒ½WebæœåŠ¡å™¨çš„åœºåˆä¸‹ï¼ŒIISå¯èƒ½å°±ä¼šè¢«&quot;å†·è½&quot;. Tomcat â€‹ Tomcatæ˜¯ä¸€ä¸ªè¿è¡ŒServletå’ŒJSPçš„Webåº”ç”¨è½¯ä»¶ï¼ŒTomcatæŠ€æœ¯å…ˆè¿›ã€æ€§èƒ½ç¨³å®šè€Œä¸”å¼€æ”¾æºä»£ç ï¼Œå› æ­¤æ·±å—Javaçˆ±å¥½è€…çš„å–œçˆ±å¹¶å¾—åˆ°äº†éƒ¨åˆ†è½¯ä»¶å¼€å‘å•†çš„è®¤å¯ï¼Œæˆä¸ºç›®å‰æ¯”è¾ƒæµè¡Œçš„Webåº”ç”¨æœåŠ¡å™¨ã€‚ä½†æ˜¯Tomcatå¤©ç”Ÿæ˜¯ä¸€ä¸ªé‡é‡çº§çš„WebæœåŠ¡å™¨ï¼Œå¯¹é™æ€æ–‡ä»¶å’Œé«˜å¹¶å‘çš„å¤„ç†æ¯”è¾ƒå¼±ã€‚ Apache â€‹ Apacheçš„å‘å±•æ—¶æœŸå¾ˆé•¿ï¼ŒåŒæ—¶ä¹Ÿæœ‰è¿‡ä¸€æ®µè¾‰ç…Œçš„ä¸šç»©ã€‚ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºå¤§æ¦‚åœ¨2014å¹´ä»¥å‰éƒ½æ˜¯å¸‚åœºä»½é¢ç¬¬ä¸€çš„æœåŠ¡å™¨ã€‚Apacheæœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œå¦‚ç¨³å®šã€å¼€æºã€è·¨å¹³å°ç­‰ã€‚ä½†æ˜¯å®ƒå‡ºç°çš„æ—¶é—´å¤ªä¹…äº†ï¼Œåœ¨å®ƒå…´èµ·çš„å¹´ä»£ï¼Œäº’è”ç½‘çš„äº§ä¸šè§„æ¨¡è¿œè¿œä¸å¦‚ä»Šå¤©ï¼Œæ‰€ä»¥å®ƒè¢«è®¾è®¡æˆä¸€ä¸ªé‡é‡çº§çš„ã€ä¸æ”¯æŒé«˜å¹¶å‘çš„WebæœåŠ¡å™¨ã€‚åœ¨ApacheæœåŠ¡å™¨ä¸Šï¼Œå¦‚æœæœ‰æ•°ä»¥ä¸‡è®¡çš„å¹¶å‘HTTPè¯·æ±‚åŒæ—¶è®¿é—®ï¼Œå°±ä¼šå¯¼è‡´æœåŠ¡å™¨ä¸Šæ¶ˆè€—å¤§é‡èƒ½å­˜ï¼Œæ“ä½œç³»ç»Ÿå†…æ ¸å¯¹æˆç™¾ä¸Šåƒçš„Apacheè¿›ç¨‹åšè¿›ç¨‹é—´åˆ‡æ¢ä¹Ÿä¼šæ¶ˆè€—å¤§é‡çš„CUPèµ„æºï¼Œå¹¶å¯¼è‡´HTTPè¯·æ±‚çš„å¹³å‡å“åº”é€Ÿåº¦é™ä½ï¼Œè¿™äº›éƒ½å†³å®šäº†Apacheä¸å¯èƒ½æˆä¸ºé«˜æ€§èƒ½çš„WebæœåŠ¡å™¨ã€‚è¿™ä¹Ÿä¿ƒä½¿äº†Lighttpdå’ŒNginxçš„å‡ºç°ã€‚ Lighttpd â€‹ Lighttpdæ˜¯å¾·å›½çš„ä¸€ä¸ªå¼€æºçš„WebæœåŠ¡å™¨è½¯ä»¶ï¼Œå®ƒå’ŒNginxä¸€æ ·ï¼Œéƒ½æ˜¯è½»é‡çº§ã€é«˜æ€§èƒ½çš„WebæœåŠ¡å™¨ï¼Œæ¬§ç¾çš„ä¸šç•Œå¼€å‘è€…æ¯”è¾ƒé’Ÿçˆ±Lighttpd,è€Œå›½å†…çš„å…¬å¸æ›´å¤šçš„é’çNginxï¼ŒåŒæ—¶ç½‘ä¸ŠNginxçš„èµ„æºè¦æ›´ä¸°å¯Œäº›ã€‚ å…¶ä»–çš„æœåŠ¡å™¨ Google Serversï¼ŒWeblogic, Webshpere(IBM)â€¦ ç»è¿‡å„ä¸ªæœåŠ¡å™¨çš„å¯¹æ¯”ï¼Œç§ç§è¿¹è±¡éƒ½è¡¨æ˜ï¼ŒNginxå°†ä»¥æ€§èƒ½ä¸ºç‹ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆé€‰æ‹©Nginxçš„ç†ç”±ã€‚ Nginxçš„ä¼˜ç‚¹ (1)é€Ÿåº¦æ›´å¿«ã€å¹¶å‘æ›´é«˜ å•æ¬¡è¯·æ±‚æˆ–è€…é«˜å¹¶å‘è¯·æ±‚çš„ç¯å¢ƒä¸‹ï¼ŒNginxéƒ½ä¼šæ¯”å…¶ä»–WebæœåŠ¡å™¨å“åº”çš„é€Ÿåº¦æ›´å¿«ã€‚ä¸€æ–¹é¢åœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå•æ¬¡è¯·æ±‚ä¼šå¾—åˆ°æ›´å¿«çš„å“åº”ï¼Œå¦ä¸€æ–¹é¢ï¼Œåœ¨é«˜å³°æœŸ(å¦‚æœ‰æ•°ä»¥ä¸‡è®¡çš„å¹¶å‘è¯·æ±‚)ï¼ŒNginxæ¯”å…¶ä»–WebæœåŠ¡å™¨æ›´å¿«çš„å“åº”è¯·æ±‚ã€‚Nginxä¹‹æ‰€ä»¥æœ‰è¿™ä¹ˆé«˜çš„å¹¶å‘å¤„ç†èƒ½åŠ›å’Œè¿™ä¹ˆå¥½çš„æ€§èƒ½åŸå› åœ¨äºNginxé‡‡ç”¨äº†å¤šè¿›ç¨‹å’ŒI/Oå¤šè·¯å¤ç”¨(epoll)çš„åº•å±‚å®ç°ã€‚ (2)é…ç½®ç®€å•ï¼Œæ‰©å±•æ€§å¼º Nginxçš„è®¾è®¡æå…·æ‰©å±•æ€§ï¼Œå®ƒæœ¬èº«å°±æ˜¯ç”±å¾ˆå¤šæ¨¡å—ç»„æˆï¼Œè¿™äº›æ¨¡å—çš„ä½¿ç”¨å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çš„é…ç½®æ¥æ·»åŠ ã€‚è¿™äº›æ¨¡å—æœ‰å®˜æ–¹æä¾›çš„ä¹Ÿæœ‰ç¬¬ä¸‰æ–¹æä¾›çš„æ¨¡å—ï¼Œå¦‚æœéœ€è¦å®Œå…¨å¯ä»¥å¼€å‘æœåŠ¡è‡ªå·±ä¸šåŠ¡ç‰¹æ€§çš„å®šåˆ¶æ¨¡å—ã€‚ (3)é«˜å¯é æ€§ Nginxé‡‡ç”¨çš„æ˜¯å¤šè¿›ç¨‹æ¨¡å¼è¿è¡Œï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªmasterä¸»è¿›ç¨‹å’ŒNå¤šä¸ªworkerè¿›ç¨‹ï¼Œworkerè¿›ç¨‹çš„æ•°é‡æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è®¾ç½®ï¼Œæ¯ä¸ªworkerè¿›ç¨‹ä¹‹é—´éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹æä¾›æœåŠ¡ï¼Œå¹¶ä¸”masterä¸»è¿›ç¨‹å¯ä»¥åœ¨æŸä¸€ä¸ªworkerè¿›ç¨‹å‡ºé”™æ—¶ï¼Œå¿«é€Ÿå»&quot;æ‹‰èµ·&quot;æ–°çš„workerè¿›ç¨‹æä¾›æœåŠ¡ã€‚ (4)çƒ­éƒ¨ç½² ç°åœ¨äº’è”ç½‘é¡¹ç›®éƒ½è¦æ±‚ä»¥7*24å°æ—¶è¿›è¡ŒæœåŠ¡çš„æä¾›ï¼Œé’ˆå¯¹äºè¿™ä¸€è¦æ±‚ï¼ŒNginxä¹Ÿæä¾›äº†çƒ­éƒ¨ç½²åŠŸèƒ½ï¼Œå³å¯ä»¥åœ¨Nginxä¸åœæ­¢çš„æƒ…å†µä¸‹ï¼Œå¯¹Nginxè¿›è¡Œæ–‡ä»¶å‡çº§ã€æ›´æ–°é…ç½®å’Œæ›´æ¢æ—¥å¿—æ–‡ä»¶ç­‰åŠŸèƒ½ã€‚ (5)æˆæœ¬ä½ã€BSDè®¸å¯è¯ BSDæ˜¯ä¸€ä¸ªå¼€æºçš„è®¸å¯è¯ï¼Œä¸–ç•Œä¸Šçš„å¼€æºè®¸å¯è¯æœ‰å¾ˆå¤šï¼Œç°åœ¨æ¯”è¾ƒæµè¡Œçš„æœ‰å…­ç§åˆ†åˆ«æ˜¯GPLã€BSDã€MITã€Mozillaã€Apacheã€LGPLã€‚è¿™å…­ç§çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢ä¸€å¼ å›¾æ¥è§£é‡Šä¸‹ï¼š Nginxæœ¬èº«æ˜¯å¼€æºçš„ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥å…è´¹çš„å°†Nginxåº”ç”¨åœ¨å•†ä¸šé¢†åŸŸï¼Œè€Œä¸”è¿˜å¯ä»¥åœ¨é¡¹ç›®ä¸­ç›´æ¥ä¿®æ”¹Nginxçš„æºç æ¥å®šåˆ¶è‡ªå·±çš„ç‰¹æ®Šè¦æ±‚ã€‚è¿™äº›ç‚¹ä¹Ÿéƒ½æ˜¯Nginxä¸ºä»€ä¹ˆèƒ½å¸å¼•æ— æ•°å¼€å‘è€…ç»§ç»­ä¸ºNginxæ¥è´¡çŒ®è‡ªå·±çš„æ™ºæ…§å’Œé’æ˜¥ã€‚OpenRestry [Nginx+Lua] Tengine[æ·˜å®] Nginxçš„åŠŸèƒ½ç‰¹æ€§åŠå¸¸ç”¨åŠŸèƒ½ Nginxæä¾›çš„åŸºæœ¬åŠŸèƒ½æœåŠ¡ä»å¤§ä½“ä¸Šå½’çº³ä¸º&quot;åŸºæœ¬HTTPæœåŠ¡&quot;ã€â€œé«˜çº§HTTPæœåŠ¡â€å’Œ&quot;é‚®ä»¶æœåŠ¡&quot;ç­‰ä¸‰å¤§ç±»ã€‚ åŸºæœ¬HTTPæœåŠ¡ Nginxå¯ä»¥æä¾›åŸºæœ¬HTTPæœåŠ¡ï¼Œå¯ä»¥ä½œä¸ºHTTPä»£ç†æœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œæ”¯æŒé€šè¿‡ç¼“å­˜åŠ é€Ÿè®¿é—®ï¼Œå¯ä»¥å®Œæˆç®€å•çš„è´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼Œæ”¯æŒåŒ…è¿‡æ»¤åŠŸèƒ½ï¼Œæ”¯æŒSSLç­‰ã€‚ å¤„ç†é™æ€æ–‡ä»¶ã€å¤„ç†ç´¢å¼•æ–‡ä»¶ä»¥åŠæ”¯æŒè‡ªåŠ¨ç´¢å¼•ï¼› æä¾›åå‘ä»£ç†æœåŠ¡å™¨ï¼Œå¹¶å¯ä»¥ä½¿ç”¨ç¼“å­˜åŠ ä¸Šåå‘ä»£ç†ï¼ŒåŒæ—¶å®Œæˆè´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼› æä¾›å¯¹FastCGIã€memcachedç­‰æœåŠ¡çš„ç¼“å­˜æœºåˆ¶ï¼Œï¼ŒåŒæ—¶å®Œæˆè´Ÿè½½å‡è¡¡å’Œå®¹é”™ï¼› ä½¿ç”¨Nginxçš„æ¨¡å—åŒ–ç‰¹æ€§æä¾›è¿‡æ»¤å™¨åŠŸèƒ½ã€‚NginxåŸºæœ¬è¿‡æ»¤å™¨åŒ…æ‹¬gzipå‹ç¼©ã€rangesæ”¯æŒã€chunkedå“åº”ã€XSLTã€SSIä»¥åŠå›¾åƒç¼©æ”¾ç­‰ã€‚å…¶ä¸­é’ˆå¯¹åŒ…å«å¤šä¸ªSSIçš„é¡µé¢ï¼Œç»ç”±FastCGIæˆ–åå‘ä»£ç†ï¼ŒSSIè¿‡æ»¤å™¨å¯ä»¥å¹¶è¡Œå¤„ç†ã€‚ æ”¯æŒHTTPä¸‹çš„å®‰å…¨å¥—æ¥å±‚å®‰å…¨åè®®SSL. æ”¯æŒåŸºäºåŠ æƒå’Œä¾èµ–çš„ä¼˜å…ˆæƒçš„HTTP/2 é«˜çº§HTTPæœåŠ¡ æ”¯æŒåŸºäºåå­—å’ŒIPçš„è™šæ‹Ÿä¸»æœºè®¾ç½® æ”¯æŒHTTP/1.0ä¸­çš„KEEP-Aliveæ¨¡å¼å’Œç®¡çº¿(PipeLined)æ¨¡å‹è¿æ¥ è‡ªå®šä¹‰è®¿é—®æ—¥å¿—æ ¼å¼ã€å¸¦ç¼“å­˜çš„æ—¥å¿—å†™æ“ä½œä»¥åŠå¿«é€Ÿæ—¥å¿—è½®è½¬ã€‚ æä¾›3xx~5xxé”™è¯¯ä»£ç é‡å®šå‘åŠŸèƒ½ æ”¯æŒé‡å†™ï¼ˆRewrite)æ¨¡å—æ‰©å±• æ”¯æŒé‡æ–°åŠ è½½é…ç½®ä»¥åŠåœ¨çº¿å‡çº§æ—¶æ— éœ€ä¸­æ–­æ­£åœ¨å¤„ç†çš„è¯·æ±‚ æ”¯æŒç½‘ç»œç›‘æ§ æ”¯æŒFLVå’ŒMP4æµåª’ä½“ä¼ è¾“ é‚®ä»¶æœåŠ¡ Nginxæä¾›é‚®ä»¶ä»£ç†æœåŠ¡ä¹Ÿæ˜¯å…¶åŸºæœ¬å¼€å‘éœ€æ±‚ä¹‹ä¸€ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹ç‰¹æ€§ï¼š æ”¯æŒIMPA/POP3ä»£ç†æœåŠ¡åŠŸèƒ½ æ”¯æŒå†…éƒ¨SMTPä»£ç†æœåŠ¡åŠŸèƒ½ Nginxå¸¸ç”¨çš„åŠŸèƒ½æ¨¡å— 12345678910é™æ€èµ„æºéƒ¨ç½²Rewriteåœ°å€é‡å†™ æ­£åˆ™è¡¨è¾¾å¼åå‘ä»£ç†è´Ÿè½½å‡è¡¡ è½®è¯¢ã€åŠ æƒè½®è¯¢ã€ip_hashã€url_hashã€fairWebç¼“å­˜ç¯å¢ƒéƒ¨ç½² é«˜å¯ç”¨çš„ç¯å¢ƒç”¨æˆ·è®¤è¯æ¨¡å—... Nginxçš„æ ¸å¿ƒç»„æˆ 1234nginxäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶nginx.confé…ç½®æ–‡ä»¶error.logé”™è¯¯çš„æ—¥å¿—è®°å½•access.logè®¿é—®æ—¥å¿—è®°å½• Nginxç¯å¢ƒå‡†å¤‡ Nginxç‰ˆæœ¬ä»‹ç» Nginxçš„å®˜æ–¹ç½‘ç«™ä¸º: http://nginx.org æ‰“å¼€æºç å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„é¡µé¢å†…å®¹ Nginxçš„å®˜æ–¹ä¸‹è½½ç½‘ç«™ä¸ºhttp://nginx.org/en/download.htmlï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥ä¹‹é—´åœ¨é¦–é¡µé€‰ä¸­å³è¾¹çš„downloadè¿›å…¥ç‰ˆæœ¬ä¸‹è½½ç½‘é¡µã€‚åœ¨ä¸‹è½½é¡µé¢æˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š è·å–Nginxæºç  http://nginx.org/download/ æ‰“å¼€ä¸Šè¿°ç½‘ç«™ï¼Œå°±å¯ä»¥æŸ¥çœ‹åˆ°Nginxçš„æ‰€æœ‰ç‰ˆæœ¬ï¼Œé€‰ä¸­è‡ªå·±éœ€è¦çš„ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ã€‚ä¸‹è½½æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨windowsä¸Šä¸‹è½½ç„¶åä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä»æœåŠ¡å™¨ä¸Šä¸‹è½½ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å‡†å¤‡ä¸€å°æœåŠ¡å™¨ã€‚ å‡†å¤‡æœåŠ¡å™¨ç³»ç»Ÿ ç¯å¢ƒå‡†å¤‡ 12345VMware WorkStationCentos7MobaXterm xsheel,SecureCRTç½‘ç»œ (1)ç¡®è®¤centosçš„å†…æ ¸ å‡†å¤‡ä¸€ä¸ªå†…æ ¸ä¸º2.6åŠä»¥ä¸Šç‰ˆæœ¬çš„æ“ä½œç³»ç»Ÿï¼Œå› ä¸ºlinux2.6åŠä»¥ä¸Šå†…æ ¸æ‰æ”¯æŒepoll,è€ŒNginxéœ€è¦è§£å†³é«˜å¹¶å‘å‹åŠ›é—®é¢˜æ˜¯éœ€è¦ç”¨åˆ°epollï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æœ‰è¿™æ ·çš„ç‰ˆæœ¬è¦æ±‚ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨uname -aå‘½ä»¤æ¥æŸ¥è¯¢linuxçš„å†…æ ¸ç‰ˆæœ¬ã€‚ (2)ç¡®ä¿centosèƒ½è”ç½‘ 1ping www.baidu.com (3)ç¡®è®¤å…³é—­é˜²ç«å¢™ è¿™ä¸€é¡¹çš„è¦æ±‚ä»…é’ˆå¯¹äºé‚£äº›å¯¹linuxç³»ç»Ÿçš„é˜²ç«å¢™è®¾ç½®è§„åˆ™ä¸å¤ªæ¸…æ¥šçš„ï¼Œå»ºè®®å¤§å®¶æŠŠé˜²ç«å¢™éƒ½å…³é—­æ‰ï¼Œå› ä¸ºæˆ‘ä»¬æ­¤æ¬¡è¯¾ç¨‹ä¸»è¦çš„å†…å®¹æ˜¯å¯¹Nginxçš„å­¦ä¹ ï¼ŒæŠŠé˜²ç«å¢™å…³é—­æ‰ï¼Œå¯ä»¥çœæ‰åç»­Nginxå­¦ä¹ è¿‡ç¨‹ä¸­é‡åˆ°çš„è¯¸å¤šé—®é¢˜ã€‚ å…³é—­çš„æ–¹å¼æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š 123systemctl stop firewalld å…³é—­è¿è¡Œçš„é˜²ç«å¢™ï¼Œç³»ç»Ÿé‡æ–°å¯åŠ¨åï¼Œé˜²ç«å¢™å°†é‡æ–°æ‰“å¼€systemctl disable firewalld æ°¸ä¹…å…³é—­é˜²ç«å¢™ï¼Œï¼Œç³»ç»Ÿé‡æ–°å¯åŠ¨åï¼Œé˜²ç«å¢™ä¾ç„¶å…³é—­systemctl status firewalld æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ ï¼ˆ4ï¼‰ç¡®è®¤åœç”¨selinux selinux(security-enhanced linux),ç¾å›½å®‰å…¨å±€å¯¹äºå¼ºåˆ¶è®¿é—®æ§åˆ¶çš„å®ç°ï¼Œåœ¨linux2.6å†…æ ¸ä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œselinuxå·²ç»æˆåŠŸå†…æ ¸ä¸­çš„ä¸€éƒ¨åˆ†ã€‚å¯ä»¥è¯´selinuxæ˜¯linuxå²ä¸Šæœ€æ°å‡ºçš„æ–°å®‰å…¨å­ç³»ç»Ÿä¹‹ä¸€ã€‚è™½ç„¶æœ‰äº†selinuxï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿä¼šæ›´å®‰å…¨ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬çš„å­¦ä¹ Nginxçš„å†ç¨‹ä¸­ï¼Œä¼šå¤šå¾ˆå¤šè®¾ç½®ï¼Œæ‰€ä»¥è¿™å—å»ºè®®å¤§å®¶å°†selinuxè¿›è¡Œå…³é—­ã€‚ sestatusæŸ¥çœ‹çŠ¶æ€ å¦‚æœæŸ¥çœ‹ä¸æ˜¯disabledçŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ–‡ä»¶æ¥è¿›è¡Œè®¾ç½®,ä¿®æ”¹SELINUX=disabledï¼Œç„¶åé‡å¯ä¸‹ç³»ç»Ÿå³å¯ç”Ÿæ•ˆã€‚ 1vim /etc/selinux/config Nginxå®‰è£…æ–¹å¼ä»‹ç» Nginxçš„å®‰è£…æ–¹å¼æœ‰ä¸¤ç§åˆ†åˆ«æ˜¯: 1234é€šè¿‡Nginxæºç  é€šè¿‡Nginxæºç ç®€å•å®‰è£… (1) é€šè¿‡Nginxæºç å¤æ‚å®‰è£… (3)é€šè¿‡yumå®‰è£… (2) å¦‚æœé€šè¿‡Nginxæºç å®‰è£…éœ€è¦æå‰å‡†å¤‡çš„å†…å®¹ï¼š GCCç¼–è¯‘å™¨ Nginxæ˜¯ä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„ç¨‹åºï¼Œå› æ­¤æƒ³è¦è¿è¡ŒNginxå°±éœ€è¦å®‰è£…ä¸€ä¸ªç¼–è¯‘å·¥å…·ã€‚GCCå°±æ˜¯ä¸€ä¸ªå¼€æºçš„ç¼–è¯‘å™¨é›†åˆï¼Œç”¨äºå¤„ç†å„ç§å„æ ·çš„è¯­è¨€ï¼Œå…¶ä¸­å°±åŒ…å«äº†Cè¯­è¨€ã€‚ ä½¿ç”¨å‘½ä»¤yum install -y gccæ¥å®‰è£… å®‰è£…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡gcc --versionæ¥æŸ¥çœ‹gccæ˜¯å¦å®‰è£…æˆåŠŸ PCRE Nginxåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨åˆ°PCREåº“ï¼ˆperl Compatible Regular Expressoin å…¼å®¹æ­£åˆ™è¡¨è¾¾å¼åº“)ï¼Œå› ä¸ºåœ¨Nginxçš„Rewriteæ¨¡å—å’Œhttpæ ¸å¿ƒæ¨¡å—éƒ½ä¼šä½¿ç”¨åˆ°PCREæ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ã€‚ å¯ä»¥ä½¿ç”¨å‘½ä»¤yum install -y pcre pcre-develæ¥è¿›è¡Œå®‰è£… å®‰è£…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡rpm -qa pcre pcre-develæ¥æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ zlib zlibåº“æä¾›äº†å¼€å‘äººå‘˜çš„å‹ç¼©ç®—æ³•ï¼Œåœ¨Nginxçš„å„ä¸ªæ¨¡å—ä¸­éœ€è¦ä½¿ç”¨gzipå‹ç¼©ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿéœ€è¦æå‰å®‰è£…å…¶åº“åŠæºä»£ç zlibå’Œzlib-devel å¯ä»¥ä½¿ç”¨å‘½ä»¤yum install -y zlib zlib-develæ¥è¿›è¡Œå®‰è£… å®‰è£…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡rpm -qa zlib zlib-develæ¥æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ OpenSSL OpenSSLæ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„è½¯ä»¶åº“åŒ…ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨è¿™ä¸ªåŒ…è¿›è¡Œå®‰å…¨é€šä¿¡ï¼Œå¹¶ä¸”é¿å…è¢«çªƒå¬ã€‚ SSL:Secure Sockets Layerå®‰å…¨å¥—æ¥åè®®çš„ç¼©å†™ï¼Œå¯ä»¥åœ¨Internetä¸Šæä¾›ç§˜å¯†æ€§ä¼ è¾“ï¼Œå…¶ç›®æ ‡æ˜¯ä¿è¯ä¸¤ä¸ªåº”ç”¨é—´é€šä¿¡çš„ä¿å¯†æ€§å’Œå¯é æ€§ã€‚åœ¨Nginxä¸­ï¼Œå¦‚æœæœåŠ¡å™¨éœ€è¦æä¾›å®‰å…¨ç½‘é¡µæ—¶å°±éœ€è¦ç”¨åˆ°OpenSSLåº“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹OpenSSLçš„åº“æ–‡ä»¶åŠå®ƒçš„å¼€å‘å®‰è£…åŒ…è¿›è¡Œä¸€ä¸ªå®‰è£…ã€‚ å¯ä»¥ä½¿ç”¨å‘½ä»¤yum install -y openssl openssl-develæ¥è¿›è¡Œå®‰è£… å®‰è£…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡rpm -qa openssl openssl-develæ¥æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ ä¸Šè¿°å‘½ä»¤ï¼Œä¸€ä¸ªä¸ªæ¥çš„è¯æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸€æ¡å‘½ä»¤æ¥è¿›è¡Œå®‰è£… yum install -y gcc pcre pcre-devel zlib zlib-devel openssl openssl-develè¿›è¡Œå…¨éƒ¨å®‰è£…ã€‚ æ–¹æ¡ˆä¸€ï¼šNginxçš„æºç ç®€å•å®‰è£… (1)è¿›å…¥å®˜ç½‘æŸ¥æ‰¾éœ€è¦ä¸‹è½½ç‰ˆæœ¬çš„é“¾æ¥åœ°å€ï¼Œç„¶åä½¿ç”¨wgetå‘½ä»¤è¿›è¡Œä¸‹è½½ 1wget http://nginx.org/download/nginx-1.16.1.tar.gz (2)å»ºè®®å¤§å®¶å°†ä¸‹è½½çš„èµ„æºè¿›è¡ŒåŒ…ç®¡ç† 12mkdir -p nginx/coremv nginx-1.16.1.tar.gz nginx/core (3)è§£å‹ç¼© 1tar -xzf nginx-1.16.1.tar.gz (4)è¿›å…¥èµ„æºæ–‡ä»¶ä¸­ï¼Œå‘ç°configure 1./configure (5)ç¼–è¯‘ 1make (6)å®‰è£… 1make install æ–¹æ¡ˆäºŒï¼šyumå®‰è£… ä½¿ç”¨æºç è¿›è¡Œç®€å•å®‰è£…ï¼Œæˆ‘ä»¬ä¼šå‘ç°å®‰è£…çš„è¿‡ç¨‹æ¯”è¾ƒç¹çï¼Œéœ€è¦æå‰å‡†å¤‡GCCç¼–è¯‘å™¨ã€PCREå…¼å®¹æ­£åˆ™è¡¨è¾¾å¼åº“ã€zlibå‹ç¼©åº“ã€OpenSSLå®‰å…¨é€šä¿¡çš„è½¯ä»¶åº“åŒ…ï¼Œç„¶åæ‰èƒ½è¿›è¡ŒNginxçš„å®‰è£…ã€‚ ï¼ˆ1ï¼‰å®‰è£…yum-utils 1sudo yum install -y yum-utils ï¼ˆ2ï¼‰æ·»åŠ yumæºæ–‡ä»¶ 1vim /etc/yum.repos.d/nginx.repo 123456789101112131415[nginx-stable]name=nginx stable repobaseurl=http://nginx.org/packages/centos/$releasever/$basearch/gpgcheck=1enabled=1gpgkey=https://nginx.org/keys/nginx_signing.keymodule_hotfixes=true[nginx-mainline]name=nginx mainline repobaseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/gpgcheck=1enabled=0gpgkey=https://nginx.org/keys/nginx_signing.keymodule_hotfixes=true ï¼ˆ3ï¼‰æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ 1yum list | grep nginx ï¼ˆ4ï¼‰ä½¿ç”¨yumè¿›è¡Œå®‰è£… 1yun install -y nginx ï¼ˆ5ï¼‰æŸ¥çœ‹nginxçš„å®‰è£…ä½ç½® 1whereis nginx ï¼ˆ6ï¼‰å¯åŠ¨æµ‹è¯• 123cd /usr/sbin./nginx#æµè§ˆå™¨æ‰“å¼€IPADDRï¼Œå‡ºç°nginxå³ä¸ºå¯åŠ¨æˆåŠŸ æºç ç®€å•å®‰è£…å’Œyumå®‰è£…çš„å·®å¼‚ï¼š è¿™é‡Œå…ˆä»‹ç»ä¸€ä¸ªå‘½ä»¤: ./nginx -V,é€šè¿‡è¯¥å‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°æ‰€å®‰è£…Nginxçš„ç‰ˆæœ¬åŠç›¸å…³é…ç½®ä¿¡æ¯ã€‚ ç®€å•å®‰è£… yumå®‰è£… è§£å‹Nginxç›®å½• æ‰§è¡Œtar -zxvf nginx-1.16.1.tar.gzå¯¹ä¸‹è½½çš„èµ„æºè¿›è¡Œè§£å‹ç¼©ï¼Œè¿›å…¥å‹ç¼©åçš„ç›®å½•ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æ„ å†…å®¹è§£é‡Šï¼š auto:å­˜æ”¾çš„æ˜¯ç¼–è¯‘ç›¸å…³çš„è„šæœ¬ CHANGES:ç‰ˆæœ¬å˜æ›´è®°å½• CHANGES.ru:ä¿„ç½—æ–¯æ–‡çš„ç‰ˆæœ¬å˜æ›´è®°å½• conf:nginxé»˜è®¤çš„é…ç½®æ–‡ä»¶ configure:nginxè½¯ä»¶çš„è‡ªåŠ¨è„šæœ¬ç¨‹åº,æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æ–‡ä»¶ï¼Œä½œç”¨å¦‚ä¸‹ï¼š â€‹ ï¼ˆ1ï¼‰æ£€æµ‹ç¯å¢ƒåŠæ ¹æ®ç¯å¢ƒæ£€æµ‹ç»“æœç”ŸæˆCä»£ç  â€‹ ï¼ˆ2ï¼‰ç”Ÿæˆç¼–è¯‘ä»£ç éœ€è¦çš„Makefileæ–‡ä»¶ contrib:å­˜æ”¾çš„æ˜¯å‡ ä¸ªç‰¹æ®Šçš„è„šæœ¬æ–‡ä»¶ï¼Œå…¶ä¸­READMEä¸­å¯¹è„šæœ¬æœ‰ç€è¯¦ç»†çš„è¯´æ˜ html:å­˜æ”¾çš„æ˜¯Nginxè‡ªå¸¦çš„ä¸¤ä¸ªhtmlé¡µé¢ï¼Œè®¿é—®Nginxçš„é¦–é¡µå’Œé”™è¯¯é¡µé¢ LICENSE:è®¸å¯è¯çš„ç›¸å…³æè¿°æ–‡ä»¶ man:nginxçš„manæ‰‹å†Œ README:Nginxçš„é˜…è¯»æŒ‡å— src:Nginxçš„æºä»£ç  æ–¹æ¡ˆä¸‰:Nginxçš„æºç å¤æ‚å®‰è£… è¿™ç§æ–¹å¼å’Œç®€å•çš„å®‰è£…é…ç½®ä¸åŒçš„åœ°æ–¹åœ¨ç¬¬ä¸€æ­¥ï¼Œé€šè¿‡./configureæ¥å¯¹ç¼–è¯‘å‚æ•°è¿›è¡Œè®¾ç½®ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æ¥æŒ‡å®šã€‚é‚£ä¹ˆéƒ½æœ‰å“ªäº›å‚æ•°å¯ä»¥è¿›è¡Œè®¾ç½®ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡Œä¸€ä¸ªè¯¦ç»†çš„è¯´æ˜ã€‚ PATH:æ˜¯å’Œè·¯å¾„ç›¸å…³çš„é…ç½®ä¿¡æ¯ with:æ˜¯å¯åŠ¨æ¨¡å—ï¼Œé»˜è®¤æ˜¯å…³é—­çš„ without:æ˜¯å…³é—­æ¨¡å—ï¼Œé»˜è®¤æ˜¯å¼€å¯çš„ æˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸€äº›ç®€å•çš„è·¯å¾„é…ç½®å·²ç»é€šè¿‡è¿™äº›é…ç½®æ¥å®Œæˆä¸€ä¸ªç®€å•çš„ç¼–è¯‘ï¼š â€“prefix=PATH 1æŒ‡å‘Nginxçš„å®‰è£…ç›®å½•ï¼Œé»˜è®¤å€¼ä¸º/usr/local/nginx â€“sbin-path=PATH 1æŒ‡å‘(æ‰§è¡Œ)ç¨‹åºæ–‡ä»¶(nginx)çš„è·¯å¾„,é»˜è®¤å€¼ä¸º&lt;prefix&gt;/sbin/nginx â€“modules-path=PATH 1æŒ‡å‘NginxåŠ¨æ€æ¨¡å—å®‰è£…ç›®å½•ï¼Œé»˜è®¤å€¼ä¸º&lt;prefix&gt;/modules â€“conf-path=PATH 1æŒ‡å‘é…ç½®æ–‡ä»¶(nginx.conf)çš„è·¯å¾„,é»˜è®¤å€¼ä¸º&lt;prefix&gt;/conf/nginx.conf â€“error-log-path=PATH 1æŒ‡å‘é”™è¯¯æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„,é»˜è®¤å€¼ä¸º&lt;prefix&gt;/logs/error.log â€“http-log-path=PATH 1æŒ‡å‘è®¿é—®æ—¥å¿—æ–‡ä»¶çš„è·¯å¾„,é»˜è®¤å€¼ä¸º&lt;prefix&gt;/logs/access.log â€“pid-path=PATH 1æŒ‡å‘Nginxå¯åŠ¨åè¿›è¡ŒIDçš„æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º&lt;prefix&gt;/logs/nginx.pid â€“lock-path=PATH 1æŒ‡å‘Nginxé”æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„,é»˜è®¤å€¼ä¸º&lt;prefix&gt;/logs/nginx.lock è¦æƒ³ä½¿ç”¨å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤ 12345678./configure --prefix=/usr/local/nginx \\--sbin-path=/usr/local/nginx/sbin/nginx \\--modules-path=/usr/local/nginx/modules \\--conf-path=/usr/local/nginx/conf/nginx.conf \\--error-log-path=/usr/local/nginx/logs/error.log \\--http-log-path=/usr/local/nginx/logs/access.log \\--pid-path=/usr/local/nginx/logs/nginx.pid \\--lock-path=/usr/local/nginx/logs/nginx.lock åœ¨ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ä¹‹å‰ï¼Œéœ€è¦å°†ä¹‹å‰æœåŠ¡å™¨å·²ç»å®‰è£…çš„nginxè¿›è¡Œå¸è½½ï¼Œå¸è½½çš„æ­¥éª¤åˆ†ä¸ºä¸‰æ­¥éª¤ï¼š æ­¥éª¤ä¸€ï¼šéœ€è¦å°†nginxçš„è¿›ç¨‹å…³é—­ 1./nginx -s stop æ­¥éª¤äºŒ:å°†å®‰è£…çš„nginxè¿›è¡Œåˆ é™¤ 1rm -rf /usr/local/nginx æ­¥éª¤ä¸‰:å°†å®‰è£…åŒ…ä¹‹å‰ç¼–è¯‘çš„ç¯å¢ƒæ¸…é™¤æ‰ 1make clean Nginxç›®å½•ç»“æ„åˆ†æ åœ¨ä½¿ç”¨Nginxä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¯¹å®‰è£…å¥½çš„Nginxç›®å½•æ–‡ä»¶è¿›è¡Œä¸€ä¸ªåˆ†æï¼Œåœ¨è¿™å—ç»™å¤§å®¶ä»‹ç»ä¸€ä¸ªå·¥å…·treeï¼Œé€šè¿‡treeæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹é¢çš„å»æŸ¥çœ‹centosç³»ç»Ÿä¸Šçš„æ–‡ä»¶ç›®å½•ç»“æ„ï¼Œå½“ç„¶ï¼Œå¦‚æœæƒ³ä½¿ç”¨treeå·¥å…·ï¼Œå°±å¾—å…ˆé€šè¿‡yum install -y treeæ¥è¿›è¡Œå®‰è£…ï¼Œå®‰è£…æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œtree /usr/local/nginx(treeåé¢è·Ÿçš„æ˜¯Nginxçš„å®‰è£…ç›®å½•)ï¼Œè·å–çš„ç»“æœå¦‚ä¸‹ï¼š conf:nginxæ‰€æœ‰é…ç½®æ–‡ä»¶ç›®å½• â€‹ CGI(Common Gateway Interface)é€šç”¨ç½‘å…³ã€æ¥å£ã€‘ï¼Œä¸»è¦è§£å†³çš„é—®é¢˜æ˜¯ä»å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªè¯·æ±‚å’Œæ•°æ®ï¼ŒæœåŠ¡ç«¯è·å–åˆ°è¯·æ±‚å’Œæ•°æ®åå¯ä»¥è°ƒç”¨è°ƒç”¨CGIã€ç¨‹åºã€‘å¤„ç†åŠç›¸åº”ç»“æœç»™å®¢æˆ·ç«¯çš„ä¸€ç§æ ‡å‡†è§„èŒƒã€‚ â€‹ fastcgi.conf:fastcgiç›¸å…³é…ç½®æ–‡ä»¶ â€‹ fastcgi.conf.default:fastcgi.confçš„å¤‡ä»½æ–‡ä»¶ â€‹ fastcgi_params:fastcgiçš„å‚æ•°æ–‡ä»¶ â€‹ fastcgi_params.default:fastcgiçš„å‚æ•°å¤‡ä»½æ–‡ä»¶ â€‹ scgi_params:scgiçš„å‚æ•°æ–‡ä»¶ â€‹ scgi_params.defaultï¼šscgiçš„å‚æ•°å¤‡ä»½æ–‡ä»¶ â€‹ uwsgi_params:uwsgiçš„å‚æ•°æ–‡ä»¶ â€‹ uwsgi_params.default:uwsgiçš„å‚æ•°å¤‡ä»½æ–‡ä»¶ â€‹ mime.types:è®°å½•çš„æ˜¯HTTPåè®®ä¸­çš„Content-Typeçš„å€¼å’Œæ–‡ä»¶åç¼€åçš„å¯¹åº”å…³ç³» â€‹ mime.types.default:mime.typesçš„å¤‡ä»½æ–‡ä»¶ â€‹ nginx.conf:è¿™ä¸ªæ˜¯Nginxçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶éå¸¸é‡è¦ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å³å°†è¦å­¦ä¹ çš„é‡ç‚¹ â€‹ nginx.conf.default:nginx.confçš„å¤‡ä»½æ–‡ä»¶ â€‹ koi-utfã€koi-winã€win-utfè¿™ä¸‰ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸ç¼–ç è½¬æ¢æ˜ å°„ç›¸å…³çš„é…ç½®æ–‡ä»¶ï¼Œç”¨æ¥å°†ä¸€ç§ç¼–ç è½¬æ¢æˆå¦ä¸€ç§ç¼–ç  html:å­˜æ”¾nginxè‡ªå¸¦çš„ä¸¤ä¸ªé™æ€çš„htmlé¡µé¢ â€‹ 50x.html:è®¿é—®å¤±è´¥åçš„å¤±è´¥é¡µé¢ â€‹ index.html:æˆåŠŸè®¿é—®çš„é»˜è®¤é¦–é¡µ logs:è®°å½•å…¥é—¨çš„æ–‡ä»¶ï¼Œå½“nginxæœåŠ¡å™¨å¯åŠ¨åï¼Œè¿™é‡Œé¢ä¼šæœ‰ access.log error.log å’Œnginx.pidä¸‰ä¸ªæ–‡ä»¶å‡ºç°ã€‚ sbin:æ˜¯å­˜æ”¾æ‰§è¡Œç¨‹åºæ–‡ä»¶nginx â€‹ nginxæ˜¯ç”¨æ¥æ§åˆ¶Nginxçš„å¯åŠ¨å’Œåœæ­¢ç­‰ç›¸å…³çš„å‘½ä»¤ã€‚ NginxæœåŠ¡å™¨å¯åœå‘½ä»¤ Nginxå®‰è£…å®Œæˆåï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦å­¦ä¹ çš„æ˜¯å¦‚ä½•å¯åŠ¨ã€é‡å¯å’Œåœæ­¢Nginxçš„æœåŠ¡ã€‚ å¯¹äºNginxçš„å¯åœåœ¨linuxç³»ç»Ÿä¸­ä¹Ÿæœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œæˆ‘ä»¬æœ¬æ¬¡è¯¾ç¨‹ä»‹ç»ä¸¤ç§æ–¹å¼ï¼š NginxæœåŠ¡çš„ä¿¡å·æ§åˆ¶ Nginxçš„å‘½ä»¤è¡Œæ§åˆ¶ æ–¹å¼ä¸€:NginxæœåŠ¡çš„ä¿¡å·æ§åˆ¶ 12345Nginxä¸­çš„masterå’Œworkerè¿›ç¨‹?Nginxçš„å·¥ä½œæ–¹å¼?å¦‚ä½•è·å–è¿›ç¨‹çš„PID?ä¿¡å·æœ‰å“ªäº›?å¦‚ä½•é€šè¿‡ä¿¡å·æ§åˆ¶Nginxçš„å¯åœç­‰ç›¸å…³æ“ä½œ? å‰é¢åœ¨æåˆ°Nginxçš„é«˜æ€§èƒ½ï¼Œå…¶å®ä¹Ÿå’Œå®ƒçš„æ¶æ„æ¨¡å¼æœ‰å…³ã€‚Nginxé»˜è®¤é‡‡ç”¨çš„æ˜¯å¤šè¿›ç¨‹çš„æ–¹å¼æ¥å·¥ä½œçš„ï¼Œå½“å°†Nginxå¯åŠ¨åï¼Œæˆ‘ä»¬é€šè¿‡ps -ef | grep nginxå‘½ä»¤å¯ä»¥æŸ¥çœ‹åˆ°å¦‚ä¸‹å†…å®¹ï¼š ps å‘½ä»¤ ï¼šè·å–æ­£åœ¨è¿è¡Œè¿›ç¨‹ä¿¡æ¯ grepï¼šè¿‡æ»¤nginxç›¸å…³å‘½ä»¤ ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°,Nginxåå°è¿›ç¨‹ä¸­åŒ…å«ä¸€ä¸ªmasterè¿›ç¨‹å’Œå¤šä¸ªworkerè¿›ç¨‹ï¼Œmasterè¿›ç¨‹ä¸»è¦ç”¨æ¥ç®¡ç†workerè¿›ç¨‹ï¼ŒåŒ…å«æ¥æ”¶å¤–ç•Œçš„ä¿¡æ¯ï¼Œå¹¶å°†æ¥æ”¶åˆ°çš„ä¿¡å·å‘é€ç»™å„ä¸ªworkerè¿›ç¨‹ï¼Œç›‘æ§workerè¿›ç¨‹çš„çŠ¶æ€ï¼Œå½“workerè¿›ç¨‹å‡ºç°å¼‚å¸¸é€€å‡ºåï¼Œä¼šè‡ªåŠ¨é‡æ–°å¯åŠ¨æ–°çš„workerè¿›ç¨‹ã€‚è€Œworkerè¿›ç¨‹åˆ™æ˜¯ä¸“é—¨ç”¨æ¥å¤„ç†ç”¨æˆ·è¯·æ±‚çš„ï¼Œå„ä¸ªworkerè¿›ç¨‹ä¹‹é—´æ˜¯å¹³ç­‰çš„å¹¶ä¸”ç›¸äº’ç‹¬ç«‹ï¼Œå¤„ç†è¯·æ±‚çš„æœºä¼šä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚nginxçš„è¿›ç¨‹æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹å›¾æ¥è¯´æ˜ä¸‹ï¼š æˆ‘ä»¬ç°åœ¨ä½œä¸ºç®¡ç†å‘˜ï¼Œåªéœ€è¦é€šè¿‡ç»™masterè¿›ç¨‹å‘é€ä¿¡å·å°±å¯ä»¥æ¥æ§åˆ¶Nginx,è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦æœ‰ä¸¤ä¸ªå‰ææ¡ä»¶ï¼Œä¸€ä¸ªæ˜¯è¦æ“ä½œçš„masterè¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯ä¿¡å·ã€‚ ï¼ˆ1ï¼‰è¦æƒ³æ“ä½œNginxçš„masterè¿›ç¨‹ï¼Œå°±éœ€è¦è·å–åˆ°masterè¿›ç¨‹çš„è¿›ç¨‹å·IDã€‚è·å–æ–¹å¼ç®€å•ä»‹ç»ä¸¤ä¸ªï¼Œ æ–¹å¼ä¸€ï¼šé€šè¿‡ps -ef | grep nginxï¼› æ–¹å¼äºŒï¼šåœ¨è®²è§£nginxçš„./configureçš„é…ç½®å‚æ•°çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªå‚æ•°æ˜¯--pid-path=PATHé»˜è®¤æ˜¯/usr/local/nginx/logs/nginx.pid,æ‰€ä»¥å¯ä»¥é€šè¿‡æŸ¥çœ‹è¯¥æ–‡ä»¶æ¥è·å–nginxçš„masterè¿›ç¨‹ID. ï¼ˆ2ï¼‰ä¿¡å· ä¿¡å· ä½œç”¨ TERM/INT ç«‹å³å…³é—­æ•´ä¸ªæœåŠ¡ QUIT &quot;ä¼˜é›…&quot;åœ°å…³é—­æ•´ä¸ªæœåŠ¡ HUP é‡è¯»é…ç½®æ–‡ä»¶å¹¶ä½¿ç”¨æœåŠ¡å¯¹æ–°é…ç½®é¡¹ç”Ÿæ•ˆ USR1 é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ï¼Œå¯ä»¥ç”¨æ¥è¿›è¡Œæ—¥å¿—åˆ‡å‰² USR2 å¹³æ»‘å‡çº§åˆ°æœ€æ–°ç‰ˆçš„nginx WINCH æ‰€æœ‰å­è¿›ç¨‹ä¸åœ¨æ¥æ”¶å¤„ç†æ–°è¿æ¥ï¼Œç›¸å½“äºç»™workè¿›ç¨‹å‘é€QUITæŒ‡ä»¤ è°ƒç”¨å‘½ä»¤ä¸ºkill -signal PID ä¾‹å¦‚ kill -TERM 20211 signal:å³ä¸ºä¿¡å·ï¼›PIDå³ä¸ºè·å–åˆ°çš„masterçº¿ç¨‹ID å‘é€TERM/INTä¿¡å·ç»™masterè¿›ç¨‹ï¼Œä¼šå°†NginxæœåŠ¡ç«‹å³å…³é—­ã€‚ 12kill -TERM PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid`kill -INT PID / kill -INT `cat /usr/local/nginx/logs/nginx.pid` å‘é€QUITä¿¡å·ç»™masterè¿›ç¨‹ï¼Œmasterè¿›ç¨‹ä¼šæ§åˆ¶æ‰€æœ‰çš„workè¿›ç¨‹ä¸å†æ¥æ”¶æ–°çš„è¯·æ±‚ï¼Œç­‰æ‰€æœ‰è¯·æ±‚å¤„ç†å®Œåï¼Œåœ¨æŠŠè¿›ç¨‹éƒ½å…³é—­æ‰ã€‚ 1kill -QUIT PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid` å‘é€HUPä¿¡å·ç»™masterè¿›ç¨‹ï¼Œmasterè¿›ç¨‹ä¼šæŠŠæ§åˆ¶æ—§çš„workè¿›ç¨‹ä¸å†æ¥æ”¶æ–°çš„è¯·æ±‚ï¼Œç­‰å¤„ç†å®Œè¯·æ±‚åå°†æ—§çš„workè¿›ç¨‹å…³é—­æ‰ï¼Œç„¶åæ ¹æ®nginxçš„é…ç½®æ–‡ä»¶é‡æ–°å¯åŠ¨æ–°çš„workè¿›ç¨‹ 1kill -HUP PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid` å‘é€USR1ä¿¡å·ç»™masterè¿›ç¨‹ï¼Œå‘Šè¯‰Nginxé‡æ–°å¼€å¯æ—¥å¿—æ–‡ä»¶ 1kill -USR1 PID / kill -TERM `cat /usr/local/nginx/logs/nginx.pid` å‘é€USR2ä¿¡å·ç»™masterè¿›ç¨‹ï¼Œå‘Šè¯‰masterè¿›ç¨‹è¦å¹³æ»‘å‡çº§ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¼šé‡æ–°å¼€å¯å¯¹åº”çš„masterè¿›ç¨‹å’Œworkè¿›ç¨‹ï¼Œæ•´ä¸ªç³»ç»Ÿä¸­å°†ä¼šæœ‰ä¸¤ä¸ªmasterè¿›ç¨‹ï¼Œå¹¶ä¸”æ–°çš„masterè¿›ç¨‹çš„PIDä¼šè¢«è®°å½•åœ¨/usr/local/nginx/logs/nginx.pidè€Œä¹‹å‰çš„æ—§çš„masterè¿›ç¨‹PIDä¼šè¢«è®°å½•åœ¨/usr/local/nginx/logs/nginx.pid.oldbinæ–‡ä»¶ä¸­ï¼Œæ¥ç€å†æ¬¡å‘é€QUITä¿¡å·ç»™æ—§çš„masterè¿›ç¨‹ï¼Œè®©å…¶å¤„ç†å®Œè¯·æ±‚åå†è¿›è¡Œå…³é—­ 1kill -USR2 PID / kill -USR2 `cat /usr/local/nginx/logs/nginx.pid` 1kill -QUIT PID / kill -QUIT `cat /usr/local/nginx/logs/nginx.pid.oldbin` å‘é€WINCHä¿¡å·ç»™masterè¿›ç¨‹,è®©masterè¿›ç¨‹æ§åˆ¶ä¸è®©æ‰€æœ‰çš„workè¿›ç¨‹åœ¨æ¥æ”¶æ–°çš„è¯·æ±‚äº†ï¼Œè¯·æ±‚å¤„ç†å®Œåå…³é—­workè¿›ç¨‹ã€‚æ³¨æ„masterè¿›ç¨‹ä¸ä¼šè¢«å…³é—­æ‰ 1kill -WINCH PID /kill -WINCH`cat /usr/local/nginx/logs/nginx.pid` æ–¹å¼äºŒ:Nginxçš„å‘½ä»¤è¡Œæ§åˆ¶ æ­¤æ–¹å¼æ˜¯é€šè¿‡Nginxå®‰è£…ç›®å½•ä¸‹çš„sbinä¸‹çš„å¯æ‰§è¡Œæ–‡ä»¶nginxæ¥è¿›è¡ŒNginxçŠ¶æ€çš„æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡nginx -hæ¥æŸ¥çœ‹éƒ½æœ‰å“ªäº›å‚æ•°å¯ä»¥ç”¨ï¼š -?å’Œ-h:æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ -v:æ‰“å°ç‰ˆæœ¬å·ä¿¡æ¯å¹¶é€€å‡º -V:æ‰“å°ç‰ˆæœ¬å·ä¿¡æ¯å’Œé…ç½®ä¿¡æ¯å¹¶é€€å‡º -t:æµ‹è¯•nginxçš„é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®å¹¶é€€å‡º -T:æµ‹è¯•nginxçš„é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®å¹¶åˆ—å‡ºç”¨åˆ°çš„é…ç½®æ–‡ä»¶ä¿¡æ¯ç„¶åé€€å‡º -q:åœ¨é…ç½®æµ‹è¯•æœŸé—´ç¦æ­¢æ˜¾ç¤ºéé”™è¯¯æ¶ˆæ¯ -s:signalä¿¡å·ï¼Œåé¢å¯ä»¥è·Ÿ ï¼š â€‹ stop[å¿«é€Ÿå…³é—­ï¼Œç±»ä¼¼äºTERM/INTä¿¡å·çš„ä½œç”¨] â€‹ quit[ä¼˜é›…çš„å…³é—­ï¼Œç±»ä¼¼äºQUITä¿¡å·çš„ä½œç”¨] â€‹ reopen[é‡æ–°æ‰“å¼€æ—¥å¿—æ–‡ä»¶ç±»ä¼¼äºUSR1ä¿¡å·çš„ä½œç”¨] â€‹ reload[ç±»ä¼¼äºHUPä¿¡å·çš„ä½œç”¨] -p:prefixï¼ŒæŒ‡å®šNginxçš„prefixè·¯å¾„ï¼Œ(é»˜è®¤ä¸º: /usr/local/nginx/) -c:filename,æŒ‡å®šNginxçš„é…ç½®æ–‡ä»¶è·¯å¾„,(é»˜è®¤ä¸º: conf/nginx.conf) -g:ç”¨æ¥è¡¥å……Nginxé…ç½®æ–‡ä»¶ï¼Œå‘NginxæœåŠ¡æŒ‡å®šå¯åŠ¨æ—¶åº”ç”¨å…¨å±€çš„é…ç½® NginxæœåŠ¡å™¨ç‰ˆæœ¬å‡çº§å’Œæ–°å¢æ¨¡å— å¦‚æœæƒ³å¯¹Nginxçš„ç‰ˆæœ¬è¿›è¡Œæ›´æ–°ï¼Œæˆ–è€…è¦åº”ç”¨ä¸€äº›æ–°çš„æ¨¡å—ï¼Œæœ€ç®€å•çš„åšæ³•å°±æ˜¯åœæ­¢å½“å‰çš„NginxæœåŠ¡ï¼Œç„¶åå¼€å¯æ–°çš„NginxæœåŠ¡ã€‚ä½†æ˜¯è¿™æ ·ä¼šå¯¼è‡´åœ¨ä¸€æ®µæ—¶é—´å†…ï¼Œç”¨æˆ·æ˜¯æ— æ³•è®¿é—®æœåŠ¡å™¨ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°NginxæœåŠ¡å™¨æä¾›çš„å¹³æ»‘å‡çº§åŠŸèƒ½ã€‚è¿™ä¸ªä¹Ÿæ˜¯Nginxçš„ä¸€å¤§ç‰¹ç‚¹ï¼Œä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå°±å¯ä»¥ä½¿Nginxåœ¨7*24å°æ—¶ä¸é—´æ–­çš„æä¾›æœåŠ¡äº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†æä¸‹éœ€æ±‚ï¼š 1éœ€æ±‚ï¼šNginxçš„ç‰ˆæœ¬æœ€å¼€å§‹ä½¿ç”¨çš„æ˜¯Nginx-1.14.2,ç”±äºæœåŠ¡å‡çº§ï¼Œéœ€è¦å°†Nginxçš„ç‰ˆæœ¬å‡çº§åˆ°Nginx-1.16.1,è¦æ±‚Nginxä¸èƒ½ä¸­æ–­æä¾›æœåŠ¡ã€‚ ä¸ºäº†åº”å¯¹ä¸Šè¿°çš„éœ€æ±‚ï¼Œè¿™é‡Œæˆ‘ä»¬ç»™å¤§å®¶æä¾›ä¸¤ç§è§£å†³æ–¹æ¡ˆ: æ–¹æ¡ˆä¸€:ä½¿ç”¨NginxæœåŠ¡ä¿¡å·å®ŒæˆNginxçš„å‡çº§ æ–¹æ¡ˆäºŒ:ä½¿ç”¨Nginxå®‰è£…ç›®å½•çš„makeå‘½ä»¤å®Œæˆå‡çº§ ç¯å¢ƒå‡†å¤‡ ï¼ˆ1ï¼‰å…ˆå‡†å¤‡ä¸¤ä¸ªç‰ˆæœ¬çš„Nginxåˆ†åˆ«æ˜¯ 1.14.2å’Œ1.16.1 ï¼ˆ2ï¼‰ä½¿ç”¨Nginxæºç å®‰è£…çš„æ–¹å¼å°†1.14.2ç‰ˆæœ¬å®‰è£…æˆåŠŸå¹¶æ­£ç¡®è®¿é—® 123è¿›å…¥å®‰è£…ç›®å½•./configuremake &amp;&amp; make install ï¼ˆ3ï¼‰å°†Nginx1.16.1è¿›è¡Œå‚æ•°é…ç½®å’Œç¼–è¯‘ï¼Œä¸éœ€è¦è¿›è¡Œå®‰è£…ã€‚ 123è¿›å…¥å®‰è£…ç›®å½•./configuremake æ–¹æ¡ˆä¸€:ä½¿ç”¨NginxæœåŠ¡ä¿¡å·è¿›è¡Œå‡çº§ ç¬¬ä¸€æ­¥:å°†1.14.2ç‰ˆæœ¬çš„sbinç›®å½•ä¸‹çš„nginxè¿›è¡Œå¤‡ä»½ 12cd /usr/local/nginx/sbinmv nginx nginxold ç¬¬äºŒæ­¥:å°†Nginx1.16.1å®‰è£…ç›®å½•ç¼–è¯‘åçš„objsç›®å½•ä¸‹çš„nginxæ–‡ä»¶ï¼Œæ‹·è´åˆ°åŸæ¥/usr/local/nginx/sbinç›®å½•ä¸‹ 12cd ~/nginx/core/nginx-1.16.1/objscp nginx /usr/local/nginx/sbin ç¬¬ä¸‰æ­¥:å‘é€ä¿¡å·USR2ç»™Nginxçš„1.14.2ç‰ˆæœ¬å¯¹åº”çš„masterè¿›ç¨‹ ç¬¬å››æ­¥:å‘é€ä¿¡å·QUITç»™Nginxçš„1.14.2ç‰ˆæœ¬å¯¹åº”çš„masterè¿›ç¨‹ 1kill -QUIT `more /usr/local/logs/nginx.pid.oldbin` æ–¹æ¡ˆäºŒ:ä½¿ç”¨Nginxå®‰è£…ç›®å½•çš„makeå‘½ä»¤å®Œæˆå‡çº§ ç¬¬ä¸€æ­¥:å°†1.14.2ç‰ˆæœ¬çš„sbinç›®å½•ä¸‹çš„nginxè¿›è¡Œå¤‡ä»½ 12cd /usr/local/nginx/sbinmv nginx nginxold ç¬¬äºŒæ­¥:å°†Nginx1.16.1å®‰è£…ç›®å½•ç¼–è¯‘åçš„objsç›®å½•ä¸‹çš„nginxæ–‡ä»¶ï¼Œæ‹·è´åˆ°åŸæ¥/usr/local/nginx/sbinç›®å½•ä¸‹ 12cd ~/nginx/core/nginx-1.16.1/objscp nginx /usr/local/nginx/sbin ç¬¬ä¸‰æ­¥:è¿›å…¥åˆ°å®‰è£…ç›®å½•ï¼Œæ‰§è¡Œmake upgrade ç¬¬å››æ­¥:æŸ¥çœ‹æ˜¯å¦æ›´æ–°æˆåŠŸ 1./nginx -v åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå…¶å®Nginxæ˜¯ä¸€ç›´å¯¹å¤–æä¾›æœåŠ¡çš„ã€‚å¹¶ä¸”å½“Nginxçš„æœåŠ¡å™¨å¯åŠ¨æˆåŠŸåï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥é€šè¿‡æµè§ˆå™¨è¿›è¡Œç›´æ¥è®¿é—®çš„ï¼ŒåŒæ—¶æˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´æ”¹htmlç›®å½•ä¸‹çš„é¡µé¢æ¥ä¿®æ”¹æˆ‘ä»¬åœ¨é¡µé¢ä¸Šæ‰€çœ‹åˆ°çš„å†…å®¹ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä¿®æ”¹htmlç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œèƒ½ä¸èƒ½å¤šæ·»åŠ ä¸€äº›é¡µé¢æ˜¯Nginxçš„åŠŸèƒ½æ›´åŠ ä¸°å¯Œï¼Œè¿˜æœ‰å‰é¢èŠåˆ°Nginxçš„å‰ç«¯åŠŸèƒ½åˆæ˜¯å¦‚ä½•æ¥å®ç°çš„ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬å¯¹Nginxçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶è¿›è¡Œä¸€ä¸ªè¯¦ç»†çš„å­¦ä¹ ã€‚ Nginxæ ¸å¿ƒé…ç½®æ–‡ä»¶ç»“æ„ ä»å‰é¢çš„å†…å®¹å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“Nginxçš„æ ¸å¿ƒé…ç½®æ–‡ä»¶é»˜è®¤æ˜¯æ”¾åœ¨/usr/local/nginx/conf/nginx.confï¼Œè¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬å°±æ¥å­¦ä¹ ä¸‹nginx.confçš„å†…å®¹å’ŒåŸºæœ¬é…ç½®æ–¹æ³•ã€‚ è¯»å–Nginxè‡ªå¸¦çš„Nginxé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å°†å…¶ä¸­çš„æ³¨é‡Šéƒ¨åˆ†ã€å­¦ä¹ ä¸€ä¸ªæŠ€æœ¯ç‚¹å°±æ˜¯åœ¨Nginxçš„é…ç½®æ–‡ä»¶ä¸­å¯ä»¥ä½¿ç”¨#æ¥æ³¨é‡Šã€‘åˆ é™¤æ‰åï¼Œå°±å‰©ä¸‹ä¸‹é¢å†…å®¹: 1234567891011121314151617181920212223242526worker_processes 1;events &#123; worker_connections 1024;&#125;http &#123; include mime.types; default_type application/octet-stream; sendfile on; keepalive_timeout 65; server &#123; listen 80; server_name localhost; location / &#123; root html; index index.html index.htm; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root html; &#125; &#125;&#125; 123456789101112131415161718æŒ‡ä»¤å æŒ‡ä»¤å€¼; #å…¨å±€å—ï¼Œä¸»è¦è®¾ç½®NginxæœåŠ¡å™¨æ•´ä½“è¿è¡Œçš„é…ç½®æŒ‡ä»¤ #eventså—,ä¸»è¦è®¾ç½®,NginxæœåŠ¡å™¨ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥,è¿™ä¸€éƒ¨åˆ†å¯¹NginxæœåŠ¡å™¨çš„æ€§èƒ½å½±å“è¾ƒå¤§events &#123; æŒ‡ä»¤å æŒ‡ä»¤å€¼;&#125;#httpå—ï¼Œæ˜¯NginxæœåŠ¡å™¨é…ç½®ä¸­çš„é‡è¦éƒ¨åˆ†ï¼Œä»£ç†ã€ç¼“å­˜ã€æ—¥å¿—è®°å½•ã€ç¬¬ä¸‰æ–¹æ¨¡å—é…ç½®... http &#123; æŒ‡ä»¤å æŒ‡ä»¤å€¼; server &#123; #serverå—ï¼Œæ˜¯Nginxé…ç½®å’Œè™šæ‹Ÿä¸»æœºç›¸å…³çš„å†…å®¹ æŒ‡ä»¤å æŒ‡ä»¤å€¼; location / &#123; #locationå—ï¼ŒåŸºäºNginxæœåŠ¡å™¨æ¥æ”¶è¯·æ±‚å­—ç¬¦ä¸²ä¸locationåé¢çš„å€¼è¿›è¡ŒåŒ¹é…ï¼Œå¯¹ç‰¹å®šè¯·æ±‚è¿›è¡Œå¤„ç† æŒ‡ä»¤å æŒ‡ä»¤å€¼; &#125; &#125; ...&#125; ç®€å•å°ç»“ä¸‹: nginx.confé…ç½®æ–‡ä»¶ä¸­é»˜è®¤æœ‰ä¸‰å¤§å—ï¼šå…¨å±€å—ã€eventså—ã€httpå— httpå—ä¸­å¯ä»¥é…ç½®å¤šä¸ªserverå—ï¼Œæ¯ä¸ªserverå—åˆå¯ä»¥é…ç½®å¤šä¸ªlocationå—ã€‚ å…¨å±€å— useræŒ‡ä»¤ ï¼ˆ1ï¼‰user:ç”¨äºé…ç½®è¿è¡ŒNginxæœåŠ¡å™¨çš„workerè¿›ç¨‹çš„ç”¨æˆ·å’Œç”¨æˆ·ç»„ã€‚ è¯­æ³• user user [group] é»˜è®¤å€¼ nobody ä½ç½® å…¨å±€å— è¯¥å±æ€§ä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™æŒ‡å®šï¼Œè¯­æ³•å¦‚ä¸‹./configure --user=user --group=group,å¦‚æœä¸¤ä¸ªåœ°æ–¹éƒ½è¿›è¡Œäº†è®¾ç½®ï¼Œæœ€ç»ˆç”Ÿæ•ˆçš„æ˜¯é…ç½®æ–‡ä»¶ä¸­çš„é…ç½®ã€‚ è¯¥æŒ‡ä»¤çš„ä½¿ç”¨æ­¥éª¤: (1)è®¾ç½®ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯&quot;www&quot; 1user www; (2) åˆ›å»ºä¸€ä¸ªç”¨æˆ· 1useradd www (3)ä¿®æ”¹userå±æ€§ 1user www (4)åˆ›å»º/root/html/index.htmlé¡µé¢ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ 123456789101112131415161718192021222324252627&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Welcome to nginx!&lt;/title&gt;&lt;style&gt; body &#123; width: 35em; margin: 0 auto; font-family: Tahoma, Verdana, Arial, sans-serif; &#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;&lt;p&gt;If you see this page, the nginx web server is successfully installed andworking. Further configuration is required.&lt;/p&gt;&lt;p&gt;For online documentation and support please refer to&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;Commercial support is available at&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;&lt;p&gt;&lt;em&gt;I am WWW&lt;/em&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt; (5)ä¿®æ”¹nginx.conf 1234location / &#123; root /root/html; index index.html index.htm;&#125; (5)æµ‹è¯•å¯åŠ¨è®¿é—® 1é¡µé¢ä¼šæŠ¥403æ‹’ç»è®¿é—®çš„é”™è¯¯ (6)åˆ†æåŸå›  1å› ä¸ºå½“å‰ç”¨æˆ·æ²¡æœ‰è®¿é—®/root/htmlç›®å½•çš„æƒé™ (7)å°†æ–‡ä»¶åˆ›å»ºåˆ° /home/www/html/index.html,ä¿®æ”¹é…ç½® 1234location / &#123; root /home/www/html; index index.html index.htm;&#125; (8)å†æ¬¡æµ‹è¯•å¯åŠ¨è®¿é—® 1èƒ½æ­£å¸¸è®¿é—®ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œä½¿ç”¨useræŒ‡ä»¤å¯ä»¥æŒ‡å®šå¯åŠ¨è¿è¡Œå·¥ä½œè¿›ç¨‹çš„ç”¨æˆ·åŠç”¨æˆ·ç»„ï¼Œè¿™æ ·å¯¹äºç³»ç»Ÿçš„æƒé™è®¿é—®æ§åˆ¶çš„æ›´åŠ ç²¾ç»†ï¼Œä¹Ÿæ›´åŠ å®‰å…¨ã€‚ work processæŒ‡ä»¤ master_process:ç”¨æ¥æŒ‡å®šæ˜¯å¦å¼€å¯å·¥ä½œè¿›ç¨‹ã€‚ è¯­æ³• master_process on|off; é»˜è®¤å€¼ master_process on; ä½ç½® å…¨å±€å— worker_processes:ç”¨äºé…ç½®Nginxç”Ÿæˆå·¥ä½œè¿›ç¨‹çš„æ•°é‡ï¼Œè¿™ä¸ªæ˜¯NginxæœåŠ¡å™¨å®ç°å¹¶å‘å¤„ç†æœåŠ¡çš„å…³é”®æ‰€åœ¨ã€‚ç†è®ºä¸Šæ¥è¯´workder processçš„å€¼è¶Šå¤§ï¼Œå¯ä»¥æ”¯æŒçš„å¹¶å‘å¤„ç†é‡ä¹Ÿè¶Šå¤šï¼Œä½†äº‹å®ä¸Šè¿™ä¸ªå€¼çš„è®¾å®šæ˜¯éœ€è¦å—åˆ°æ¥è‡ªæœåŠ¡å™¨è‡ªèº«çš„é™åˆ¶ï¼Œå»ºè®®å°†è¯¥å€¼å’ŒæœåŠ¡å™¨CPUçš„å†…æ ¸æ•°ä¿å­˜ä¸€è‡´ã€‚ è¯­æ³• worker_processes num/auto; é»˜è®¤å€¼ 1 ä½ç½® å…¨å±€å— å¦‚æœå°†worker_processesè®¾ç½®æˆ2ï¼Œåˆ™ä¼šçœ‹åˆ°å¦‚ä¸‹å†…å®¹: å…¶ä»–æŒ‡ä»¤ daemonï¼šè®¾å®šNginxæ˜¯å¦ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼å¯åŠ¨ã€‚ å®ˆæŠ¤å¼è¿›ç¨‹æ˜¯linuxåå°æ‰§è¡Œçš„ä¸€ç§æœåŠ¡è¿›ç¨‹ï¼Œç‰¹ç‚¹æ˜¯ç‹¬ç«‹äºæ§åˆ¶ç»ˆç«¯ï¼Œä¸ä¼šéšç€ç»ˆç«¯å…³é—­è€Œåœæ­¢ã€‚ è¯­æ³• daemon on|off; é»˜è®¤å€¼ daemon on; ä½ç½® å…¨å±€å— pid:ç”¨æ¥é…ç½®Nginxå½“å‰masterè¿›ç¨‹çš„è¿›ç¨‹å·IDå­˜å‚¨çš„æ–‡ä»¶è·¯å¾„ã€‚ è¯­æ³• pid file; é»˜è®¤å€¼ é»˜è®¤ä¸º:/usr/local/nginx/logs/nginx.pid ä½ç½® å…¨å±€å— è¯¥å±æ€§å¯ä»¥é€šè¿‡./configure --pid-path=PATHæ¥æŒ‡å®š error_log:ç”¨æ¥é…ç½®Nginxçš„é”™è¯¯æ—¥å¿—å­˜æ”¾è·¯å¾„ è¯­æ³• error_log file [æ—¥å¿—çº§åˆ«]; é»˜è®¤å€¼ error_log logs/error.log error; ä½ç½® å…¨å±€å—ã€httpã€serverã€location è¯¥å±æ€§å¯ä»¥é€šè¿‡./configure --error-log-path=PATHæ¥æŒ‡å®š å…¶ä¸­æ—¥å¿—çº§åˆ«çš„å€¼æœ‰ï¼šdebug|info|notice|warn|error|crit|alert|emergï¼Œç¿»è¯‘è¿‡æ¥ä¸ºè¯•|ä¿¡æ¯|é€šçŸ¥|è­¦å‘Š|é”™è¯¯|ä¸´ç•Œ|è­¦æŠ¥|ç´§æ€¥ï¼Œè¿™å—å»ºè®®å¤§å®¶è®¾ç½®çš„æ—¶å€™ä¸è¦è®¾ç½®æˆinfoä»¥ä¸‹çš„ç­‰çº§ï¼Œå› ä¸ºä¼šå¸¦æ¥å¤§é‡çš„ç£ç›˜I/Oæ¶ˆè€—ï¼Œå½±å“Nginxçš„æ€§èƒ½ã€‚ ï¼ˆ5ï¼‰include:ç”¨æ¥å¼•å…¥å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œä½¿Nginxçš„é…ç½®æ›´åŠ çµæ´» è¯­æ³• include file; é»˜è®¤å€¼ æ—  ä½ç½® any eventså— ï¼ˆ1ï¼‰accept_mutex:ç”¨æ¥è®¾ç½®Nginxç½‘ç»œè¿æ¥åºåˆ—åŒ– è¯­æ³• accept_mutex on|off; é»˜è®¤å€¼ accept_mutex on; ä½ç½® events è¿™ä¸ªé…ç½®ä¸»è¦å¯ä»¥ç”¨æ¥è§£å†³å¸¸è¯´çš„&quot;æƒŠç¾¤&quot;é—®é¢˜ã€‚å¤§è‡´æ„æ€æ˜¯åœ¨æŸä¸€ä¸ªæ—¶åˆ»ï¼Œå®¢æˆ·ç«¯å‘æ¥ä¸€ä¸ªè¯·æ±‚è¿æ¥ï¼ŒNginxåå°æ˜¯ä»¥å¤šè¿›ç¨‹çš„å·¥ä½œæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰å¤šä¸ªworkerè¿›ç¨‹ä¼šè¢«åŒæ—¶å”¤é†’ï¼Œä½†æ˜¯æœ€ç»ˆåªä¼šæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥è·å–åˆ°è¿æ¥ï¼Œå¦‚æœæ¯æ¬¡å”¤é†’çš„è¿›ç¨‹æ•°ç›®å¤ªå¤šï¼Œå°±ä¼šå½±å“Nginxçš„æ•´ä½“æ€§èƒ½ã€‚å¦‚æœå°†ä¸Šè¿°å€¼è®¾ç½®ä¸ºon(å¼€å¯çŠ¶æ€)ï¼Œå°†ä¼šå¯¹å¤šä¸ªNginxè¿›ç¨‹æ¥æ”¶è¿æ¥è¿›è¡Œåºåˆ—å·ï¼Œä¸€ä¸ªä¸ªæ¥å”¤é†’æ¥æ”¶ï¼Œå°±é˜²æ­¢äº†å¤šä¸ªè¿›ç¨‹å¯¹è¿æ¥çš„äº‰æŠ¢ã€‚ ï¼ˆ2ï¼‰multi_accept:ç”¨æ¥è®¾ç½®æ˜¯å¦å…è®¸åŒæ—¶æ¥æ”¶å¤šä¸ªç½‘ç»œè¿æ¥ è¯­æ³• multi_accept on|off; é»˜è®¤å€¼ multi_accept off; ä½ç½® events å¦‚æœmulti_acceptè¢«ç¦æ­¢äº†ï¼Œnginxä¸€ä¸ªå·¥ä½œè¿›ç¨‹åªèƒ½åŒæ—¶æ¥å—ä¸€ä¸ªæ–°çš„è¿æ¥ã€‚å¦åˆ™ï¼Œä¸€ä¸ªå·¥ä½œè¿›ç¨‹å¯ä»¥åŒæ—¶æ¥å—æ‰€æœ‰çš„æ–°è¿æ¥ ï¼ˆ3ï¼‰worker_connectionsï¼šç”¨æ¥é…ç½®å•ä¸ªworkerè¿›ç¨‹æœ€å¤§çš„è¿æ¥æ•° è¯­æ³• worker_connections number; é»˜è®¤å€¼ worker_commections 512; ä½ç½® events è¿™é‡Œçš„è¿æ¥æ•°ä¸ä»…ä»…åŒ…æ‹¬å’Œå‰ç«¯ç”¨æˆ·å»ºç«‹çš„è¿æ¥æ•°ï¼Œè€Œæ˜¯åŒ…æ‹¬æ‰€æœ‰å¯èƒ½çš„è¿æ¥æ•°ã€‚å¦å¤–ï¼Œnumberå€¼ä¸èƒ½å¤§äºæ“ä½œç³»ç»Ÿæ”¯æŒæ‰“å¼€çš„æœ€å¤§æ–‡ä»¶å¥æŸ„æ•°é‡ã€‚ ï¼ˆ4ï¼‰use:ç”¨æ¥è®¾ç½®NginxæœåŠ¡å™¨é€‰æ‹©å“ªç§äº‹ä»¶é©±åŠ¨æ¥å¤„ç†ç½‘ç»œæ¶ˆæ¯ã€‚ è¯­æ³• use method; é»˜è®¤å€¼ æ ¹æ®æ“ä½œç³»ç»Ÿå®š ä½ç½® events æ³¨æ„ï¼šæ­¤å¤„æ‰€é€‰æ‹©äº‹ä»¶å¤„ç†æ¨¡å‹æ˜¯Nginxä¼˜åŒ–éƒ¨åˆ†çš„ä¸€ä¸ªé‡è¦å†…å®¹ï¼Œmethodçš„å¯é€‰å€¼æœ‰select/poll/epoll/kqueueç­‰ï¼Œä¹‹å‰åœ¨å‡†å¤‡centosç¯å¢ƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¼ºè°ƒè¿‡è¦ä½¿ç”¨linuxå†…æ ¸åœ¨2.6ä»¥ä¸Šï¼Œå°±æ˜¯ä¸ºäº†èƒ½ä½¿ç”¨epollå‡½æ•°æ¥ä¼˜åŒ–Nginxã€‚ å¦å¤–è¿™äº›å€¼çš„é€‰æ‹©ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™ä½¿ç”¨ --with-select_moduleã€--without-select_moduleã€ --with-poll_moduleã€ --without-poll_moduleæ¥è®¾ç½®æ˜¯å¦éœ€è¦å°†å¯¹åº”çš„äº‹ä»¶é©±åŠ¨æ¨¡å—ç¼–è¯‘åˆ°Nginxçš„å†…æ ¸ã€‚ eventsæŒ‡ä»¤é…ç½®å®ä¾‹ æ‰“å¼€Nginxçš„é…ç½®æ–‡ä»¶ nginx.conf,æ·»åŠ å¦‚ä¸‹é…ç½® 123456events&#123; accept_mutex on; multi_accept on; worker_commections 1024; use epoll;&#125; å¯åŠ¨æµ‹è¯• 12./nginx -t./nginx -s reload httpå— å®šä¹‰MIME-Type æˆ‘ä»¬éƒ½çŸ¥é“æµè§ˆå™¨ä¸­å¯ä»¥æ˜¾ç¤ºçš„å†…å®¹æœ‰HTMLã€XMLã€GIFç­‰ç§ç±»ç¹å¤šçš„æ–‡ä»¶ã€åª’ä½“ç­‰èµ„æºï¼Œæµè§ˆå™¨ä¸ºäº†åŒºåˆ†è¿™äº›èµ„æºï¼Œå°±éœ€è¦ä½¿ç”¨MIME Typeã€‚æ‰€ä»¥è¯´MIME Typeæ˜¯ç½‘ç»œèµ„æºçš„åª’ä½“ç±»å‹ã€‚Nginxä½œä¸ºwebæœåŠ¡å™¨ï¼Œä¹Ÿéœ€è¦èƒ½å¤Ÿè¯†åˆ«å‰ç«¯è¯·æ±‚çš„èµ„æºç±»å‹ã€‚ åœ¨Nginxçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé»˜è®¤æœ‰ä¸¤è¡Œé…ç½® 12include mime.types;default_type application/octet-stream; ï¼ˆ1ï¼‰default_type:ç”¨æ¥é…ç½®Nginxå“åº”å‰ç«¯è¯·æ±‚é»˜è®¤çš„MIMEç±»å‹ã€‚ è¯­æ³• default_type mime-type; é»˜è®¤å€¼ default_type text/plainï¼› ä½ç½® httpã€serverã€location åœ¨default_typeä¹‹å‰è¿˜æœ‰ä¸€å¥include mime.types,includeä¹‹å‰æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡ï¼Œç›¸å½“äºæŠŠmime.typesæ–‡ä»¶ä¸­MIMTç±»å‹ä¸ç›¸å…³ç±»å‹æ–‡ä»¶çš„æ–‡ä»¶åç¼€åçš„å¯¹åº”å…³ç³»åŠ å…¥åˆ°å½“å‰çš„é…ç½®æ–‡ä»¶ä¸­ã€‚ ä¸¾ä¾‹æ¥è¯´æ˜ï¼š æœ‰äº›æ—¶å€™è¯·æ±‚æŸäº›æ¥å£çš„æ—¶å€™éœ€è¦è¿”å›æŒ‡å®šçš„æ–‡æœ¬å­—ç¬¦ä¸²æˆ–è€…jsonå­—ç¬¦ä¸²ï¼Œå¦‚æœé€»è¾‘éå¸¸ç®€å•æˆ–è€…å¹²è„†æ˜¯å›ºå®šçš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨nginxå¿«é€Ÿå®ç°ï¼Œè¿™æ ·å°±ä¸ç”¨ç¼–å†™ç¨‹åºå“åº”è¯·æ±‚äº†ï¼Œå¯ä»¥å‡å°‘æœåŠ¡å™¨èµ„æºå ç”¨å¹¶ä¸”å“åº”æ€§èƒ½éå¸¸å¿«ã€‚ å¦‚ä½•å®ç°: 123456789location /get_text &#123; #è¿™é‡Œä¹Ÿå¯ä»¥è®¾ç½®æˆtext/plain default_type text/html; return 200 &quot;This is nginx&#x27;s text&quot;;&#125;location /get_json&#123; default_type application/json; return 200 &#x27;&#123;&quot;name&quot;:&quot;TOM&quot;,&quot;age&quot;:18&#125;&#x27;;&#125; è‡ªå®šä¹‰æœåŠ¡æ—¥å¿— Nginxä¸­æ—¥å¿—çš„ç±»å‹åˆ†access.logã€error.logã€‚ access.log:ç”¨æ¥è®°å½•ç”¨æˆ·æ‰€æœ‰çš„è®¿é—®è¯·æ±‚ã€‚ error.log:è®°å½•nginxæœ¬èº«è¿è¡Œæ—¶çš„é”™è¯¯ä¿¡æ¯ï¼Œä¸ä¼šè®°å½•ç”¨æˆ·çš„è®¿é—®è¯·æ±‚ã€‚ NginxæœåŠ¡å™¨æ”¯æŒå¯¹æœåŠ¡æ—¥å¿—çš„æ ¼å¼ã€å¤§å°ã€è¾“å‡ºç­‰è¿›è¡Œè®¾ç½®ï¼Œéœ€è¦ä½¿ç”¨åˆ°ä¸¤ä¸ªæŒ‡ä»¤ï¼Œåˆ†åˆ«æ˜¯access_logå’Œlog_formatæŒ‡ä»¤ã€‚ ï¼ˆ1ï¼‰access_log:ç”¨æ¥è®¾ç½®ç”¨æˆ·è®¿é—®æ—¥å¿—çš„ç›¸å…³å±æ€§ã€‚ è¯­æ³• access_log path[format[buffer=size]] é»˜è®¤å€¼ access_log logs/access.log combined; ä½ç½® http, server, location ï¼ˆ2ï¼‰log_format:ç”¨æ¥æŒ‡å®šæ—¥å¿—çš„è¾“å‡ºæ ¼å¼ã€‚ è¯­æ³• log_format name [escape=default|json|none] stringâ€¦; é»˜è®¤å€¼ log_format combined â€œâ€¦â€; ä½ç½® http å…¶ä»–é…ç½®æŒ‡ä»¤ ï¼ˆ1ï¼‰sendfile:ç”¨æ¥è®¾ç½®NginxæœåŠ¡å™¨æ˜¯å¦ä½¿ç”¨sendfile()ä¼ è¾“æ–‡ä»¶ï¼Œè¯¥å±æ€§å¯ä»¥å¤§å¤§æé«˜Nginxå¤„ç†é™æ€èµ„æºçš„æ€§èƒ½ è¯­æ³• sendfile on|offï¼› é»˜è®¤å€¼ sendfile off; ä½ç½® httpã€serverã€location ï¼ˆ2ï¼‰keepalive_timeout:ç”¨æ¥è®¾ç½®é•¿è¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚ ã€‹ä¸ºä»€ä¹ˆè¦ä½¿ç”¨keepaliveï¼Ÿ 12æˆ‘ä»¬éƒ½çŸ¥é“HTTPæ˜¯ä¸€ç§æ— çŠ¶æ€åè®®ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªTCPè¯·æ±‚ï¼ŒæœåŠ¡ç«¯å“åº”å®Œæ¯•åæ–­å¼€è¿æ¥ã€‚å¦‚ä½•å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€å¤šä¸ªè¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦é‡æ–°åˆ›å»ºä¸€æ¬¡è¿æ¥ï¼Œæ•ˆç‡ç›¸å¯¹æ¥è¯´æ¯”è¾ƒå¤šï¼Œä½¿ç”¨keepaliveæ¨¡å¼ï¼Œå¯ä»¥å‘Šè¯‰æœåŠ¡å™¨ç«¯åœ¨å¤„ç†å®Œä¸€ä¸ªè¯·æ±‚åä¿æŒè¿™ä¸ªTCPè¿æ¥çš„æ‰“å¼€çŠ¶æ€ï¼Œè‹¥æ¥æ”¶åˆ°æ¥è‡ªè¿™ä¸ªå®¢æˆ·ç«¯çš„å…¶ä»–è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å°±ä¼šåˆ©ç”¨è¿™ä¸ªæœªè¢«å…³é—­çš„è¿æ¥ï¼Œè€Œä¸éœ€è¦é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°è¿æ¥ï¼Œæå‡æ•ˆç‡ï¼Œä½†æ˜¯è¿™ä¸ªè¿æ¥ä¹Ÿä¸èƒ½ä¸€ç›´ä¿æŒï¼Œè¿™æ ·çš„è¯ï¼Œè¿æ¥å¦‚æœè¿‡å¤šï¼Œä¹Ÿä¼šæ˜¯æœåŠ¡ç«¯çš„æ€§èƒ½ä¸‹é™ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦æˆ‘ä»¬è¿›è¡Œè®¾ç½®å…¶çš„è¶…æ—¶æ—¶é—´ã€‚ è¯­æ³• keepalive_timeout time; é»˜è®¤å€¼ keepalive_timeout 75s; ä½ç½® httpã€serverã€location ï¼ˆ3ï¼‰keepalive_requests:ç”¨æ¥è®¾ç½®ä¸€ä¸ªkeep-aliveè¿æ¥ä½¿ç”¨çš„æ¬¡æ•°ã€‚ è¯­æ³• keepalive_requests number; é»˜è®¤å€¼ keepalive_requests 100; ä½ç½® httpã€serverã€location serverå—å’Œlocationå— serverå—å’Œlocationå—éƒ½æ˜¯æˆ‘ä»¬è¦é‡ç‚¹è®²è§£å’Œå­¦ä¹ çš„å†…å®¹ï¼Œå› ä¸ºæˆ‘ä»¬åé¢ä¼šå¯¹Nginxçš„åŠŸèƒ½è¿›è¡Œè¯¦ç»†è®²è§£ï¼Œæ‰€ä»¥è¿™å—å†…å®¹å°±æ”¾åˆ°é™æ€èµ„æºéƒ¨ç½²çš„åœ°æ–¹ç»™å¤§å®¶è¯¦ç»†è¯´æ˜ã€‚ æœ¬èŠ‚æˆ‘ä»¬ä¸»è¦æ¥è®¤è¯†ä¸‹Nginxé»˜è®¤ç»™çš„nginx.confä¸­çš„ç›¸å…³å†…å®¹ï¼Œä»¥åŠserverå—ä¸locationå—åœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„çš„ä¸€äº›å†…å®¹ã€‚ 12345678910111213server &#123; listen 80; server_name localhost; location / &#123; root html; index index.html index.htm; &#125; error_page 500 502 503 504 404 /50x.html; location = /50x.html &#123; root html; &#125; &#125;","categories":[{"name":"Webå¼€å‘","slug":"Webå¼€å‘","permalink":"http://kaillliu.github.io/categories/Web%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://kaillliu.github.io/tags/Java/"},{"name":"Centos","slug":"Centos","permalink":"http://kaillliu.github.io/tags/Centos/"},{"name":"Linux","slug":"Linux","permalink":"http://kaillliu.github.io/tags/Linux/"}]},{"title":"CentOS 7 å®‰è£… JAVAç¯å¢ƒï¼ˆJDK 1.8ï¼‰","slug":"CentOS 7å®‰è£…JAVAç¯å¢ƒï¼ˆJDK 1.8ï¼‰","date":"2022-04-21T06:29:13.000Z","updated":"2022-04-21T06:30:12.821Z","comments":true,"path":"2022/04/21/CentOS 7å®‰è£…JAVAç¯å¢ƒï¼ˆJDK 1.8ï¼‰/","link":"","permalink":"http://kaillliu.github.io/2022/04/21/CentOS%207%E5%AE%89%E8%A3%85JAVA%E7%8E%AF%E5%A2%83%EF%BC%88JDK%201.8%EF%BC%89/","excerpt":"","text":"å¸è½½CentOSé»˜è®¤å®‰è£…çš„OpenJDK æŸ¥çœ‹æ˜¯å¦å®‰è£… OpenJDK 1234java -versionopenjdk version &quot;1.8.0_222&quot;OpenJDK Runtime Environment (build 1.8.0_222-b10)OpenJDK 64-Bit Server VM (build 25.222-b10, mixed mode) å¤åˆ¶ æŸ¥çœ‹å®‰è£…ä½ç½® 123456789rpm -qa | grep javajavamail-1.4.6-8.el7.noarchpython-javapackages-3.4.1-11.el7.noarchtzdata-java-2019b-1.el7.noarchjavapackages-tools-3.4.1-11.el7.noarchjava-1.8.0-openjdk-headless-1.8.0.222.b10-0.el7_6.x86_64java-1.8.0-openjdk-1.8.0.222.b10-0.el7_6.x86_64javassist-3.16.1-10.el7.noarchjava-1.8.0-openjdk-devel-1.8.0.222.b10-0.el7_6.x86_64 å¤åˆ¶ æ‰§è¡Œè¯­å¥åˆ é™¤openjdk 123rpm -e --nodeps java-1.8.0-openjdk-headless-1.8.0.222.b10-0.el7_6.x86_64rpm -e --nodeps java-1.8.0-openjdk-1.8.0.222.b10-0.el7_6.x86_64rpm -e --nodeps java-1.8.0-openjdk-devel-1.8.0.222.b10-0.el7_6.x86_64 å¤åˆ¶ æ£€æŸ¥æ˜¯å¦åˆ é™¤ 12java -version-bash: /usr/bin/java: No such file or directory å¤åˆ¶ å®‰è£…Oracle Java JDK 8 ä»å®˜ç½‘ä¸‹è½½jdk-8u221-linux-x64.tar.gzã€‚ ä¸‹è½½åé€šè¿‡ftpä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚ åˆ›å»ºç›®å½•ï¼Œè§£å‹ 12mkdir /usr/javatar zvxf jdk-8u221-linux-x64.tar.gz -C /usr/java å¤åˆ¶ ç¯å¢ƒé…ç½®ï¼Œä¿®æ”¹profileæ–‡ä»¶ 1vi /etc/profile æ·»åŠ  123export JAVA_HOME=/usr/java/jdk1.8.0_221export PATH=$JAVA_HOME/bin:$PATHexport CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar å¤åˆ¶ ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ 1source /etc/profile æ£€æŸ¥æ˜¯å¦é…ç½®æˆåŠŸ 1234java -versionjava version &quot;1.8.0_221&quot;Java(TM) SE Runtime Environment (build 1.8.0_221-b11)Java HotSpot(TM) 64-Bit Server VM (build 25.221-b11, mixed mode) å¤åˆ¶","categories":[{"name":"Java","slug":"Java","permalink":"http://kaillliu.github.io/categories/Java/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://kaillliu.github.io/tags/Java/"},{"name":"Centos","slug":"Centos","permalink":"http://kaillliu.github.io/tags/Centos/"}]},{"title":"åœ¨VMwareä¸Šå®‰è£…Centos7ç³»ç»Ÿ","slug":"åœ¨VMwareä¸Šå®‰è£…Centos7ç³»ç»Ÿåœ¨VMwareä¸Šå®‰è£…Centos7ç³»ç»Ÿ","date":"2022-04-19T09:18:13.000Z","updated":"2022-05-23T05:41:23.080Z","comments":true,"path":"2022/04/19/åœ¨VMwareä¸Šå®‰è£…Centos7ç³»ç»Ÿåœ¨VMwareä¸Šå®‰è£…Centos7ç³»ç»Ÿ/","link":"","permalink":"http://kaillliu.github.io/2022/04/19/%E5%9C%A8VMware%E4%B8%8A%E5%AE%89%E8%A3%85Centos7%E7%B3%BB%E7%BB%9F%E5%9C%A8VMware%E4%B8%8A%E5%AE%89%E8%A3%85Centos7%E7%B3%BB%E7%BB%9F/","excerpt":"","text":"å‰è¨€ æœ¬åœ°è™šæ‹ŸæœºæœåŠ¡å™¨ï¼Œä½¿ç”¨CentOs7ï¼Œè¿ç»´ç¯å¢ƒæ˜¯å®å¡”é¢æ¿ã€‚ å·¥å…· VMware Workstation Pro 15.5.5ï¼ˆè™šæ‹Ÿæœºï¼‰ CentOs7ï¼ˆisoé•œåƒï¼‰ é˜¿é‡Œäº‘é•œåƒï¼šhttp://mirrors.aliyun.com/centos/7/isos/x86_64/ Xshellï¼ˆç”¨äºè¿æ¥è™šæ‹Ÿæœºï¼Œæ–¹ä¾¿ä½¿ç”¨Linuxå‘½ä»¤ï¼Œæ˜¯ä¸€ä¸ªè¿œç¨‹å·¥å…·ï¼Œå³é”®å°±å¯ä»¥å¤åˆ¶ç²˜è´´ï¼Œè¿˜å¯ä»¥æ‹‰æ»šåŠ¨æ¡ã€‚ï¼‰ è™šæ‹Ÿæœºvmnet8 ip è™šæ‹Ÿæœºé‡Œé¢çš„è™šæ‹Ÿç½‘ç»œéœ€è¦è®¾ç½®ä¸€ä¸‹ï¼Œè™šæ‹Ÿæœºé‡Œé¢çš„è™šæ‹Ÿç½‘ç»œéœ€è¦å¤„ç†ä¸€ä¸‹ï¼Œè™šæ‹Ÿæœºé‡Œé¢çš„è™šæ‹Ÿç½‘ç»œéœ€è¦ç¼–è¾‘ä¸€ä¸‹ã€‚ ä¸‹å›¾æ ‡è®°2çš„åœ°æ–¹ï¼Œå‹¾å‹¾è¦å»æ‰ï¼Œå»æ‰ä¹‹åç‚¹å‡»NATè®¾ç½®ï¼ŒæŸ¥çœ‹è™šæ‹Ÿæœºçš„vmnet8 ipï¼ŒæŠŠçº¢æ¡†é‡Œçš„å­ç½‘IPã€å­ç½‘æ©ç ã€é»˜è®¤ç½‘å…³ç”¨æ–‡æœ¬è®°ä¸‹æ¥ï¼Œç„¶åç‚¹å‡»ç¡®å®šã€‚ è®°ä½å­ç½‘IPã€å­ç½‘æ©ç ã€ç½‘å…³ åˆ›å»ºè™šæ‹Ÿæœº ç‚¹å‡»åˆ›å»ºæ–°çš„è™šæ‹Ÿæœºã€‚ ç‚¹å‡»è‡ªå®šä¹‰ï¼Œä¸‹ä¸€æ­¥ã€‚ é€‰æ‹©è™šæ‹Ÿæœºç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œæ˜¯15.5.5ï¼Œä¸‹ä¸€æ­¥ ç‚¹å‡»ç¨åå®‰è£…æ“ä½œç³»ç»Ÿï¼Œä¸‹ä¸€æ­¥ã€‚ é€‰æ‹©Linuxæ“ä½œç³»ç»Ÿï¼Œç°åœ¨å®‰è£…çš„æ˜¯entOs7ï¼Œæ‰€ä»¥ç‰ˆæœ¬é€‰æ‹©CentOs7 64ä½ï¼Œä¸‹ä¸€æ­¥ã€‚ è™šæ‹Ÿæœºåç§°éšæ„ï¼Œå¯ä»¥ä¸­æ–‡ï¼Œè¿™é‡Œæˆ‘å†™çš„æ˜¯æœåŠ¡å™¨ipåï¼ˆå¯ä»¥é‡å‘½åçš„ï¼‰ï¼Œä¸ºäº†æ–¹ä¾¿å®šä½ï¼Œä¸ç”¨æˆ‘è¯´éƒ½æ‡‚çš„å•¦ï¼Œä»å·¦è¾¹æ å°±å¯ä»¥çœ‹å‡º100ã€101ã€102æ²¡æœ‰102ï¼Œå“ï¼Ÿæˆ‘è·³è¿‡102äº†ï¼Ÿæˆ‘æ˜¯æŠŠæµç¨‹èµ°ä¸€éå†ç å­—çš„ï¼Œç å­—çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨å·²ç»okäº†ï¼Œä¸è¿‡é—®é¢˜ä¸å¤§ï¼Œä¸‹ä¸€æ­¥ã€‚ã€‚ã€‚ã€‚ é»˜è®¤ï¼ˆæœ¬ç«™çš„æ ¸å¿ƒæ˜¯2ä¸ªï¼Œä½†æ˜¯æˆ‘100ã€101éƒ½æ˜¯1ä¸ªæ ¸å¿ƒï¼Œè¿™é‡Œé»˜è®¤1ä¸ªæ ¸å¿ƒå¤Ÿç”¨äº†ï¼‰ï¼Œæœ¬åœ°æœåŠ¡å™¨ï¼Œä¹Ÿå°±è‡ªå·±ä¸€ä¸ªäººè®¿é—®ï¼Œè€Œä¸”è¿™é‡Œé…ç½®æ˜¯è·Ÿæœ¬æœºç”µè„‘é…ç½®æœ‰å…³çš„ï¼ŒæœåŠ¡å™¨ä¸€æ ¸å¿ƒè¶³çŸ£ï¼ˆåªè¦ç”µè„‘å¸¦å¾—åŠ¨ï¼Œç»™å…«æ ¸æˆ‘ä¹Ÿæ²¡æ„è§ï¼‰ï¼Œä¸‹ä¸€æ­¥ã€‚ é»˜è®¤ï¼ˆæœ¬ç«™çš„å†…å­˜æ˜¯1GBï¼Œä½†æ˜¯æˆ‘100ã€101éƒ½æ˜¯2GBï¼Œè¿™é‡Œé»˜è®¤1GBå¤Ÿç”¨äº†ï¼‰ï¼ŒåŒä¸Šï¼ˆå¦‚æœåœ¨é˜¿é‡Œäº‘ä¹°æœåŠ¡å™¨ï¼Œæˆ‘å»ºè®®æ˜¯1æ ¸å¿ƒ2GBå†…å­˜å“¦ï¼‰ï¼Œä¸‹ä¸€æ­¥ã€‚ ç‚¹å‡»ä½¿ç”¨ç½‘ç»œåœ°å€è½¬æ¢(NAT)ï¼Œä¸‹ä¸€æ­¥ã€‚ é»˜è®¤ï¼Œä¸‹ä¸€æ­¥ã€‚ é»˜è®¤ï¼Œä¸‹ä¸€æ­¥ã€‚ é»˜è®¤ï¼Œä¸‹ä¸€æ­¥ã€‚ é»˜è®¤ï¼ˆç£ç›˜å¤§å°è‡ªå·±æ”¹ï¼Œ20GBå®é™…ä¸Šå¤Ÿäº†ï¼Œä¸‹é¢é€‰é¡¹é»˜è®¤ï¼‰ï¼Œä¸‹ä¸€æ­¥ã€‚ é»˜è®¤ï¼Œä¸‹ä¸€æ­¥ã€‚ ç‚¹å‡»è‡ªå®šä¹‰ç¡¬ä»¶ã€‚ ç‚¹å‡»æ‰“å°æœºï¼Œç„¶åç‚¹å‡»ç§»é™¤ã€‚ è·Ÿç€æ•°å­—çš„æ­¥éª¤èµ°ï¼ˆæ­¥éª¤3ï¼šé€‰æ‹©ä¸‹è½½å¥½çš„CentOs7é•œåƒï¼Œæˆ‘ä¸ªäººæ˜¯æ¨èæ”¾åœ¨æœåŠ¡å™¨æ ¹ç›®å½•ä¸‹ï¼Œçœ‹æˆ‘å›¾ä¸­çš„è·¯å¾„ï¼Œè¿™é‡Œä¸æ˜ç™½è¦ç•™è¨€å“¦ï¼‰ã€‚ ç‚¹å‡»å®Œæˆã€‚ å®‰è£…CentOs7ç³»ç»Ÿ ç‚¹å‡»å¼€å¯æ­¤è™šæ‹Ÿæœºã€‚ è¿™é‡Œè¯´ä¸€ä¸‹ï¼Œé»˜è®¤é€‰ä¸­çš„æ˜¯Test this this media &amp; install CentOS 7ï¼ˆç™½è‰²å­—ä½“æ˜¯é€‰ä¸­çŠ¶æ€ï¼‰ï¼ŒæŒ‰æ–¹å‘é”®â†‘ç„¶åå›è½¦ï¼ˆå¦‚æœæŒ‰é”®æ²¡æ•ˆæœï¼Œéœ€è¦æŠŠé¼ æ ‡ç‚¹ä¸€ä¸‹è™šæ‹Ÿæœºæ˜¾ç¤ºå±ï¼‰ã€‚ ä¸­æ–‡åœ¨æœ€ä¸‹é¢ï¼Œæ»šä¸‹å»æˆ–è€…æ‹‰åˆ°ä¸‹é¢æ‰çœ‹åˆ°ï¼ˆä¸‹é¢çš„æœç´¢chineseï¼‰ï¼Œç‚¹å‡»ç»§ç»­ã€‚ è¿™é‡Œçœ‹ä¸€ä¸‹è‡ªå·±çš„æ—¥æœŸå’Œæ—¶é—´æ˜¯ä¸æ˜¯äºšæ´²/ä¸Šæµ· æ—¶åŒºï¼Œä¸æ˜¯çš„è¯è‡ªå·±è¿›å»è°ƒä¸€ä¸‹ï¼ˆç™¾åº¦ï¼‰ã€‚ ç‚¹å‡»è½¯ä»¶é€‰æ‹©ã€‚ æŠŠçº¢æ¡†é‡Œçš„ä¸¤ä¸ªå‹¾å‹¾ç‚¹ä¸Šï¼Œå®Œæˆã€‚ ç‚¹å‡»å®‰è£…ä½ç½®ã€‚ ç‚¹å‡»æˆ‘è¦é…ç½®åˆ†åŒºï¼Œå®Œæˆã€‚ ç‚¹å‡»ç‚¹è¿™é‡Œè‡ªåŠ¨åˆ›å»ºä»–ä»¬ï¼Œå®Œæˆã€‚ é»˜è®¤ï¼Œ/bootï¼ˆå¯åŠ¨æ–‡ä»¶ï¼‰ï¼Œswapï¼ˆäº¤æ¢åˆ†åŒºï¼Œç±»ä¼¼windowsè™šæ‹Ÿå†…å­˜ã€‚çœ‹å†…å­˜æ€»å¤§å°ï¼Œå¦‚æœå†…å­˜è¶³å¤Ÿå¤§ï¼Œè¿™ä¸ªç©ºé—´å°±è¦è®¾ç½®å¾ˆå¤§ï¼Œå¦‚æœå†…å­˜å°äº2Gï¼Œé‚£ä¹ˆè¿™ä¸ªç©ºé—´è®¾ç½®æˆå†…å­˜çš„2å€å¤§å°ã€‚ï¼‰ï¼Œ/ï¼ˆæ ¹åˆ†åŒºï¼‰ï¼Œå®Œæˆã€‚ ç‚¹å‡»æ¥å—æ›´æ”¹ã€‚ ç‚¹å‡»ç½‘ç»œå’Œä¸»æœºåã€‚ æ‰“å¼€ä»¥å¤ªç½‘ï¼Œä¿®æ”¹ä¸»æœºåï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤ï¼‰ï¼Œç„¶åç‚¹å‡»åº”ç”¨ï¼ˆç‚¹å®Œåº”ç”¨åçœ‹çœ‹ä»¥å¤ªç½‘æ˜¯ä¸æ˜¯å…³é—­äº†ï¼Œå¦‚æœå…³é—­äº†å†ç‚¹å¼€ï¼‰ï¼Œå®Œæˆã€‚ ç‚¹å‡»å¼€å§‹å®‰è£…ã€‚ ç‚¹å‡»ROOTå¯†ç ã€‚ è®¾ç½®å¯†ç ï¼Œæˆ‘è¿™é‡Œè®¾ç½®123456ï¼ˆæœ¬æœºçš„ï¼Œèµ·ä¸ªå¥½è®°çš„å°±å¥½ï¼‰ï¼Œå®Œæˆï¼ˆç‚¹ä¸¤æ¬¡ï¼‰ã€‚ ç­‰å¾…å®‰è£…ï¼ˆæ ¹æ®è‡ªå·±çš„éœ€æ±‚å»åˆ›å»ºç”¨æˆ·å§ï¼Œä½†æ˜¯åˆ›å»ºåå¯èƒ½æŸäº›æ“ä½œéœ€è¦rootæƒé™ï¼Œä¸æŠ˜è…¾å°±ä¸è¦åˆ›äº†ï¼Œæ˜¨æ™šæCentOs8æœåŠ¡å™¨å·®ç‚¹å´©æºƒï¼ŒCentOs8æ˜¯è§„å®šè¦åˆ›å»ºç”¨æˆ·çš„ï¼ŒCentOs7å’ŒCentOs8å°±è·Ÿwindows7å’Œwindows10ä¸€æ ·ï¼‰ã€‚ å®‰è£…å®Œæ¯•ï¼Œç‚¹å‡»é‡å¯ã€‚ é€‰æ‹©ç¬¬ä¸€ä¸ªã€‚ æˆ‘çš„ç”¨æˆ·åæ˜¯rootï¼Œå¯†ç 123456ã€‚ è¾“å…¥ç”¨æˆ·årootï¼Œå›è½¦ã€‚ è¾“å…¥å¯†ç 123456ï¼ˆä¸å¯è§çš„ï¼Œè¾“å…¥å°±è¡Œäº†ï¼‰ï¼Œå›è½¦ã€‚ é…ç½®æœåŠ¡å™¨é™æ€ipï¼ˆéœ€è¦é…ç½®æœåŠ¡å™¨åŠ¨æ€ipçš„è‡ªå·±ç™¾åº¦ä¸€ä¸‹ï¼‰ æ‰“å¼€ç›®å½•ï¼šcd /etc/sysconfig/network-scripts/ï¼ˆå¤åˆ¶ç²˜è´´å°±å¥½ï¼Œè¿™ä¸ªå¤åˆ¶ç²˜è´´æœ‰ç‚¹éº»çƒ¦ï¼Œæ‰¾ä¸åˆ°çš„å°±æ‰‹æ•²ï¼Œæ­£æ˜¯è¿™æ ·æ‰è¦ç”¨Xshellå·¥å…·æ¥è¿œç¨‹ï¼Œå¾—å…ˆé…ç½®ipï¼Œå¿ä¸€å¿å§ï¼‰ï¼Œå›è½¦ã€‚ æˆ‘è¿™é‡Œæ˜¾ç¤ºçš„æ˜¯ifcfg-ens33ï¼Œè¿™é‡Œè¦è¯´ä¸€ä¸‹ï¼Œæˆ‘ç™¾åº¦è¿‡ï¼Œæœ‰äº›æ˜¯32ï¼Œä¹Ÿæœ‰1667777ï¼Œå…ˆç”¨cd /etc/sysconfig/network-scripts/è¿›å…¥ç›®å½•ï¼Œç„¶ållæ˜¾ç¤ºåˆ—è¡¨ï¼ˆlsä¹Ÿå¯ä»¥æ˜¾ç¤ºåˆ—è¡¨ï¼Œåªæ˜¾ç¤ºåˆ—è¡¨åï¼‰ã€‚ ç¼–è¾‘ifcfg-ens33ï¼švi ifcfg-ens33ï¼ˆviï¼šè¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œæ–‡ä»¶ååˆ«æ•²é”™ã€‚ï¼‰ï¼Œå›è½¦ã€‚ æŒ‰ i å­—æ¯é”®è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼ˆå¦‚æœä¸æ˜¾ç¤ºä¸‹å›¾çš„ï¼Œè‚¯å®šæ˜¯vi ifcfg-ens33è¾“å…¥é”™äº†ï¼Œè‡ªå·±æ£€æŸ¥ä¸€ä¸‹ï¼Œé€€å‡ºviæ–¹æ³•ï¼šæŒ‰Escï¼ˆæ³¨æ„å·¦ä¸‹è§’ï¼‰ï¼Œè¾“å…¥:q!ï¼ˆä¸ä¿å­˜é€€å‡ºï¼‰ï¼‰ã€‚ çœ‹å›¾ 1234#è™šæ‹ŸæœºIPç›¸åŒï¼Œä½†æ˜¯IPADDRåä¸‰ä½åœ¨3~240ä¹‹é—´é€‰æ‹©IPADDR=192.168.157.103NETMASK=255.255.255.0GATEWAY=192.168.157.2 ä¿å­˜å¹¶é€€å‡ºï¼šæŒ‰Escé”®ï¼Œç„¶åè¾“å…¥:wqï¼ˆå¿…é¡»å°å†™ï¼‰ï¼Œå›è½¦ã€‚ é‡å¯ç½‘ç»œï¼šsystemctl restart networkï¼Œå›è½¦ã€‚ æŸ¥çœ‹ipï¼šip addrï¼Œ å›è½¦ã€‚ é…ç½®æœ¬åœ°çš„ç½‘ç»œï¼ˆåªéœ€è¦é…ç½®ä¸€æ¬¡ï¼‰ è¿™æ˜¯æœ¬åœ°è®¿é—®è™šæ‹Ÿæœºè¦é…ç½®çš„ 12#é€‰æ‹©ä½¿ç”¨ä¸‹é¢çš„IPåœ°å€,æœ€åä¸€ä½ä¸º 1 ï¼Œå­ç½‘æ©ç è‡ªåŠ¨ç”ŸæˆIP=192.168.157.1 ä½¿ç”¨Xshellè¿æ¥è™šæ‹ŸæœºæœåŠ¡å™¨ æ–°å»ºä¼šè¯ï¼Œè¿™é‡Œéš§é“è¦å–æ¶ˆè½¬å‘X11è¿æ¥åˆ°ï¼š æ–°å»ºä¼šè¯ï¼Œè¾“å…¥IPADDRåç§°192.168.157.103ï¼ˆè¾“å…¥åç§°åï¼Œä¸‹é¢çš„ä¸»æœºä¹Ÿæ˜¯åŒæ­¥çš„ã€‚ï¼‰ï¼Œç„¶åç‚¹å‡»è¿æ¥ã€‚ å‡ºç°è¿™ä¸ªå¼¹çª—å°±è¯´æ˜99.99%æˆåŠŸäº†ï¼Œå¦‚æœæ²¡æœ‰å°±è¯´æ˜æœ¬åœ°ç½‘ç»œé…ç½®å‡ºé”™ è¾“å…¥ç”¨æˆ·årootã€‚ è¾“å…¥ç”¨æˆ·å123456ã€‚ okayã€‚ å®‰è£…å®å¡”é¢æ¿ å®å¡”å®˜ç½‘ï¼šhttps://www.bt.cn/ å®å¡”Linuxé¢æ¿å‘½ä»¤å¤§å…¨ï¼šhttps://www.bt.cn/btcode.htmlï¼ˆä¸€å®šè¦å¤šçœ‹ï¼‰ è¿™é‡Œæ ‡æ³¨å‡ ä¸ªå¸¸ç”¨çš„å‘½ä»¤ï¼ˆæœ¬æ–‡ç« ç”¨åˆ°çš„ï¼‰ï¼šcdã€clearï¼ˆæ¸…å±ï¼Œä¹Ÿå¯ä»¥ç”¨Ctrl+Lï¼‰ã€llï¼ˆå½“å‰åˆ—è¡¨ï¼Œè¯¦ç»†çš„å±•ç¤ºåˆ—è¡¨ï¼‰ï¼Œlsï¼ˆå½“å‰åˆ—è¡¨ï¼Œç®€æ´çš„å±•ç¤ºåˆ—è¡¨ï¼‰ã€vi æ–‡ä»¶åï¼ˆç¼–è¾‘æ–‡ä»¶ï¼ŒæŒ‰Escï¼š:wqä¿å­˜å¹¶é€€å‡ºã€:qï¼ˆé€€å‡ºï¼‰ã€:q!å¼ºåˆ¶ä¸ä¿å­˜å¹¶é€€å‡ºï¼‰ã€‚ å®‰è£… å®‰è£…è„šæœ¬ï¼šyum install -y wget &amp;&amp; wget -O install.sh http://download.bt.cn/install/install_6.0.sh &amp;&amp; sh install.sh PSï¼šæ­¤è„šæœ¬ä»å®˜æ–¹å¤åˆ¶è¿‡æ¥çš„æ—¶é—´ä¸º2020å¹´6æœˆ19æ—¥ï¼Œä»…é™CentOsç³»ç»Ÿï¼Œå¦‚æœè·ç¦»å·²ä¹…ï¼Œè¯·åˆ°å®˜ç½‘å¤åˆ¶ã€‚ å³é”®éšæ„å¤åˆ¶ç²˜è´´ï¼ŒXshellå·¥å…·çš„å¥½å¤„ï¼ˆä½›ä¸»ï¼šhttps://www.kancloud.cn/jiangguowu/kfjsdkfjskd/1076752ï¼‰ã€‚ DO you want to install Bt Panel tothe /www directory now?(y/n):ï¼ˆç°åœ¨æ˜¯å¦è¦å°†Bté¢æ¿å®‰è£…åˆ°/wwwç›®å½•ï¼Ÿï¼ˆæ˜¯/å¦ï¼‰ï¼šï¼‰ã€‚ æŒ‰yï¼Œå›è½¦ã€‚ å®å¡”é¢æ¿è®¿é—®åœ°å€ï¼šhttp://192.168.157.103:8888/7a81976fï¼Œ119.137.3.117æ¢æˆ192.168.157.103è‡ªå·±è®¾ç½®çš„æœåŠ¡å™¨ipï¼ˆåˆ«å‚»äº†ï¼Œåªæœ‰æœ¬åœ°æ‰èƒ½è®¿é—®ï¼‰ã€‚ username: yq0g4uxd password: c937d4a9 ç‚¹å‡»ä¸€é”®å®‰è£…ï¼ˆä¹Ÿå¯ä»¥ä¸é€‰æ‹©ï¼Œç„¶åè‡ªå·±å»å·¦è¾¹çš„è½¯ä»¶å•†åº—è‡ªå·±é€‰æ‹©å®‰è£…ï¼‰ã€‚ å»ºè®®è®¾ç½®ä¸€ä¸‹å®‰å…¨å…¥å£ã€é¢æ¿ç”¨æˆ·ã€é¢æ¿å¯†ç ï¼ˆåªèƒ½è®¾ç½®8ä½æ•°ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘å¼ºè¡Œä½¿ç”¨å‘½ä»¤è¡Œå°†å¯†ç è®¾ç½®ä¸º123456ï¼Œå‘½ä»¤ï¼šcd /www/server/panel &amp;&amp; python tools.py panel 123456ï¼Œæ›´å¤šçš„å®å¡”å‘½ä»¤è¯·åˆ°å®å¡”Linuxé¢æ¿å‘½ä»¤å¤§å…¨æŸ¥çœ‹ï¼šhttps://www.bt.cn/btcode.htmlï¼‰ å‚è€ƒé“¾æ¥ï¼š é…ç½®æ­¥éª¤ï¼š https://www.cnblogs.com/langting/p/13167539.html https://blog.langting.top/archives/117.html è™šæ‹Ÿæœºç½‘ç»œç›¸å…³é—®é¢˜çš„è§£å†³ https://blog.csdn.net/weixin_44080445/article/details/110714332","categories":[{"name":"Webå¼€å‘","slug":"Webå¼€å‘","permalink":"http://kaillliu.github.io/categories/Web%E5%BC%80%E5%8F%91/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://kaillliu.github.io/tags/Java/"},{"name":"Centos","slug":"Centos","permalink":"http://kaillliu.github.io/tags/Centos/"},{"name":"è™šæ‹Ÿæœº","slug":"è™šæ‹Ÿæœº","permalink":"http://kaillliu.github.io/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"},{"name":"Linux","slug":"Linux","permalink":"http://kaillliu.github.io/tags/Linux/"}]},{"title":"è®¾è®¡æ¨¡å¼æ€»è§ˆ","slug":"è®¾è®¡æ¨¡å¼","date":"2022-04-12T09:27:23.000Z","updated":"2022-04-12T11:05:30.789Z","comments":true,"path":"2022/04/12/è®¾è®¡æ¨¡å¼/","link":"","permalink":"http://kaillliu.github.io/2022/04/12/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/","excerpt":"","text":"ä¹¦æœ¬ç½‘ç›˜é“¾æ¥ğŸ˜€ é“¾æ¥ï¼šhttps://pan.baidu.com/s/1KU0Ik8WTDn5fwBGvDd5dQw?pwd=rlye æå–ç ï¼šrlye CSDNæ€»ç»“ï¼š https://blog.csdn.net/cooldragon/article/details/52164380 èŒƒå›´ åˆ›å»ºå‹ ç»“æ„å‹ è¡Œä¸ºå‹ ç±» Factory Methodï¼ˆå·¥å‚æ–¹æ³•ï¼‰ Adapter(ç±»)ï¼ˆé€‚é…å™¨ï¼‰ Interpreterï¼ˆè§£é‡Šå™¨ï¼‰Template Methodï¼ˆæ¨¡ç‰ˆæ–¹æ³•ï¼‰ å¯¹è±¡ Abstract Factoryï¼ˆæŠ½è±¡å·¥å‚ï¼‰Builderï¼ˆå»ºé€ è€…ï¼‰Prototypeï¼ˆåŸå‹ï¼‰Singletonï¼ˆå•ä¾‹ï¼‰ Adapter(å¯¹è±¡)ï¼ˆé€‚é…å™¨)Bridgeï¼ˆæ¡¥æ¥ï¼‰Compositeï¼ˆç»„åˆï¼‰Decoratorï¼ˆè£…é¥°è€…ï¼‰FaÃ§adeï¼ˆå¤–è§‚ï¼‰Flyweightï¼ˆäº«å…ƒï¼‰Proxyï¼ˆä»£ç†ï¼‰ Chain of Responsibilityï¼ˆèŒè´£é“¾ï¼‰CoMmandï¼ˆå‘½ä»¤ï¼‰Iteratorï¼ˆè¿­ä»£å™¨ï¼‰Mediatorï¼ˆä¸­ä»‹è€…ï¼‰Mementoï¼ˆå¤‡å¿˜å½•ï¼‰Observerï¼ˆè§‚å¯Ÿè€…ï¼‰Stateï¼ˆçŠ¶ä½“ï¼‰Strategyï¼ˆç­–ç•¥ï¼‰Visitorï¼ˆè®¿é—®è€…ï¼‰","categories":[{"name":"è®¡ç®—æœºåŸºç¡€","slug":"è®¡ç®—æœºåŸºç¡€","permalink":"http://kaillliu.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://kaillliu.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"è®¡ç®—æœºåŸºç¡€","slug":"è®¡ç®—æœºåŸºç¡€","permalink":"http://kaillliu.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"}]},{"title":"è®¾è®¡æ¨¡å¼ç¬”è®°ä¹‹Adapterï¼ˆé€‚é…å™¨ï¼‰æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼ç¬”è®°ä¹‹Adapterï¼ˆé€‚é…å™¨ï¼‰æ¨¡å¼","date":"2022-04-02T05:36:59.000Z","updated":"2022-05-23T05:41:22.999Z","comments":true,"path":"2022/04/02/è®¾è®¡æ¨¡å¼ç¬”è®°ä¹‹Adapterï¼ˆé€‚é…å™¨ï¼‰æ¨¡å¼/","link":"","permalink":"http://kaillliu.github.io/2022/04/02/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%AC%94%E8%AE%B0%E4%B9%8BAdapter%EF%BC%88%E9%80%82%E9%85%8D%E5%99%A8%EF%BC%89%E6%A8%A1%E5%BC%8F/","excerpt":"","text":"ä¹¦æœ¬ç½‘ç›˜é“¾æ¥ğŸ˜€ é“¾æ¥ï¼šhttps://pan.baidu.com/s/1KU0Ik8WTDn5fwBGvDd5dQw?pwd=rlye æå–ç ï¼šrlye Adapterï¼ˆé€‚é…å™¨ï¼‰æ¨¡å¼ æ„å›¾ å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå¦å¤–ä¸€ä¸ªå®¢æˆ·å¸Œæœ›çš„æ¥å£ã€‚Adapter æ¨¡å¼ä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚ æ³¨ï¼šé€‚é…å™¨æ¨¡å¼åœ¨è¯¦ç»†è®¾è®¡é˜¶æ®µä¸éœ€è¦è€ƒè™‘å®ƒï¼Œå®ƒæ˜¯ä¸ºäº†å¯¹ç°æœ‰ç³»ç»Ÿæˆ–äº§å“æ¥å£å…¼å®¹æ—¶ï¼Œä¹Ÿå°±æ˜¯æ—¢æˆäº‹å®çš„æƒ…å†µä¸‹çš„è¡¥æ•‘æªæ–½ã€‚ é€‚ç”¨æ€§ ä½ æƒ³ä½¿ç”¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç±»ï¼Œè€Œå®ƒçš„æ¥å£ä¸ç¬¦åˆä½ çš„éœ€æ±‚ã€‚ ä½ æƒ³åˆ›å»ºä¸€ä¸ªå¯ä»¥å¤ç”¨çš„ç±»ï¼Œè¯¥ç±»å¯ä»¥ä¸å…¶ä»–ä¸ç›¸å…³çš„ç±»æˆ–ä¸å¯é¢„è§çš„ç±»ï¼ˆå³é‚£äº›æ¥å£å¯èƒ½ä¸ä¸€å®šå…¼å®¹çš„ç±»ï¼‰ååŒå·¥ä½œã€‚ ï¼ˆä»…é€‚ç”¨äºå¯¹è±¡Adapterï¼‰ä½ æƒ³ä½¿ç”¨ä¸€äº›å·²ç»å­˜åœ¨çš„å­ç±»ï¼Œä½†æ˜¯ä¸å¯èƒ½å¯¹æ¯ä¸€ä¸ªéƒ½è¿›è¡Œå­ç±»åŒ–ä»¥åŒ¹é…å®ƒä»¬çš„æ¥å£ã€‚å¯¹è±¡é€‚é…å™¨å¯ä»¥é€‚é…å®ƒçš„çˆ¶ç±»æ¥å£ã€‚ ç»“æ„ ç±»é€‚é…å™¨æ¨¡å¼ å¯¹è±¡é€‚é…å™¨æ¨¡å¼ ç™»åœºè§’è‰² **Target (ç›®æ ‡è§’è‰² å¯¹è±¡ï¼Œè¦ç”¨çš„æ¥å£) ** å®šä¹‰Clientæ‰€éœ€çš„æ–¹æ³•ã€‚ **Client (ä½¿ç”¨åœºæ™¯ è¯·æ±‚è€…) ** ä¸ç¬¦åˆTargetæ¥å£çš„å¯¹è±¡ååŒï¼Œä½¿ç”¨Targetè§’è‰²å®šä¹‰çš„æ–¹æ³•è¿›è¡Œå…·ä½“å¤„ç†ã€‚ **Adaptee (è¢«é€‚é…) ** å®šä¹‰ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ¥è§’è‰²ï¼Œè¿™ä¸ªè§’è‰²éœ€è¦é€‚é…ã€‚ Adapter (é€‚é…å™¨ï¼ŒæŠŠAdapteeæ¥å£è½¬æ¢ä¸ºTargetå¯ç”¨çš„æ¥å£) å¯¹Adapteeçš„æ¥å£ä¸Targetæ¥å£è¿›è¡Œé€‚é… ä¼˜ç‚¹ å¯ä»¥è®©ä¸¤ä¸ªæ²¡æœ‰ä»»ä½•å…³ç³»çš„ç±»åœ¨ä¸€èµ·è¿è¡Œï¼Œåªè¦é€‚é…å™¨è¿™ä¸ªè§’è‰²èƒ½å¤Ÿæå®šä»–ä»¬å°±æˆã€‚ å¢åŠ äº†ç±»çš„é€æ˜æ€§ æé«˜äº†ç±»çš„å¤ç”¨åº¦ çµæ´»æ€§éå¸¸å¥½","categories":[{"name":"è®¡ç®—æœºåŸºç¡€","slug":"è®¡ç®—æœºåŸºç¡€","permalink":"http://kaillliu.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://kaillliu.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"è®¡ç®—æœºåŸºç¡€","slug":"è®¡ç®—æœºåŸºç¡€","permalink":"http://kaillliu.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"}]},{"title":"è®¾è®¡æ¨¡å¼ç¬”è®°ä¹‹Factory Methodï¼ˆå·¥å‚æ–¹æ³•ï¼‰æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼ç¬”è®°ä¹‹Factoryï¼ˆå·¥å‚ï¼‰æ¨¡å¼","date":"2022-04-02T05:36:59.000Z","updated":"2022-05-23T05:41:22.939Z","comments":true,"path":"2022/04/02/è®¾è®¡æ¨¡å¼ç¬”è®°ä¹‹Factoryï¼ˆå·¥å‚ï¼‰æ¨¡å¼/","link":"","permalink":"http://kaillliu.github.io/2022/04/02/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%AC%94%E8%AE%B0%E4%B9%8BFactory%EF%BC%88%E5%B7%A5%E5%8E%82%EF%BC%89%E6%A8%A1%E5%BC%8F/","excerpt":"","text":"ä¹¦æœ¬ç½‘ç›˜é“¾æ¥ğŸ˜€ é“¾æ¥ï¼šhttps://pan.baidu.com/s/1KU0Ik8WTDn5fwBGvDd5dQw?pwd=rlye æå–ç ï¼šrlye Factory Methodï¼ˆå·¥å‚æ–¹æ³•ï¼‰æ¨¡å¼ æ„å›¾ å®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ã€‚Factory Method ä½¿ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å…¶å­ç±»ã€‚ é€‚ç”¨æ€§ â€¢ å½“ä¸€ä¸ªç±»ä¸çŸ¥é“å®ƒæ‰€å¿…é¡»åˆ›å»ºçš„å¯¹è±¡çš„ç±»çš„æ—¶å€™ã€‚ â€¢ å½“ä¸€ä¸ªç±»å¸Œæœ›ç”±å®ƒçš„å­ç±»æ¥æŒ‡å®šå®ƒæ‰€åˆ›å»ºçš„å¯¹è±¡çš„æ—¶å€™ã€‚ â€¢ å½“ç±»å°†åˆ›å»ºå¯¹è±¡çš„èŒè´£å§”æ‰˜ç»™å¤šä¸ªå¸®åŠ©å­ç±»ä¸­çš„æŸä¸€ä¸ªï¼Œå¹¶ä¸”ä½ å¸Œæœ›å°†å“ªä¸€ä¸ªå¸®åŠ©å­ç±»æ˜¯ä»£ç†è€…è¿™ä¸€ä¿¡æ¯å±€éƒ¨åŒ–çš„æ—¶å€™ã€‚ ç»“æ„ ç™»åœºè§’è‰² Product äº§å“ å®šä¹‰å·¥å‚æ–¹æ³•æ‰€åˆ›å»ºçš„å¯¹è±¡çš„æ¥å£ã€‚ Creator åˆ›å»ºè€… å£°æ˜å·¥å‚æ–¹æ³•,è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª Productç±»å‹çš„å¯¹è±¡ã€‚ Creatorä¹Ÿå¯ä»¥å®šä¹‰ä¸€ä¸ªå·¥å‚æ–¹ æ³•çš„ç¼ºçœå®ç°,å®ƒè¿”å›ä¸€ä¸ªç¼ºçœçš„ ConcreteProductå¯¹è±¡ã€‚ ConcreteProduct å…·ä½“çš„äº§å“ å†³å®šäº†å…·ä½“çš„äº§å“ï¼Œå®ç°Productæ¥å£ã€‚ ConcreteCreator å…·ä½“çš„åˆ›å»ºè€… è´Ÿè´£ç”Ÿæˆå…·ä½“çš„äº§å“ï¼Œé‡å®šä¹‰å·¥å‚æ–¹æ³•ä»¥è¿”å›ä¸€ä¸ª ConcreteProductå®ä¾‹ã€‚ ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼š é¦–å…ˆï¼Œè‰¯å¥½çš„å°è£…æ€§ï¼Œä»£ç ç»“æ„æ¸…æ™°ã€‚ä¸€ä¸ªå¯¹è±¡åˆ›å»ºæ˜¯æœ‰æ¡ä»¶çº¦æŸçš„ï¼Œå¦‚ä¸€ä¸ªè°ƒç”¨è€…éœ€è¦ä¸€ä¸ªå…·ä½“çš„äº§å“å¯¹è±¡ï¼Œåªè¦çŸ¥é“è¿™ä¸ªäº§å“çš„ç±»åï¼ˆæˆ–çº¦æŸå­—ç¬¦ä¸²ï¼‰å°±å¯ä»¥äº†ï¼Œä¸ç”¨çŸ¥é“åˆ›å»ºå¯¹è±¡çš„è‰°è¾›è¿‡ç¨‹ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆã€‚ å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯å…¸å‹çš„è§£è€¦æ¡†æ¶ã€‚é«˜å±‚æ¨¡å—åªéœ€è¦çŸ¥é“äº§å“çš„æŠ½è±¡ç±»ï¼Œå…¶ä»–çš„å®ç°ç±»éƒ½ä¸ç”¨å…³å¿ƒï¼Œç¬¦åˆè¿ªç±³ç‰¹æ³•åˆ™ï¼Œæˆ‘ä¸éœ€è¦çš„å°±ä¸è¦å»äº¤æµï¼›ä¹Ÿç¬¦åˆä¾èµ–å€’ç½®åŸåˆ™ï¼Œåªä¾èµ–äº§å“ç±»çš„æŠ½è±¡ï¼›å½“ç„¶ä¹Ÿç¬¦åˆé‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œå¯ä»¥ä½¿ç”¨äº§å“å­ç±»æ›¿æ¢äº§å“çˆ¶ç±»ã€‚","categories":[{"name":"è®¡ç®—æœºåŸºç¡€","slug":"è®¡ç®—æœºåŸºç¡€","permalink":"http://kaillliu.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://kaillliu.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"è®¡ç®—æœºåŸºç¡€","slug":"è®¡ç®—æœºåŸºç¡€","permalink":"http://kaillliu.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"}]},{"title":"è®¾è®¡æ¨¡å¼ç¬”è®°ä¹‹Iteratorï¼ˆè¿­ä»£å™¨ï¼‰æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼ç¬”è®°ä¹‹Iteratorï¼ˆè¿­ä»£å™¨ï¼‰æ¨¡å¼","date":"2022-04-02T05:36:59.000Z","updated":"2022-05-23T05:41:22.939Z","comments":true,"path":"2022/04/02/è®¾è®¡æ¨¡å¼ç¬”è®°ä¹‹Iteratorï¼ˆè¿­ä»£å™¨ï¼‰æ¨¡å¼/","link":"","permalink":"http://kaillliu.github.io/2022/04/02/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%AC%94%E8%AE%B0%E4%B9%8BIterator%EF%BC%88%E8%BF%AD%E4%BB%A3%E5%99%A8%EF%BC%89%E6%A8%A1%E5%BC%8F/","excerpt":"","text":"ä¹¦æœ¬ç½‘ç›˜é“¾æ¥ğŸ˜€ é“¾æ¥ï¼šhttps://pan.baidu.com/s/1KU0Ik8WTDn5fwBGvDd5dQw?pwd=rlye æå–ç ï¼šrlye Iteratorï¼ˆè¿­ä»£å™¨ï¼‰æ¨¡å¼ æ„å›¾ æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­å„ä¸ªå…ƒç´ , è€Œåˆä¸éœ€æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºï¼Œå³ä¸ºéå†å’Œå®ç°å¯ä»¥åˆ†ç¦»å¼€æ¥ã€‚ é€‚ç”¨æ€§ è®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡çš„å†…å®¹è€Œæ— éœ€æš´éœ²å®ƒçš„å†…éƒ¨è¡¨ç¤ºã€‚ æ”¯æŒå¯¹èšåˆå¯¹è±¡çš„å¤šç§éå†ã€‚ ä¸ºéå†ä¸åŒçš„èšåˆç»“æ„æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ï¼ˆå³, æ”¯æŒå¤šæ€è¿­ä»£ï¼‰ã€‚ ç»“æ„ ç™»åœºè§’è‰² Iterator è¿­ä»£å™¨ è´Ÿè´£å®šä¹‰è®¿é—®å’Œéå†å…ƒç´ çš„æ¥å£ï¼ˆAPIï¼‰ã€‚ Concretelterator å…·ä½“çš„è¿­ä»£å™¨ è´Ÿè´£å®ç°Iteratorè§’è‰²æ‰€å®šä¹‰çš„æ¥å£ï¼ˆAPIï¼‰ã€‚ Aggregate é›†åˆ é›†åˆå®šä¹‰åˆ›å»ºIteratorè§’è‰²çš„æ¥å£ï¼Œåœ¨ç¤ºä¾‹ç¨‹åºä¸­ï¼Œç”±Aggregateæ¥å£æ‰®æ¼”æ­¤è§’è‰²ï¼Œé‡Œé¢å®šä¹‰äº†Iteratoræ–¹æ³•ã€‚ ConcreteAggregate å…·ä½“çš„é›†åˆ è´Ÿè´£å®ç°Aggregateè§’è‰²æ‰€å®šä¹‰çš„æ¥å£ã€‚","categories":[{"name":"è®¡ç®—æœºåŸºç¡€","slug":"è®¡ç®—æœºåŸºç¡€","permalink":"http://kaillliu.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://kaillliu.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"è®¡ç®—æœºåŸºç¡€","slug":"è®¡ç®—æœºåŸºç¡€","permalink":"http://kaillliu.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"}]},{"title":"è®¾è®¡æ¨¡å¼ç¬”è®°ä¹‹Template Methodï¼ˆæ¨¡æ¿æ–¹æ³•ï¼‰æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼ç¬”è®°ä¹‹Templateï¼ˆæ¨¡æ¿æ–¹æ³•ï¼‰æ¨¡å¼","date":"2022-04-02T05:36:59.000Z","updated":"2022-05-23T05:41:22.939Z","comments":true,"path":"2022/04/02/è®¾è®¡æ¨¡å¼ç¬”è®°ä¹‹Templateï¼ˆæ¨¡æ¿æ–¹æ³•ï¼‰æ¨¡å¼/","link":"","permalink":"http://kaillliu.github.io/2022/04/02/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%AC%94%E8%AE%B0%E4%B9%8BTemplate%EF%BC%88%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%EF%BC%89%E6%A8%A1%E5%BC%8F/","excerpt":"","text":"ä¹¦æœ¬ç½‘ç›˜é“¾æ¥ğŸ˜€ é“¾æ¥ï¼šhttps://pan.baidu.com/s/1KU0Ik8WTDn5fwBGvDd5dQw?pwd=rlye æå–ç ï¼šrlye Template Methodï¼ˆæ¨¡æ¿æ–¹æ³•ï¼‰æ¨¡å¼ æ„å›¾ å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­çš„ç®—æ³•çš„éª¨æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚Template Methodä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚ é€‚ç”¨æ€§ ä¸€æ¬¡æ€§å®ç°ä¸€ä¸ªç®—æ³•çš„ä¸å˜çš„éƒ¨åˆ†ï¼Œå¹¶å°†å¯å˜çš„è¡Œä¸ºç•™ç»™å­ç±»æ¥å®ç°ã€‚ å„å­ç±»ä¸­å…¬å…±çš„ è¡Œä¸ºåº”è¢«æå–å‡ºæ¥å¹¶é›†ä¸­åˆ°ä¸€ä¸ªå…¬å…±çˆ¶ç±»ä¸­ä»¥é¿å…ä»£ç é‡å¤ã€‚è¿™æ˜¯Opdykeå’ŒJohnsonæ‰€æè¿°è¿‡çš„â€œé‡åˆ†è§£ä»¥ä¸€èˆ¬åŒ–â€çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚é¦–å…ˆè¯†åˆ«ç°æœ‰ ä»£ç ä¸­çš„ä¸åŒä¹‹å¤„ï¼Œå¹¶ä¸”å°†ä¸åŒä¹‹å¤„åˆ†ç¦»ä¸ºæ–°çš„æ“ä½œã€‚æœ€åï¼Œç”¨ä¸€ä¸ªè°ƒç”¨è¿™äº›æ–°çš„æ“ä½œçš„æ¨¡æ¿æ–¹æ³•æ¥æ›¿æ¢è¿™äº›ä¸åŒçš„ä»£ç ã€‚ æ§åˆ¶å­ç±»æ‰©å±•ã€‚æ¨¡æ¿æ–¹æ³•åªåœ¨ç‰¹å®šç‚¹è°ƒç”¨â€œhookâ€æ“ä½œï¼Œè¿™æ ·å°±åªå…è®¸åœ¨è¿™äº›ç‚¹è¿›è¡Œæ‰©å±•ã€‚ ç»“æ„ ç™»åœºè§’è‰² **AbstractClass(æŠ½è±¡ç±») ** è´Ÿè´£å®ç°æ¨¡æ¿æ–¹æ³•ï¼Œå£°æ˜åœ¨æ¨¡æ¿æ–¹æ³•ä¸­æ‰€ä½¿ç”¨åˆ°çš„æŠ½è±¡æ–¹æ³•ã€‚è¿™äº›æŠ½è±¡æ–¹æ³•ç”±å­ç±»ConcreteClassè§’è‰²è´Ÿè´£å®ç°ã€‚ **ConcreteClass(å…·ä½“ç±») ** è´Ÿè´£å…·ä½“å®ç°AbstractClassè§’è‰²ä¸­å®šä¹‰çš„æŠ½è±¡æ–¹æ³•ã€‚ ä¼˜ç‚¹ å°è£…ä¸å˜éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ† æŠŠè®¤ä¸ºæ˜¯ä¸å˜éƒ¨åˆ†çš„ç®—æ³•å°è£…åˆ°çˆ¶ç±»å®ç°ï¼Œè€Œå¯å˜éƒ¨åˆ†çš„åˆ™å¯ä»¥é€šè¿‡ç»§æ‰¿æ¥ç»§ç»­æ‰©å±•ã€‚åœ¨æ‚é©¬æ¨¡å‹ä¾‹å­ä¸­ï¼Œæ˜¯ä¸æ˜¯å°±éå¸¸å®¹æ˜“æ‰©å±•ï¼Ÿä¾‹å¦‚å¢åŠ ä¸€ä¸ªH3å‹å·çš„æ‚é©¬æ¨¡å‹ï¼Œå¾ˆå®¹æ˜“å‘€ï¼Œå¢åŠ ä¸€ä¸ªå­ç±»ï¼Œå®ç°çˆ¶ç±»çš„åŸºæœ¬æ–¹æ³•å°±å¯ä»¥äº†ã€‚ æå–å…¬å…±éƒ¨åˆ†ä»£ç ï¼Œä¾¿äºç»´æŠ¤ æˆ‘ä»¬ä¾‹å­ä¸­åˆšåˆšèµ°è¿‡çš„å¼¯è·¯å°±æ˜¯æœ€å¥½çš„è¯æ˜ï¼Œå¦‚æœæˆ‘ä»¬ä¸æŠ½å–åˆ°çˆ¶ç±»ä¸­ï¼Œä»»ç”±è¿™ç§æ•£ä¹±çš„ä»£ç å‘ç”Ÿï¼Œæƒ³æƒ³åæœæ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿç»´æŠ¤äººå‘˜ä¸ºäº†ä¿®æ­£ä¸€ä¸ªç¼ºé™·ï¼Œéœ€è¦åˆ°å¤„æŸ¥æ‰¾ç±»ä¼¼çš„ä»£ç ï¼ è¡Œä¸ºç”±çˆ¶ç±»æ§åˆ¶ï¼Œå­ç±»å®ç° åŸºæœ¬æ–¹æ³•æ˜¯ç”±å­ç±»å®ç°çš„ï¼Œå› æ­¤å­ç±»å¯ä»¥é€šè¿‡æ‰©å±•çš„æ–¹å¼å¢åŠ ç›¸åº”çš„åŠŸèƒ½ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚ æ€è€ƒ ä¹ é¢˜3-2 123public final void diaplay()&#123; ...&#125; AbstractDisplayç±»ä¸­ä½¿ç”¨final è¡¨ç¤ºå­ç±»æ— æ³•é‡å†™displayæ–¹æ³•ã€‚ ä¸è¦é‡å†™æ¨¡æ¿æ–¹æ³• ä¹ é¢˜3-4 Javaä¸ºä»€ä¹ˆä¸ç”¨æ¥å£ä»£æ›¿æŠ½è±¡ç±»ï¼Ÿ å› ä¸ºæ­¤æ¨¡å¼ä¸‹AbstractClassè§’è‰²å¿…é¡»å®ç°éƒ¨åˆ†å¤„ç†æµç¨‹ã€‚æ¥å£æ— æ³•å®ç°","categories":[{"name":"è®¡ç®—æœºåŸºç¡€","slug":"è®¡ç®—æœºåŸºç¡€","permalink":"http://kaillliu.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://kaillliu.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"è®¡ç®—æœºåŸºç¡€","slug":"è®¡ç®—æœºåŸºç¡€","permalink":"http://kaillliu.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"}]},{"title":"Leetcode-084,085-å•è°ƒæ ˆ-æ•°ç»„ä¸­çš„æœ€å¤§çŸ©é˜µ,æœ€å¤§çŸ©é˜µ","slug":"leetcode-42-æ•°ç»„ä¸­çš„æœ€å¤§çŸ©å½¢","date":"2022-03-29T13:28:00.000Z","updated":"2022-03-31T12:00:14.287Z","comments":true,"path":"2022/03/29/leetcode-42-æ•°ç»„ä¸­çš„æœ€å¤§çŸ©å½¢/","link":"","permalink":"http://kaillliu.github.io/2022/03/29/leetcode-42-%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9C%80%E5%A4%A7%E7%9F%A9%E5%BD%A2/","excerpt":"","text":"é¢˜ç›®é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/largest-rectangle-in-histogram/ â€‹ ï¼šhttps://leetcode-cn.com/problems/maximal-rectangle/ 84. è§£æ³•ä¸€ï¼šæš´åŠ›æ±‚è§£ 123456789101112131415161718192021222324252627//æ—¶é—´å¤æ‚åº¦ä¸ºo(N^2)ï¼Œæäº¤ç»“æœè¶…æ—¶class Solution &#123; public int largestRectangleArea(int[] heights) &#123; //å®šä¹‰é•¿åº¦ï¼Œè¿”å›å€¼ int area = 0, n = heights.length; for(int i = 0; i &lt; n; i++)&#123; //ç¡®å®šå®½ int left = i; int right = i; //ç¡®å®šå·¦è¾¹ for(; left&gt;=0; left--)&#123; if(heights[left] &lt; heights[i])&#123; break; &#125; &#125; //ç¡®å®šå³è¾¹ for(; right&lt;n; right++)&#123; if(heights[right] &lt; heights[i])&#123; break; &#125; &#125; //è®¡ç®—é¢ç§¯ area = Math.max(area,(heights[i] * (right - left -1))); &#125; return area; &#125;&#125; è§£æ³•äºŒï¼šå•è°ƒæ ˆï¼Œç”¨Dequeæ•°æ®ç»“æ„ï¼ˆæ¥è‡ªè¯„è®ºåŒºå¤§ä½¬ï¼Œå¤ªå¦™äº†ï¼‰ 1234567891011121314151617181920212223public int largestRectangleArea(int[] heights) &#123; // è¿™é‡Œä¸ºäº†ä»£ç ç®€ä¾¿ï¼Œåœ¨æŸ±ä½“æ•°ç»„çš„å¤´å’Œå°¾åŠ äº†ä¸¤ä¸ªé«˜åº¦ä¸º 0 çš„æŸ±ä½“ã€‚ // arraycopy(æºï¼Œèµ·å§‹ï¼Œç›®æ ‡ï¼Œç›®æ ‡èµ·å§‹ï¼Œæºé•¿åº¦) int[] tmp = new int[heights.length + 2]; System.arraycopy(heights, 0, tmp, 1, heights.length); Deque&lt;Integer&gt; stack = new ArrayDeque&lt;&gt;(); int area = 0; for (int i = 0; i &lt; tmp.length; i++) &#123; // å¯¹æ ˆä¸­æŸ±ä½“æ¥è¯´ï¼Œæ ˆä¸­çš„ä¸‹ä¸€ä¸ªæŸ±ä½“å°±æ˜¯å…¶ã€Œå·¦è¾¹ç¬¬ä¸€ä¸ªå°äºè‡ªèº«çš„æŸ±ä½“ã€ï¼› // è‹¥å½“å‰æŸ±ä½“ i çš„é«˜åº¦å°äºæ ˆé¡¶æŸ±ä½“çš„é«˜åº¦ï¼Œè¯´æ˜ i æ˜¯æ ˆé¡¶æŸ±ä½“çš„ã€Œå³è¾¹ç¬¬ä¸€ä¸ªå°äºæ ˆé¡¶æŸ±ä½“çš„æŸ±ä½“ã€ã€‚ // iæ˜¯å³è¾¹ç•Œ // å› æ­¤ä»¥æ ˆé¡¶æŸ±ä½“ä¸ºé«˜çš„çŸ©å½¢çš„å·¦å³å®½åº¦è¾¹ç•Œå°±ç¡®å®šäº†ï¼Œå¯ä»¥è®¡ç®—é¢ç§¯ï½ //stack.peek()è·å¾—æ ˆé¡¶å…ƒç´ ï¼Œstack.pop()è·å–æ ˆé¡¶å…ƒç´ å¹¶åˆ é™¤ while (!stack.isEmpty() &amp;&amp; tmp[i] &lt; tmp[stack.peek()]) &#123; int h = tmp[stack.pop()]; area = Math.max(area, (i - stack.peek() - 1) * h); &#125; stack.push(i); &#125; return area; &#125; 85. è§£æ³• ç»™å®šä¸€ä¸ªä»…åŒ…å« 0 å’Œ 1 ã€å¤§å°ä¸º rows x cols çš„äºŒç»´äºŒè¿›åˆ¶çŸ©é˜µï¼Œæ‰¾å‡ºåªåŒ…å« 1 çš„æœ€å¤§çŸ©å½¢ï¼Œå¹¶è¿”å›å…¶é¢ç§¯ã€‚ æ€è·¯ï¼šè½¬åŒ–ä¸º84ä¸­çš„æ±‚çŸ©é˜µä¸­çš„æœ€å¤§çŸ©å½¢ï¼Œéå†ï¼Œå¯¹æ¯ä¸€è¡Œæ±‚é«˜ 123456789101112131415161718192021222324252627282930313233343536373839404142class Solution &#123; //85-æœ€å¤§çŸ©é˜µ public int maximalRectangle(char[][] matrix) &#123; if(matrix.length == 0 || matrix[0].length == 0)&#123; return 0; &#125; int col = matrix.length; int row = matrix[0].length; int[] heights = new int[row]; int result = 0; //éå†è¡Œ for(int i = 0; i &lt; col; i++)&#123; //éå†åˆ—ï¼Œæ±‚é«˜ for (int j = 0; j &lt; row; j++) &#123; if(matrix[i][j] == &#x27;1&#x27;) &#123; heights[j] += 1; &#125; else &#123; heights[j] = 0; &#125; &#125; result = Math.max(result,max(heights)); &#125; return result; &#125; //84 public int max(int[] heights)&#123; int[] temp = new int[heights.length + 2]; System.arraycopy(heights, 0, temp, 1, heights.length); Deque&lt;Integer&gt; stack = new ArrayDeque&lt;&gt;(); int area = 0; for(int i = 0; i &lt; temp.length; i++)&#123; while(!stack.isEmpty() &amp;&amp; temp[i] &lt; temp[stack.peek()] )&#123; int h = temp[stack.pop()]; area = Math.max(area,(i - stack.peek() - 1) * h); &#125; stack.push(i); &#125; return area; &#125;&#125;","categories":[{"name":"LeetCode","slug":"LeetCode","permalink":"http://kaillliu.github.io/categories/LeetCode/"}],"tags":[{"name":"Java","slug":"Java","permalink":"http://kaillliu.github.io/tags/Java/"},{"name":"LeetCode","slug":"LeetCode","permalink":"http://kaillliu.github.io/tags/LeetCode/"},{"name":"å•è°ƒæ ˆ","slug":"å•è°ƒæ ˆ","permalink":"http://kaillliu.github.io/tags/%E5%8D%95%E8%B0%83%E6%A0%88/"}]},{"title":"Hexoé…åˆGithub Pagesæ­å»ºä¸ªäººåšå®¢","slug":"HI","date":"2022-03-27T08:21:26.000Z","updated":"2022-05-23T05:41:23.080Z","comments":true,"path":"2022/03/27/HI/","link":"","permalink":"http://kaillliu.github.io/2022/03/27/HI/","excerpt":"","text":"å‰è¨€ ç›®å‰å¸‚é¢ä¸Šæœ‰æˆç†Ÿçš„çŸ¥è¯†åˆ†äº«å¹³å°ï¼Œä¾‹å¦‚CSDNã€æ˜é‡‘ç­‰ç­‰ï¼Œä¹Ÿå¯ä»¥è¢«æœç´¢å¼•æ“æ£€ç´¢åˆ°ã€‚é™¤æ­¤ä¹‹å¤–ä¹Ÿå¯ä»¥è‡ªå·±æ­å»ºä¸€ä¸ªä¸ªäººåšå®¢ç½‘ç«™ï¼Œä¸»è¦ä½¿ç”¨çš„å°±æ˜¯ Hexo + GitPage çš„æ–¹å¼ï¼Œæœ¬ç«™ä¸»è¦ä½¿ç”¨ GitHub Page + Hexoæ­å»ºé™æ€åšå®¢ç½‘ç«™ã€‚ GitHub Pages æ˜¯ä»€ä¹ˆï¼Ÿ What is GitHub Pages? - GitHub Help GitHub Pages æ˜¯ç”± GitHub å®˜æ–¹æä¾›çš„ä¸€ç§å…è´¹çš„é™æ€ç«™ç‚¹æ‰˜ç®¡æœåŠ¡ï¼Œè®©æˆ‘ä»¬å¯ä»¥åœ¨ GitHub ä»“åº“é‡Œæ‰˜ç®¡å’Œå‘å¸ƒè‡ªå·±çš„é™æ€ç½‘ç«™é¡µé¢ã€‚ Hexoæ˜¯ä»€ä¹ˆï¼Ÿ å®˜ç½‘ï¼šhexo.io Hexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„é™æ€åšå®¢æ¡†æ¶ï¼Œå®ƒåŸºäº Node.js è¿è¡Œï¼Œå¯ä»¥å°†æˆ‘ä»¬æ’°å†™çš„ Markdown æ–‡æ¡£è§£ææ¸²æŸ“æˆé™æ€çš„ HTML ç½‘é¡µã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨Hexo + GitHub Pages ä¼˜ç‚¹ï¼š ä¸»è¦æ˜¯ Hexo å®Œå…¨å…è´¹ï¼Œé™æ€ï¼Œè½»é‡å¿«é€Ÿï¼Œå¹¶ä¸”å¯ä»¥æ‰˜ç®¡åœ¨GitHubï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æ‰˜ç®¡åœ¨å›½å†…çš„Giteeé‡Œé¢ï¼Œä½†æ˜¯ä¼šéº»çƒ¦ä¸€ç‚¹ã€‚ ç¼ºç‚¹ï¼š åœ¨å›½å†…GitHubè®¿é—®é€Ÿåº¦ä¸€èˆ¬ï¼Œå‰æœŸæ­å»ºå’Œå‘å¸ƒæ–‡ç« æœ‰ç‚¹ç‚¹éº»çƒ¦ã€‚ æ­å»ºæ­¥éª¤ å®‰è£…å‡†å¤‡ åœ¨æ­å»ºåšå®¢ä¹‹å‰ï¼Œéœ€è¦ç¡®è®¤ç”µè„‘ä¸Šå·²ç»å®‰è£…å¥½äº† Git å’Œ Node.js ï¼Œç„¶åå†å®‰è£…Hexoã€‚ â€‹ Node.js å®˜ç½‘ â€‹ Git å®˜ç½‘ â€‹ Git å®‰è£…æ•™ç¨‹ â€‹ Node.js å®‰è£…æ•™ç¨‹ 12# å®‰è£…Node.jsä¹‹åä½¿ç”¨å›½å†…çš„æ·˜å®é•œåƒæºåŠ é€Ÿï¼Œå®‰è£…ä¹‹åå¯ä»¥ç”¨ cnpm ä»£æ›¿ npmnpm install -g cnpm --registry=https://registry.npm.taobao.org é“¾æ¥GitHub éœ€è¦ä¸€ä¸ªGitHubè´¦å·ï¼Œä½¿ç”¨é‚®ç®±æ³¨å†Œã€‚ é…ç½®GitHubè´¦å· 123# é…ç½®ç”¨æˆ·åå’Œé‚®ç®±git config --global user.name &quot;githubçš„ç”¨æˆ·å&quot;git config --global user.email &quot;githubçš„æ³¨å†Œé‚®ç®±&quot; åˆ›å»ºSSHå¯†é’¥ 12# ç”Ÿæˆ ssh å¯†é’¥ssh-keygen -t rsa -C &quot;githubçš„æ³¨å†Œé‚®ç®±&quot; æ·»åŠ å¯†åŒ™ï¼š è¿›å…¥ C:\\Users\\ç”¨æˆ·å\\.ssh ç›®å½•ï¼ˆè¦å‹¾é€‰æ˜¾ç¤ºâ€œéšè—çš„é¡¹ç›®â€ï¼‰ï¼Œç”¨è®°äº‹æœ¬æ‰“å¼€å…¬é’¥ id_rsa.pub æ–‡ä»¶å¹¶å¤åˆ¶é‡Œé¢çš„å†…å®¹ã€‚ ç™»é™† GitHub ï¼Œè¿›å…¥ Settings é¡µé¢ï¼Œé€‰æ‹©å·¦è¾¹æ çš„ SSH and GPG keysï¼Œç‚¹å‡» New SSH keyã€‚ Title éšä¾¿å–ä¸ªåå­—ï¼Œç²˜è´´å¤åˆ¶çš„ id_rsa.pub å†…å®¹åˆ° Key ä¸­ï¼Œç‚¹å‡» Add SSH key å®Œæˆæ·»åŠ ã€‚ éªŒè¯è¿æ¥ï¼š æ‰“å¼€ Git Bashï¼Œè¾“å…¥ ssh -T git@github.com å‡ºç° â€œAre you sureâ€¦â€¦â€ï¼Œè¾“å…¥ yes å›è½¦ç¡®è®¤ã€‚ æ˜¾ç¤º â€œHi xxx! Youâ€™ve successfullyâ€¦â€¦â€ å³è¿æ¥æˆåŠŸã€‚ æ–°å»ºGithub Pages ä»“åº“ GitHub ä¸»é¡µå³ä¸Šè§’åŠ å· -&gt; New repositoryï¼š Repository name ä¸­è¾“å…¥ ç”¨æˆ·å.github.io å‹¾é€‰ â€œInitialize this repository with a READMEâ€ Description é€‰å¡« å¡«å¥½åç‚¹å‡» Create repository åˆ›å»ºã€‚ åˆ›å»ºåé»˜è®¤è‡ªåŠ¨å¯ç”¨ HTTPSï¼Œåšå®¢åœ°å€ä¸ºï¼šhttps://ç”¨æˆ·å.github.io æœ¬åœ°å®‰è£…Hexo æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨æ¥å­˜æ”¾ Hexo çš„ç¨‹åºæ–‡ä»¶ï¼Œå¦‚ Hexo-Blogã€‚æ‰“å¼€è¯¥æ–‡ä»¶å¤¹ï¼Œå³é”® -&gt; Git Bash Hereã€‚ å®‰è£… Hexo ä½¿ç”¨ npm ä¸€é”®å®‰è£… Hexo åšå®¢ç¨‹åºï¼š 1cnpm install -g hexo-cli Hexo åˆå§‹åŒ–å’Œæœ¬åœ°é¢„è§ˆ åˆå§‹åŒ–å¹¶å®‰è£…æ‰€éœ€ç»„ä»¶ï¼š 12hexo init # åˆå§‹åŒ–cnpm install # å®‰è£…ç»„ä»¶ å®Œæˆåä¾æ¬¡è¾“å…¥ä¸‹é¢å‘½ä»¤ï¼Œå¯åŠ¨æœ¬åœ°æœåŠ¡å™¨è¿›è¡Œé¢„è§ˆï¼š 1234# hexo clean hexo g # ç”Ÿæˆé¡µé¢hexo s # å¯åŠ¨é¢„è§ˆ è®¿é—® http://localhost:4000ï¼Œå‡ºç° Hexo é»˜è®¤é¡µé¢ï¼Œæœ¬åœ°åšå®¢å®‰è£…æˆåŠŸï¼ **Tipsï¼š**å¦‚æœå‡ºç°é¡µé¢åŠ è½½ä¸å‡ºæ¥ï¼Œå¯èƒ½æ˜¯ç«¯å£è¢«å ç”¨äº†ã€‚Ctrl+C å…³é—­æœåŠ¡å™¨ï¼Œè¿è¡Œ hexo server -p 5000 æ›´æ”¹ç«¯å£å·åé‡è¯•ã€‚ Hexo åšå®¢æ–‡ä»¶å¤¹ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š éƒ¨ç½²Hexoåˆ°GitHub Pages æœ¬åœ°åšå®¢æµ‹è¯•æˆåŠŸåï¼Œå°±æ˜¯ä¸Šä¼ åˆ° GitHub è¿›è¡Œéƒ¨ç½²ï¼Œä½¿å…¶èƒ½å¤Ÿåœ¨ç½‘ç»œä¸Šè®¿é—®ã€‚ é¦–å…ˆå®‰è£… hexo-deployer-gitï¼š 1cnpm install hexo-deployer-git --save ç„¶åä¿®æ”¹ _config.yml æ–‡ä»¶æœ«å°¾çš„ Deployment éƒ¨åˆ†ï¼Œä¿®æ”¹æˆå¦‚ä¸‹ï¼š 12345# ä»“åº“åœ°å€æœ€å¥½æ˜¯sshæ–¹å¼ï¼Œä¹Ÿå¯ä»¥æ˜¯httpæ ¼å¼ï¼Œå¯ä»¥åœ¨githubä»“åº“ä¸­æŸ¥æ‰¾åˆ°deploy: type: git repository: git@github.com:ç”¨æˆ·å/ç”¨æˆ·å.github.io.git branch: master å®Œæˆåè¿è¡Œ hexo d å°†ç½‘ç«™ä¸Šä¼ éƒ¨ç½²åˆ° GitHub Pagesã€‚ å®Œæˆï¼è¿™æ—¶è®¿é—®æˆ‘ä»¬çš„ GitHub åŸŸå https://ç”¨æˆ·å.github.io å°±å¯ä»¥çœ‹åˆ° Hexo ç½‘ç«™äº†ã€‚ ç»‘å®šåŸŸåï¼ˆå¾…æ›´æ–°ï¼‰ å¼€å§‹ä½¿ç”¨ å‘å¸ƒæ–‡ç«  è¿›å…¥åšå®¢æ‰€åœ¨ç›®å½•ï¼Œå³é”®æ‰“å¼€ Git Bash Hereï¼Œåˆ›å»ºåšæ–‡ï¼š 1hexo new &quot;My New Post&quot; ç„¶å source æ–‡ä»¶å¤¹ä¸­ä¼šå‡ºç°ä¸€ä¸ª My New Post.md æ–‡ä»¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ Markdown ç¼–è¾‘å™¨åœ¨è¯¥æ–‡ä»¶ä¸­æ’°å†™æ–‡ç« äº†ã€‚ å†™å®Œåè¿è¡Œä¸‹é¢ä»£ç å°†æ–‡ç« æ¸²æŸ“å¹¶éƒ¨ç½²åˆ° GitHub Pages ä¸Šå®Œæˆå‘å¸ƒã€‚ä»¥åæ¯æ¬¡å‘å¸ƒæ–‡ç« éƒ½æ˜¯è¿™ä¸¤æ¡å‘½ä»¤ã€‚ 12hexo g # ç”Ÿæˆé¡µé¢hexo d # éƒ¨ç½²å‘å¸ƒ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨å‘½ä»¤è‡ªå·±åˆ›å»º .md æ–‡ä»¶ï¼Œåªéœ€åœ¨æ–‡ä»¶å¼€å¤´æ‰‹åŠ¨åŠ å…¥å¦‚ä¸‹æ ¼å¼ Front-matter å³å¯ï¼Œå†™å®Œåè¿è¡Œ hexo g å’Œ hexo d å‘å¸ƒã€‚ 12345678910111213---title: Hello World # æ ‡é¢˜date: 2019/3/26 hh:mm:ss # æ—¶é—´categories: # åˆ†ç±»- Diarytags: # æ ‡ç­¾- PS3- Games---æ‘˜è¦&lt;!--more--&gt;æ­£æ–‡ ç½‘ç«™è®¾ç½® åŒ…æ‹¬ç½‘ç«™åç§°ã€æè¿°ã€ä½œè€…ã€é“¾æ¥æ ·å¼ç­‰ï¼Œå…¨éƒ¨åœ¨ç½‘ç«™ç›®å½•ä¸‹çš„ _config.yml æ–‡ä»¶ä¸­ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£æŒ‰éœ€è¦ç¼–è¾‘ã€‚ æ³¨æ„ï¼šå†’å·åè¦åŠ ä¸€ä¸ªç©ºæ ¼ï¼ æ›´æ¢ä¸»é¢˜ åœ¨ Themes | Hexo é€‰æ‹©ä¸€ä¸ªå–œæ¬¢çš„ä¸»é¢˜ï¼Œæ¯”å¦‚ NexTï¼Œè¿›å…¥ç½‘ç«™ç›®å½•æ‰“å¼€ Git Bash Here ä¸‹è½½ä¸»é¢˜ï¼š 1git clone https://github.com/iissnan/hexo-theme-next themes/next ç„¶åä¿®æ”¹ _config.yml ä¸­çš„ theme ä¸ºæ–°ä¸»é¢˜åç§° nextï¼Œå‘å¸ƒã€‚ï¼ˆæœ‰çš„ä¸»é¢˜éœ€è¦å°† _config.yml æ›¿æ¢ä¸ºä¸»é¢˜è‡ªå¸¦çš„ï¼Œå‚è€ƒä¸»é¢˜è¯´æ˜ã€‚ï¼‰ å¸¸ç”¨å‘½ä»¤ 12345678hexo new &quot;name&quot; # æ–°å»ºæ–‡ç« hexo new page &quot;name&quot; # æ–°å»ºé¡µé¢hexo g # ç”Ÿæˆé¡µé¢hexo d # éƒ¨ç½²hexo g -d # ç”Ÿæˆé¡µé¢å¹¶éƒ¨ç½²hexo s # æœ¬åœ°é¢„è§ˆhexo clean # æ¸…é™¤ç¼“å­˜å’Œå·²ç”Ÿæˆçš„é™æ€æ–‡ä»¶hexo help # å¸®åŠ© PicGo + Github + fastly æ­å»ºåšå®¢å›¾åºŠ åˆ›å»ºä»“åº“ æ–°é”®ä¸€ä¸ªå›¾ç‰‡ä»“åº“ å¡«å¥½ç›¸å…³ä¿¡æ¯ è·å–token token tokençš„æ„æ€æ˜¯â€œä»¤ç‰Œâ€ï¼Œæ˜¯æœåŠ¡ç«¯ç”Ÿæˆçš„ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œä½œä¸ºå®¢æˆ·ç«¯è¿›è¡Œè¯·æ±‚çš„ä¸€ä¸ªæ ‡è¯†ã€‚ å½“ç”¨æˆ·ç¬¬ä¸€æ¬¡ç™»å½•åï¼ŒæœåŠ¡å™¨ç”Ÿæˆä¸€ä¸ªtokenå¹¶å°†æ­¤tokenè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä»¥åå®¢æˆ·ç«¯åªéœ€å¸¦ä¸Šè¿™ä¸ªtokenå‰æ¥è¯·æ±‚æ•°æ®å³å¯ï¼Œæ— éœ€å†æ¬¡å¸¦ä¸Šç”¨æˆ·åå’Œå¯†ç ã€‚æˆ‘ä»¬é€šè¿‡tokenæ¥ç¡®å®šGitHubä»“åº“çš„ä½ç½®ã€‚ ç‚¹å‡»setting Settings -&gt; Developer settings -&gt; Personal access tokensï¼Œæœ€åç‚¹å‡» generate new tokenï¼› ç‚¹å‡»ç”Ÿæˆtoken ä¿å­˜å¥½ç”Ÿæˆçš„token(ä»…æ˜¾ç¤ºä¸€æ¬¡)ï¼Œå› æ­¤æœ€å¥½å­˜æ”¾åˆ°å¤‡å¿˜å½•é‡Œé¢ã€‚ ä¸‹è½½PicGo è¿›å…¥picgoå®˜ç½‘: https://picgo.github.io/PicGo-Doc/zh/ ç‚¹å‡»å…è´¹ä¸‹è½½ï¼Œè·³è½¬åˆ°GitHubç•Œé¢ï¼Œé€‰æ‹©å¯¹åº”ç³»ç»Ÿçš„ç‰ˆæœ¬è¿›è¡Œå®‰è£… è®¾ç½®PicGo é€‰æ‹©GitHubå›¾åºŠï¼Œæ ¹æ®æç¤ºå¡«å†™ï¼Œä¿å­˜å›¾ç‰‡çš„åº“å¯ä»¥æ›´æ¢ï¼Œåªéœ€è¦æŠŠPicGoé‡Œé¢çš„ä»“åº“åå¯¹åº”æ”¹æ‰å°±è¡Œ åœ¨picgoè®¾ç½®é‡Œé¢å¯ä»¥è®¾ç½®ä¸Šä¼ çš„å¿«æ·é”®ï¼Œæ­¤å¤–ï¼Œæœ€å¥½æ‰“å¼€æ—¶é—´æˆ³é‡å‘½ååŠŸèƒ½ï¼Œé˜²æ­¢å›¾ç‰‡åå­—é‡å¤ fastlyåŠ é€Ÿ fastlyçš„å…¨ç§°æ˜¯Content Delivery Networkï¼Œå³å†…å®¹åˆ†å‘ç½‘ç»œã€‚å…¶ç›®çš„æ˜¯é€šè¿‡åœ¨ç°æœ‰çš„internetä¸­å¢åŠ ä¸€å±‚æ–°çš„ç½‘ç»œæ¶æ„ï¼Œå°†ç½‘ç«™çš„å†…å®¹å‘å¸ƒåˆ°æœ€æ¥è¿‘ç”¨æˆ·çš„ç½‘ç»œè¾¹ç¼˜ï¼Œä½¿ç”¨æˆ·å¯ä»¥å°±è¿‘å–å¾—æ‰€éœ€çš„å†…å®¹ï¼Œæé«˜ç”¨æˆ·è®¿é—®ç½‘ç«™çš„å“åº”é€Ÿåº¦ã€‚ åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©äº†å¿«é€Ÿå…è´¹å…¬æœ‰çš„fastly-jsdelivr é…ç½®æ–¹æ³•ï¼š åªéœ€è¦åœ¨æˆ‘ä»¬ PicGo å›¾åºŠé…ç½®ä¸­æ·»åŠ å¦‚ä¸‹è‡ªå®šä¹‰åŸŸåå³å¯ https://fastly.jsdelivr.net/gh/ç”¨æˆ·å/ä»“åº“å åˆ°è¿™é‡Œï¼Œä¸€ä¸ªå›¾åºŠç®—æ˜¯åŸºæœ¬æ­å»ºå¥½äº†ã€‚é€šè¿‡picgoä¸Šä¼ å›¾ç‰‡ï¼Œä¼šåœ¨GitHubåˆ›å»ºçš„ä»“åº“ä¸­ä¿å­˜ã€‚ Markdownç¼–è¾‘å™¨Typoraçš„è®¾ç½®ï¼ˆå¯é€‰ï¼‰ Markdown å®˜ç½‘ï¼šhttps://markdown.com.cn/ Markdownæ˜¯ä¸€ç§è½»é‡çº§çš„ã€Œæ ‡è®°è¯­è¨€ã€ï¼Œé€šå¸¸ä¸ºç¨‹åºå‘˜ç¾¤ä½“æ‰€ç”¨ï¼Œç›®å‰å®ƒå·²æ˜¯å…¨çƒæœ€å¤§çš„æŠ€æœ¯åˆ†äº«ç½‘ç«™ GitHub å’ŒæŠ€æœ¯é—®ç­”ç½‘ç«™ StackOverFlow çš„å¾¡ç”¨ä¹¦å†™æ ¼å¼ã€‚ markdownçš„ä¼˜ç‚¹ï¼š ä¸“æ³¨äºæ–‡å­—å†…å®¹ï¼› çº¯æ–‡æœ¬ï¼Œæ˜“è¯»æ˜“å†™ï¼Œå¯ä»¥æ–¹ä¾¿åœ°çº³å…¥ç‰ˆæœ¬æ§åˆ¶ï¼› è¯­æ³•ç®€å•ï¼Œæ²¡æœ‰ä»€ä¹ˆå­¦ä¹ æˆæœ¬ï¼Œèƒ½è½»æ¾åœ¨ç å­—çš„åŒæ—¶åšå‡ºç¾è§‚å¤§æ–¹çš„æ’ç‰ˆã€‚ Typora yporaæ˜¯ä¸€ä¸ªä¸“æ³¨äºmarkdownè¯­è¨€çš„ä¼˜ç§€ç¼–è¾‘å™¨ã€‚ å®˜ç½‘ï¼šhttps://typora.io/ æ‰“å¼€Typoraçš„åå¥½è®¾ç½®ï¼Œè®¾ç½®å¥½çº¢è‰²æ–¹æ¡†é‡Œé¢çš„å†…å®¹ï¼Œä¾¿å¯ä»¥åœ¨Typoraé‡Œé¢ç¼–å†™æ–‡ç« çš„åŒæ—¶ä¸Šä¼ å›¾ç‰‡åˆ°å›¾åºŠäº†ã€‚ å¸¸è§é—®é¢˜ è®¾ç½®ç½‘ç«™å›¾æ ‡ è¿›å…¥ themes/ä¸»é¢˜ æ–‡ä»¶å¤¹ï¼Œæ‰“å¼€ _config.yml é…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ° favicon ä¿®æ”¹ï¼Œä¸€èˆ¬æ ¼å¼ä¸ºï¼šfavicon: å›¾æ ‡åœ°å€ã€‚ï¼ˆä¸åŒä¸»é¢˜å¯èƒ½ç•¥æœ‰å·®åˆ«ï¼‰ ä¿®æ”¹å¹¶éƒ¨ç½²åæ²¡æœ‰æ•ˆæœ ä½¿ç”¨ hexo clean æ¸…ç†åé‡æ–°éƒ¨ç½²ã€‚ å¼€å¯ HTTPS åè®¿é—®ç½‘ç«™æ˜¾ç¤ºè¿æ¥ä¸å®‰å…¨ï¼Ÿ è¯ä¹¦è¿˜æœªéƒ¨ç½²ç”Ÿæ•ˆï¼Œç­‰å¾…ä¸€ä¼šå„¿ï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜å†è¯•ã€‚ Hexoéƒ¨ç½²å‡ºç°é”™è¯¯err: Error: Spawn failedè§£å†³æ–¹å¼ https://blog.csdn.net/weixin_41256398/article/details/117994899 Githubè¿æ¥å‡ºç°ssh: connect to host github.com port 22: Connection timed out é”™è¯¯ â€‹ Githubè¿æ¥å‡ºç°ssh: connect to host github.com port 22: Connection timed out é”™è¯¯ â€‹ git commitã€merge å¦‚ä½•é€€å‡ºgit bash vimç¼–è¾‘å™¨ å‚è€ƒèµ„æ–™ Easy Hexo ï¼šåŒ…æ‹¬Hexoå¿«é€Ÿå¼€å§‹ï¼Œæ¨èä¸»é¢˜ï¼Œæ’ä»¶ä½¿ç”¨ç­‰ç­‰ Butterflyï¼šæœ¬ç«™ä½¿ç”¨çš„ä¸»é¢˜ æ­å»ºæ•™ç¨‹ï¼š https://zhuanlan.zhihu.com/p/60578464 https://blog.csdn.net/github_39655029/article/details/116485386 ä½¿ç”¨sshè¿æ¥Gitä»“åº“ï¼ˆGithub) https://www.jianshu.com/p/20089411571d PicGo+GitHubå›¾åºŠæ­å»ºéƒ¨åˆ†çš„å‚è€ƒ https://zhuanlan.zhihu.com/p/350598351 https://zhuanlan.zhihu.com/p/138012354 Node.js ä½¿ç”¨æ·˜å® NPM é•œåƒçš„ç›¸å…³è¯´æ˜ https://www.twle.cn/l/yufei/nodejs/nodejs-basic-cnpm.html","categories":[{"name":"Hexo","slug":"Hexo","permalink":"http://kaillliu.github.io/categories/Hexo/"}],"tags":[{"name":"Hexo","slug":"Hexo","permalink":"http://kaillliu.github.io/tags/Hexo/"}]}],"categories":[{"name":"æ•…éšœè¯Šæ–­","slug":"æ•…éšœè¯Šæ–­","permalink":"http://kaillliu.github.io/categories/%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/"},{"name":"GitHub","slug":"GitHub","permalink":"http://kaillliu.github.io/categories/GitHub/"},{"name":"Webå¼€å‘","slug":"Webå¼€å‘","permalink":"http://kaillliu.github.io/categories/Web%E5%BC%80%E5%8F%91/"},{"name":"Java","slug":"Java","permalink":"http://kaillliu.github.io/categories/Java/"},{"name":"è®¡ç®—æœºåŸºç¡€","slug":"è®¡ç®—æœºåŸºç¡€","permalink":"http://kaillliu.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"},{"name":"LeetCode","slug":"LeetCode","permalink":"http://kaillliu.github.io/categories/LeetCode/"},{"name":"Hexo","slug":"Hexo","permalink":"http://kaillliu.github.io/categories/Hexo/"}],"tags":[{"name":"æ·±åº¦å­¦ä¹ ","slug":"æ·±åº¦å­¦ä¹ ","permalink":"http://kaillliu.github.io/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"},{"name":"CNN","slug":"CNN","permalink":"http://kaillliu.github.io/tags/CNN/"},{"name":"æ•…éšœè¯Šæ–­","slug":"æ•…éšœè¯Šæ–­","permalink":"http://kaillliu.github.io/tags/%E6%95%85%E9%9A%9C%E8%AF%8A%E6%96%AD/"},{"name":"GitHub","slug":"GitHub","permalink":"http://kaillliu.github.io/tags/GitHub/"},{"name":"Java","slug":"Java","permalink":"http://kaillliu.github.io/tags/Java/"},{"name":"Centos","slug":"Centos","permalink":"http://kaillliu.github.io/tags/Centos/"},{"name":"docket","slug":"docket","permalink":"http://kaillliu.github.io/tags/docket/"},{"name":"Linux","slug":"Linux","permalink":"http://kaillliu.github.io/tags/Linux/"},{"name":"è™šæ‹Ÿæœº","slug":"è™šæ‹Ÿæœº","permalink":"http://kaillliu.github.io/tags/%E8%99%9A%E6%8B%9F%E6%9C%BA/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"http://kaillliu.github.io/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"è®¡ç®—æœºåŸºç¡€","slug":"è®¡ç®—æœºåŸºç¡€","permalink":"http://kaillliu.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"},{"name":"LeetCode","slug":"LeetCode","permalink":"http://kaillliu.github.io/tags/LeetCode/"},{"name":"å•è°ƒæ ˆ","slug":"å•è°ƒæ ˆ","permalink":"http://kaillliu.github.io/tags/%E5%8D%95%E8%B0%83%E6%A0%88/"},{"name":"Hexo","slug":"Hexo","permalink":"http://kaillliu.github.io/tags/Hexo/"}]}